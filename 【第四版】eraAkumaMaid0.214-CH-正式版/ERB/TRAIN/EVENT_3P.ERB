;-------------------------------------------------
;多人数PLAYで用いる共通処理はここで行う
;-------------------------------------------------
;-------------------------------------------------
;３Ｐにおける指令口上の汎用部分
;-------------------------------------------------
@TRAIN_MESSAGE_3P
;同じ指令の組み合わせで連続実行
IF SELECTCOM:2 == PREVCOM:2 && SELECTCOM == PREVCOM
	IF RAND:3 == 0
		PRINTFORMW %CALLNAME:PLAYER%和%CALLNAME:(PLAYER:1)%在%CALLNAME:TARGET%身上尽情地贪图着快乐…
		RETURN 1
	ENDIF
	SELECTCASE SELECTCOM
	;挿入
	CASE 60 TO 79, 83
		PRINTFORM %CALLNAME:PLAYER%是%CALLNAME:(PLAYER:1)%
		SELECTCASE PREVCOM:2
		CASE 90, 97
			PRINTFORM 我的阴茎\@ PREVCOM:2 == 97 ?%CLO("内褲冲")% # 在手 \@下使用着
		CASE 91
			PRINTFORM 大口大口地吸着那只阴茎
		CASE 92
			PRINTFORM 像在吃馅饼一样
		CASE 96
			PRINTFORM 在责备屁股上的屁穴
		CASE 98
			PRINTFORM 用舌頭品尝着味道
		ENDSELECT
		PRINTFORMW 连续激烈地侵犯了%CALLNAME:TARGET%……
	;強制口交
	CASE 140
		PRINTFORM %CALLNAME:PLAYER%与%CALLNAME:(PLAYER:1)%对%CALLNAME:TARGET%的腰部的动作合而为一、幅度一致
		SELECTCASE PREVCOM:2
		CASE 60 TO 69
			PRINTFORM 阴道
		CASE 70 TO 79
			PRINTFORM 肛門
		CASE 83 TO 88
			PRINTFORM 尿道
		CASEELSE
			IF INSERT("Ｖ挿入", TARGET, PLAYER:1)
				PRINTFORM 阴道
			ELSEIF INSERT("Ａ挿入", TARGET, PLAYER:1)
				PRINTFORM 肛門
			ELSEIF INSERT("尿道挿入", TARGET, PLAYER:1)
				PRINTFORM 尿道
			ENDIF
		ENDSELECT
		PRINTFORMW 不断侵犯着咽喉……
	CASEELSE
		;この値は助手側の行動での分岐(PREVCOM:2での分岐と思って問題ない)
		SELECTCASE CHECK_COM("３Ｐ奉仕")
		;乳頭奸
		CASE 82
			SELECTCASE SELECTCOM
			;左右乳頭奸
			CASE 82
				PRINTFORMW %CALLNAME:PLAYER%和%CALLNAME:(PLAYER:1)%、一起做着腰的运动持续侵犯着%CALLNAME:TARGET%左右的乳頭…
			CASE 90
				PRINTFORMW %CALLNAME:TARGET%一边用胸接受%CALLNAME:(PLAYER:1)%的阴茎、一边将%CALLNAME:PLAYER%的阴茎转向自己、一边用手持续撸动着……
			CASE 91
				PRINTFORMW %CALLNAME:TARGET%的胸口接受了%CALLNAME:(PLAYER:1)%的阴茎、舌頭缠绕在%CALLNAME:PLAYER%的阴茎上……
			CASE 97
				PRINTFORMW %CALLNAME:TARGET%一边用%CLO("内褲冲")%接受%CALLNAME:(PLAYER:1)%的阴茎、一边用%CLO("内褲冲")%持续处理%CALLNAME:PLAYER%的东西…
			ENDSELECT
		CASE 90
			SELECTCASE SELECTCOM
			CASE 82
				PRINTFORMW %CALLNAME:PLAYER%持续打着手冲、%CALLNAME:(PLAYER:1)%的阴茎侵犯着%CALLNAME:TARGET%的乳頭……
			CASE 90, 97
				PRINTFORMW %CALLNAME:TARGET%让%CALLNAME:PLAYER%他们两人的阴茎转向自己的脸、灵巧地用双手不停地搓着…
			CASEELSE
				PRINTFORMW %CALLNAME:TARGET%用手玩弄着%CALLNAME:(PLAYER:1)%的阴茎、舌頭缠绕着%CALLNAME:PLAYER%的阴茎……
			ENDSELECT
		CASE 91
			SELECTCASE SELECTCOM
			CASE 82
				PRINTFORMW %CALLNAME:PLAYER%不断地侵犯了为%CALLNAME:(PLAYER:1)%的阴茎服务的%CALLNAME:TARGET%的乳頭……
			CASE 90
				PRINTFORMW %CALLNAME:TARGET%一边粘粘地舔着%CALLNAME:(PLAYER:1)%的阴茎、一边用手将%CALLNAME:PLAYER%的东西转向自己……
			CASE 97
				PRINTFORMW %CALLNAME:TARGET%一边粘粘地舔着%CALLNAME:(PLAYER:1)%的阴茎、一边用%CLO("内褲冲")%持续处理%CALLNAME:PLAYER%的东西……
			CASEELSE
				PRINTFORMW %CALLNAME:TARGET%急忙地用嘴巴照顾着%CALLNAME:PLAYER%他们两人的阴茎…
			ENDSELECT
		CASEELSE
			PRINTFORM %CALLNAME:TARGET%跨坐在%CALLNAME:(PLAYER:1)%身上、摇着腰、
			SELECTCASE SELECTCOM
			;現在はこれは死に分岐
			CASE 82
				PRINTFORMW 用乳腺接受着%CALLNAME:PLAYER%之物…
			CASE 90
				PRINTFORMW 将%CALLNAME:PLAYER%的东西转向自己、继续用手来服侍……
			CASE 97
				PRINTFORMW 在%CLO("内褲冲")%继续使用%CALLNAME:PLAYER%之物…
			CASE 91
				PRINTFORMW %CALLNAME:PLAYER%的鼻息粗暴地持续喷薄着…
			CASE 92
				PRINTFORMW 用胸口夹住%CALLNAME:PLAYER%的东西继续摩擦…
			CASE 96
				PRINTFORMW 继续用舌頭爬在%CALLNAME:PLAYER%的肛門上...
			CASE 98
				PRINTFORMW 一边舔着%CALLNAME:PLAYER%的爱液、一边用舌頭不断刺激那里……
			ENDSELECT
		ENDSELECT
	ENDSELECT
	RETURN 1
ENDIF

SELECTCASE SELECTCOM
;性交系や強制口交などPLAYER主導指令
CASE 60 TO 79, 82, 83, 140
	PRINTFORM %CALLNAME:PLAYER%是%CALLNAME:(PLAYER:1)%
	SELECTCASE PREVCOM:2
	CASE 60 TO 69
		PRINTFORM 在被凶狠地侵犯
	CASE 70 TO 79
		PRINTFORM 在狠狠地侵犯屁眼
	CASE 82
		PRINTFORM 在%TEXTR("侵犯着乳頭/用胸部承受着侵犯")%
	CASE 83 TO 88
		PRINTFORM 被严重侵犯尿道
	CASE 90, 97
		PRINTFORM 的东西。\@ PREVCOM:2 == 97 ?%CLO("内褲冲")% # 在手 \@下使用
	CASE 91
		PRINTFORM 用嘴吮吸着
	CASE 92
		PRINTFORM 用胸口摩擦着
	CASE 96
		PRINTFORM 用舌頭服务于屁穴
	CASE 98
		PRINTFORM 用舌頭服务着
	CASE 140
		PRINTFORM 被侵犯到喉咙深处
	ENDSELECT

	PRINTFORM %CALLNAME:TARGET%

	SELECTCASE SELECTCOM
	CASE 60 TO 69
		PRINTFORM 的%TEXTS("Ｖ挿入前")%
		SELECTCASE PREVCOM
		CASE 70 TO 79
			PRINTFORMW 从肛門抽出了%NAMES("阴茎", PLAYER)%開始侵犯…
		CASE 83 TO 88
			PRINTFORMW 把从尿道抽出的%NAMES("阴茎", PLAYER)%插入侵犯…
		CASEELSE
			PRINTFORMW 開始侵犯了……
		ENDSELECT
	CASE 70 TO 79
		PRINTFORM 的%TEXTS("肛門")%肛門
		SELECTCASE PREVCOM
		CASE 60 TO 69
			PRINTFORMW 用沾满爱液的%NAMES("阴茎", PLAYER)%開始侵犯…
		CASE 83 TO 88
			PRINTFORMW 带着氨气味儿的%NAMES("阴茎", PLAYER)%開始侵犯了…
		CASEELSE
			PRINTFORMW 開始侵犯了……
		ENDSELECT
	CASE 82
		PRINTFORM 的没有被使用的乳頭。
		SELECTCASE PREVCOM
		CASE 60 TO 69
			PRINTFORMW 用沾满爱液的%NAMES("阴茎", PLAYER)%開始侵犯…
		CASE 70 TO 79
			PRINTFORMW 从肛門抽出了%NAMES("阴茎", PLAYER)%開始侵犯…
		CASE 83 TO 88
			PRINTFORMW 用沾满小便的%NAMES("阴茎", PLAYER)%開始侵犯…
		CASEELSE
			PRINTFORMW 開始侵犯了……
		ENDSELECT
	CASE 83
		PRINTFORMW 
	CASE 140
		PRINTFORMW 抓住脑袋、粗暴地以%NAMES("阴茎", PLAYER)%開始侵犯嘴巴……
	ENDSELECT
CASEELSE
	PRINTFORM %CALLNAME:TARGET%是%CALLNAME:(PLAYER:1)%

	SELECTCASE CHECK_COM("３Ｐ奉仕")
	;乳頭奸
	CASE 82
		PRINTFORM 虽然是%TEXTR("侵犯着乳頭/用胸部承受着侵犯")%、
	CASE 90
		PRINTFORM 的东西。\@ PREVCOM:2 == 97 ?%CLO("内褲冲")% # 手 \@边使用
	CASE 91
		SELECTCASE SELECTCOM
		CASE 91
			PRINTFORM 与此同时、
		CASEELSE
			PRINTFORM 边用嘴边聊天、
		ENDSELECT
	CASEELSE
		SELECTCASE PREVCOM:2
		CASE 60 TO 69
			PRINTFORM 用阴道勒紧那东西、缓慢地一边动腰、
		CASE 70 TO 79
			PRINTFORM 用直肠吞下丁丁、
		CASE 83 TO 88
			PRINTFORM 一边用尿道紧紧地勒紧丁丁、
		CASEELSE
			IF INSERT("Ｖ挿入", TARGET, PLAYER:1)
				PRINTFORM 用阴道勒紧那东西、缓慢地一边动腰、
			ELSEIF INSERT("Ａ挿入", TARGET, PLAYER:1)
				PRINTFORM 用直肠吞下丁丁、
			ELSEIF INSERT("尿道挿入", TARGET, PLAYER:1)
				PRINTFORM 一边用尿道紧紧地勒紧丁丁、
			ENDIF
		ENDSELECT
	ENDSELECT

	SELECTCASE SELECTCOM
	CASE 90 TO 92, 97
		SELECTCASE PREVCOM
		CASE 60 TO 69
			PRINTFORM 刚才还在侵犯自己
		CASE 70 TO 79
			PRINTFORM 刚从肛門拔出的
		CASE 83 TO 88
			PRINTFORM 刚刚从小穴里拔出来的
		ENDSELECT
	ENDSELECT

	PRINTFORM %CALLNAME:PLAYER%の
	SELECTCASE SELECTCOM
	CASE 90
		PRINTFORM 用余下的阴茎
		IF RAND:3 == 0
			PRINTW 嗤嗤地開始擦……
		ELSEIF RAND:2
			PRINTW 開始使用了……
		ELSE
			PRINTW 開始玩弄了……
		ENDIF
	CASE 97
		PRINTFORM %CLO("内褲冲")%中的阴茎
		IF RAND:3 == 0
			PRINTW 開始擦了……
		ELSEIF RAND:2
			PRINTW 開始使用了……
		ELSE
			PRINTW 開始玩弄……
		ENDIF
	CASE 91
		PRINTFORM 把嘴对着阴茎
		;奉仕精神3以上か欲情4以上
		IF (ABL:奉仕精神 >= 3  || PALAM:欲情 >= PALAMLV:4) && RAND:2 == 0
			PRINTFORMW 開始猛烈地打喷嚏了……
		ELSEIF RAND:2 == 0 && ABL:技巧 >= 2
			PRINTFORMW 吸了一口气開始说话……
		ELSE
			PRINTFORMW 舔过来了……
		ENDIF
	CASE 92
		PRINTFORM 陰莖
		IF TALENT:貧乳
			PRINTFORM 用小小的胸口拼命地
		ELSEIF TALENT:巨乳
			PRINTFORM 用丰满的胸怀包围著
		ELSE
			PRINTFORM 夹在胸口
		ENDIF
		PRINTW 擦好了……
	CASE 96
		PRINTFORM 屁股上的屁穴
		IF ABL:奉仕精神 >= 3 && ABL:施虐属性 >= 3 && RAND:2 == 0
			PRINTFORMW 用尖锐的舌頭舔到里面……
		ELSEIF ABL:奉仕精神 >= 3
			PRINTFORMW 用舌頭好好地舔着、開始清洁了……
			STAIN:PLAYER:Ａ = SET_STAIN(0, "Ａ")
		ELSEIF ABL:施虐属性 >= 3 || TEQUIP:推倒
			PRINTFORMW 用舌頭责备过来了……
		ELSE
			PRINTFORMW 战战兢兢地舔了过来……
		ENDIF
	CASE 98
		PRINTFORM 把那里
		IF ABL:奉仕精神 >= 3 && ABL:施虐属性 >= 3 && RAND:2 == 0
			PRINTFORMW 用尖锐的舌頭舔着中间的褶皱……
		ELSEIF ABL:奉仕精神 >= 3
			PRINTFORMW 推開、用舌頭開始舔到各个角落……
			STAIN:PLAYER:Ａ = SET_STAIN(0, "Ａ")
		ELSE
			PRINTFORMW 舔过来了……
		ENDIF
	ENDSELECT
ENDSELECT

;-------------------------------------------------
;３Ｐにおける射精口上の汎用部分
;-------------------------------------------------
@SAMEN_SHOOT_MESSAGE_3P, ARGS
PRINTFORM %CALLNAME:(PLAYER:1)%
SELECTCASE SELECTCOM:2
CASE 60 TO 79, 83 TO 88
	IF COND("絶頂", PLAYER:1)
		PRINTFORM 让人全身发麻的中出了
	ELSEIF INSERT("騎乗位")
		PRINTFORM 跨坐着摇着腰
	ELSE
		PRINTFORM 被侵犯…
	ENDIF
CASE 82
	IF COND("絶頂", PLAYER:1)
		PRINTFORM 精液在胸中流出,身体在颤抖
	ELSE
		PRINTFORM 被阴茎侵犯了胸部
	ENDIF
CASE 90, 97
	IF COND("絶頂", PLAYER:1)
		IF ARGS == "手"
			PRINTFORM 同时
		ELSE
			PRINTFORM 被骗了
		ENDIF
	ELSE
		IF ARGS == "手"
			PRINTFORM 热情地对待两只阴茎
		ELSE
			PRINTFORM 使用阴茎
		ENDIF
	ENDIF
CASE 91
	IF COND("絶頂", PLAYER:1)
		IF ARGS == "口"
			PRINTFORM 同时
		ELSE
			PRINTFORM 精液从嘴里流了出来
		ENDIF
	ELSE
		IF ARGS == "口"
			PRINTFORM 阴茎脱口而出
		ELSE
			PRINTFORM 正在吮吸阴茎。
		ENDIF
	ENDIF
CASE 92
	IF COND("絶頂", PLAYER:1)
		PRINTFORM 被精液污染了胸部
	ELSE
		PRINTFORM 用胸脯擦亮阴茎
	ENDIF
CASE 96
	IF COND("絶頂", PLAYER:1)
		PRINTFORM 用屁股享受着快乐
	ELSE
		PRINTFORM 舌頭塞进屁穴里
	ENDIF
CASE 98
	IF COND("絶頂", PLAYER:1)
		PRINTFORM 达到了绝顶
	ELSE
		PRINTFORM 用舌頭服务着
	ENDIF
CASE 140
	IF COND("絶頂", PLAYER:1)
		PRINTFORM 被迫直接喝下精液的
	ELSE
		PRINTFORM 嗓子被非常粗暴得侵犯
	ENDIF
ENDSELECT


;-------------------------------------------------
;３Ｐにおける補佐役（通常は助手）の指令決定（自由行動は今のところ没有）
;-------------------------------------------------
@SET_SELECTCOM_3P
SELECTCASE SELECTCOM
CASE 82, 90 TO 104, 140
	SIF CHECK_COM("Ｗ奉仕")
		SELECTCOM:1 = SELECTCOM
	SIF CHECK_COM("３Ｐ奉仕")
		SELECTCOM:2 = PREVCOM:2
CASE 60 TO 69
	IF CHECK_COM("两根挿入Ｖ中")
		SELECTCOM:2 = 64
	ELSEIF CHECK_COM("二穴挿入")
		SELECTCOM:2 = 74
	ELSEIF CHECK_COM("３Ｐ奉仕")
		SELECTCOM:2 = PREVCOM:2
	ENDIF
CASE 70 TO 79
	IF CHECK_COM("两根挿入Ａ中")
		SELECTCOM:2 = 75
	ELSEIF CHECK_COM("二穴挿入")
		SELECTCOM:2 = 65
	ELSEIF CHECK_COM("３Ｐ奉仕")
		SELECTCOM:2 = PREVCOM:2
	ENDIF
CASE 83 TO 88
	SIF CHECK_COM("３Ｐ奉仕")
		SELECTCOM:2 = PREVCOM:2
ENDSELECT

;-------------------------------------------------
;ARGS:1～5で指定された禁止ワードに応じたビットを設定する
;-------------------------------------------------
@BIT_FORBIDCOM(ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5)
#FUNCTION
#DIM LCOUNT

LOCAL = 0
FOR LCOUNT, 1, 6
	ARGS = %ARGS:LCOUNT%
	;補佐役がPLAYヤーの動き（封印中）
	IF COND("調教側", PLAYER:1)
		SELECTCASE ARGS
		;TARGETに対する指令管理
		CASE "Ｔ顔"
			SETBIT LOCAL, 0
		CASE "Ｔ下半身"
			SETBIT LOCAL, 1
			SETBIT LOCAL, 2
			SETBIT LOCAL, 3
			SETBIT LOCAL, 4
		CASE "Ｔ阴茎"
			SETBIT LOCAL, 2
		CASE "Ｔ阴部"
			SETBIT LOCAL, 3
		CASE "Ｔ肛門"
			SETBIT LOCAL, 4
		CASE "Ｔ胸"
			SETBIT LOCAL, 5
		CASE "Ｔ指"
			SETBIT LOCAL, 6
		CASE "Ｔ前面"
			SETBIT LOCAL, 7
			SETBIT LOCAL, 5
			SETBIT LOCAL, 2
		CASE "Ｔ後面"
			SETBIT LOCAL, 8
			SETBIT LOCAL, 4
		ENDSELECT
	ELSE
		SELECTCASE ARGS
		;PLAYERに対する指令管理
		CASE "Ｐ顔"
			SETBIT LOCAL, 20
		CASE "Ｐ下半身"
			SETBIT LOCAL, 21
			SETBIT LOCAL, 22
			SETBIT LOCAL, 23
			SETBIT LOCAL, 24
		CASE "Ｐ阴茎"
			SETBIT LOCAL, 22
		CASE "Ｐ阴部"
			SETBIT LOCAL, 23
		CASE "Ｐ肛門"
			SETBIT LOCAL, 24
		CASE "Ｐ胸"
			SETBIT LOCAL, 25
		CASE "Ｐ指"
			SETBIT LOCAL, 26
		CASE "Ｐ前面"
			SETBIT LOCAL, 27
			SETBIT LOCAL, 25
			SETBIT LOCAL, 22
		CASE "Ｐ後面"
			SETBIT LOCAL, 28
			SETBIT LOCAL, 24
		;PLAYERに対する奉仕指令
		CASE "手交"
			SETBIT LOCAL, 30
		CASE "手交以外"
			SETBIT LOCAL, 31
			SETBIT LOCAL, 32
			SETBIT LOCAL, 33
			SETBIT LOCAL, 34
			SETBIT LOCAL, 35
			SETBIT LOCAL, 36
			SETBIT LOCAL, 39
		CASE "口交"
			SETBIT LOCAL, 31
		CASE "口交以外"
			SETBIT LOCAL, 30
			SETBIT LOCAL, 32
			SETBIT LOCAL, 33
			SETBIT LOCAL, 34
			SETBIT LOCAL, 35
			SETBIT LOCAL, 36
			SETBIT LOCAL, 39
		CASE "乳交"
			SETBIT LOCAL, 32
		CASE "乳交以外"
			SETBIT LOCAL, 30
			SETBIT LOCAL, 31
			SETBIT LOCAL, 33
			SETBIT LOCAL, 34
			SETBIT LOCAL, 35
			SETBIT LOCAL, 36
			SETBIT LOCAL, 39
		CASE "足交"
			SETBIT LOCAL, 33
		CASE "足交以外"
			SETBIT LOCAL, 30
			SETBIT LOCAL, 31
			SETBIT LOCAL, 32
			SETBIT LOCAL, 34
			SETBIT LOCAL, 35
			SETBIT LOCAL, 36
			SETBIT LOCAL, 39
		CASE "素股"
			SETBIT LOCAL, 34
		CASE "素股以外"
			SETBIT LOCAL, 30
			SETBIT LOCAL, 31
			SETBIT LOCAL, 32
			SETBIT LOCAL, 33
			SETBIT LOCAL, 35
			SETBIT LOCAL, 36
			SETBIT LOCAL, 39
		CASE "泡泡浴"
			SETBIT LOCAL, 35
		CASE "泡泡浴以外"
			SETBIT LOCAL, 30
			SETBIT LOCAL, 31
			SETBIT LOCAL, 32
			SETBIT LOCAL, 33
			SETBIT LOCAL, 34
			SETBIT LOCAL, 36
			SETBIT LOCAL, 39
		CASE "内褲冲"
			SETBIT LOCAL, 36
		CASE "内褲冲以外"
			SETBIT LOCAL, 31
			SETBIT LOCAL, 32
			SETBIT LOCAL, 33
			SETBIT LOCAL, 34
			SETBIT LOCAL, 35
			SETBIT LOCAL, 39
		CASE "性交"
			SETBIT LOCAL, 39
		ENDSELECT
	ENDIF
	SIF STRLENS(ARGS:(LCOUNT + 1) ) == 0
		RETURNF LOCAL
NEXT
RETURNF LOCAL

;-------------------------------------------------
;PLAYERでもTARGETでも無いARG(主に助手)に、他の角色が選んだ指令ARG:1に応じた禁止指令を設定する
;-------------------------------------------------
@SET_FORBIDCOM, ARG, ARG:1
VARSET LOCAL

SELECTCASE ARG:1
;面部騎乗などPLAYERの口を責める
CASE 1
	LOCAL = BIT_FORBIDCOM("Ｐ顔", "Ｔ阴部")
CASE 4
	LOCAL = BIT_FORBIDCOM("Ｐ顔", "Ｔ阴茎")
CASE 5
	LOCAL = BIT_FORBIDCOM("Ｐ指", "Ｔ胸")
CASE 6
	LOCAL = BIT_FORBIDCOM("Ｐ顔", "Ｔ顔")
CASE 9
	LOCAL = BIT_FORBIDCOM("Ｐ顔", "Ｔ肛門")
;騎乗位などPLAYERの阴茎を阴部や肛門で責める
CASE 60, 62, 63
	LOCAL = BIT_FORBIDCOM("Ｐ前面", "Ｔ下半身", "Ｔ前面")
CASE 61
	LOCAL = BIT_FORBIDCOM("Ｐ前面", "Ｔ下半身", "Ｔ後面")
CASE 64
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｐ前面", "Ｔ後面")
CASE 65
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ阴部")
CASE 66 TO 69
	IF TEQUIP:推倒
		LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ阴部")
	ELSE
		LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ下半身")
	ENDIF
CASE 70, 72, 73
	LOCAL = BIT_FORBIDCOM("Ｐ前面", "Ｔ下半身", "Ｔ前面")
CASE 71
	LOCAL = BIT_FORBIDCOM("Ｐ前面", "Ｔ下半身", "Ｔ後面")
CASE 74
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｐ前面", "Ｔ後面")
CASE 75
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ阴部", "Ｔ後面")
CASE 76 TO 79
	IF TEQUIP:推倒
		LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ阴部", "Ｔ後面")
	ELSE
		LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ下半身")
	ENDIF
;磨鏡
CASE 80
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ下半身")
;尿道挿入
CASE 83, 85, 86
	LOCAL = BIT_FORBIDCOM("Ｐ前面", "Ｔ下半身", "Ｔ前面")
CASE 84
	LOCAL = BIT_FORBIDCOM("Ｐ前面", "Ｔ下半身", "Ｔ後面")
CASE 87
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｐ前面", "Ｔ後面")
CASE 88
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｔ阴部", "Ｔ後面")
;手交などPLAYERの阴茎を手とかで責める
CASE 90
	LOCAL = BIT_FORBIDCOM("手交以外", "Ｔ指")
CASE 91
	LOCAL = BIT_FORBIDCOM("口交以外", "Ｔ顔")
CASE 92
	LOCAL = BIT_FORBIDCOM("乳交以外", "Ｔ胸")
CASE 93, 101
	LOCAL = BIT_FORBIDCOM("素股以外", "Ｔ下半身")
CASE 94
	LOCAL = BIT_FORBIDCOM("泡泡浴以外", "Ｔ前面")
CASE 95
	IF PENIS(MASTER)
		LOCAL = BIT_FORBIDCOM("足交以外", "Ｔ下半身")
	ELSE
		LOCAL = BIT_FORBIDCOM("足交以外", "Ｔ下半身")
	ENDIF
CASE 96
	LOCAL = BIT_FORBIDCOM("Ｐ肛門", "Ｔ顔")
CASE 97
	LOCAL = BIT_FORBIDCOM("内褲冲以外", "Ｔ指")
CASE 98
	LOCAL = BIT_FORBIDCOM("Ｐ阴部", "Ｔ顔")
CASE 104
	LOCAL = BIT_FORBIDCOM("Ｐ顔", "Ｔ胸", "Ｔ前面")
;逆肛交
CASE 125 TO 129
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｐ後面", "Ｔ阴茎", "Ｔ前面")
;逆強姦などPLAYERの阴部を責める
CASE 120 TO 124
	LOCAL = BIT_FORBIDCOM("Ｐ下半身", "Ｐ前面", "Ｔ阴茎", "Ｔ前面")
CASE 140
	LOCAL = BIT_FORBIDCOM("Ｐ阴茎", "Ｐ前面", "Ｔ顔")
CASE 141
	LOCAL = BIT_FORBIDCOM("Ｐ指", "Ｔ阴部")
CASE 142
	LOCAL = BIT_FORBIDCOM("Ｐ指", "Ｔ肛門")
CASE 143
	LOCAL = BIT_FORBIDCOM("Ｐ指", "Ｐ前面", "Ｔ下半身")
ENDSELECT
TCVAR:ARG:指令制限 = LOCAL

;-------------------------------------------------
;ARGS:1～5が実際に禁止されているかを見る
;-------------------------------------------------
@FORBIDCOM(ARG, ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5)
#FUNCTION
SIF TCVAR:ARG:指令制限 & BIT_FORBIDCOM(ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5)
	RETURNF 1
RETURNF 0


;-------------------------------------------------
;３ＰやＷ推倒などでの補佐役（通常は助手）の行動を決定する
;-------------------------------------------------
@SET_SELECTCOM_MULTI, ARGS
SELECTCASE ARGS
CASE "Ｗ推倒"
	CALL SET_SELECTCOM_W
CASE "３Ｐ"
	CALL SET_SELECTCOM_3P
ENDSELECT

;-------------------------------------------------
;Ｗ推倒の時には助手の指令口上とSOURCE等を管理する
;補佐役の取得経験は邪魔だから隠すことにした
;-------------------------------------------------
@EQUIP_COM_3P
#DIM MEMO_LINECOUNT
#DIM ACTOR

ACTOR = TARGET:1
VARSET LOCAL

;表示があったかを判定
MEMO_LINECOUNT = LINECOUNT

;最初のターンは何もしてこない
IF SELECTCOM:1 == -1
	IF PREVCOM:1 >= 0
		CALL BLANKLINE
		PRINTFORMW %CALLNAME:ACTOR%看着%CALLNAME:PLAYER%他们玩的很開心…
	ENDIF
	RETURN 0
;二人して同じことをしているor二穴挿入
ELSEIF SELECTCOM:1 == SELECTCOM || (SELECTCOM == 120 && SELECTCOM:1 == 126) || (SELECTCOM == 126 && SELECTCOM:1 == 120)
	CALL GET_PALAM_MULTI, 1
;前回の助手、今回のTARGETとも異なる行動or眺めている
ELSEIF SELECTCOM:1 != SELECTCOM && SELECTCOM:1 != PREVCOM:1
	CALL BLANKLINE
	PRINTFORM %CALLNAME:ACTOR%は
	SELECTCASE SELECTCOM:1
	CASE 1
		PRINTFORMW 跨过%CALLNAME:PLAYER%的脸把那里压了下来……
		SIF INSERT("騎乗位") && COND("性別嫌悪", ACTOR) == 0 && RAND:3 == 0
			PRINTFORMW 于是、他開始和眼前摇着腰的%CALLNAME:TARGET%接吻……
	CASE 9
		PRINTFORMW 跨过%CALLNAME:PLAYER%的脸让其舔了肛門……
		SIF INSERT("騎乗位") && COND("性別嫌悪", ACTOR) == 0 && RAND:3 == 0
			PRINTFORMW 于是、他開始和眼前摇着腰的%CALLNAME:TARGET%接吻……
	CASE 4
		PRINTFORMW 用阴茎開始侵犯%CALLNAME:PLAYER%的嘴巴…
	CASE 6
		PRINTFORMW 温柔地亲吻了%CALLNAME:PLAYER%…
	CASE 60 TO 79, 83
		PRINTFORMW 瞄准%CALLNAME:PLAYER%的阴茎坐下了…
		PRINTFORM 然后、
		SELECTCASE SELECTCOM:1
		CASE 60 TO 69
			PRINTFORM 阴道
		CASE 70 TO 79
			PRINTFORM 肛門
		CASE 83 TO 88
			PRINTFORM 尿道
		ENDSELECT
		IF RAND:3 == 0
			PRINTFORM 巧妙地蠢动着
		ELSEIF RAND:2 == 0
			PRINTFORM 紧紧地勒紧
		ELSE
			SELECTCASE SELECTCOM:1
			CASE 60 TO 69
				PRINTFORM 爱液满满的溢出
			CASE 70 TO 79
				PRINTFORM 从零開始一边溢出粘液
			CASE 83 TO 88
				PRINTFORM 从缝隙中溢出来
			ENDSELECT
		ENDIF
		IF ABL:ACTOR:技巧 >= 3 && RAND:3 == 0
			PRINTFORMW 扭起腰来了……
		ELSEIF RAND:2 == 0
			PRINTFORMW 摇起腰来……
		ELSE
			PRINTFORMW 用大幅度的開始动腰……
		ENDIF
	CASE 90
		IF TALENT:ACTOR:恋慕 && RAND:4 == 0
			PRINTFORMW 对爱着%CALLNAME:PLAYER%的阴茎、用手来侍奉……
		ELSEIF ABL:ACTOR:技巧 >= 3 && ABL:ACTOR:奉仕精神 >= 3 && RAND:3 == 0
			PRINTFORMW 把%CALLNAME:PLAYER%的龟頭用手掌扭转过来……
		ELSEIF ABL:ACTOR:奉仕精神 >= 3 && RAND:2 == 0
			PRINTFORMW 慢慢地服侍了%CALLNAME:PLAYER%的阴茎…
		ELSEIF ABL:ACTOR:技巧 >= 3 && RAND:2 == 0
			PRINTFORMW %CALLNAME:PLAYER%的阴茎被绝妙的力度刺激…
		ELSE
			PRINTFORMW 開始用手来侍奉%CALLNAME:PLAYER%的阴茎…
		ENDIF
	CASE 91
		IF TALENT:ACTOR:恋慕 && RAND:4 == 0
			PRINTFORMW 爱着%CALLNAME:PLAYER%的阴茎…用嘴吞下
		ELSEIF ABL:ACTOR:技巧 >= 4 && ABL:ACTOR:奉仕精神 >= 3 && RAND:3 == 0
			PRINTFORMW 将%CALLNAME:PLAYER%的阴茎叼到喉咙深处、用很大的幅度吞咽着……
		ELSEIF ABL:ACTOR:奉仕精神 >= 3 && RAND:2 == 0
			PRINTFORMW 把%CALLNAME:PLAYER%的阴茎美味地用嘴品味了…
		ELSEIF ABL:ACTOR:技巧 >= 3 && RAND:2 == 0
			PRINTFORMW %CALLNAME:PLAYER%的阴茎缠绕着舌頭、激烈地吮吸着……
		ELSE
			PRINTFORMW 開始用舌頭舔%CALLNAME:PLAYER%的阴茎…
		ENDIF
	CASE 92
		IF TALENT:ACTOR:巨乳
			PRINTFORM 巨大的
		ELSEIF TALENT:ACTOR:貧乳
			PRINTFORM 小小的
		ENDIF
		PRINTFORM 胸口的阴茎
		IF TALENT:ACTOR:巨乳
			PRINTFORMW 一边处理、一边舔着从胸部山谷中露出来的龟頭……
		ELSE
			PRINTFORMW 处理过的……
		ENDIF
	CASE 93
		PRINTFORMW 在%CALLNAME:PLAYER%的阴茎上磨蹭着阴部……
	CASE 94
		PRINTFORMW 在%CALLNAME:PLAYER%身上擦着沾满泡沫的肢体……
	CASE 95
		PRINTFORM %CALLNAME:PLAYER%の
		IF TALENT:MASTER:扶她 + TALENT:MASTER:男性
			PRINTFORMW 用脚玩弄了阴茎……
		ELSE
			PRINTFORMW 把股间用脚玩弄着……
		ENDIF
	CASE 96
		PRINTFORMW 舔了%CALLNAME:PLAYER%的肛門...
	CASE 97
		PRINTFORMW 脱下内裤后、%CALLNAME:PLAYER%的阴茎便開始使用了……
	CASE 98
		PRINTFORMW 舔了%CALLNAME:PLAYER%的阴部…
	CASE 101
		PRINTFORMW %CALLNAME:PLAYER%把自己的阴茎在尻部上摩擦起来…
	CASE 104
		PRINTFORMW 把%CALLNAME:PLAYER%的脸用胸部压着……
	CASE 120
		PRINTFORM %CALLNAME:PLAYER%の
		IF TALENT:MASTER:処女 == 1
			PRINTFORM 不识男人滋味的
		ELSE
			PRINTFORM 湿透了
		ENDIF
		IF TALENT:娇小
			PRINTFORM 年幼的
		ELSE
			PRINTFORM 阴道を
		ENDIF
		IF PENIS(ACTOR)
			PRINTFORM 阴茎
		ELSE
			PRINTFORM 穿戴式假陰茎
		ENDIF
		PRINTFORMW 中犯下的……
	CASE 126
		PRINTFORM %CALLNAME:PLAYER%的屁眼
		IF PENIS(ACTOR)
			PRINTFORM 阴茎
		ELSE
			PRINTFORM 穿戴式假陰茎
		ENDIF
		PRINTFORMW 中犯下的……
	;CASE 997
	;	PRINTFORMW 絶頂の余韻を味わい的同时、%CALLNAME:PLAYER%たちのPLAYを眺めている…
	CASE 0
		IF SELECTCOM:1 == PREVCOM:1
			PRINTFORMW 把身体贴在%CALLNAME:PLAYER%身上…
		ELSE
			PRINTFORMW 把身体靠近%CALLNAME:PLAYER%、把手指吮吸着……
		ENDIF
	ENDSELECT
	;地の文を記録する処理の追加
	SIF LINECOUNT > MEMO_LINECOUNT
		STR:調教指令の地の文 = %GETPRINTEDSENTENCE(MEMO_LINECOUNT+1)%
	SIF SELECTCOM:1 >= 0
		CALL GET_PALAM_MULTI, 1
;口上は発言させない
ELSE
	CALL BLANKLINE
	CALL GET_PALAM_MULTI
ENDIF

;何かテ接吻トを表示したならもう一個改行
SIF LINECOUNT > MEMO_LINECOUNT
	CALL BLANKLINE

;-------------------------------------------------
;3Pの行動による補佐役のPALAM、EXP変化
;Ｗ推倒の場合にはSELECTCOM:1が助手が選択した指令なので、それに応じて計算する
;-------------------------------------------------
@GET_PALAM_MULTI, ARG
#DIM MEMO_PLAYER
#DIM ACTOR

;何もやっていない場合
SIF SELECTCOM:1 == -1
	RETURN 0

;助手のBEGIN ABLUPをＯＮにする
SIF TARGET:1 == ASSI
	FLAG:助手を調教した = 1

SWAP SELECTCOM, SELECTCOM:1
SWAP PREVCOM, PREVCOM:1

IF COND("調教側", PLAYER:1)
	ACTOR = PLAYER:1

	MEMO_PLAYER = PLAYER
	PLAYER = PLAYER:1

	CALL SOURCE_CHECK_SIMPLE, SELECTCOM, ARG, 100, 1

	PLAYER = MEMO_PLAYER
ELSE
	ACTOR = TARGET:1
	SWAP TARGET, TARGET:1

	CALL SOURCE_CHECK_SIMPLE, SELECTCOM, ARG, 100, 1

	SWAP TARGET, TARGET:1
ENDIF

SWAP SELECTCOM, SELECTCOM:1
SWAP PREVCOM, PREVCOM:1

;PRINTFORML ACTOR = [{ACTOR}]%NAME:ACTOR%, BASE:{ACTOR}:体力 = {BASE:ACTOR:体力}, BASE:{ACTOR}:精力 = {BASE:ACTOR:精力}

;ダウン判定
SIF BASE:ACTOR:体力 < 500 || BASE:ACTOR:精力 <= 0
	CALL ASSI_DOWN, ACTOR


;-------------------------------------------------
;テ接吻トを不顯示、簡易指令選択
;ARGはSELECTCOMを代入し、ARG:1の値でPRINTの出力を決定する。
;ARG:2は強度でARG:3は行う回数
;-------------------------------------------------
@SOURCE_CHECK_SIMPLE, ARG, ARG:1, ARG:2, ARG:3
#DIM MEMO_SELECTCOM
#DIM MEMO_TFLAG

MEMO_SELECTCOM = SELECTCOM
SELECTCOM = ARG

MEMO_TFLAG = TFLAG:システム文スキップ
;システム文スキップフラグON
TFLAG:システム文スキップ = 1

TRYCALLFORM SHOW_COM_ORDER_COM, SELECTCOM, 1
TRYCALLFORM FLAG_COM{SELECTCOM}, ARG:2*ARG:3
TRYCALLFORM SOURCE_COM{SELECTCOM}, ARG:2*ARG:3
CALL SETFLAG, "快楽経験判定", SELECTCOM
CALL SAMEN_CHECK, ARG:2*ARG:3
CALL CALC_SOURCE, "調教指令"

;挿入解除（NEXTCOM等を考慮）
CALL SETFLAG, "体勢戻し"

;振動棒など付けっぱ无道具の格子(主にSOURCE計算。快楽のSOURCEが増えないものは、ここにはなくても良い)
CALL EQUIP_1

;ソースの計算
CALL CALC_SOURCE
;絶頂処理_見込み
CALL ORGASM_ADD_A

;口上
SIF ARG:1
	CALL KOJO_MESSAGE_COM
;絶頂処理_本番
CALL ORGASM_ADD_A
CALL ORGASM_ADD_B

;各種経験の変動
CALL GET_EXP_COM, ARG:3

;指令による情緒の獲得
CALL MOOD_COM, SELECTCOM

;挿入フラグ獲得
CALL CHECK_INSERT

;ソースの計算
CALL CALC_SOURCE

;被虐快楽経験、奉仕快楽経験等の格子
CALL EXP_GOT_CHECK

;特別経験格子
SIF ARG:1
	CALL RECORD_SP_EXP

;体力の減少
CALL CALC, "体力減少"

;特殊な素質などの判定
CALL GET_EXABL2, TARGET

SELECTCOM = MEMO_SELECTCOM
TFLAG:システム文スキップ = MEMO_TFLAG

;-------------------------------------------------
;３Ｐにおける絶頂口上の処理
;-------------------------------------------------
@KOJO_MESSAGE_SAMEN_AND_EXTACY_3P
;Ｗ推倒などTARGETが二人の時
IF TEQUIP:Ｗ推倒 || SELECTCOM:1 >= 0
	SIF COND("絶頂", PLAYER)
		CALL BLANKLINE
	;TARGET:1を一時的にTARGETに
	SWAP TARGET, TARGET:1
	SWAP SELECTCOM, SELECTCOM:1
	SWAP PREVCOM, PREVCOM:1
	;射精部位を、TARGET:1の行動に対応したものに
	SWAP TCVAR:PLAYER:PLAY区分メイン, TCVAR:PLAYER:PLAY区分サブ

	CALL KOJO_MESSAGE_SAMEN_AND_EXTACY

	SWAP TARGET, TARGET:1
	SWAP SELECTCOM, SELECTCOM:1
	SWAP PREVCOM, PREVCOM:1
	SWAP TCVAR:PLAYER:PLAY区分メイン, TCVAR:PLAYER:PLAY区分サブ
ENDIF
;PLAYERが二人の、いわゆる３Ｐの時
IF COND("３Ｐ") && COND("絶頂", PLAYER:1) && COND("絶頂", PLAYER) == 0
	CALL SETFLAG, "調教者交代"

	CALL KOJO_MESSAGE_SAMEN_AND_EXTACY

	CALL SETFLAG, "調教者交代"
ENDIF

;-------------------------------------------------
;挣扎など、指令途中でRETURN 0する指令での発言に適している。
;-------------------------------------------------
@KOJO_MESSAGE_COM_MULTI
SIF TEQUIP:Ｗ推倒 == 0
	RETURN 0

SWAP TARGET, TARGET:1
SWAP PREVCOM, PREVCOM:1

PRINTFORML 
CALL KOJO_MESSAGE_COM

SWAP TARGET, TARGET:1
SWAP PREVCOM, PREVCOM:1


