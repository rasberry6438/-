;YYYYを任意のダンジョン名に変更する
;その後、「各ダンジョン固有変数.ERH」に以下の変数を追加すること

; #DIM SAVEDATA ダンジョン構造配列_YYYY, 100, 9
; #DIM SAVEDATA ダンジョン出現フラグ_YYYY
; #DIM SAVEDATA ダンジョンクリアフラグ_YYYY


@ダンジョン初期処理_YYYY
;ダンジョン構造の読み込み
;0でない時、そのマスは存在する
#DIM 深度
#DIM 分岐

ダンジョンマス画像URL_伏せ状態 = ;開いてないマスの画像名を入れる
ダンジョン現在位置:0 = ;初期位置のマス深度を入れる
ダンジョン現在位置:1 = ;初期位置のマス分岐値を入れる
ダンジョン背景画像 = ;ダンジョンの背景画像名を入れる

;---------------------------------------------------------------------------------
;ここから変更しないこと
;---------------------------------------------------------------------------------
;ビット0：存在するか　ビット1：移動できるか　ビット2：マスをオープンするか（ビット１をONにしないと無意味）　ビット3：入れないがオープンする場合に使用
;ビット4以降：自由枠。主に宝箱の開閉やイベント達成フラグなどに使用
IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}") == 0
	SETVAR @"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}", 3
ENDIF

FOR 深度, 1, 100
	LOCAL = 0
	FOR 分岐, 0, 9
		IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{深度}:{分岐}")
			;既にマス情報が入ってるなら飛ばす
			LOCAL = 1
			CONTINUE
		ELSEIF ENUMFUNCBEGINSWITH(@"ダンジョンマス情報_%ダンジョン名%_{深度}_{分岐}")
			LOCAL = 1
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:深度:分岐", 1
		ENDIF
	NEXT
	IF LOCAL
		ダンジョン最大深度 = 深度
	ENDIF
NEXT
;---------------------------------------------------------------------------------
;ここまで変更しないこと
;---------------------------------------------------------------------------------

@ダンジョン解説文_YYYY

詳細文文字列受け渡し変数 = ;ここに解説文を入れる

;任意の推奨レベルを返す
RETURN 0

;---------------------------------------------------------------------
;共通ドロップアイテム
;---------------------------------------------------------------------
@敵討伐後処理_ダンジョン固有_YYYY(討伐エネミー数)
;ダンジョン内で戦闘した後に呼ばれる関数、主にダンジョンごとのドロップアイテム取得に使用
;まだ敵データはリセットしていないので敵BATTLE_STATEで色々情報は取得可能
#DIM 討伐エネミー数
#DIM ドロップ確率
#DIMS ドロップアイテム

ドロップ確率 = ;ドロ率を入れる。単位は％
ドロップアイテム = ;ドロップする素材明を入れる
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

;---------------------------------------------------------------------
;マップ構造
;---------------------------------------------------------------------
@ダンジョンマス情報_YYYY_X_Y(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = ;マス深度を入れる
マス分岐 = ;マス分岐値を入れる

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = ;開いた後のマス画像名を入れる
	CASE "接続先"
		;マスから移動出来るマスを設定する
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "X_Y")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			;2回目以降
			KSTR:(K++) = 
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT
