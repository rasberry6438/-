;--------------------------------------------------
;●パチュリー・ノーレッジ口上＠erablue_resort用
;　――ダンジョン探索中にダンジョンハプニングを踏んだとき表示される文章
;--------------------------------------------------

;--------------------------------------------------
;●ライセンス/更新履歴/概要/使用フラグ
;--------------------------------------------------
;　いずれもパチュリー口上_readme.txt記載に従う
;--------------------------------------------------

;--------------------------------------------------
;●ダンジョンハプニング全体に関して
;--------------------------------------------------
;　ハプニングERB側でセクハラ反応タイプが判定され、その後口上を呼ぶか、汎用文章が表示される。
;　下記のような順番。
;　　１、風が吹いた！
;　　２、口上を呼ぶことを試みる
;　　3-A、口上を表示する
;　　3-B、「しかし、パッチェさんは特に気にしていない」的な汎用文章を表示する
;　口上を用意すると、3-Bは表示されない。
;--------------------------------------------------
;　@セクハラ反応タイプ　で色々変動
;　返り値、反応タイプ判定結果は下記の分岐。
;　/
;　・RFLAG:コマンド結果受渡し変数
;　　1:拒絶 2:受け入れ 3:喜び
;　・RFLAG:コマンド結果受渡し変数２ = X
;　　1:無知  2:無反応  3:嫌悪  4:拒否  5:余裕  6:羞恥  7:愉悦  8:汎用
;　/
;　変数２が先に判定される。
;　１無知、２無反応は優先して判定され、パッチェさんは無関心持ちなので基本的に２＝無反応が返ってくる
;　変数１は、陥落状況、欲情PALAM、酩酊や、変数２の結果にも影響され、受け入れ度が変わる。
;--------------------------------------------------


;--------------------------------------------------
;「スカート捲れ」時
;--------------------------------------------------
;いやん、イタズラな突風ッ。……でスカートがまくれる。
;--------------------------------------------------
@KOJO_ハプニング_スカート捲れ_1147(対象キャラ)
#DIM 対象キャラ
	CALL 口上変数初期化_1147
	LOCAL = キャラ隊列検索(対象キャラ)

	;タイツとか下着とかが影響してくるが分岐はさせない
	IF 0
	ELSEIF !RAND:2
		KSTR:(K++) = 「あ」
	ELSE
		KSTR:(K++) = 「わ」
	ENDIF
	KSTR:(K++) = 　
	KSTR:(K++) = _呼び名_は、一音の声を出した。
	KSTR:(K++) = 裾が長く、余裕のあるデザインのローブは風で大きくめくれ上がり、_呼び名_の上半身、顔にまで張り付いていた……
	IF 0
	ELSEIF !RAND:2
		KSTR:(K++) = 「……見てる？　できれば見ないでほしいのだけど……」
		KSTR:(K++) = 　
		KSTR:(K++) = 風音に紛れる声に、羞恥心はあまり感じられない……
	ELSE
		KSTR:(K++) = 「たすけて」
		KSTR:(K++) = 　
		KSTR:(K++) = シンプルな求めに、_主人_は応じた……
	ENDIF
	WSTR:(K++) =  

	CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0 , , 対象キャラ)

;--------------------------------------------------
;「ポロリ発生」時
;--------------------------------------------------
;魔物の奇襲、を撃退したけど、服が乱れてポロリしちゃったよ！ってやつ
;「魔物の奇襲は撃退できたが、胸の部分が露出してしまっている」って文章から続きます
;--------------------------------------------------
@KOJO_ハプニング_ポロリ発生_1147(対象キャラ)
#DIM 対象キャラ
	CALL 口上変数初期化_1147
	LOCAL = キャラ隊列検索(対象キャラ)

	IF 0
	ELSEIF !RAND:2
		KSTR:(K++) = 「？　……あ」
	ELSE
		KSTR:(K++) = 「あら」
	ENDIF
	KSTR:(K++) = 　
	KSTR:(K++) = _呼び名_は、胸が露出していることに気付くと、特に急いだ様子もなく、服にしまいこんだ。
	WSTR:(K++) = 

	CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0 , , 対象キャラ)

;--------------------------------------------------
;「乳タッチ」時
;--------------------------------------------------
;オーナーが転んでパイタッチ、っていうかわしづかみ、をしちゃう
;--------------------------------------------------
@KOJO_ハプニング_乳タッチ_1147(対象キャラ)
#DIM 対象キャラ
	CALL 口上変数初期化_1147
	LOCAL = キャラ隊列検索(対象キャラ)

	IF 0
	ELSEIF !RAND:2
		KSTR:(K++) = 「わ」
	ELSE
		KSTR:(K++) = 「ん」
	ENDIF
	KSTR:(K++) = 　
	KSTR:(K++) = _呼び名_は、ガッツリ乳を掴まれ、一音の声を出した。
	KSTR:(K++) = まるで腕を掴まれたような反応だ。多少の困惑、不快感はあるようだが、嫌がってはいなさそうだ。
	KSTR:(K++) = 　
	KSTR:(K++) = 「……離してくれないと痛いわ」
	KSTR:(K++) = 　
	KSTR:(K++) = _呼び名_から春風めいた風が発生し、_主人_は押し返された……
	;スプリングウィンド：弾幕格闘シリーズで使用される、敵を押し返す風を発生させる技。打撃無敵付き。

	WSTR:(K++) = 

	CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0 , , 対象キャラ)

;--------------------------------------------------
;「発情罠」時/セックス
;--------------------------------------------------
;陥落状態かつ初うふふ経験済みだと物陰でセックスする
;　V挿入したことがない場合、V快楽は発生しない　B快楽も一緒に発生する
;　A挿入したことがない場合、A快楽は発生しない
;　C,S快楽は必ず発生する
;　なお、「セックスした」とは書かれてない。挿入経験や精液経験なども増えない。
;--------------------------------------------------
@KOJO_ハプニング_発情罠セックス_1147(対象キャラ)
#DIM 対象キャラ
#DIM 発生セックス
#DIM パーティ人数
#DIM 配列番号
#DIM テキストパターン

	CALL 口上変数初期化_1147
	LOCAL = キャラ隊列検索(対象キャラ)

	;セックス発生判定
	;……というか、描写範囲設定。
	;VA経験ありだと必ずVA快楽が入るので。
	;/
	;パターンは４つ。素股、V、A、VA。
	;　0.VAセックス経験がないなら素股のみ
	;　1.Vセックス経験があるなら素股とVで均等の確率
	;　2.Aセックス経験があるなら素股とAで均等の確率
	;　3.VAセックス経験があるなら素股、V、A、VAで均等の確率
	;……としたい。
	;/
	;まずビット演算で判断する
	発生セックス = 0
	;Vセックス発生
	SIF HAS_VAGINA(対象キャラ) && 初体験日:対象キャラ:Ｖ挿入初体験
		SETBIT 発生セックス, 0
	;Aセックス発生
	SIF EXP:対象キャラ:Ａ性交経験
		SETBIT 発生セックス, 1
	;具体的な表示の判断
	IF 0
	;VA経験あり
	;４パターンすべて発生しうるので単純なRAND4でOK
	ELSEIF GETBIT(発生セックス, 0) && GETBIT(発生セックス, 1)
		テキストパターン = RAND:4
	;VまたはA経験のみ
	;素股とV/Aのみ。２パターンなのでRAND2して、経験ありがAなら＋１。
	ELSEIF GETBIT(発生セックス, 0) || GETBIT(発生セックス, 1)
		テキストパターン = RAND:2
		;Aセックスの場合値を補正
		SIF GETBIT(発生セックス, 1) && 発生セックス == 1
			テキストパターン += 1
	;素股の場合はゼロな
	ELSE
		テキストパターン = 0
	ENDIF

	;パーティ人数
	;他に人員がいるかを確認
	;パッチェさんがいるので最低１にはなる、今回は２以上かを見るよ
	パーティ人数 = 0
	FOR 配列番号, 0, 4
		SIF BATTLE_STATE:配列番号:0 > 0
			パーティ人数 += 1
	NEXT
	FOR 配列番号, 10, 14
		SIF BATTLE_STATE:配列番号:0 > 0
			パーティ人数 += 1
	NEXT

	IF 0
	ELSEIF !RAND:2
		KSTR:(K++) = 「ふーッ、ふーッ_H_」
	ELSE
		KSTR:(K++) = 「はぁーッ、はぁーッ_H_」
	ENDIF
	KSTR:(K++) = 　
	;やだーッ　男の人呼んでーッ
	KSTR:(K++) = _呼び名_は_主人_の腕をひっつかんで物陰に連れ込むと、普段の様子からは想像できない勢いで_主人_の下半身を脱衣させた。

	;テキストパターン表示
	IF 0
	;両方発生
	;VAで２発ヤってる扱い
	ELSEIF テキストパターン == 3
		KSTR:(K++) = そうして、ローブの裾をがばりと持ち上げ、丸く白い尻を露出させた。
		KSTR:(K++) = たっぷりと媚肉のついた尻たぶを広げ、股を開き、腰を高く掲げる。
		KSTR:(K++) = 生白い太ももを、粘度の高い液体が幾筋も伝う。
		KSTR:(K++) = 　
		KSTR:(K++) = 「……はやくっ_H_」
		KSTR:(K++) = 　
		KSTR:(K++) = _呼び名_は上ずった声で言う。
		KSTR:(K++) = ……求められて否やはないが――どちらからがいいのだろうか？
		KSTR:(K++) = そんなことを問うと、_呼び名_の尻が震え、汁が噴き出た。
		KSTR:(K++) = 　
		KSTR:(K++) = 「……両方っ、どっちも……！」
		KSTR:(K++) = 　
		KSTR:(K++) = 答えになっていないが、それも罠によるものだろう。
		KSTR:(K++) = 普段の_呼び名_であれば――リゾートに来る前の_呼び名_であれば絶対にしないであろう物言いを楽しみながら、挿入してやる。
	;A発生
	ELSEIF テキストパターン == 2
		;丸く白い。マロい。
		KSTR:(K++) = そうして、ローブの裾をがばりと持ち上げ、丸く白い尻を露出させた。
		KSTR:(K++) = たっぷりと媚肉のついた尻たぶを広げ、尻穴を広げる。
		KSTR:(K++) = 　
		KSTR:(K++) = 「使って、……使っていい、わ……っ_H_　今すぐ、ハメて……くれてもっ_H_」
		KSTR:(K++) = 　
		KSTR:(K++) = _呼び名_は上ずった声で言う。
		KSTR:(K++) = 『発情しちゃったから性欲解消に付き合って』――
		KSTR:(K++) = ――とは、なにかと直裁な_呼び名_も言えないらしい。
		KSTR:(K++) = 　
		KSTR:(K++) = 「なにしてるの、……き、きれいには……してあるからっ……_H_」
		KSTR:(K++) = 　
		KSTR:(K++) = どこまでプライドを捨てるのか見てみたくはあったが……状況が状況だ。
		KSTR:(K++) = 尻穴に挿入すると、_呼び名_は低い声を出して悶えた。
	;V発生
	;これはB快楽もセット
	ELSEIF テキストパターン == 1
		KSTR:(K++) = そのまま_呼び名_はぐっちょりと濡れそぼった秘所を露わにし、_主人_に抱き着くように位置を合わせ、まだ勃起しきっていない男根を膣口で飲む。
		KSTR:(K++) = 　
		KSTR:(K++) = 「ひ、ぁあっ_H_　はー、ァ_H_　こ、れ_H_　ほしか、った_H_　こんなのっ_H_」
		KSTR:(K++) = 　
		KSTR:(K++) = _呼び名_の膣内はひどく淫靡にうごめき、男根を勃起させようとする。
		KSTR:(K++) = 　
		KSTR:(K++) = 「うぅっ_H_　_二人称_、もっ……動いて……っ_H_」
		KSTR:(K++) = 　
		KSTR:(K++) = 否やはない。
	;C.Sだけ、まあペッティングかな～というあたり
	;この口上では素股として扱う。
	ELSE
		KSTR:(K++) = ぐっちょりと濡れそぼった秘所を露わにし、まだ勃起しきっていない男根をむっちりとした太ももに挟む。
		KSTR:(K++) = そうして、セックスをするように腰を動かし、男根で股間をこすり始めた。
		KSTR:(K++) = 　
		KSTR:(K++) = 「いっ……いいからッ……入れちゃだめよ……このまま……使わせてッ……_H_
		KSTR:(K++) = 　っく……きゅ、ぅ、気持ちい、いいっ……_H_　いぃい……っ_H__H__H_」
		KSTR:(K++) = 　
		KSTR:(K++) = ヘコヘコと腰を前後させるさまからは、普段の知性はまったく感じられない。
	ENDIF

	;VA経験が両方あれば確定で２回以上ヤったテキストにする
	;または、VまたはA経験があるが、素股パターンが出た場合も２回以上バージョン。
	IF (GETBIT(発生セックス, 0) && GETBIT(発生セックス, 1)) || (テキストパターン == 0 && 発生セックス > 0)
		KSTR:(K++) = _主人_はようやく芯の入った男根を使い、_呼び名_を何度も悦ばせた……
	ELSE
		KSTR:(K++) = _主人_はようやく芯の入った男根を使い、_呼び名_をたっぷりと悦ばせた……
	ENDIF

	;パーティメンバーが２人以上だと「声が聞こえる！」される場合がある
	SIF パーティ人数 > 1 && !RAND:2
		KSTR:(K++) = 声はおそらく、他のメンバーにも聞こえてしまっていただろう……

	WSTR:(K++) = 

	CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0 , , 対象キャラ)

;--------------------------------------------------
;「発情罠」時/オナニー
;--------------------------------------------------
;まず「一日終了時オナニーOPTION」がオフだと発生しない（薬とか魔法とか気合で直したってテキストが出ます）
;陥落していない、またはうふふに入ったことがない場合はオナニーになる
;部位の決定方法は一日終了時オナニーと同様
;（全部位からランダム、ABLや敏感素質があると確率UP
;　V経験・A経験が無い場合はそれぞれV・Aは選択されない
;　男の場合、V・Bは選択されない）
;/
;口上側では、どのオナニーかは分からないっぽい（決定はされているが、引数として持ってこれない）
;--------------------------------------------------
@KOJO_ハプニング_発情罠オナニー_1147(対象キャラ)
#DIM 対象キャラ
#DIM パーティ人数
#DIM 配列番号

	CALL 口上変数初期化_1147
	LOCAL = キャラ隊列検索(対象キャラ)

	;パーティ人数
	;他に人員がいるかを確認
	;パッチェさんがいるので最低１にはなる、今回は２以上かを見るよ
	パーティ人数 = 0
	;戦闘メンバー、サブメンバー内を確認
	FOR 配列番号, 0, 14
		;配置枠以外の範囲（４～９）だったら次
		SIF 配列番号 > 3 && 配列番号 < 10
			CONTINUE
		;誰か配置されてなければ次
		SIF BATTLE_STATE:配列番号:0 < 1
			CONTINUE
		;ここまで来たら人員＋１
		パーティ人数 += 1
	NEXT

	;オナニーはあんまり性癖でないので分岐は控えめに。
	;陥落してるからって、オーナーのことを呼びながらオナるタイプでもないだろうしね
	KSTR:(K++) = 「……っ、ちょっと……ひとりになるわっ……_H_」
	KSTR:(K++) = 　
	KSTR:(K++) = _呼び名_は上ずった声で言い、足早に物陰へと入っていく。
	KSTR:(K++) = ……罠の効果は分かっている。
	;パチュリー以外にも誰かいる
	IF パーティ人数 > 1
		KSTR:(K++) = _主人_たちは、周囲の警戒に努めた……
	;パチュリーだけの場合
	ELSE
		KSTR:(K++) = _主人_は、周囲の警戒に努めた……
	ENDIF

	;陥落などの分岐パターンはこんな感じになるかな～
;	IF 0
;	;性知識と自慰経験が無い場合、あなたが自慰を教えてあげるシチュになる
;	;接触ソースが発生し、キャラがオナニー覚えたて状態になる
;	ELSEIF 知識素質:対象キャラ:性知識 < 0 && EXP:対象キャラ:自慰経験 <= 0
;		;パッチェさんは性知識があるのでここには来ないはず。
;	;陥落してはいるが、うふふをしたことがない
;	ELSEIF 陥落チェック(対象キャラ)
;	;陥落していないが、うふふは経験済み
;	ELSEIF 初体験日:対象キャラ番号:初うふふ
;	;陥落しておらず、うふふもしていない
;	ELSE
;		KSTR:(K++) = 
;	ENDIF

	WSTR:(K++) = 
	CALL メッセージ欄表示用関数(@"探索用_{LOCAL}_顔", CALLNAME:対象キャラ,,0 , , 対象キャラ)

