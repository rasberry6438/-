
@固有アビ_180_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 56
	アビ名 = 空裂く風矢++
	消費ＭＰ = 125
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 24
	アビ名 = 空裂く風矢+
	消費ＭＰ = 125
ELSE
	アビ名 = 空裂く風矢
	消費ＭＰ = 150
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵単体に［攻撃力✕200％］の風属性ダメージを4回与える。
		詳細文文字列受け渡し変数 += @"<br>［累積10/最大40］（累積枠・5ターン）の風属性耐性減少効果を与える。"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 56
			詳細文文字列受け渡し変数 += @"<br>［累積10％/最大40％］（累積枠・5ターン）のDA率減少効果を与える。"
			詳細文文字列受け渡し変数 += @"<br>［累積10％/最大40％］（累積枠・5ターン）のTA率減少効果を与える。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵単体
		アビ汎用変数:効果割合 = 200
		FOR LOCAL, 0, 4
			CALL アビテンプレート_ダメージ処理_風属性
		NEXT
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 属性被ダメージ_風累積
		アビ汎用文字列:バフ・デバフ対象能力 = 属性被ダメージ_風
		アビ汎用変数:効果量 = 10
		アビ汎用変数:累積上限_固定値 = 40
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 56
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = DA率累積
			アビ汎用文字列:バフ・デバフ対象能力 = DA率
			アビ汎用変数:効果量 = 10
			アビ汎用変数:累積上限_固定値 = 40
			アビ汎用変数:持続ターン = 5
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = TA率累積
			アビ汎用文字列:バフ・デバフ対象能力 = TA率
			アビ汎用変数:効果量 = 10
			アビ汎用変数:累積上限_固定値 = 40
			アビ汎用変数:持続ターン = 5
			CALL アビテンプレート_不利効果_累積デバフ効果セット
		ENDIF
ENDSELECT



@固有アビ_180_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 対象番号
#DIM 追加攻撃回数
#DIM 数値保存

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 72
	アビ名 = 無窮穿撃++
	消費ＭＰ = 300
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 40
	アビ名 = 無窮穿撃+
	消費ＭＰ = 300
ELSE
	アビ名 = 無窮穿撃
	消費ＭＰ = 350
ENDIF

追加攻撃回数 = 0

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>ランダムな敵に［攻撃力✕100％］の風属性ダメージを10回与える。
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 72
			詳細文文字列受け渡し変数 += @"<br>敵全体に［1］のバフ消去を与える。"
		ENDIF
		詳細文文字列受け渡し変数 += @"<br>敵に付与されているデバフの種類数に応じて、攻撃回数が増加する。"
		詳細文文字列受け渡し変数 += @"<br>（1種のデバフにつき1回追加し、最大で+10回まで増加する。）"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		FOR 対象番号, 10, 20
			SIF 敵BATTLE_STATE_STR:(対象番号 - 10):エネミー名 == ""
				CONTINUE
			SIF 敵BATTLE_STATE:(対象番号 - 10):ＨＰ < 1
				CONTINUE
			数値保存 = 弱体数算出(対象番号)
			IF 数値保存 > 追加攻撃回数
				追加攻撃回数 = 数値保存
				SIF 追加攻撃回数 > 10
					追加攻撃回数 = 10
			ENDIF
		NEXT
		
		FOR LOCAL, 0, 10 + 追加攻撃回数
			CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
			アビ汎用変数:効果割合 = 100
			CALL アビテンプレート_ダメージ処理_風属性
		NEXT
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 72
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_敵全体_生者のみ
			CALL アビテンプレート_不利効果_バフ消去
		ENDIF
ENDSELECT



@固有アビ_180_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 隊列番号
#DIM バフ・デバフ行数

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 80
	アビ名 = 青風螺旋+
	消費ＭＰ = 300
ELSE
	アビ名 = 青風螺旋
	消費ＭＰ = 300
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵全体に様々な弱体効果を与える。
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵全体に［10％］（Ａ枠・5ターン）の弱体耐性減少効果を与える。
		詳細文文字列受け渡し変数 += "［25％］（Ａ枠・5ターン）の攻撃力減少効果を与える。"
		詳細文文字列受け渡し変数 += "［25％］（Ａ枠・5ターン）の防御力減少効果を与える。"
		詳細文文字列受け渡し変数 += "［50％］（Ａ枠・5ターン）のDA率減少効果を与える。"
		詳細文文字列受け渡し変数 += "［50％］（Ａ枠・5ターン）のTA率減少効果を与える。"
		詳細文文字列受け渡し変数 += "［100］（通常枠・5ターン）の毒効果を与える。成功率90％。"
		詳細文文字列受け渡し変数 += "［100］（通常枠・5ターン）の火傷効果を与える。成功率90％。"
		詳細文文字列受け渡し変数 += "［30％］（通常枠・5ターン）の暗闇効果を与える。成功率70％。"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 80
			詳細文文字列受け渡し変数 += "［10％］（通常枠・3ターン）の与ダメージ減少効果を与える。成功率70％。"
			詳細文文字列受け渡し変数 += "［30％］（通常枠・3ターン）の魅了効果を与える。成功率70％。"
			詳細文文字列受け渡し変数 += "［200］（通常枠・3ターン）の侵食効果を与える。成功率70％。"
			詳細文文字列受け渡し変数 += "（侵食："
			詳細文文字列受け渡し変数 += "　ターン終了時にダメージを受ける状態。）"
		ENDIF
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 弱体耐性A
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体耐性
		アビ汎用変数:効果割合 = 10
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 攻撃力A
		アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
		アビ汎用変数:効果割合 = 25
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 防御力A
		アビ汎用文字列:バフ・デバフ対象能力 = 防御力
		アビ汎用変数:効果割合 = 25
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = DA率A
		アビ汎用文字列:バフ・デバフ対象能力 = DA率
		アビ汎用変数:効果量 = 50
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = TA率A
		アビ汎用文字列:バフ・デバフ対象能力 = TA率
		アビ汎用変数:効果量 = 50
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 毒
		アビ汎用文字列:バフ・デバフ対象能力 = 毒
		アビ汎用変数:効果量 = 100
		アビ汎用変数:持続ターン = 5
		アビ汎用変数:基礎成功確率 = 90
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 火傷
		アビ汎用文字列:バフ・デバフ対象能力 = 火傷
		アビ汎用変数:効果量 = 100
		アビ汎用変数:持続ターン = 5
		アビ汎用変数:基礎成功確率 = 90
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 暗闇
		アビ汎用文字列:バフ・デバフ対象能力 = 暗闇
		アビ汎用変数:効果割合 = 30
		アビ汎用変数:持続ターン = 5
		アビ汎用変数:基礎成功確率 = 70
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 80
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 与ダメージ減少
			アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
			アビ汎用変数:効果割合 = 10
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 70
			CALL アビテンプレート_不利効果_デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 魅了
			アビ汎用文字列:バフ・デバフ対象能力 = 魅了
			アビ汎用変数:効果割合 = 30
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 70
			CALL アビテンプレート_不利効果_デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 侵食
			アビ汎用文字列:バフ・デバフ対象能力 = 自傷
			アビ汎用変数:効果量 = 200
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 70
			CALL アビテンプレート_不利効果_デバフ効果セット
		ENDIF
ENDSELECT



@固有通常攻撃後処理_キャラ_180(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM 対象番号
#DIM 発動確率
#DIM 数値保存
#DIM 発動判定
#DIM アミ番号

SIF 全滅フラグ
	RETURN 0

発動確率 = 0
発動判定 = 1

アミ番号 = GETCHARA(180)

FOR 対象番号, 10, 20
	SIF 敵BATTLE_STATE_STR:(対象番号 - 10):エネミー名 == ""
		CONTINUE
	SIF 敵BATTLE_STATE:(対象番号 - 10):ＨＰ < 1
		CONTINUE
	
	数値保存 = 弱体数算出(対象番号) * 10
	IF 数値保存 > 発動確率
		発動確率 = 数値保存
		SIF 発動確率 > 100
			発動確率 = 100
	ENDIF
NEXT

IF 発動確率 == 100
	発動判定 = 1
ELSEIF 発動確率 >= RAND(1, 100)
	発動判定 = 1
ELSE
	発動判定 = 0
ENDIF

IF 発動判定 == 1
	WSTR:(K++) = 「射抜いて見せる…！」
	WSTR:(K++) = アミの空裂く風矢！

	CALL アビ汎用変数文字列リセット
	アビ汎用変数:効果割合 = 200
	FOR LOCAL, 0, 4
		CALL アビテンプレート_ダメージ処理_風属性
	NEXT
	
	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 属性被ダメージ_風累積
	アビ汎用文字列:バフ・デバフ対象能力 = 属性被ダメージ_風
	アビ汎用変数:効果量 = 10
	アビ汎用変数:累積上限_割合 = 40
	アビ汎用変数:持続ターン = 5
	CALL アビテンプレート_不利効果_累積デバフ効果セット
	
	IF 基礎BATTLE_STATE:アミ番号:Lv >= 56
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = DA率_累積枠
		アビ汎用文字列:バフ・デバフ対象能力 = DA率
		アビ汎用変数:効果量 = 10
		アビ汎用変数:累積上限_割合 = 40
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = TA率_累積枠
		アビ汎用文字列:バフ・デバフ対象能力 = TA率
		アビ汎用変数:効果量 = 10
		アビ汎用変数:累積上限_割合 = 40
		アビ汎用変数:持続ターン = 5
		CALL アビテンプレート_不利効果_累積デバフ効果セット
	ENDIF
ENDIF



;--------------------------------------------------
;戦闘能力の固有処理説明
;--------------------------------------------------
;戦闘能力画面に表示されるキャラごとの固有処理説明
;--------------------------------------------------
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;　口上と同じ感覚で使う為に書式を統一しているが、ステータス画面で表示されるので
;　基本的にWAIT系列は使わないことを推奨
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_180(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

KSTR:(K++) = □ 特性：『百歩穿楊』 □----------------------------------------------------------------
KSTR:(K++) = 　最大HPが低いが、敵に弱体効果が付与されている時、通常攻撃後に確率で空裂く風矢が発動
KSTR:(K++) = 　◆敵に付与されている弱体効果数が多いほど発動確率アップ

CALL 口上変数表示(対象キャラ, 1)


