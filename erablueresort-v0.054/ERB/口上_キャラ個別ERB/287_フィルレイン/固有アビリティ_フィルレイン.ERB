
@固有アビ_287_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIMS 银冰吐息
#DIM 効果数値, 1

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 25
	アビ名 = 银冰吐息+
	消費ＭＰ = 60
ELSE
	アビ名 = 银冰吐息
	消費ＭＰ = 70
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}　　对敌方单体造成［攻击力✕400％］的水属性伤害。
		詳細文文字列受け渡し変数 += @"<br>赋予［每层10％/最大40％］（叠加槽・4回合）的攻击力下降效果。"
		詳細文文字列受け渡し変数 += @"<br>赋予［每层10％/最大40％］（叠加槽・4回合）的防御力下降效果。"
		詳細文文字列受け渡し変数 += @"<br>赋予银冰吐息效果（4回合・不可驱散）。"
		詳細文文字列受け渡し変数 += @"<br>当目标存在银冰吐息效果时，此技能会发动2次连击。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_敵単体
		アビ汎用変数:効果割合 = 400
		FOR LOCAL, 10, 20
			IF デバフ番号取得_枠("银冰吐息", LOCAL) > -1
				CALL アビテンプレート_ダメージ処理_水属性
			ENDIF
		NEXT
		CALL アビテンプレート_ダメージ処理_水属性
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 攻撃力累積
		アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
		アビ汎用変数:効果割合 = 10
		アビ汎用変数:累積上限_割合 = 40
		アビ汎用変数:持続ターン = 4
		アビ汎用変数:基礎成功確率 = 100
		FOR LOCAL, 10, 20
			IF デバフ番号取得_枠("银冰吐息", LOCAL) > -1
				CALL アビテンプレート_不利効果_累積デバフ効果セット
			ENDIF
		NEXT
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 防御力累積
		アビ汎用文字列:バフ・デバフ対象能力 = 防御力
		アビ汎用変数:効果割合 = 10
		アビ汎用変数:累積上限_割合 = 40
		アビ汎用変数:持続ターン = 4
		アビ汎用変数:基礎成功確率 = 100
		FOR LOCAL, 10, 20
			IF デバフ番号取得_枠("银冰吐息", LOCAL) > -1
				CALL アビテンプレート_不利効果_累積デバフ効果セット
			ENDIF
		NEXT
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 银冰吐息
		アビ汎用変数:持続ターン = 4
		アビ汎用変数:基礎成功確率 = 999
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		IF バフ番号取得_枠("银冰飞雪", 戦闘行動キャラ) > -1
			アビ汎用変数:効果割合 = 100
			FOR LOCAL, 0, 6
				CALL アビテンプレート_ダメージ処理_水属性
			NEXT
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 氷結
			アビ汎用文字列:バフ・デバフ対象能力 = 氷結
			CALL バフ込み数値算出("攻撃力")
			アビ汎用変数:効果量 = RESULT
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 1
			CALL アビテンプレート_不利効果_スロウ
			
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用変数:消去不可バフデバフ削除オプション = 1
			CALL アビテンプレート_不利効果_バフ消去("银冰飞雪")
		ENDIF
ENDSELECT




@固有アビ_287_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名


;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
	アビ名 = 白银雪花+
	消費ＭＰ = 100
ELSE
	アビ名 = 白银雪花
	消費ＭＰ = 120
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>赋予我方全体［30］（常规槽・6回合）的水属性攻击提升效果。
		詳細文文字列受け渡し変数 += "<br>赋予［25％］（常规槽・6回合）的技能伤害提升效果。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 白银雪花
		アビ汎用文字列:バフ・デバフ対象能力 = 白银雪花
		アビ汎用変数:持続ターン = 6
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = -1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 属性与ダメージ_水
		アビ汎用文字列:バフ・デバフ対象能力 = 属性与ダメージ_水
		アビ汎用変数:効果割合 = 30
		アビ汎用変数:持続ターン = 6
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = ダメージ補正_アビリティダメージ
		アビ汎用文字列:バフ・デバフ対象能力 = ダメージ補正_アビリティダメージ
		アビ汎用変数:効果割合 = 25
		アビ汎用変数:持続ターン = 6
		CALL アビテンプレート_有利効果_バフ効果セット
ENDSELECT




@固有アビ_287_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 効果数値, 1

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 15
 	アビ名 = 冰雪抱拥
 	消費ＭＰ = 120
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>对敌方单体造成［攻击力✕100％］的水属性伤害6次。
		詳細文文字列受け渡し変数 += @"<br>赋予［攻击力✕100％］（常规槽・3回合）的冰结效果。"
		詳細文文字列受け渡し変数 += @"<br>赋予［1］层减速效果。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_敵単体
		アビ汎用変数:効果割合 = 100
		FOR LOCAL, 0, 6
			CALL アビテンプレート_ダメージ処理_水属性
		NEXT
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 氷結
		アビ汎用文字列:バフ・デバフ対象能力 = 氷結
		CALL バフ込み数値算出("攻撃力")
		アビ汎用変数:効果量 = RESULT
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:基礎成功確率 = 100
		CALL アビテンプレート_不利効果_デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 1
		CALL アビテンプレート_不利効果_スロウ
ENDSELECT




@固有戦闘開始時処理_キャラ_287
#DIM 隊列番号
#DIM 対象番号

CALL アビ対象選択テンプレート_自己のみ
アビテンプレート用_アビ名表示済フラグ = 1

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 氷結・氷牢反応
アビ汎用文字列:バフ・デバフ対象能力 = 氷結・氷牢反応
アビ汎用変数:持続ターン = -1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:特殊表示オプション = -1
アビ汎用文字列:適用範囲 = 味方全体
CALL アビテンプレート_有利効果_パッシブバフ効果セット




@固有行動直後処理_バフ・デバフ_氷結・氷牢反応(効果番号)
#DIM 効果番号
#DIM 行動キャラ保存
#DIM 隊列番号
#DIMS 银冰吐息

;その行動で氷結・氷牢を付けてないなら戻す
SIF STRFIND(アビテンプレート用_付与デバフ保存, "氷結") < 0 && STRFIND(アビテンプレート用_付与デバフ保存, "氷牢") < 0
    RETURN 0

;フィルレインが前衛にいないなら戻す
隊列番号 = キャラ隊列検索(キャラ検索("[银冰龙女]菲琳"))
SIF 隊列番号 < 0 || 隊列番号 > 3
    RETURN 0

;一時的に戦闘行動キャラをフィルレインに渡す
SWAP 戦闘行動キャラ, 行動キャラ保存
戦闘行動キャラ = 隊列番号

;ここに银冰吐息処理いれるんだけど、あのアビ単体対象だしどうするんだろ。まあどうにかする
;とりあえずランダムターゲットに
アビテンプレート用_アビ名 = 银冰吐息

CALL アビ汎用変数文字列リセット
CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
アビ汎用変数:効果割合 = 400
FOR LOCAL, 10, 20
	IF デバフ番号取得_枠("银冰吐息", LOCAL) > -1
		CALL アビテンプレート_ダメージ処理_水属性
	ENDIF
NEXT
CALL アビテンプレート_ダメージ処理_水属性

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 攻撃力_累積
アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
アビ汎用変数:効果割合 = 10
アビ汎用変数:累積上限_割合 = 40
アビ汎用変数:持続ターン = 4
アビ汎用変数:基礎成功確率 = 100
FOR LOCAL, 10, 20
	IF デバフ番号取得_枠("银冰吐息", LOCAL) > -1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
	ENDIF
NEXT
CALL アビテンプレート_不利効果_累積デバフ効果セット
		
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 防御力_累積
アビ汎用文字列:バフ・デバフ対象能力 = 防御力
アビ汎用変数:効果割合 = 10
アビ汎用変数:累積上限_割合 = 40
アビ汎用変数:持続ターン = 4
アビ汎用変数:基礎成功確率 = 100
FOR LOCAL, 10, 20
	IF デバフ番号取得_枠("银冰吐息", LOCAL) > -1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
	ENDIF
NEXT
CALL アビテンプレート_不利効果_累積デバフ効果セット

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 银冰吐息
アビ汎用変数:持続ターン = 4
アビ汎用変数:基礎成功確率 = 999
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:特殊表示オプション = 1
CALL アビテンプレート_不利効果_デバフ効果セット

;戦闘行動キャラを戻す
SWAP 戦闘行動キャラ, 行動キャラ保存




@固有戦闘不能時処理_キャラ_287
#DIM 対象番号
#DIM 氷結・氷牢反応

FOR 対象番号, 0, 4
	氷結・氷牢反応 = バフ番号取得_枠("氷結・氷牢反応", 対象番号)
	CALL 戦闘効果削除(氷結・氷牢反応)
NEXT




@固有行動開始時処理_バフ_永久凍土(バフ・デバフ行数)
#DIM バフ・デバフ行数
#DIM 隊列番号

隊列番号 = キャラ隊列検索(GETCHARA(287))

FOR LOCAL, 10, 20
	IF デバフ番号取得_枠("银冰吐息", LOCAL) > -1
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 被ダメ軽減
		アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
		アビ汎用変数:効果割合 = 20
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 与ダメ増加
		アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
		アビ汎用変数:効果量 = 50
		CALL アビテンプレート_有利効果_バフ効果セット
	ENDIF
NEXT




@バフ・デバフ特殊表示_银冰吐息(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 银冰吐息
PRINTFORML 因菲琳的奥义而获得的受到追加额外伤害的状态［不可驱散］
PRINTFORML 持续回合：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}




@バフ・デバフ特殊表示_银冰飞雪(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 银冰飞雪
PRINTFORML 在下次使用银冰吐息时，将会追加发动冰雪抱拥的状态［不可驱散］
PRINTFORML 持续次数：1


;--------------------------------------------------
;戦闘能力の固有処理説明
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_287(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

;口上と同じ感覚で使う為に書式を統一しているが、ステータス画面で表示されるので
;基本的にWAIT系列は使わないことを推奨

KSTR:(K++) = □ 特性:『这就是你最后的呼吸』 □-------------------------------------------------------------------------------
KSTR:(K++) = 　当我方对敌人使用造成冻结或冰牢状态的能力后，无论敌人处于何种状态都会追加发动银冰吐息
KSTR:(K++) = 　
KSTR:(K++) = □ 特性:『永久冻土』 □-------------------------------------------------------------------------------
KSTR:(K++) = 　我方受到处于银冰吐息状态的敌人伤害降低/对处于银冰吐息状态的敌人造成伤害增加

CALL 口上変数表示(対象キャラ, 1)
