;CUP計算用関数
;ARG	被行為者
;ARG:1	行為者
;ARG:2	強度
;--------------------------------------------------------------------------------------------------
;CUP一覧と上昇PALAM
;--------------------------------------------------------------------------------------------------
;CALC_快Ｃ：快Ｃ・潤滑・欲情
;CALC_快Ｖ：快Ｖ・潤滑・欲情
;CALC_快Ａ：快Ａ・潤滑・欲情・屈服
;CALC_快Ｂ：快Ｂ・潤滑・欲情
;CALC_快Ｓ：快Ｓ・潤滑・欲情
;CALC_接触：欲情・不快・好感度UP
;CALC_液体：潤滑
;CALC_露出：欲情・潤滑・恥情・反感・屈服
;CALC_苦痛：苦痛・欲情・潤滑・反感・屈服
;CALC_拘束：欲情・潤滑・反感・屈服
;CALC_歓楽：好感度UP・欲情
;CALC_奉仕：習得・奉仕・反感・屈服
;CALC_征服：欲情・恥情・征服
;CALC_不潔：不快・反感・屈服
;CALC_絶頂：欲情・潤滑・恥情
;CALC_精液：屈服・不快
;CALC_不快:不快
;CALC_反感：反感
;--------------------------------------------------------------------------------------------------
;基礎値処理
;--------------------------------------------------------------------------------------------------
@SOURCE_COMMON_CHECK(被行為者, 行為者, 行為強度, ソース種別)
#DIM 被行為者
#DIM 行為者
#DIM 行為強度
#DIM ソース種別

;好感度などから基礎値を導く
;ソース種別に応じて基礎値の補正が変動する
;基本的にMAXで200になるよう調整だが、ABLの数値によっては限界突破する


SELECTCASE ソース種別
	CASE 0 TO 5
		;物理的な快楽は好感度などの補正が最小限
		IF 行為者 == MASTER
			LOCAL = ((CFLAG:被行為者:好感度レベル + 恋慕_性愛比較(被行為者)) / 4) + ABL:被行為者:ソース種別 * 15
			LOCAL = (LOCAL + 50) * 行為強度 / 100
		ELSE
			;MASTER関係ない場合、100%ABLで計算する
			LOCAL = ABL:被行為者:ソース種別 * 20 * 行為強度 / 100 + 50
		ENDIF
	CASE 10 TO 15
		;精神的な快楽は好感度がそこそこ影響する
		IF 行為者 == MASTER
			LOCAL = (CFLAG:被行為者:好感度レベル + 恋慕_性愛比較(被行為者) / 2) + ABL:被行為者:ソース種別 * 10
			LOCAL = (LOCAL + 50) * 行為強度 / 100
		ELSE
			;MASTER関係ない場合、100%ABLで計算する
			LOCAL = ABL:被行為者:ソース種別 * 20 * 行為強度 / 100 + 50
		ENDIF
	CASE 20, 999
		;技巧、歓楽・好感度・恋慕度は好感度のみ影響する
		IF 行為者 == MASTER
			LOCAL = (CFLAG:被行為者:好感度レベル + 恋慕_恋心比較(被行為者)+ 50) * 行為強度 / 100
		ELSE
			;MASTER関係ない場合、Lv50（友人相手にした時）として計算する
			LOCAL = 行為強度 / 2
		ENDIF
ENDSELECT
;全ソース影響する要素
;貞操観念はあらゆるソースを減少させる（恋慕後は無効）
SIF TALENT:被行為者:貞操 > 0 && !TALENT:被行為者:恋慕
	LOCAL = LOCAL * 9 / 10
;抵抗はあらゆるソースを減少させる（恋慕後は無効）
SIF TALENT:被行為者:抵抗 > 0 && !TALENT:被行為者:恋慕
	LOCAL = LOCAL * 9 / 10
;性転換は陥落があるなら増加、ないなら減少
IF 行為者 > -1
	IF TALENT:被行為者:性転換 && TALENT:被行為者:性転換 == TALENT:行為者:性別
		IF 陥落チェック(被行為者)
			LOCAL = LOCAL * 11 / 10
		ELSE
			LOCAL = LOCAL * 9 / 10
		ENDIF
	ENDIF
ENDIF
;発情期はなんでも喜ぶ
SIF CFLAG:被行為者:発情期フラグ < 0
	LOCAL = LOCAL * 15 / 10

RETURN LOCAL


@NEGATIVE_SOURCE_COMMON_CHECK(被行為者, 行為者, 行為強度)
#DIM 被行為者
#DIM 行為者
#DIM 行為強度
#DIM ソース種別

;こっちは増加することでデメリットが発生するソースの基礎値計算（反感・不快）
;好感度などから基礎値を導く
;ソース種別に応じて基礎値の補正が変動する
;行為強度が一定値以下なら1に補正


;物理的な快楽は好感度などの補正が最小限
IF 行為者 == MASTER
	;基本値
	LOCAL = (2000 * 行為強度 / 100)
	;一定値以下の行為強度の場合は1に補正
	;一定値は素質によって変動
	LOCAL:1 = 40
	LOCAL:1 += CFLAG:被行為者:好感度レベル / 5
	LOCAL:1 += 恋慕_恋心比較(被行為者)
	LOCAL:1 += TALENT:被行為者:恋慕 * 20
	LOCAL:1 += TALENT:被行為者:態度 * -10
	LOCAL:1 += TALENT:被行為者:プライド * -15
	IF CFLAG:被行為者:好感度レベル < 51
		LOCAL:1 += TALENT:被行為者:ツンデレ * -10
	ELSE
		LOCAL:1 += 15
		LOCAL:1 += TALENT:被行為者:ツンデレ * 20
	ENDIF
	SIF TALENT:被行為者:無関心 > 0
		LOCAL:1 += TALENT:被行為者:無関心 * 10
	LOCAL:1 += TALENT:被行為者:感情乏しい * 10
	LOCAL:1 += TALENT:被行為者:抵抗 * -20
	
	SIF LOCAL:1 >= 行為強度
		LOCAL = 0
	RETURN LOCAL
ELSE
	;MASTER関係ない場合0
	RETURN 0
ENDIF

RETURN LOCAL

;--------------------------------------------------------------------------------------------------
;数値減衰処理
;--------------------------------------------------------------------------------------------------
@SOURCE_上限減衰(ARG, ARG:1)
#FUNCTION
#DIM 減衰ライン値
#DIM 計算数値
減衰ライン値 = 6000

IF ARG:1
	ARG:1 = MIN(ARG:1, 1000)
	減衰ライン値 = 減衰ライン値 * (666 + ARG:1) / 666
ENDIF

計算数値 = ARG
;一回のコマンドで与えるソースの量がインフレしないように上限を設ける
IF 計算数値 >= 減衰ライン値
	計算数値 = (計算数値 - 減衰ライン値) / 4 + 減衰ライン値
ENDIF

IF 計算数値 >= 減衰ライン値 + 500
	計算数値 = (計算数値 - (減衰ライン値 + 500)) / 10 + (減衰ライン値 + 500)
ENDIF

IF 計算数値 >= 減衰ライン値 + 1000
	計算数値 = (計算数値 - (減衰ライン値 + 1000)) / 100 + (減衰ライン値 + 1000)
ENDIF

RETURNF 計算数値

@NEGATIVE_SOURCE_上限減衰(ARG, 基礎値)
#FUNCTION
#DIM 基礎値

LOCAL = ARG
;反感不快が発生しているのに実質０にならないよう、1/10に減衰ラインを設ける
IF LOCAL >= 基礎値 * 8 / 10
	LOCAL = (LOCAL - (基礎値 * 8 / 10)) / 4 + (基礎値 * 8 / 10)
ENDIF
IF LOCAL >= 基礎値 * 9 / 10
	LOCAL = (LOCAL - (基礎値 * 9 / 10)) / 10 + (基礎値 * 9 / 10)
ENDIF

RETURNF LOCAL

@数値丸め(ARG, ARG:1)
#FUNCTION
;ARGの値をARG:1周辺を減衰ラインにして丸める

;第一減衰ライン
LOCAL = ARG:1 * 4 / 5
;第二減衰ライン
LOCAL:1 = ARG:1
;第三減衰ライン
LOCAL:2 = ARG:1 * 6 / 5
;第四減衰ライン
LOCAL:3 = ARG:1 * 7 / 5

IF ARG > LOCAL
	ARG = (ARG - LOCAL) / 4 + LOCAL
ENDIF

IF ARG > LOCAL:1
	ARG = (ARG - LOCAL:1) / 10 + LOCAL:1
ENDIF

IF ARG > LOCAL:2
	ARG = (ARG - LOCAL:2) / 100 + LOCAL:2
ENDIF

IF ARG > LOCAL:3
	ARG = (ARG - LOCAL:3) / 1000 + LOCAL:3
ENDIF

RETURNF ARG

;--------------------------------------------------------------------------------------------------
;快Ｃ
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_快Ｃ(ARG, ARG:1, ARG:2)
VARSET LOCAL

;C無しの場合なにも発生しない
SIF TALENT:ARG:Ｃ感度 == -2
	RETURN 0

;快Ｃ計算
;基礎値
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "Ｃ感覚"))
	LOCAL = RESULT + 500
;物理枠（Ａ枠）
	;技巧(3で等倍、それ以下やそれ以上だと補正、最大+35%)
	SIF ARG:1 >= 0
		LOCAL:1 += (ABL:(ARG:1):技巧 - 3) * 5
	;媚薬(+100%)
	SIF TEQUIP:ARG:媚薬
		LOCAL:1 += 100
	;Ｃ感度(-20%～+20%)
	SIF TALENT:ARG:Ｃ感度
		LOCAL:1 += TALENT:ARG:Ｃ感度 * 20
	;発情期の過敏体質化
	SIF GETBIT(TALENT:ARG:発情期あり, 6) && CFLAG:ARG:発情期フラグ < 0
		LOCAL:1 += 20
;経験枠（Ｂ枠）
	;うふふ中、既に同一部位で絶頂してたら大補正
	LOCAL:2 += MIN(TCVAR:ARG:うふふ中Ｃ絶頂累積 * 20, 100)
	;Ｃ経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｃ経験, 250)
	;Ｃ絶頂経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｃ絶頂経験, 250)
;精神枠（Ｃ枠）
	;PALAM:欲情をみる
	IF PALAM:ARG:欲情 < PALAMLV:1
		LOCAL:3 += -20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:2
		LOCAL:3 += 0
	ELSEIF PALAM:ARG:欲情 < PALAMLV:3
		LOCAL:3 += 20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:4
		LOCAL:3 += 40
	ELSEIF PALAM:ARG:欲情 >= PALAMLV:4
		LOCAL:3 += 60
	ENDIF
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 200 , 3000)
	;性別嗜好
	IF ARG >= 0 && ARG:1 >= 0
		SIF 同性愛性癖判定(ARG, ARG:1)
			LOCAL:3 += 性癖素質:ARG:同性愛 * 10
		SELECTCASE TALENT:ARG:性別嗜好
			CASE 1
				SIF TALENT:(ARG:1):性別 == 2
					LOCAL:3 += -30
			CASE 2
				SIF TALENT:(ARG:1):性別 == 1
					LOCAL:3 += -30
			CASE 3
				LOCAL:3 += -30
		ENDSELECT
		;調教者のTALENT:謎の魅力をみる
		SIF ARG:1 >= 0 && TALENT:(ARG:1):謎の魅力
			LOCAL:3 += 20
	ENDIF
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = LOCAL * (LOCAL:1 + 100) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100
;首絞め補正
LOCAL = 首絞め補正_快楽(ARG, LOCAL)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
SIF ARG:1 == MASTER
	LOCAL = LOCAL * (1000 + 数値丸め(EXP:ARG:肉体熟知, 1000)) / 1000
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
	
IF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	CUP:ARG:快Ｃ += LOCAL / 4
	SIF ARG == MASTER && ARG:1 >= 0
		TCVAR:(ARG:1):あなた快楽上昇 += LOCAL / 4
ELSE
	CUP:ARG:快Ｃ += LOCAL
	SIF ARG == MASTER && ARG:1 >= 0
		TCVAR:(ARG:1):あなた快楽上昇 += LOCAL
ENDIF
	
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(0, LOCAL)
;勃起度上昇
IF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL)
ENDIF
IF ARG:1 > -1 && TALENT:(ARG:1):性別 & 2
	CALL 勃起度上昇(ARG:1, LOCAL / 5)
ENDIF
;快Ｃ計算ここまで

CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = TALENT:ARG:快感応答 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで

;快楽発生時かつ非うふふ時、欲情に応じて性欲が上昇
SIF CFLAG:ARG:うふふ == 0 && TALENT:ARG:性欲 > -2
	BASE:ARG:性欲 = MIN(MAXBASE:ARG:性欲, BASE:ARG:性欲 + LOCAL / 20)

;--------------------------------------------------------------------------------------------------
;快Ｖ
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_快Ｖ(ARG, ARG:1, ARG:2)
VARSET LOCAL

;V無しの場合なにも発生しない
SIF TALENT:ARG:Ｖ感度 == -2
	RETURN 0
SIF GETBIT(TALENT:ARG:性別, 0) == 0
	RETURN 0

;快Ｖ計算
;基礎値
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "Ｖ感覚"))
	LOCAL = RESULT
;物理枠（Ａ枠）
	;技巧(3で等倍、それ以下やそれ以上だと補正、最大+35%)
	SIF ARG:1 >= 0
		LOCAL:1 += (ABL:(ARG:1):技巧 - 3) * 5
	;媚薬(+100%)
	SIF TEQUIP:ARG:媚薬
		LOCAL:1 += 100
	;Ｖ感度(-20%～+20%)
	SIF TALENT:ARG:Ｖ感度
		LOCAL:1 += TALENT:ARG:Ｖ感度 * 20
	;PALAM:潤滑(拡張経験があると軽減)
	IF PALAM:ARG:潤滑 < PALAMLV:1
		LOCAL:1 += MIN(-80 + EXP:ARG:Ｖ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 < PALAMLV:2
		LOCAL:1 += MIN(-60 + EXP:ARG:Ｖ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 < PALAMLV:3
		LOCAL:1 += MIN(-40 + EXP:ARG:Ｖ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 < PALAMLV:4
		LOCAL:1 += MIN(-20 + EXP:ARG:Ｖ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 >= PALAMLV:4
		LOCAL:1 += 0
	ENDIF
	;発情期の過敏体質化
	SIF GETBIT(TALENT:ARG:発情期あり, 6) && CFLAG:ARG:発情期フラグ < 0
		LOCAL:1 += 20
;経験枠（Ｂ枠）
	;うふふ中、既に同一部位で絶頂してたら大補正
	LOCAL:2 += MIN(TCVAR:ARG:うふふ中Ｖ絶頂累積 * 20, 100)
	;Ｖ経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｖ経験, 250)
	;Ｖ絶頂経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｖ絶頂経験, 250)
	;処女
	SIF TALENT:ARG:処女
		LOCAL:2 += -30
;精神枠（Ｃ枠）
	;PALAM:欲情をみる
	IF PALAM:ARG:欲情 < PALAMLV:1
		LOCAL:3 += -20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:2
		LOCAL:3 += 0
	ELSEIF PALAM:ARG:欲情 < PALAMLV:3
		LOCAL:3 += 20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:4
		LOCAL:3 += 40
	ELSEIF PALAM:ARG:欲情 >= PALAMLV:4
		LOCAL:3 += 60
	ENDIF
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 200 , 3000)
	;性別嗜好
	IF ARG >= 0 && ARG:1 >= 0
		SIF 同性愛性癖判定(ARG, ARG:1)
			LOCAL:3 += 性癖素質:ARG:同性愛 * 10
		SELECTCASE TALENT:ARG:性別嗜好
			CASE 1
				SIF TALENT:(ARG:1):性別 == 2
					LOCAL:3 += -30
			CASE 2
				SIF TALENT:(ARG:1):性別 == 1
					LOCAL:3 += -30
			CASE 3
				LOCAL:3 += -30
		ENDSELECT
		;調教者のTALENT:謎の魅力をみる
		SIF ARG:1 >= 0 && TALENT:(ARG:1):謎の魅力
			LOCAL:3 += 20
	ENDIF
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = LOCAL * MAX(LOCAL:1 + 100, 1) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100
;首絞め補正
LOCAL = 首絞め補正_快楽(ARG, LOCAL)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
IF RCVAR:ARG:Ｇスポ開発フラグ
	LOCAL:1 = MIN(EXP:ARG:Ｇスポ開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:Ｇスポ開発)
ELSEIF RCVAR:ARG:ポルチオ開発フラグ
	LOCAL:1 = MIN(EXP:ARG:ポルチオ開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:ポルチオ開発)
ELSE
	LOCAL = SOURCE_上限減衰(LOCAL)
ENDIF
SIF ARG:1 == MASTER
	LOCAL = LOCAL * (1000 + 数値丸め(EXP:ARG:肉体熟知, 1000)) / 1000
IF RCVAR:ARG:膣内射精フラグ
	;膣内射精補正
	IF 性癖素質:ARG:膣内射精 > 0
		LOCAL += 性癖素質:ARG:膣内射精 * 3500
	ENDIF
	LOCAL += MIN(EXP:ARG:膣内射精絶頂経験, 100) * 35
ELSE
	;弱点コマンド
	SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
		LOCAL = LOCAL * 15 / 10
ENDIF
CUP:ARG:快Ｖ += LOCAL
SIF ARG == MASTER && ARG:1 >= 0
	TCVAR:(ARG:1):あなた快楽上昇 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(1, LOCAL)
;快Ｖ計算ここまで

;女性、ふたなり
IF TALENT:ARG:性別 & 1
	CUP:ARG:潤滑 += (LOCAL / 5) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)
ELSE
	CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)
ENDIF

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = TALENT:ARG:快感応答 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
IF ARG:1 > -1 && TALENT:(ARG:1):性別 & 2
	CALL 勃起度上昇(ARG:1, LOCAL / 5)
ENDIF
;欲情計算ここまで

;快楽発生時かつ非うふふ時、欲情に応じて性欲が上昇
SIF CFLAG:ARG:うふふ == 0 && TALENT:ARG:性欲 > -2
	BASE:ARG:性欲 = MIN(MAXBASE:ARG:性欲, BASE:ARG:性欲 + LOCAL / 20)


;--------------------------------------------------------------------------------------------------
;快Ａ
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_快Ａ(ARG, ARG:1, ARG:2)
VARSET LOCAL

;A無しの場合なにも発生しない
SIF TALENT:ARG:Ａ感度 == -2
	RETURN 0

;快Ａ計算
;基礎値
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "Ａ感覚"))
	LOCAL = RESULT
;物理枠（Ａ枠）
	;技巧(3で等倍、それ以下やそれ以上だと補正、最大+35%)
	SIF ARG:1 >= 0
		LOCAL:1 += (ABL:(ARG:1):技巧 - 3) * 5
	;媚薬(+100%)
	SIF TEQUIP:ARG:媚薬
		LOCAL:1 += 100
	;Ａ感度(-20%～+20%)
	SIF TALENT:ARG:Ａ感度
		LOCAL:1 += TALENT:ARG:Ａ感度 * 20
	;PALAM:潤滑(拡張経験があると軽減)
	IF PALAM:ARG:潤滑 < PALAMLV:1
		LOCAL:1 += MIN(-80 + EXP:ARG:Ａ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 < PALAMLV:2
		LOCAL:1 += MIN(-60 + EXP:ARG:Ａ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 < PALAMLV:3
		LOCAL:1 += MIN(-40 + EXP:ARG:Ａ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 < PALAMLV:4
		LOCAL:1 += MIN(-20 + EXP:ARG:Ａ拡張経験, 0)
	ELSEIF PALAM:ARG:潤滑 >= PALAMLV:4
		LOCAL:1 += 0
	ENDIF
	;発情期の過敏体質化
	SIF GETBIT(TALENT:ARG:発情期あり, 6) && CFLAG:ARG:発情期フラグ < 0
		LOCAL:1 += 20
;経験枠（Ｂ枠）
	;うふふ中、既に同一部位で絶頂してたら大補正
	LOCAL:2 += MIN(TCVAR:ARG:うふふ中Ａ絶頂累積 * 20, 100)
	;Ａ経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ａ経験, 250)
	;Ａ絶頂経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ａ絶頂経験, 250)
;精神枠（Ｃ枠）
	;PALAM:欲情をみる
	IF PALAM:ARG:欲情 < PALAMLV:1
		LOCAL:3 += -20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:2
		LOCAL:3 += 0
	ELSEIF PALAM:ARG:欲情 < PALAMLV:3
		LOCAL:3 += 20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:4
		LOCAL:3 += 40
	ELSEIF PALAM:ARG:欲情 >= PALAMLV:4
		LOCAL:3 += 60
	ENDIF
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 200 , 3000)
	;性別嗜好
	IF ARG >= 0 && ARG:1 >= 0
		SIF 同性愛性癖判定(ARG, ARG:1)
			LOCAL:3 += 性癖素質:ARG:同性愛 * 10
		SELECTCASE TALENT:ARG:性別嗜好
			CASE 1
				SIF TALENT:(ARG:1):性別 == 2
					LOCAL:3 += -30
			CASE 2
				SIF TALENT:(ARG:1):性別 == 1
					LOCAL:3 += -30
			CASE 3
				LOCAL:3 += -30
		ENDSELECT
		;調教者のTALENT:謎の魅力をみる
		SIF ARG:1 >= 0 && TALENT:(ARG:1):謎の魅力
			LOCAL:3 += 20
	ENDIF
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = LOCAL * MAX(LOCAL:1 + 100, 1) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100
;首絞め補正
LOCAL = 首絞め補正_快楽(ARG, LOCAL)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
IF RCVAR:ARG:前立腺開発フラグ
	LOCAL:1 = MIN(EXP:ARG:前立腺開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:前立腺開発)
ELSEIF RCVAR:ARG:Ｓ字結腸開発フラグ
	LOCAL:1 = MIN(EXP:ARG:Ｓ字結腸開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:Ｓ字結腸開発)
ELSEIF RCVAR:ARG:尻尾開発フラグ
	LOCAL:1 = MIN(EXP:ARG:尻尾開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:尻尾開発)
ELSE
	LOCAL = SOURCE_上限減衰(LOCAL)
ENDIF
SIF ARG:1 == MASTER
	LOCAL = LOCAL * (1000 + 数値丸め(EXP:ARG:肉体熟知, 1000)) / 1000
IF RCVAR:ARG:腸内射精フラグ
	;腸内射精補正
	IF 性癖素質:ARG:腸内射精 > 0
		LOCAL += 性癖素質:ARG:腸内射精 * 3500
	ENDIF
	LOCAL += MIN(EXP:ARG:腸内射精絶頂経験, 100) * 35
ELSE
	;弱点コマンド
	SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
		LOCAL = LOCAL * 15 / 10
ENDIF
CUP:ARG:快Ａ += LOCAL
SIF ARG == MASTER && ARG:1 >= 0
	TCVAR:(ARG:1):あなた快楽上昇 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(2, LOCAL)
;快Ａ計算ここまで

;女性、ふたなり
IF TALENT:ARG:性別 & 1
	CUP:ARG:潤滑 += (LOCAL / 5) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)
ELSE
	CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)
ENDIF

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = TALENT:ARG:快感応答 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
IF ARG:1 > -1 && TALENT:(ARG:1):性別 & 2
	CALL 勃起度上昇(ARG:1, LOCAL / 5)
ENDIF
;欲情計算ここまで

;快楽発生時かつ非うふふ時、欲情に応じて性欲が上昇
SIF CFLAG:ARG:うふふ == 0 && TALENT:ARG:性欲 > -2
	BASE:ARG:性欲 = MIN(MAXBASE:ARG:性欲, BASE:ARG:性欲 + LOCAL / 20)

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = TALENT:ARG:Ａ感度 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで
;--------------------------------------------------------------------------------------------------
;快Ｂ
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_快Ｂ(ARG, ARG:1, ARG:2)
VARSET LOCAL

;B無しの場合なにも発生しない
SIF TALENT:ARG:Ｂ感度 == -2
	RETURN 0

;快Ｂ計算
;基礎値
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "Ｂ感覚"))
	IF TALENT:ARG:性別 & 1
		LOCAL = RESULT + 250
	ELSE
		LOCAL = MAX((ABL:ARG:Ｂ感覚 + 1) * 10, RESULT - 100)
	ENDIF
;物理枠（Ａ枠）
	;技巧(3で等倍、それ以下やそれ以上だと補正、最大+35%)
	SIF ARG:1 >= 0
		LOCAL:1 += (ABL:(ARG:1):技巧 - 3) * 5
	;媚薬(+100%)
	SIF TEQUIP:ARG:媚薬
		LOCAL:1 += 100
	;Ｂ感度(-20%～+20%)
	LOCAL:1 += TALENT:ARG:Ｂ感度 * 20
	;ドラフ(+30%)
	SIF TALENT:ARG:種族 == 3
		LOCAL:1 += 30
	;発情期の過敏体質化
	SIF GETBIT(TALENT:ARG:発情期あり, 6) && CFLAG:ARG:発情期フラグ < 0
		LOCAL:1 += 20
;経験枠（Ｂ枠）
	;うふふ中、既に同一部位で絶頂してたら大補正
	LOCAL:2 += MIN(TCVAR:ARG:うふふ中Ｂ絶頂累積 * 20, 100)
	;Ｂ経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｂ経験, 250)
	;Ｂ絶頂経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｂ絶頂経験, 250)
;精神枠（Ｃ枠）
	;PALAM:欲情をみる
	IF PALAM:ARG:欲情 < PALAMLV:1
		LOCAL:3 += -20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:2
		LOCAL:3 += 0
	ELSEIF PALAM:ARG:欲情 < PALAMLV:3
		LOCAL:3 += 20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:4
		LOCAL:3 += 40
	ELSEIF PALAM:ARG:欲情 >= PALAMLV:4
		LOCAL:3 += 60
	ENDIF
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 200 , 3000)
	;性別嗜好
	IF ARG >= 0 && ARG:1 >= 0
		SIF 同性愛性癖判定(ARG, ARG:1)
			LOCAL:3 += 性癖素質:ARG:同性愛 * 10
		SELECTCASE TALENT:ARG:性別嗜好
			CASE 1
				SIF TALENT:(ARG:1):性別 == 2
					LOCAL:3 += -30
			CASE 2
				SIF TALENT:(ARG:1):性別 == 1
					LOCAL:3 += -30
			CASE 3
				LOCAL:3 += -30
		ENDSELECT
		;調教者のTALENT:謎の魅力をみる
		SIF ARG:1 >= 0 && TALENT:(ARG:1):謎の魅力
			LOCAL:3 += 20
	ENDIF
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = LOCAL * (LOCAL:1 + 100) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100
;首絞め補正
LOCAL = 首絞め補正_快楽(ARG, LOCAL)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
IF RCVAR:ARG:乳首開発フラグ
	;乳首開発フラグが立ってるなら陥没乳首系の処理を突っ込む
	IF TALENT:ARG:陥没乳首
		;快楽1.2倍
		LOCAL = LOCAL * 12 / 10
		SIF PALAM:ARG:欲情 >= PALAMLV:3
			TCVAR:ARG:陥没乳首露出フラグ = MIN(TCVAR:ARG:陥没乳首露出フラグ + 10, 100)
	ENDIF
	LOCAL:1 = MIN(EXP:ARG:乳首開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:乳首開発)
ELSE
	LOCAL = SOURCE_上限減衰(LOCAL)
ENDIF
SIF ARG:1 == MASTER
	LOCAL = LOCAL * (1000 + 数値丸め(EXP:ARG:肉体熟知, 1000)) / 1000
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
	
SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200
	
CUP:ARG:快Ｂ += LOCAL
SIF ARG == MASTER && ARG:1 >= 0
	TCVAR:(ARG:1):あなた快楽上昇 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(3, LOCAL)
;快Ｂ計算ここまで

;潤滑＋
CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = TALENT:ARG:快感応答 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)

SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200

CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
IF ARG:1 > -1 && TALENT:(ARG:1):性別 & 2
	CALL 勃起度上昇(ARG:1, LOCAL / 5)
ENDIF
;欲情計算ここまで

;快楽発生時かつ非うふふ時、欲情に応じて性欲が上昇
SIF CFLAG:ARG:うふふ == 0 && TALENT:ARG:性欲 > -2
	BASE:ARG:性欲 = MIN(MAXBASE:ARG:性欲, BASE:ARG:性欲 + LOCAL / 20)


;--------------------------------------------------------------------------------------------------
;快Ｓ
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_快Ｓ(ARG, ARG:1, ARG:2)
VARSET LOCAL

;快Ｓ計算(他の感覚に比べ上昇しづらい)
;基礎値
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 3, GETNUM(ABL, "Ｓ感覚"))
	LOCAL = RESULT
;物理枠（Ａ枠）
	;技巧(3で等倍、それ以下やそれ以上だと補正、最大+35%)
	SIF ARG:1 >= 0
		LOCAL:1 += (ABL:(ARG:1):技巧 - 3) * 5
	;媚薬(+100%)
	SIF TEQUIP:ARG:媚薬
		LOCAL:1 += 100
	;Ｓ感度(-20%～+20%)
	SIF TALENT:ARG:Ｓ感度
		LOCAL:1 += TALENT:ARG:Ｓ感度 * 20
	;発情期の過敏体質化
	SIF GETBIT(TALENT:ARG:発情期あり, 6) && CFLAG:ARG:発情期フラグ < 0
		LOCAL:1 += 20
;経験枠（Ｂ枠）
	;うふふ中、既に同一部位で絶頂してたら大補正
	LOCAL:2 += MIN(TCVAR:ARG:うふふ中Ｓ絶頂累積 * 20, 100)
	;Ｓ経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｓ経験, 250)
	;Ｓ絶頂経験（最大+250%）
	LOCAL:2 += MIN(EXP:ARG:Ｓ絶頂経験, 250)
;精神枠（Ｃ枠）
	;PALAM:欲情をみる
	IF PALAM:ARG:欲情 < PALAMLV:1
		LOCAL:3 += -20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:2
		LOCAL:3 += 0
	ELSEIF PALAM:ARG:欲情 < PALAMLV:3
		LOCAL:3 += 20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:4
		LOCAL:3 += 40
	ELSEIF PALAM:ARG:欲情 >= PALAMLV:4
		LOCAL:3 += 60
	ENDIF
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 200 , 3000)
	;性別嗜好
	IF ARG >= 0 && ARG:1 >= 0
		SIF 同性愛性癖判定(ARG, ARG:1)
			LOCAL:3 += 性癖素質:ARG:同性愛 * 10
		SELECTCASE TALENT:ARG:性別嗜好
			CASE 1
				SIF TALENT:(ARG:1):性別 == 2
					LOCAL:3 += -30
			CASE 2
				SIF TALENT:(ARG:1):性別 == 1
					LOCAL:3 += -30
			CASE 3
				LOCAL:3 += -30
		ENDSELECT
		;調教者のTALENT:謎の魅力をみる
		SIF ARG:1 >= 0 && TALENT:(ARG:1):謎の魅力
			LOCAL:3 += 20
	ENDIF
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = LOCAL * (LOCAL:1 + 100) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100
;首絞め補正
LOCAL = 首絞め補正_快楽(ARG, LOCAL, 1)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
IF RCVAR:ARG:角開発フラグ
	LOCAL = LOCAL * MIN(3, (EXP:ARG:角開発 / 100 + 1))
	LOCAL:1 = MIN(EXP:ARG:角開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:角開発)
ELSEIF RCVAR:ARG:尻尾開発フラグ
	LOCAL = LOCAL * MIN(3, (EXP:ARG:尻尾開発 / 100 + 1))
	LOCAL:1 = MIN(EXP:ARG:尻尾開発, 1000)
	LOCAL = LOCAL * (200 + LOCAL:1) / 200
	LOCAL = SOURCE_上限減衰(LOCAL, EXP:ARG:尻尾開発)
ELSE
	LOCAL = SOURCE_上限減衰(LOCAL)
ENDIF
SIF ARG:1 == MASTER
	LOCAL = LOCAL * (1000 + 数値丸め(EXP:ARG:肉体熟知, 1000)) / 1000
IF RCVAR:ARG:精飲フラグ
	;精飲時補正
	IF 性癖素質:ARG:精飲 > 0
		LOCAL += 性癖素質:ARG:精飲 * 3500
	ENDIF
	LOCAL += MIN(EXP:ARG:精飲快楽経験, 100) * 20
ELSE
	;弱点コマンド
	SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
		LOCAL = LOCAL * 15 / 10
ENDIF


IF TALENT:ARG:性別 == 2  &&  OPTION変数:男性感度上昇低下
	CUP:ARG:快Ｓ += LOCAL / 20
	SIF ARG == MASTER && ARG:1 >= 0
		TCVAR:(ARG:1):あなた快楽上昇 += LOCAL / 20
ELSE
	CUP:ARG:快Ｓ += LOCAL
	SIF ARG == MASTER && ARG:1 >= 0
		TCVAR:(ARG:1):あなた快楽上昇 += LOCAL
ENDIF
	
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(4, LOCAL)
IF ARG:1 > -1 && TALENT:(ARG:1):性別 & 2
	CALL 勃起度上昇(ARG:1, LOCAL / 5)
ENDIF
;快Ｓ計算ここまで

CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 5, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = TALENT:ARG:快感応答 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで

;快楽発生時かつ非うふふ時、欲情に応じて性欲が上昇
;快Ｓは他部位の倍上昇
SIF CFLAG:ARG:うふふ == 0 && TALENT:ARG:性欲 > -2
	BASE:ARG:性欲 = MIN(MAXBASE:ARG:性欲, BASE:ARG:性欲 + LOCAL / 10)



;--------------------------------------------------------------------------------------------------
;接触
;--------------------------------------------------------------------------------------------------
;欲情、不快の珠、好感度UP
@SOURCE_CALC_接触(ARG, ARG:1, ARG:2)
VARSET LOCAL

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	;性欲の強さ
	LOCAL:1 = TALENT:ARG:性欲 * 20
	SIF TALENT:ARG:性欲 == -2
		LOCAL:1 -= 20
	;体の開発度
	LOCAL:1 += ABL:ARG:Ｃ感覚 + ABL:ARG:Ｖ感覚 + ABL:ARG:Ａ感覚 + ABL:ARG:Ｂ感覚 + ABL:ARG:Ｓ感覚
LOCAL = MAX(0, LOCAL * (LOCAL:1 + 100) / 100)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで


;不快
;恋慕時は発生しない
SIF TALENT:ARG:恋慕 > 0
	RETURN 0
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_不快(ARG, ARG:1, RESULT)
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:不快 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(31, LOCAL - LOCAL:1)
;不快ここまで


;--------------------------------------------------------------------------------------------------
;接触（不快なし）
;主にAUTOCOM（相手からの行動）で使用
;--------------------------------------------------------------------------------------------------
;欲情、不快の珠、好感度UP
@SOURCE_CALC_接触_不快無し(ARG, ARG:1, ARG:2)
VARSET LOCAL

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	;性欲の強さ
	LOCAL:1 = TALENT:ARG:性欲 * 20
	SIF TALENT:ARG:性欲 == -2
		LOCAL:1 -= 20
	;体の開発度
	LOCAL:1 += ABL:ARG:Ｃ感覚 + ABL:ARG:Ｖ感覚 + ABL:ARG:Ａ感覚 + ABL:ARG:Ｂ感覚 + ABL:ARG:Ｓ感覚
LOCAL = MAX(0, LOCAL * (LOCAL:1 + 100) / 100)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで


;--------------------------------------------------------------------------------------------------
;液体追加
;润滑液等の固定値を想定
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_液体(ARG, ARG:1, ARG:2)
	CUP:ARG:潤滑 += ARG:2
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, ARG:2)


;--------------------------------------------------------------------------------------------------
;露出
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_露出(ARG, ARG:1, ARG:2)
;欲情、恥情、反感,屈服

VARSET LOCAL

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	;羞恥心
	LOCAL:1 = TALENT:ARG:羞恥心 * 20
	;ABL:露出癖
	LOCAL:1 += ABL:ARG:露出癖 * 10
	;EXP:露出快楽経験
	LOCAL:1 += MIN(150, EXP:ARG:露出快楽経験)
	;倒錯的
	LOCAL:1 += TALENT:ARG:倒錯的 * 10
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
	
SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200
	
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)

;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで

CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)


;恥情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "露出癖"))
	LOCAL = PALAM変換_恥情(ARG, ARG:1, RESULT)
;ソース別独自枠
	;EXP:露出快楽経験
	LOCAL:1 += MIN(100, EXP:ARG:露出快楽経験 / 10)
	;酩酊・トランス
	IF TCVAR:ARG:トランス残り時間 > 0 && BASE:ARG:酩酊 < 1000
		LOCAL:1 -= 50
	ELSEIF BASE:ARG:酩酊 > 0
		LOCAL:1 += BASE:ARG:酩酊 / -20
	ENDIF
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)

SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200

CUP:ARG:恥情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(10, LOCAL)
;露出癖があるとS快楽が発生することがある
IF LOCAL * ABL:ARG:露出癖 / 10 > 500
	CUP:ARG:快Ｓ += LOCAL * ABL:ARG:露出癖 / 10
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(4, LOCAL * ABL:ARG:露出癖 / 10)
ENDIF
;恥情計算ここまで

;反感
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_反感(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:2 = (ABL:ARG:マゾ性感 + ABL:ARG:露出癖) * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:反感 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(30, LOCAL - LOCAL:1)
;反感ここまで

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = ABL:ARG:露出癖 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)

SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200

CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで

;--------------------------------------------------------------------------------------------------
;露出（反感なし）
;主にAUTOCOM（相手からの行動）で使用
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_露出_反感無し(ARG, ARG:1, ARG:2)
;欲情、恥情、反感,屈服

VARSET LOCAL

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	;羞恥心
	LOCAL:1 = TALENT:ARG:羞恥心 * 20
	;ABL:露出癖
	LOCAL:1 += ABL:ARG:露出癖 * 10
	;倒錯的
	LOCAL:1 += TALENT:ARG:倒錯的 * 10
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
	
SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200
	
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで

CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)


;恥情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "露出癖"))
	LOCAL = PALAM変換_恥情(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)

SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200

CUP:ARG:恥情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(10, LOCAL)
;露出癖があるとS快楽が発生することがある
IF LOCAL * ABL:ARG:露出癖 / 10 > 500
	CUP:ARG:快Ｓ += LOCAL * ABL:ARG:露出癖 / 10
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(4, LOCAL * ABL:ARG:露出癖 / 10)
ENDIF
;欲情計算ここまで

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = ABL:ARG:露出癖 * 20
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)

SIF TALENT:ARG:性別 == 2 &&  OPTION変数:男性感度上昇低下
	LOCAL = LOCAL / 200

CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで

;--------------------------------------------------------------------------------------------------
;苦痛
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_苦痛(ARG, ARG:1, ARG:2)
;苦痛,欲情,反感,屈服

VARSET LOCAL

;欲情計算
;恋愛対象でないと上昇しない
IF 恋愛対象外チェック(ARG, ARG:1) == 0
	;基礎値＆枠計算
		CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "欲望"))
		LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
	;ソース別独自枠
		;ABL:マゾ性感
		LOCAL:1 = ABL:ARG:マゾ性感 * 10
		;倒錯的
		LOCAL:1 += TALENT:ARG:倒錯的 * 10
		;苦痛快楽経験
		LOCAL:1 += MIN(EXP:ARG:苦痛快楽経験 + EXP:ARG:苦痛絶頂経験, 250)
		;発情期の過敏体質化
		SIF GETBIT(TALENT:ARG:発情期あり, 6) && CFLAG:ARG:発情期フラグ < 0
			LOCAL:1 += 20
	LOCAL = LOCAL * (LOCAL:1 + 100) / 100
	;乱数(±5%)
	LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
	;減衰
	LOCAL = SOURCE_上限減衰(LOCAL)
	;弱点コマンド
	SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
		LOCAL = LOCAL * 15 / 10
	CUP:ARG:欲情 += LOCAL
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
	;勃起度上昇
	SIF TALENT:ARG:性別 & 2
		CALL 勃起度上昇(ARG, LOCAL / 5)
	;欲情計算ここまで

	CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)
ENDIF

;苦痛計算
;乱数(±5%)
LOCAL = ARG:2 * ((RAND:11 - 5) + 100) / 100
;星晶獣は痛みに強い
SIF TALENT:ARG:種族 == 5
	LOCAL = LOCAL * 8 / 10
CUP:ARG:苦痛 += LOCAL
;快Ｓが苦痛に応じて発生
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_苦痛快Ｓ発生(ARG, ARG:1, RESULT)
;ソース別独自枠
;マゾ性感による補正をもう一度掛ける
SELECTCASE ABL:ARG:マゾ性感
	CASE 0
		LOCAL:1 = -99
	CASE 1
		LOCAL:1 = -70
	CASE 2
		LOCAL:1 = -40
	CASE 3
		LOCAL:1 = -20
	CASE 4
		LOCAL:1 = 0
	CASEELSE
		LOCAL:1 = 20
ENDSELECT
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:快Ｓ += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(16, LOCAL)
;苦痛計算ここまで

;反感
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_反感(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:2 = ABL:ARG:マゾ性感 * 10
	;倒錯的
	LOCAL:2 += TALENT:ARG:倒錯的 * 10
	;苦痛刻印
	LOCAL:2 += MARK:ARG:苦痛刻印 * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:反感 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(30, LOCAL - LOCAL:1)
;反感ここまで

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = ABL:ARG:マゾ性感 * 10
	;苦痛刻印
	LOCAL:1 += MARK:ARG:苦痛刻印 * 10
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで

;--------------------------------------------------------------------------------------------------
;拘束
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_拘束(ARG, ARG:1, ARG:2)
;欲情,反感,屈服

VARSET LOCAL

;欲情計算
;性欲が溜まってる時、恋愛対象でないと上昇しない
IF 恋愛対象外チェック(ARG, ARG:1) == 0
	;基礎値＆枠計算
		CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "欲望"))
		LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
	;ソース別独自枠
		;ABL:露出癖
		LOCAL:1 = ABL:ARG:マゾ性感 * 10
		;倒錯的
		LOCAL:1 += TALENT:ARG:倒錯的 * 10
	LOCAL = LOCAL * (LOCAL:1 + 100) / 100
	;乱数(±5%)
	LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
	;減衰
	LOCAL = SOURCE_上限減衰(LOCAL)
	;弱点コマンド
	SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
		LOCAL = LOCAL * 15 / 10
	CUP:ARG:欲情 += LOCAL
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
	;勃起度上昇
	SIF TALENT:ARG:性別 & 2
		CALL 勃起度上昇(ARG, LOCAL / 5)
	;欲情計算ここまで

	CUP:ARG:潤滑 += (LOCAL / 10) * (100 + TALENT:ARG:濡れやすさ * 20) / 100
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, (LOCAL / 20) * (100 + TALENT:ARG:濡れやすさ * 20) / 100)
ENDIF

;反感
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_反感(ARG, ARG:1, RESULT)
;ソース別独自枠
	;倒錯的
	LOCAL:2 = TALENT:ARG:倒錯的 * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:反感 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(30, LOCAL - LOCAL:1)
;反感ここまで

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで

;--------------------------------------------------------------------------------------------------
;歓楽
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_歓楽(ARG, ARG:1, ARG:2)

;欲情計算
;性欲が溜まってる時、恋愛対象でないと上昇しない
IF BASE:ARG:性欲 > MAXBASE:ARG:性欲 / 2 && 恋愛対象外チェック(ARG, ARG:1) == 0
	;基礎値＆枠計算
		CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 10, GETNUM(ABL, "欲望"))
		LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
	;ソース別独自枠
	;LOCAL = LOCAL * (LOCAL:1 + 100) / 100
	;乱数(±5%)
	LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
	;減衰
	LOCAL = SOURCE_上限減衰(LOCAL)
	;弱点コマンド
	SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
		LOCAL = LOCAL * 15 / 10
	CUP:ARG:欲情 += LOCAL
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
	;勃起度上昇
	SIF TALENT:ARG:性別 & 2
		CALL 勃起度上昇(ARG, LOCAL / 5)
	;欲情計算ここまで
ENDIF

;ムード計算
;好感度や恋慕度は別枠で加算しているためここでは触らない
;強度の1/10を単純に足す
IF CFLAG:ARG:デート == ARG:1 + 100
	;デート中はニ倍
	NOWEX:ARG:ムード上昇格納 += ARG:2 / 10 * 2
ELSE
	NOWEX:ARG:ムード上昇格納 += ARG:2 / 10
ENDIF
;ムード計算ここまで

;--------------------------------------------------------------------------------------------------
;欲情
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_欲情(ARG, ARG:1, ARG:2)

;欲情計算

;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 10, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで

;ムード計算
;好感度や恋慕度は別枠で加算しているためここでは触らない
;強度の1/10を単純に足す
IF CFLAG:ARG:デート == ARG:1 + 100
	;デート中はニ倍
	NOWEX:ARG:ムード上昇格納 += ARG:2 / 10 * 2
ELSE
	NOWEX:ARG:ムード上昇格納 += ARG:2 / 10
ENDIF
;ムード計算ここまで

;--------------------------------------------------------------------------------------------------
;愛情
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_愛情(ARG, ARG:1, ARG:2)
;好意
VARSET LOCAL

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 5, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで


;--------------------------------------------------------------------------------------------------
;奉仕
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_奉仕(ARG, ARG:1, ARG:2)
;習得,恭順,反感,屈服
VARSET LOCAL

;習得計算
;基礎値＆枠計算
CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "技巧"))
LOCAL = PALAM変換_習得(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL = LOCAL * (LOCAL:1 + 100) / 100

;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:習得 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(20, LOCAL)
;習得計算ここまで


;奉仕計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "奉仕精神"))
	LOCAL = PALAM変換_奉仕(ARG, ARG:1, RESULT)
;ソース別独自枠
	;ABL:露出癖
	LOCAL:1 = ABL:ARG:マゾ性感 * 10
	;倒錯的
	LOCAL:1 += TALENT:ARG:倒錯的 * 10
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:奉仕 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(11, LOCAL)
;奉仕計算ここまで

;技巧EXP処理
技巧経験値:ARG:0 += MAX((ARG:2 / 100), 1)

;反感
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_反感(ARG, ARG:1, RESULT)
;ソース別独自枠
	;性的興味
	LOCAL:2 = TALENT:ARG:性的興味 * 10
	;献身的
	LOCAL:2 += TALENT:ARG:献身的 * 20
	;奉仕精神
	SELECTCASE ABL:ARG:奉仕精神
		CASE 0
			LOCAL:2 += -30
		CASE 1
			LOCAL:2 += 10
		CASE 2
			LOCAL:2 += 15
		CASE 3
			LOCAL:2 += 20
		CASE 4
			LOCAL:2 += 25
		CASE 5
			LOCAL:2 += 30
		CASE 6
			LOCAL:2 += 35
		CASE 7
			LOCAL:2 += 40
		CASE 8
			LOCAL:2 += 45
		CASE 9
			LOCAL:2 += 50
		CASEELSE
			LOCAL:2 += 60
	ENDSELECT
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:反感 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(30, LOCAL - LOCAL:1)
;反感ここまで


;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = ABL:ARG:奉仕精神 * 10
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで


;--------------------------------------------------------------------------------------------------
;屈従
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_屈従(ARG, ARG:1, ARG:2)
;屈服,反感
VARSET LOCAL

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
; 	LOCAL:1 = 
; LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで
;技巧EXP処理
技巧経験値:ARG:0 += MAX((ARG:2 / 100), 1)

;反感
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_反感(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:反感 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(30, LOCAL - LOCAL:1)
;反感ここまで

;--------------------------------------------------------------------------------------------------
;征服
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_征服(ARG, ARG:1, ARG:2)
;優越,欲情,恥情
VARSET LOCAL


;欲情計算
;恋愛対象でないと上昇しない
IF 恋愛対象外チェック(ARG, ARG:1) == 0
	;基礎値＆枠計算
		CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 10, GETNUM(ABL, "欲望"))
		LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
	;ソース別独自枠
		;ABL:露出癖
		LOCAL:1 = ABL:ARG:サド性感 * 10
		;倒錯的
		LOCAL:1 += TALENT:ARG:倒錯的 * 10
	LOCAL = LOCAL * (LOCAL:1 + 100) / 100
	;乱数(±5%)
	LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
	;減衰
	LOCAL = SOURCE_上限減衰(LOCAL)
	;弱点コマンド
	SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
		LOCAL = LOCAL * 15 / 10
	CUP:ARG:欲情 += LOCAL
	TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
	;勃起度上昇
	SIF TALENT:ARG:性別 & 2
		CALL 勃起度上昇(ARG, LOCAL / 5)
	;欲情計算ここまで
ENDIF

;征服計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "サド性感"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:征服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(13, LOCAL)
;征服計算ここまで

;--------------------------------------------------------------------------------------------------
;不潔
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_不潔(ARG, ARG:1, ARG:2)
;不快、反感,屈服
VARSET LOCAL

;不快
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_不快(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:2 = TALENT:ARG:汚臭耐性 * 25
	;倒錯的
	LOCAL:2 += TALENT:ARG:倒錯的 * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:不快 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(31, LOCAL - LOCAL:1)
;不快ここまで

;反感
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_反感(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:2 = TALENT:ARG:汚臭耐性 * 25
	;倒錯的
	LOCAL:2 += TALENT:ARG:倒錯的 * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:反感 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(30, LOCAL - LOCAL:1)
;反感ここまで

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = TALENT:ARG:汚臭耐性 * -20
	;倒錯的
	LOCAL:1 += TALENT:ARG:倒錯的 * 10
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで


;--------------------------------------------------------------------------------------------------
;絶頂
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_絶頂(ARG, ARG:1, ARG:2)
;欲情、恥情
VARSET LOCAL

;欲情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "欲望"))
	LOCAL = PALAM変換_欲情(ARG, ARG:1, RESULT)
;ソース別独自枠
	;快感応答
	LOCAL:1 = TALENT:ARG:快感応答 * 25
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
;弱点コマンド
SIF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = LOCAL * 15 / 10
CUP:ARG:欲情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(5, LOCAL)
;勃起度上昇
SIF TALENT:ARG:性別 & 2
	CALL 勃起度上昇(ARG, LOCAL / 5)
;欲情計算ここまで

CUP:ARG:潤滑 += LOCAL * 2 * (100 + TALENT:ARG:濡れやすさ * 20) / 100
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(9, LOCAL * (100 + TALENT:ARG:濡れやすさ * 20) / 100)

;恥情計算
;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 4, GETNUM(ABL, "露出癖"))
	LOCAL = PALAM変換_恥情(ARG, ARG:1, RESULT)
;ソース別独自枠
;LOCAL = LOCAL * (LOCAL:1 + 100) / 100

;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:恥情 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(10, LOCAL)
;恥情計算ここまで

;--------------------------------------------------------------------------------------------------
;精液
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_精液(ARG, ARG:1, ARG:2)
;恭順、屈服、不快
VARSET LOCAL

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = MIN(EXP:ARG:精液経験, 100)
	LOCAL:1 += TALENT:ARG:汚臭耐性 * 15
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで

;不快
;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2 / 2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_不快(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = MIN(EXP:ARG:精液経験, 100)
	LOCAL:2 = TALENT:ARG:汚臭耐性 * 25
	;倒錯的
	LOCAL:2 += TALENT:ARG:倒錯的 * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:不快 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(31, LOCAL - LOCAL:1)
;不快ここまで


;--------------------------------------------------------------------------------------------------
;精液(不快なし)
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_精液_不快なし(ARG, ARG:1, ARG:2)
;恭順、屈服、不快
VARSET LOCAL

;屈服計算
;基礎値＆枠計算(基礎値は半分)
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, GETNUM(ABL, "マゾ性感"))
	LOCAL = PALAM変換_屈服(ARG, ARG:1, RESULT)
;ソース別独自枠
	LOCAL:1 = MIN(EXP:ARG:精液経験, 100)
	LOCAL:1 += TALENT:ARG:汚臭耐性 * 15
LOCAL = LOCAL * (LOCAL:1 + 100) / 100
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
CUP:ARG:屈服 += LOCAL
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(12, LOCAL)
;屈服計算ここまで



;--------------------------------------------------------------------------------------------------
;不快直接発生
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_不快(ARG, ARG:1, ARG:2)
;不快
VARSET LOCAL

;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_不快(ARG, ARG:1, RESULT)
;ソース別独自枠
	;倒錯的
	LOCAL:2 += TALENT:ARG:倒錯的 * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:不快 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(31, LOCAL - LOCAL:1)
;不快ここまで

;--------------------------------------------------------------------------------------------------
;反感直接発生
;--------------------------------------------------------------------------------------------------
@SOURCE_CALC_反感(ARG, ARG:1, ARG:2)
;反感
;ARG:1=MASTER以外ダメ
SIF ARG < 1 || ARG:1
	RETURN
VARSET LOCAL

;基礎値＆減算値計算
	CALL NEGATIVE_SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2)
	LOCAL = RESULT
	LOCAL:1 = PALAM変換_反感(ARG, ARG:1, RESULT)
;ソース別独自枠
	;倒錯的
	LOCAL:2 += TALENT:ARG:倒錯的 * 10
LOCAL:1 = LOCAL:1 * (LOCAL:2 + 100) / 100
;乱数(±5%)
LOCAL:1 = LOCAL:1 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL:1 = NEGATIVE_SOURCE_上限減衰(LOCAL:1, LOCAL)
;弱点コマンド
IF TCVAR:ARG:弱点コマンドフラグ || TCVAR:ARG:弱点シチュフラグ
	LOCAL = 0
	LOCAL:1 = 0
ENDIF
CUP:ARG:反感 += LOCAL - LOCAL:1
TRYCALLFORM PALAMUP_CHARAEVENT_{NO:ARG}(30, LOCAL - LOCAL:1)
;反感ここまで


@SOURCE_CALC_好感度要素_友情度UP(ARG, ARG:1, ARG:2)
;好感度UP
#DIM 基礎値
;ARG:1=MASTER以外ダメ
SIF ARG < 1 || ARG:1
	RETURN
VARSET LOCAL

;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, 999)
	基礎値 = RESULT

;友情度計算
;物理枠（Ａ枠）
	;話術(最大+100%)
	LOCAL:1 = ABL:(ARG:1):話術技能 * 10
	;反発刻印(最大-90%)
	LOCAL:1 += (MARK:ARG:反発刻印 * MARK:ARG:反発刻印) * -10
	;会話資質(-10%～+10%)
	LOCAL:1 += TALENT:ARG:会話資質 * -10
;経験枠（Ｂ枠）
	;現在の友情度を見る
	SELECTCASE CFLAG:ARG:友情度
		CASE IS < 10000
			LOCAL:2 = 0
		CASE IS < 25000
			LOCAL:2 = 20
		CASE IS < 60000
			LOCAL:2 = 40
		CASEELSE
			LOCAL:2 = 60
	ENDSELECT
;精神枠（Ｃ枠）
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 100 , 3000)
	;ムード(最大で+200%倍)
	LOCAL:3 += GET_REVISION(BASE:ARG:ムード, 1000 , 6000)
	;態度(-10%～+10%)
	LOCAL:3 += TALENT:ARG:態度 * -10
	;無関心(-10%)
	LOCAL:3 += TALENT:ARG:無関心 * -10
	;感情乏しい(-10%)
	LOCAL:3 += TALENT:ARG:感情乏しい * -10
	;ツンデレ(-10%～+20%)
	;プライド(-10%～+10%)
	IF CFLAG:ARG:好感度レベル < 51
		LOCAL:3 += TALENT:ARG:ツンデレ * -10
		LOCAL:3 += TALENT:ARG:プライド * -10
	ELSE
		LOCAL:3 += TALENT:ARG:ツンデレ * 20
	ENDIF
	;性別嗜好
	SELECTCASE TALENT:ARG:性別嗜好
		CASE 1
			SIF TALENT:(ARG:1):性別 == 2
				LOCAL:3 += -30
		CASE 2
			SIF TALENT:(ARG:1):性別 == 1
				LOCAL:3 += -30
		CASE 3
			LOCAL:3 += -30
	ENDSELECT
	;調教者のTALENT:謎の魅力をみる
	SIF TALENT:(ARG:1):謎の魅力
		LOCAL:3 += 20
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = 基礎値 * MAX(LOCAL:1 + 100, 1) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100

;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
LOCAL:1 = LOCAL * ((RAND:11 - 5) + 100) / 1000
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
LOCAL:1 = SOURCE_上限減衰(LOCAL:1)
TRYCCALLFORM 好感度要素_友情度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
	NOWEX:ARG:友情度上昇格納 += RESULT
CATCH
	NOWEX:ARG:友情度上昇格納 += LOCAL
ENDCATCH
TRYCCALLFORM 好感度要素_信頼度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL:1)
	NOWEX:ARG:信頼度上昇格納 += RESULT
CATCH
	NOWEX:ARG:信頼度上昇格納 += LOCAL:1
ENDCATCH
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;恋慕度
IF CFLAG:ARG:ゲージ起動分類 == 1
	TRYCCALLFORM 恋慕度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
		NOWEX:ARG:恋慕度上昇格納 += RESULT / 3
	CATCH
		NOWEX:ARG:恋慕度上昇格納 += LOCAL / 3
	ENDCATCH
ENDIF
;友情度UPここまで


@SOURCE_CALC_好感度要素_信頼度UP(ARG, ARG:1, ARG:2)
;好感度UP
#DIM 基礎値
;ARG:1=MASTER以外ダメ
SIF ARG < 1 || ARG:1
	RETURN
VARSET LOCAL

;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, 999)
	基礎値 = RESULT

;友情度計算
;物理枠（Ａ枠）
	;話術(最大+100%)
	LOCAL:1 = ABL:(ARG:1):話術技能 * 10
	;反発刻印(最大-90%)
	LOCAL:1 += (MARK:ARG:反発刻印 * MARK:ARG:反発刻印) * -10
;経験枠（Ｂ枠）
	;現在の探索経験（＝一緒に探索した経験）を見る
	SELECTCASE EXP:ARG:探索経験
		CASE IS < 10
			LOCAL:2 = 0
		CASE IS < 40
			LOCAL:2 = 10
		CASE IS < 90
			LOCAL:2 = 20
		CASE IS < 160
			LOCAL:2 = 30
		CASE IS < 250
			LOCAL:2 = 40
		CASE IS < 360
			LOCAL:2 = 50
		CASEELSE
			LOCAL:2 = 60
	ENDSELECT
;精神枠（Ｃ枠）
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 100 , 3000)
	;ムード(最大で+200%倍)
	LOCAL:3 += GET_REVISION(BASE:ARG:ムード, 1000 , 6000)
	;態度(-10%～+10%)
	LOCAL:3 += TALENT:ARG:態度 * -10
	;無関心(-10%)
	LOCAL:3 += TALENT:ARG:無関心 * -10
	;感情乏しい(-10%)
	LOCAL:3 += TALENT:ARG:感情乏しい * -10
	;ツンデレ(-10%～+20%)
	;プライド(-10%～+10%)
	IF CFLAG:ARG:好感度レベル < 51
		LOCAL:3 += TALENT:ARG:ツンデレ * -10
		LOCAL:3 += TALENT:ARG:プライド * -10
	ELSE
		LOCAL:3 += TALENT:ARG:ツンデレ * 20
	ENDIF
	;性別嗜好
	SELECTCASE TALENT:ARG:性別嗜好
		CASE 1
			SIF TALENT:(ARG:1):性別 == 2
				LOCAL:3 += -30
		CASE 2
			SIF TALENT:(ARG:1):性別 == 1
				LOCAL:3 += -30
		CASE 3
			LOCAL:3 += -30
	ENDSELECT
	;調教者のTALENT:謎の魅力をみる
	SIF TALENT:(ARG:1):謎の魅力
		LOCAL:3 += 20
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = 基礎値 * MAX(LOCAL:1 + 100, 1) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100

;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
LOCAL:1 = LOCAL * ((RAND:11 - 5) + 100) / 2000
LOCAL:2 = LOCAL * ((RAND:11 - 5) + 100) / 1000
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
LOCAL:1 = SOURCE_上限減衰(LOCAL:1)
LOCAL:2 = SOURCE_上限減衰(LOCAL:2)
TRYCCALLFORM 好感度要素_信頼度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
	NOWEX:ARG:信頼度上昇格納 += RESULT
CATCH
	NOWEX:ARG:信頼度上昇格納 += LOCAL
ENDCATCH
TRYCCALLFORM 好感度要素_友情度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL:1)
	NOWEX:ARG:友情度上昇格納 += RESULT
CATCH
	NOWEX:ARG:友情度上昇格納 += LOCAL:1
ENDCATCH
TRYCCALLFORM 好感度要素_恋心度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL:2)
	NOWEX:ARG:恋心度上昇格納 += RESULT
CATCH
	NOWEX:ARG:恋心度上昇格納 += LOCAL:2
ENDCATCH
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;恋慕度
IF CFLAG:ARG:ゲージ起動分類 == 1
	TRYCCALLFORM 恋慕度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
		NOWEX:ARG:恋慕度上昇格納 += RESULT / 2
	CATCH
		NOWEX:ARG:恋慕度上昇格納 += LOCAL / 2
	ENDCATCH
ENDIF
;信頼度UPここまで

@SOURCE_CALC_好感度要素_恋心度UP(ARG, ARG:1, ARG:2)
;好感度UP
#DIM 基礎値
;ARG:1=MASTER以外ダメ
SIF ARG < 1 || ARG:1
	RETURN
VARSET LOCAL

;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, 999)
	基礎値 = RESULT

;友情度計算
;物理枠（Ａ枠）
	;話術(最大+100%)
	LOCAL:1 = ABL:(ARG:1):話術技能 * 10
	;反発刻印(最大-90%)
	LOCAL:1 += (MARK:ARG:反発刻印 * MARK:ARG:反発刻印) * -10
;経験枠（Ｂ枠）
	;愛情経験（最大+500%）
	LOCAL:2 += MIN(EXP:ARG:愛情経験, 500)
;精神枠（Ｃ枠）
	;ムード(最大で+200%倍)
	LOCAL:3 += GET_REVISION(BASE:ARG:ムード, 1000 , 6000)
	;自制心(-10%～+5%)
	LOCAL:3 += TALENT:ARG:自制心 * -5
	;態度(-10%～+10%)
	LOCAL:3 += TALENT:ARG:態度 * -10
	;無関心(-10%)
	LOCAL:3 += TALENT:ARG:無関心 * -10
	;感情乏しい(-10%)
	LOCAL:3 += TALENT:ARG:感情乏しい * -10
	;ツンデレ(-10%～+20%)
	;プライド(-10%～+10%)
	IF CFLAG:ARG:好感度レベル < 51
		LOCAL:3 += TALENT:ARG:ツンデレ * -10
		LOCAL:3 += TALENT:ARG:プライド * -10
	ELSE
		LOCAL:3 += TALENT:ARG:ツンデレ * 20
	ENDIF
	;恋慕
	LOCAL:3 += TALENT:ARG:恋慕 * 20
	;性別嗜好
	SIF 同性愛性癖判定(ARG, ARG:1)
		LOCAL:3 += 性癖素質:ARG:同性愛 * 10
	SELECTCASE TALENT:ARG:性別嗜好
		CASE 1
			SIF TALENT:(ARG:1):性別 == 2
				LOCAL:3 += -30
		CASE 2
			SIF TALENT:(ARG:1):性別 == 1
				LOCAL:3 += -30
		CASE 3
			LOCAL:3 += -30
	ENDSELECT
	;調教者のTALENT:謎の魅力をみる
	SIF ARG:1 >= 0 && TALENT:(ARG:1):謎の魅力
		LOCAL:3 += 20
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = 基礎値 * MAX(LOCAL:1 + 100, 1) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100

;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
LOCAL:1 = LOCAL * ((RAND:11 - 5) + 100) / 2000
LOCAL:2 = LOCAL * ((RAND:11 - 5) + 100) / 1000
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
LOCAL:1 = SOURCE_上限減衰(LOCAL:1)
LOCAL:2 = SOURCE_上限減衰(LOCAL:2)
TRYCCALLFORM 好感度要素_恋心度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
	NOWEX:ARG:恋心度上昇格納 += RESULT
CATCH
	NOWEX:ARG:恋心度上昇格納 += LOCAL
ENDCATCH
TRYCCALLFORM 好感度要素_性愛度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL:1)
	NOWEX:ARG:性愛度上昇格納 += RESULT
CATCH
	NOWEX:ARG:性愛度上昇格納 += LOCAL:1
ENDCATCH
TRYCCALLFORM 好感度要素_信頼度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL:2)
	NOWEX:ARG:信頼度上昇格納 += RESULT
CATCH
	NOWEX:ARG:信頼度上昇格納 += LOCAL:2
ENDCATCH
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;恋慕度
IF CFLAG:ARG:ゲージ起動分類 == 1
	TRYCCALLFORM 恋慕度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
		NOWEX:ARG:恋慕度上昇格納 += RESULT
	CATCH
		NOWEX:ARG:恋慕度上昇格納 += LOCAL
	ENDCATCH
ENDIF
;恋心度UPここまで

@SOURCE_CALC_好感度要素_性愛度UP(ARG, ARG:1, ARG:2)
;好感度UP
#DIM 基礎値
;ARG:1=MASTER以外ダメ
SIF ARG < 1 || ARG:1
	RETURN
VARSET LOCAL

;基礎値＆枠計算
	CALL SOURCE_COMMON_CHECK(ARG, ARG:1, ARG:2, 999)
	基礎値 = RESULT

;友情度計算
;物理枠（Ａ枠）
	;話術(最大+100%)
	LOCAL:1 = ABL:(ARG:1):話術技能 * 10
	;反発刻印(最大-90%)
	LOCAL:1 += (MARK:ARG:反発刻印 * MARK:ARG:反発刻印) * -10
;経験枠（Ｂ枠）
	;性別嗜好経験(最大+150%)
	SIF 同性愛性癖判定(ARG, ARG:1)
		LOCAL:2 += MIN(EXP:ARG:同性愛経験, 150)
;精神枠（Ｃ枠）
	;ムード(最大で+200%倍)
	LOCAL:3 += GET_REVISION(BASE:ARG:ムード, 1000 , 6000)
	;PALAM:欲情をみる
	IF PALAM:ARG:欲情 < PALAMLV:2
		LOCAL:3 += 0
	ELSEIF PALAM:ARG:欲情 < PALAMLV:3
		LOCAL:3 += 20
	ELSEIF PALAM:ARG:欲情 < PALAMLV:4
		LOCAL:3 += 40
	ELSEIF PALAM:ARG:欲情 >= PALAMLV:4
		LOCAL:3 += 60
	ENDIF
	;理性(上限1.5倍)
	LOCAL:3 += GET_REVISION(1000 - BASE:ARG:理性, 100 , 3000)
	;自制心(-10%～+5%)
	LOCAL:3 += TALENT:ARG:自制心 * -10
	;態度(-10%～+10%)
	LOCAL:3 += TALENT:ARG:態度 * -10
	;無関心(-10%)
	LOCAL:3 += TALENT:ARG:無関心 * -10
	;感情乏しい(-10%)
	LOCAL:3 += TALENT:ARG:感情乏しい * -10
	;ツンデレ(-10%～+20%)
	;プライド(-10%～+10%)
	IF CFLAG:ARG:好感度レベル < 51
		LOCAL:3 += TALENT:ARG:ツンデレ * -10
		LOCAL:3 += TALENT:ARG:プライド * -10
	ELSE
		LOCAL:3 += TALENT:ARG:ツンデレ * 20
	ENDIF
	;恋慕
	LOCAL:3 += TALENT:ARG:恋慕 * 20
	;性別嗜好
	SIF 同性愛性癖判定(ARG, ARG:1)
		LOCAL:3 += 性癖素質:ARG:同性愛 * 10
	SELECTCASE TALENT:ARG:性別嗜好
		CASE 1
			SIF TALENT:(ARG:1):性別 == 2
				LOCAL:3 += -30
		CASE 2
			SIF TALENT:(ARG:1):性別 == 1
				LOCAL:3 += -30
		CASE 3
			LOCAL:3 += -30
	ENDSELECT
	;調教者のTALENT:謎の魅力をみる
	SIF ARG:1 >= 0 && TALENT:(ARG:1):謎の魅力
		LOCAL:3 += 20
;枠統合計算(マイナスになる可能性がある枠は最低1%に)
LOCAL = 基礎値 * MAX(LOCAL:1 + 100, 1) / 100 * (LOCAL:2 + 100) / 100 * MAX(LOCAL:3 + 100, 1) / 100

;乱数(±5%)
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
LOCAL:1 = LOCAL * ((RAND:11 - 5) + 100) / 1000
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
LOCAL:1 = SOURCE_上限減衰(LOCAL:1)
TRYCCALLFORM 好感度要素_性愛度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
	NOWEX:ARG:性愛度上昇格納 += RESULT
CATCH
	NOWEX:ARG:性愛度上昇格納 += LOCAL
ENDCATCH
TRYCCALLFORM 好感度要素_恋心度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL:1)
	NOWEX:ARG:恋心度上昇格納 += RESULT
CATCH
	NOWEX:ARG:恋心度上昇格納 += LOCAL:1
ENDCATCH
;乱数(±5%)
LOCAL = LOCAL * ((RAND:11 - 5) + 100) / 100
;恋慕度
IF CFLAG:ARG:ゲージ起動分類 == 1
	TRYCCALLFORM 恋慕度上昇反応_CHARAEVENT_{NO:ARG}(LOCAL)
		NOWEX:ARG:恋慕度上昇格納 += RESULT / 2
	CATCH
		NOWEX:ARG:恋慕度上昇格納 += LOCAL / 2
	ENDCATCH
ENDIF
;性愛度UPここまで


@SOURCE_CALC_好感度要素_キャラ固有好感度UP(ARG, ARG:1, ARG:2)
;好感度UP
;ARG:1=MASTER以外ダメ
SIF ARG < 1 || ARG:1
	RETURN
VARSET LOCAL
;基本的に補正その他はここに来る前に掛かってるはずなので乱数と減衰のみ

;乱数(±5%)
LOCAL = ARG:2 * ((RAND:11 - 5) + 100) / 100
;減衰
LOCAL = SOURCE_上限減衰(LOCAL)
NOWEX:ARG:キャラ固有好感度要素上昇格納 += LOCAL
;キャラ固有好感度UPここまで
