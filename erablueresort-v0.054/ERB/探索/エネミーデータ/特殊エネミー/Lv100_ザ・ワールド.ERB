
@敵BATTLE_STATE_Lv100_ザ・ワールド(ARG)
敵BATTLE_STATE:ARG:Lv = 100
敵BATTLE_STATE:ARG:最大ＨＰ = 360000
敵BATTLE_STATE:ARG:ＨＰ = 360000
敵BATTLE_STATE:ARG:攻撃力 = 1000
敵BATTLE_STATE:ARG:防御力 = 1000
敵BATTLE_STATE:ARG:回復力 = 0
敵BATTLE_STATE:ARG:行動速度 = 1000
敵BATTLE_STATE:ARG:DA率 = 50
敵BATTLE_STATE:ARG:TA率 = 25
敵BATTLE_STATE:ARG:命中率 = 120
敵BATTLE_STATE:ARG:回避率 = 20
敵BATTLE_STATE:ARG:属性 = 6
敵BATTLE_STATE:ARG:所持EXP = 45000
敵BATTLE_STATE:ARG:所持ルピ = 90000
敵BATTLE_STATE:ARG:最大チャージターン = 2

敵BATTLE_STATE:ARG:ボスフラグ = 1
敵BATTLE_STATE:ARG:ランダム不許可フラグ = 1

敵BATTLE_STATE_STR:ARG:種族 = 星晶獣

@敵討伐後処理_Lv100_ザ・ワールド(隊列番号)
#DIM 隊列番号
#DIM ドロップ確率
#DIMS ドロップアイテム
#DIM データベース行数
#DIM トレハンLv

トレハンLv = 0
データベース行数 = デバフ番号取得("ドロップ率UP")
SIF データベース行数 > -1
	トレハンLv = DT_CELL_GET("戦闘効果データベース", データベース行数, "効果量_固定値")

ドロップ確率 = 100
ドロップアイテム = 世界的理念
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 50 + トレハンLv * 2
ドロップアイテム = 世界的理念
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)



@敵トリガー行動_Lv100_ザ・ワールド
#DIM 味方番号
#DIM ダメージ量

IF バフ番号取得_枠("ヴァース・クライシス", 戦闘行動キャラ) > -1
	IF 戦闘中カウント:10:被ダメ合計 > 20000
		WSTR:(K++) = 创世崩解已解除！
		
		CALL バフ削除_枠(戦闘行動キャラ, "ヴァース・クライシス")
		RETURN 1
	ELSE
		;『ヴァース・クライシス』：味方全体に現在HP70％分のダメージ/強化効果を全て消去・奥義ゲージDOWN効果
		WSTR:(K++) = 「创造之力…尽在吾掌！」
		WSTR:(K++) = %敵BATTLE_STATE_STR:(戦闘行動キャラ - 10):エネミー名%的创世崩解！
		
		FOR 味方番号, 0, 4
			SIF BATTLE_STATE:味方番号:キャラ登録番号 < 1
				CONTINUE
			SIF BATTLE_STATE:味方番号:ＨＰ < 1
				CONTINUE
			
			ダメージ量 = (BATTLE_STATE:味方番号:ＨＰ / 10) * 7
			
			BATTLE_STATE:味方番号:ＨＰ = MAX(BATTLE_STATE:味方番号:ＨＰ - ダメージ量, 0)
			WSTR:(K++) = %CALLNAME:(BATTLE_STATE:味方番号:キャラ登録番号)%受到了{ダメージ量}的伤害！
			CALL メッセージ欄表示用関数(,,,0)
		NEXT
		
		CALL 口上変数初期化
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		FOR LOCAL, 0, 9
			CALL アビテンプレート_不利効果_バフ消去()
		NEXT
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 100
		CALL アビテンプレート_不利効果_奥義ゲージDOWN
		
		敵BATTLE_STATE:(戦闘行動キャラ - 10):チャージターン = 0

		行動種別フラグ:戦闘行動キャラ:大技発動 = 1
		CALL バフ削除_枠(戦闘行動キャラ, "ヴァース・クライシス")
		RETURN 1
	ENDIF
ELSEIF バフ番号取得_枠("スターリー・ノヴァ", 戦闘行動キャラ) > -1
	IF 戦闘中カウント:10:被ダメ合計 > 10000
		WSTR:(K++) = 星爆新星已解除！
		
		CALL バフ削除_枠(戦闘行動キャラ, "スターリー・ノヴァ")
		RETURN 1
	ELSE
		;『スターリー・ノヴァ』：味方全体にランダム属性4倍ダメージ/ザ・ワールドに与ダメ増加効果・TA率UP効果
		SELECTCASE RAND:2
			CASE 0
				WSTR:(K++) = 「此乃…崭新法则！」
			CASE 1
				WSTR:(K++) = 「赐予愚者……幸福的终焉！」
		ENDSELECT
		
		アビテンプレート用_アビ名 = スターリー・ノヴァ
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用変数:効果割合 = 400
		SELECTCASE RAND:6
			CASE 0
				CALL アビテンプレート_ダメージ処理_火属性
			CASE 1
				CALL アビテンプレート_ダメージ処理_水属性
			CASE 2
				CALL アビテンプレート_ダメージ処理_土属性
			CASE 3
				CALL アビテンプレート_ダメージ処理_風属性
			CASE 4
				CALL アビテンプレート_ダメージ処理_光属性
			CASE 5
				CALL アビテンプレート_ダメージ処理_闇属性
		ENDSELECT
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用変数:効果量 = 100
		アビ汎用文字列:バフ・デバフ枠 = 与ダメ増加
		アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
		アビ汎用変数:持続ターン = 4
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 50
		アビ汎用文字列:バフ・デバフ枠 = TA率
		アビ汎用文字列:バフ・デバフ対象能力 = TA率
		アビ汎用変数:持続ターン = 4
		CALL アビテンプレート_有利効果_バフ効果セット
		
		敵BATTLE_STATE:(戦闘行動キャラ - 10):チャージターン = 0
		
		行動種別フラグ:戦闘行動キャラ:大技発動 = 1
		CALL バフ削除_枠(戦闘行動キャラ, "スターリー・ノヴァ")
		RETURN 1
	ENDIF
ELSEIF 敵BATTLE_STATE:(戦闘行動キャラ - 10):ＨＰ < (敵BATTLE_STATE:(戦闘行動キャラ - 10):最大ＨＰ / 4) * 3 && GETBIT(敵BATTLE_STATE:(戦闘行動キャラ - 10):トリガー行動フラグ, 0) == 0
	;75%で真の力を解放/弱体効果を回復
	WSTR:(K++) = %敵BATTLE_STATE_STR:(戦闘行動キャラ - 10):エネミー名%解放了真正的力量！
	
	アビテンプレート用_アビ名 = 真力解放
	
	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_自己のみ
	FOR LOCAL, 0, DT_ROW_LENGTH("戦闘効果データベース")
		SIF DT_CELL_GETS("戦闘効果データベース", LOCAL, "適用範囲") == "10"
			CALL アビテンプレート_有利効果_デバフ消去()
	NEXT

	;HPトリガー使い終わったのでフラグを立てる
	SETBIT 敵BATTLE_STATE:(戦闘行動キャラ - 10):トリガー行動フラグ, 0
	RETURN 1
ELSEIF 敵BATTLE_STATE:(戦闘行動キャラ - 10):ＨＰ < 敵BATTLE_STATE:(戦闘行動キャラ - 10):最大ＨＰ / 2 && GETBIT(敵BATTLE_STATE:(戦闘行動キャラ - 10):トリガー行動フラグ, 1) == 0
	;50%で『ヴァース・クライシス』を構え始める
	WSTR:(K++) = %敵BATTLE_STATE_STR:(戦闘行動キャラ - 10):エネミー名%的掌心汇聚创世之光！
	
	アビテンプレート用_アビ名 = 大技待機

	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用変数:特殊表示オプション = 1
	アビ汎用変数:消去不可オプション = 1
	アビ汎用文字列:バフ・デバフ枠 = ヴァース・クライシス
	アビ汎用文字列:バフ・デバフ対象能力 = ヴァース・クライシス
	アビ汎用変数:持続ターン = -1
	CALL アビテンプレート_有利効果_バフ効果セット
	
	戦闘中カウント:10:被ダメ合計 = 0
	
	;HPトリガー使い終わったのでフラグを立てる
	SETBIT 敵BATTLE_STATE:(戦闘行動キャラ - 10):トリガー行動フラグ, 1
	RETURN 1
ELSEIF 敵BATTLE_STATE:(戦闘行動キャラ - 10):ＨＰ < 敵BATTLE_STATE:(戦闘行動キャラ - 10):最大ＨＰ / 5 && GETBIT(敵BATTLE_STATE:(戦闘行動キャラ - 10):トリガー行動フラグ, 2) == 0
	;25%で『スターリー・ノヴァ』を構え始める
	WSTR:(K++) = %敵BATTLE_STATE_STR:(戦闘行動キャラ - 10):エネミー名%开始凝聚星之力…
	
	アビテンプレート用_アビ名 = 大技待機
	
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用変数:特殊表示オプション = 1
	アビ汎用変数:消去不可オプション = 1
	アビ汎用文字列:バフ・デバフ枠 = スターリー・ノヴァ
	アビ汎用文字列:バフ・デバフ対象能力 = スターリー・ノヴァ
	アビ汎用変数:持続ターン = -1
	CALL アビテンプレート_有利効果_バフ効果セット
	
	戦闘中カウント:10:被ダメ合計 = 0
	
	;HPトリガー使い終わったのでフラグを立てる
	SETBIT 敵BATTLE_STATE:(戦闘行動キャラ - 10):トリガー行動フラグ, 2
	RETURN 1
ENDIF



@敵チャージ行動_Lv100_ザ・ワールド
IF 敵BATTLE_STATE:(戦闘行動キャラ - 10):ＨＰ < (敵BATTLE_STATE:(戦闘行動キャラ - 10):最大ＨＰ / 4) * 3
	SELECTCASE RAND:2
		CASE 0
			SELECTCASE RAND:2
				CASE 0
					WSTR:(K++) = 「此乃…崭新法则！」
				CASE 1
					WSTR:(K++) = 「赐予愚者……幸福的终焉！」
			ENDSELECT
			
			アビテンプレート用_アビ名 = スターリー・ノヴァ
			
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果割合 = 400
			SELECTCASE RAND:6
				CASE 0
					CALL アビテンプレート_ダメージ処理_火属性
				CASE 1
					CALL アビテンプレート_ダメージ処理_水属性
				CASE 2
					CALL アビテンプレート_ダメージ処理_土属性
				CASE 3
					CALL アビテンプレート_ダメージ処理_風属性
				CASE 4
					CALL アビテンプレート_ダメージ処理_光属性
				CASE 5
					CALL アビテンプレート_ダメージ処理_闇属性
			ENDSELECT
			
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用変数:効果量 = 100
			アビ汎用文字列:バフ・デバフ枠 = 与ダメ増加
			アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
			アビ汎用変数:持続ターン = 4
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 50
			アビ汎用文字列:バフ・デバフ枠 = TA率
			アビ汎用文字列:バフ・デバフ対象能力 = TA率
			アビ汎用変数:持続ターン = 4
			CALL アビテンプレート_有利効果_バフ効果セット
		CASE 1
			SELECTCASE RAND:2
				CASE 0
					WSTR:(K++) = 「我才是！ 真神啊啊啊啊！！」
				CASE 1
					WSTR:(K++) = 「终焉之时已至！」
			ENDSELECT
			
			アビテンプレート用_アビ名 = 梅比彗星
			
			CALL アビ汎用変数文字列リセット
			
			FOR LOCAL, 0, 19
				CALL アビ対象選択テンプレート_味方ランダムＸ体(1)
				アビ汎用変数:効果割合 = 70
				SELECTCASE RAND:6
					CASE 0
						CALL アビテンプレート_ダメージ処理_火属性
					CASE 1
						CALL アビテンプレート_ダメージ処理_水属性
					CASE 2
						CALL アビテンプレート_ダメージ処理_土属性
					CASE 3
						CALL アビテンプレート_ダメージ処理_風属性
					CASE 4
						CALL アビテンプレート_ダメージ処理_光属性
					CASE 5
						CALL アビテンプレート_ダメージ処理_闇属性
				ENDSELECT
			NEXT
			
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果量 = 0
			アビ汎用文字列:バフ・デバフ枠 = アビ封印
			アビ汎用文字列:バフ・デバフ対象能力 = アビ封印
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 0
			アビ汎用文字列:バフ・デバフ枠 = 奥義封印
			アビ汎用文字列:バフ・デバフ対象能力 = 奥義封印
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
	ENDSELECT
ELSE
	SELECTCASE RAND:2
		CASE 0
			WSTR:(K++) = 「见证新神的诞生吧……蝼蚁们！」

			アビテンプレート用_アビ名 = 天球
			
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果割合 = 300
			SELECTCASE RAND:6
				CASE 0
					CALL アビテンプレート_ダメージ処理_火属性
				CASE 1
					CALL アビテンプレート_ダメージ処理_水属性
				CASE 2
					CALL アビテンプレート_ダメージ処理_土属性
				CASE 3
					CALL アビテンプレート_ダメージ処理_風属性
				CASE 4
					CALL アビテンプレート_ダメージ処理_光属性
				CASE 5
					CALL アビテンプレート_ダメージ処理_闇属性
			ENDSELECT
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 0
			アビ汎用文字列:バフ・デバフ枠 = 強圧
			アビ汎用文字列:バフ・デバフ対象能力 = 強圧
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果割合 = 50
			アビ汎用文字列:バフ・デバフ枠 = 暗闇
			アビ汎用文字列:バフ・デバフ対象能力 = 暗闇
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
		CASE 1
			CALL アビ汎用変数文字列リセット
			WSTR:(K++) = 「真理…由我执掌！」

			アビテンプレート用_アビ名 = 世界答案
			
			FOR LOCAL, 0, 41
				CALL アビ対象選択テンプレート_味方ランダムＸ体(1)
				アビ汎用変数:効果割合 = 30
				SELECTCASE RAND:6
					CASE 0
						CALL アビテンプレート_ダメージ処理_火属性
					CASE 1
						CALL アビテンプレート_ダメージ処理_水属性
					CASE 2
						CALL アビテンプレート_ダメージ処理_土属性
					CASE 3
						CALL アビテンプレート_ダメージ処理_風属性
					CASE 4
						CALL アビテンプレート_ダメージ処理_光属性
					CASE 5
						CALL アビテンプレート_ダメージ処理_闇属性
				ENDSELECT
			NEXT
			
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果量 = 50
			アビ汎用文字列:バフ・デバフ枠 = DA率
			アビ汎用文字列:バフ・デバフ対象能力 = DA率
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 50
			アビ汎用文字列:バフ・デバフ枠 = TA率
			アビ汎用文字列:バフ・デバフ対象能力 = TA率
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
	ENDSELECT
ENDIF



@固有戦闘開始時処理_エネミー_Lv100_ザ・ワールド()
SELECTCASE RAND:2
	CASE 0
		WSTR:(K++) = 「试炼的尽头！」
	CASE 1
		WSTR:(K++) = 「成为新世界的基石吧！」
ENDSELECT
	
アビテンプレート用_アビ名 = プロジェクション・ワールド

CALL アビ対象選択テンプレート_自己のみ
アビ汎用変数:特殊表示オプション = 1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:効果量 = 0
アビ汎用文字列:バフ・デバフ枠 = プロジェクション・ワールド
アビ汎用文字列:バフ・デバフ対象能力 = プロジェクション・ワールド
アビ汎用変数:持続ターン = 2
CALL アビテンプレート_有利効果_バフ効果セット



@バフ・デバフ特殊表示_プロジェクション・ワールド(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

SETCOLOR カラーパレット("紫")
PRINTFORML ⚠预兆显现中！⚠
RESETCOLOR
PRINTFORML 投影世界生效中［2回合/不可驱散］
PRINTFORML ◆本体会停止攻击，但每回合结束时「世界」的攻击力与防御力持续叠加［永久/不可驱散］
SETCOLOR カラーパレット("紫")
PRINTFORML ⚔造成25000点伤害或效果回合结束时解除
RESETCOLOR



@固有行動開始時処理_バフ_プロジェクション・ワールド(バフ・デバフ行数)
#DIM バフ・デバフ行数

IF 戦闘中カウント:10:被ダメ合計 > 500
	WSTR:(K++) = 投影世界已解除！
	
	CALL バフ削除_枠(戦闘行動キャラ, "プロジェクション・ワールド")
ELSE
	WSTR:(K++) = 「世界」正将苍穹重构为新世界…
	行動不能フラグ = 1
ENDIF



@固有ターン終了時処理_エネミー_Lv100_ザ・ワールド()
#DIM プロジェクション・ワールド

プロジェクション・ワールド = バフ番号取得_枠("プロジェクション・ワールド", 10)
IF プロジェクション・ワールド > -1
	IF 戦闘中カウント:10:被ダメ合計 > 500
		WSTR:(K++) = 投影世界已解除！
		
		CALL バフ削除_枠(戦闘行動キャラ, "プロジェクション・ワールド")
	ELSE
		アビテンプレート用_アビ名 = プロジェクション・ワールド
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用変数:効果割合 = 50
		アビ汎用変数:累積上限_割合 = 100
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		
		アビ汎用文字列:バフ・デバフ枠 = 攻撃力_P・W
		アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
		CALL アビテンプレート_有利効果_累積バフ効果セット
		
		アビ汎用文字列:バフ・デバフ枠 = 防御力_P・W
		アビ汎用文字列:バフ・デバフ対象能力 = 防御力
		CALL アビテンプレート_有利効果_累積バフ効果セット
	ENDIF
ENDIF



@バフ・デバフ特殊表示_ヴァース・クライシス(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

SETCOLOR カラーパレット("黄")
PRINTFORML ⚠预兆显现中！⚠
RESETCOLOR
PRINTFORML 创世崩解预备状态［不可驱散］
PRINTFORML ◆对全体友方造成当前HP70％的真实伤害/驱散所有增益效果/必杀技槽衰减
SETCOLOR カラーパレット("黄")
PRINTFORML ⚔累计造成20000点伤害后解除
RESETCOLOR



@バフ・デバフ特殊表示_スターリー・ノヴァ(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

SETCOLOR カラーパレット("紫")
PRINTFORML ⚠预兆显现中！⚠
RESETCOLOR
PRINTFORML 星爆新星咏唱状态［不可驱散］
PRINTFORML ◆对全体友方施加随机属性四倍伤害/「世界」获得增伤200％・TA率提升
SETCOLOR カラーパレット("紫")
PRINTFORML ⚔单次造成10000点伤害后解除
RESETCOLOR



@戦闘画面表示_Lv100_ザ・ワールド(レイヤー番号, 隊列番号)
#DIM レイヤー番号
#DIM 隊列番号
#DIM プロジェクション・ワールド
#DIM ヴァース・クライシス
#DIM スターリー・ノヴァ

プロジェクション・ワールド = バフ番号取得_枠("プロジェクション・ワールド", 10)
IF プロジェクション・ワールド > -1
	GSETBRUSH レイヤー番号, 0xFFC070C0
	GDRAWTEXT レイヤー番号, "⚠プロジェクション・ワールド", 10, 70
ENDIF

ヴァース・クライシス = バフ番号取得_枠("ヴァース・クライシス", 10)
IF ヴァース・クライシス > -1
	GSETBRUSH レイヤー番号, 0xFFFFD900
	GDRAWTEXT レイヤー番号, "⚠ヴァース・クライシス", 10, 70
ENDIF

スターリー・ノヴァ = バフ番号取得_枠("スターリー・ノヴァ", 10)
IF スターリー・ノヴァ > -1
	GSETBRUSH レイヤー番号, 0xFFC070C0
	GDRAWTEXT レイヤー番号, "⚠スターリー・ノヴァ", 10, 70
ENDIF

