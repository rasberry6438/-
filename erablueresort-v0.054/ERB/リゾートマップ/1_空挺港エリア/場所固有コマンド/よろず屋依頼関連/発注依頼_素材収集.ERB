@発注依頼_素材収集

依頼文章保存 = 
依頼文章保存 += "可指定任意素材进行收集委托<br>"
依頼文章保存 += "（仅限曾经获得过的素材）<br>"
依頼文章保存 += "素材数量与所需报酬随素材等级浮动<br>"
依頼文章保存 += "所需报酬根据市场行情变化<br>"
依頼文章保存 += "<br>"
依頼文章保存 += @"委托物品："
IF 依頼アイテム名 != ""
	LOCALS = %属性数値文字色変換_HTML(素材アイテム_数値データ取得("素材属性", 依頼アイテム名))%
	依頼文章保存 += @"<font color='#%LOCALS%'>%依頼アイテム名%</font><br>"
	LOCAL = 素材アイテム_数値データ取得("素材ランク", 依頼アイテム名)
	LOCAL:1 = 素材アイテム_数値データ取得("素材値相場", 依頼アイテム名)
	依頼報酬額 = (LOCAL + 1) * (LOCAL + 1) * 500 * LOCAL:1 / 100
	依頼文章保存 += @"所需报酬：%NUM_FORMAT(依頼報酬額)%<br>"
ENDIF
依頼文章保存 += "<br>"
依頼文章保存 += "<button value='200'>[200] 更改委托物品</button><br>"
依頼文章保存 += "<button value='201'>[201] 确认发布</button><br><br>"

@依頼追加表示情報_素材収集(表示依頼枠番号)
#DIM 表示依頼枠番号

詳細文文字列受け渡し変数 = 
IF 遂行中依頼_対象名:表示依頼枠番号 !=""
	LOCALS = %属性数値文字色変換_HTML(素材アイテム_数値データ取得("素材属性", 遂行中依頼_対象名:表示依頼枠番号))%
	詳細文文字列受け渡し変数 = %STRFORM(@"委托物品：<font color='#%LOCALS%'>%遂行中依頼_対象名:表示依頼枠番号%</font>")%
ENDIF

@発注実処理_素材収集(表示依頼枠番号)
#DIM 表示依頼枠番号

BINPUT
LOCAL = RESULT
SELECTCASE LOCAL
	CASE 200
		CALL 素材アイテム一覧表示("累計入手素材数 > 0", 1)
		IF RESULT > -1
			依頼アイテム名 = %DT_CELL_GETS("所持素材データベース", RESULT, "素材アイテム名", 1)%
		ENDIF
	CASE 201
		IF 依頼アイテム名 != ""
			IF MONEY < 依頼報酬額
				PRINTL 
				PRINTW 卢比不足。
				RETURN 0
			ENDIF
			PRINTL
			PRINTFORMW 已发布素材收集委托：%依頼アイテム名%
			MONEY -= 依頼報酬額
			遂行中依頼_対象名:表示依頼枠番号 = %依頼アイテム名%
			LOCAL = 素材アイテム_数値データ取得("素材ランク", 依頼アイテム名)
			依頼完了確率_初期値:表示依頼枠番号 = MAX(0, (5 - LOCAL) * 10)
			依頼完了確率_進数:表示依頼枠番号 = MAX(5, (5 - LOCAL) * 3)
			RETURN 1
		ELSE
			PRINTL
			PRINTFORMW 未指定委托物品
			RETURN 0
		ENDIF
	CASE 999
		依頼アイテム名 = 
		RETURN -1
ENDSELECT

@依頼完了時処理_素材収集(表示依頼枠番号)
#DIM 表示依頼枠番号

LOCAL = 素材アイテム_数値データ取得("素材ランク", 遂行中依頼_対象名:表示依頼枠番号)
LOCAL = RAND:2 + (6 - LOCAL)
依頼報告文字列:表示依頼枠番号 += @"%依頼受注者名:表示依頼枠番号%已完成%遂行中依頼:表示依頼枠番号%委托！<br>"
依頼報告文字列:表示依頼枠番号 += @"获得{LOCAL}个%遂行中依頼_対象名:表示依頼枠番号%！<br>"
CALL 素材入手処理(遂行中依頼_対象名:表示依頼枠番号, LOCAL)
