
@イベント発生条件_突発イベント_魔物襲撃
;開放条件を満たしたら1を返すこと

イベント消滅日数渡し = 3
イベント消滅確率渡し = 30
イベント再発生日数渡し = 3
イベント再発生確率渡し = 30

IF ダンジョンクリアフラグ_沿岸部の森 == 0
	RETURN 0
ENDIF
IF BATTLE_STATE:0:キャラ登録番号 == 0
	RETURN 0
ENDIF
RETURN 1

@イベント関数_突発イベント_魔物襲撃(ARG)
#DIM 最大レベル

LOCAL = DT_CELL_GET("各イベント用変数配列", ARG, "イベント再発生CT")
IF LOCAL == 0
	;初回
	DRAWLINE
	PRINTL ［魔物袭击］
	DRAWLINE
	PRINTW
	PRINTFORMW 似乎有魔物从附近山林袭来。
	PRINTFORMW 虽不至于造成人员死亡，但放任不管会导致设施损坏或人员受伤。
	PRINTFORMW 届时度假区人气必将暴跌。
	PRINTFORMW 需在受害前迅速击溃。
	PRINTL
	PRINTL 将与袭击度假区的魔物交战。准备就绪了吗？
	PRINTBUTTON "[0]确定", 0
	PRINTL
	PRINTBUTTON "[1]取消", 1
	PRINTL
	BINPUT
	SELECTCASE RESULT
		CASE 0
			PRINTFORMW %CALLNAME:PLAYER%一行迎击来袭魔物！

			CALL イベント戦闘初期処理()
			;最大レベル取得
			最大レベル = 0
			VARSET LOCAL
			FOR LOCAL, 0, 14
				SIF LOCAL > 3 && LOCAL < 10
					CONTINUE
				SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
					CONTINUE
				SIF BATTLE_STATE:LOCAL:Lv > 最大レベル
					最大レベル = BATTLE_STATE:LOCAL:Lv
				;キャラ数もカウント
				LOCAL:1 ++
			NEXT
			CALL ランダムエネミーセット関数(LOCAL:1, 最大レベル - 2)
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利
				PRINTFORMW %CALLNAME:PLAYER%一行顺利清剿魔物。
				CALL イベント完了フラグ汎用処理("魔物襲撃")
			ELSEIF RESULT == 1
				;全滅
				PRINTW 遭遇惨败，暂且撤退重整旗鼓。
			ELSEIF RESULT == -1
				;逃走
				PRINTW 敌方实力超乎预期，暂且撤退从长计议。
			ENDIF
			CALL ダンジョン終了時処理
		CASE 1
			PRINTW 不，不能掉以轻心。还是充分准备后再行动吧。
	ENDSELECT
ELSE
	;二回目以降
	DRAWLINE
	PRINTL ［魔物袭击］
	DRAWLINE
	PRINTW
	PRINTFORMW 又有魔物侵袭至度假区。
	PRINTFORMW 需在受害前迅速击溃。
	PRINTL
	PRINTL 将与袭击度假区的魔物交战。准备就绪了吗？
	PRINTBUTTON "[0]确定", 0
	PRINTL
	PRINTBUTTON "[1]取消", 1
	PRINTL
	BINPUT
	SELECTCASE RESULT
		CASE 0
			PRINTFORMW %CALLNAME:PLAYER%一行迎击来袭魔物！

			CALL イベント戦闘初期処理()
			;最大レベル取得
			最大レベル = 0
			VARSET LOCAL
			FOR LOCAL, 0, 14
				SIF LOCAL > 3 && LOCAL < 10
					CONTINUE
				SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
					CONTINUE
				SIF BATTLE_STATE:LOCAL:Lv > 最大レベル
					最大レベル = BATTLE_STATE:LOCAL:Lv
				;キャラ数もカウント
				LOCAL:1 ++
			NEXT
			CALL ランダムエネミーセット関数(LOCAL:1, 最大レベル - 2)
			CALL イベント中戦闘用処理()
			IF RESULT == 0
				;勝利
				PRINTL 
				PRINTL 
				PRINTFORMW %CALLNAME:PLAYER%一行顺利清剿魔物。
				CALL イベント完了フラグ汎用処理("魔物襲撃")
			ELSEIF RESULT == 1
				;全滅
				PRINTL 
				PRINTL 
				PRINTW 遭遇惨败，暂且撤退重整旗鼓。
			ELSEIF RESULT == -1
				;逃走
				PRINTL 
				PRINTL 
				PRINTW 敌方实力超乎预期，暂且撤退从长计议。
			ENDIF
			CALL ダンジョン終了時処理
		CASE 1
			PRINTW 不，不能掉以轻心。还是充分准备后再行动吧。
	ENDSELECT
ENDIF








