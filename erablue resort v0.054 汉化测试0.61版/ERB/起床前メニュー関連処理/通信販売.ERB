@通信販売_BUY
#DIMS 右側表示モード
#DIM 現在ページ
#DIM 表示候補, 500
#DIM 候補人数
#DIM 販売フラグ


DRAWLINE
PRINTL 通过邮购购买物品。
PRINTL ※功能开发中，可能存在异常情况。
DRAWLINE
;上
LOCALS = <div rect='81,31,1937,381' padding='50,25,50' border='31' bcolor='#C0C0C0'>
LOCALS += @"持有卢比：%NUM_FORMAT(MONEY)%<br>"
LOCALS += @"持有ZP　：%ZP所持量全文字列()%"
LOCALS += "</div>"

;左側、アイテムの種類を羅列
LOCALS += "<div rect='81,444,1937,2812' padding='50,25,50' border='31' bcolor='#C0C0C0'>"
IF 右側表示モード == "成人用品"
	LOCALS += @"<nonbutton><font color='#%カラーパレット_HTML("黄")%'>[-1] 成人用品</font></nonbutton><br>"
ELSE
	LOCALS += "<button value='-1'>[-1] 成人用品</button><br>"
ENDIF
IF 右側表示モード == "消耗品"
	LOCALS += @"<nonbutton><font color='#%カラーパレット_HTML("黄")%'>[-2] 消耗品</font></nonbutton><br>"
ELSE
	LOCALS += "<button value='-2'>[-2] 消耗品</button><br>"
ENDIF
IF 施設改造度:20:0
	IF 右側表示モード == "家居用品"
		LOCALS += @"<nonbutton><font color='#%カラーパレット_HTML("黄")%'>[-3] 家居用品</font></nonbutton><br>"
	ELSE
		LOCALS += "<button value='-3'>[-3] 家居用品</button><br>"
	ENDIF
ENDIF
IF STRFIND(高速船記録:初回派遣先記録, @"智慧殿堂_") >= 0
	IF 右側表示モード == "书籍类商品"
		LOCALS += @"<nonbutton><font color='#%カラーパレット_HTML("黄")%'>[-4] 书籍类商品</font></nonbutton><br>"
	ELSE
		LOCALS += "<button value='-4'>[-4] 书籍类商品</button><br>"
	ENDIF
ENDIF
LOCALS += "<br>"
LOCALS += "<button value='-100'>[-100] 系统说明</button><br>"
LOCALS += "<br>"
LOCALS += "<button value='-99'>[-99] 返回</button><br>"
LOCALS += "</div>"

;右側
LOCALS += "<div rect='2050,444,3875,2812' padding='50,25,50' border='31' bcolor='#C0C0C0'>"
CALL 通信販売_品揃え登録(LOCALS, 右側表示モード)
LOCALS += "</div>"

HTML_PRINT LOCALS
FOR LOCAL, 0, 30
	PRINTL
NEXT

$INPUT_LOOP
IF チュートリアルフラグ:通信販売 == 0
	RESULT = -100
ELSE
	BINPUT
ENDIF
LOCAL = RESULT
SELECTCASE LOCAL
	CASE -10 TO -1
		右側表示モード = %表示モード配列:(ABS(LOCAL) - 1)%
		販売フラグ = 0
		現在ページ = 0
		RESTART
	CASE -98
		INVERTBIT 購入済み非表示フラグ, 0
		RESTART
	CASE -99
		RETURN 0
	CASE -100
		CALL 通信販売チュートリアル()
		RESTART
ENDSELECT


; IF ITEMSTOCK(RESULT) == 1 || ITEMSTOCK(RESULT) == 4 || LOCAL < 0 || LOCAL > 2000
; 	RESTART
; ELSEIF ITEMSTOCK(RESULT) == 2
; 	PRINTW 売切です
; 	RESTART
; ELSEIF ITEMSTOCK(RESULT) == 3
; 	PRINTW 所持金が足りません
; 	RESTART
; ELSEIF ITEMSTOCK(RESULT) == 5
; 	PRINTW 既に十分持っています
; 	RESTART
; ENDIF
LOCAL = RESULT
DRAWLINE

IF LOCAL == 70
	現在ページ = 0
	PRINTL 是否购买【元气药水】？
	PRINTL ※使用后三天内，目标角色体力上限提高1000。
	PRINTBUTTON "[0] 确定", 0
	PRINTL
	PRINTBUTTON "[1] 取消", 1
	PRINTL
	BINPUT
	SIF RESULT
		RESTART
	PRINTL 请选择使用对象

	VARSET 表示候補
	候補人数 = 0
	FOR LOCAL, 1, CHARANUM
		SIF CFLAG:LOCAL:滞在期間 < 0
			CONTINUE
		表示候補:候補人数 = LOCAL
		候補人数 += 1
	NEXT

	$INPUT_LOOP_70
	VARSET LOCAL
	LOCALS = 
	;表示処理
	FOR LOCAL, 現在ページ * 30, 候補人数
		IF CFLAG:(表示候補:LOCAL):元気になる薬フラグ > 0
			LOCALS += @"<font color='#%カラーパレット_HTML("グレーアウト")%'><nonbutton>[{表示候補:LOCAL,3}] %ADD_STR_SPACE(NAME表示省略(NAME表示(表示候補:LOCAL)), "]", 1),41,LEFT%</nonbutton>"
			LOCALS += @"　已使用：剩余{CFLAG:(表示候補:LOCAL):元気になる薬フラグ, 2}天　</font>"
		ELSE
			LOCALS += @"<button value = '{表示候補:LOCAL}'>[{表示候補:LOCAL,3}] %ADD_STR_SPACE(NAME表示省略(NAME表示(表示候補:LOCAL)), "]", 1),41,LEFT%</button>"
			IF CFLAG:(表示候補:LOCAL):滞在期間 == 1
				LOCALS += @"　　　　　<font color='#%カラーパレット_HTML("黄")%'>今天回家</font>　"
			ELSEIF CFLAG:(表示候補:LOCAL):滞在期間 == 999
				LOCALS += "　　　　　常驻人员　"
			ELSEIF CFLAG:(表示候補:LOCAL):滞在期間 > 1
				LOCALS += @"　　剩余天数：{CFLAG:(表示候補:LOCAL):滞在期間 - 1, 2}天　"
			ENDIF
		ENDIF
		LOCAL:1 += 1
		IF LOCAL:1 % 2 == 0
			HTML_PRINT LOCALS
			LOCALS = 
		ENDIF
		SIF LOCAL:1 > 29
			BREAK
	NEXT
	IF LOCALS != ""
		HTML_PRINT LOCALS
		LOCALS = 
	ENDIF
	PRINTL 
	IF 現在ページ > 0
		PRINTLC  [900]上一页
	ELSE
		PRINTLC  
	ENDIF
		PRINTLC  [999]返回
	IF 現在ページ < 候補人数 / 30
		PRINTLC  [901]下一页
	ENDIF
	PRINTL
	DRAWLINE

	BINPUT
	LOCAL = RESULT
	SELECTCASE LOCAL
		CASE 999
			RESTART
		CASE 900
			現在ページ -= 1
			GOTO INPUT_LOOP_70
		CASE 901
			現在ページ += 1
			GOTO INPUT_LOOP_70
		CASEELSE
			IF MONEY < ITEMPRICE:70
				PRINTW 卢比不足。
				RESTART
			ENDIF
			MONEY -= ITEMPRICE:70
			PRINTFORMW %NAME表示(LOCAL)%的体力上限已提升1000。
			CFLAG:LOCAL:元気になる薬フラグ = 3
			CALL 体力変動素質適用処理(LOCAL)
			BASE:LOCAL:体力 = MIN(MAXBASE:LOCAL:体力, BASE:LOCAL:体力 + 1000)
	ENDSELECT
	GOTO INPUT_LOOP_70
ENDIF

IF LOCAL == 90
	現在ページ = 0
	PRINTL 是否购买【记忆消除＆再生药剂】？
	PRINTL ※将重置后天获得的爱慕/炮友等关系（固有设定关系除外），重塑童贞与处女状态
	PRINTL ※非系统原生功能，可能导致意外错误！建议存档后使用！
	PRINTBUTTON "[0] 确定", 0
	PRINTL
	PRINTBUTTON "[1] 取消", 1
	PRINTL
	BINPUT
	SIF RESULT
		RESTART
	PRINTL 请选择使用对象

	VARSET 表示候補
	候補人数 = 0
	FOR LOCAL, 1, CHARANUM
		SIF CFLAG:LOCAL:滞在期間 < 0
			CONTINUE
		表示候補:候補人数 = LOCAL
		候補人数 += 1
	NEXT

	$INPUT_LOOP_90
	VARSET LOCAL
	LOCALS = 
	;表示処理
	FOR LOCAL, 現在ページ * 30, 候補人数
		LOCALS += @"<button value = '{表示候補:LOCAL}'>[{表示候補:LOCAL,3}] %ADD_STR_SPACE(NAME表示省略(NAME表示(表示候補:LOCAL)), "]", 1),41,LEFT%</button>"
		IF CFLAG:(表示候補:LOCAL):滞在期間 == 1
			LOCALS += @"　　　　　<font color='#%カラーパレット_HTML("黄")%'>今天回家</font>　"
		ELSEIF CFLAG:(表示候補:LOCAL):滞在期間 == 999
			LOCALS += "　　　　　常驻人员　"
		ELSEIF CFLAG:(表示候補:LOCAL):滞在期間 > 1
			LOCALS += @"　　剩余天数：{CFLAG:(表示候補:LOCAL):滞在期間 - 1, 2}天　"
		ENDIF
		LOCAL:1 += 1
		IF LOCAL:1 % 2 == 0
			HTML_PRINT LOCALS
			LOCALS = 
		ENDIF
		SIF LOCAL:1 > 29
			BREAK
	NEXT

	IF LOCALS != ""
	HTML_PRINT LOCALS
	LOCALS = 
	ENDIF
	PRINTL 
	IF 現在ページ > 0
		PRINTLC  [900]上一页
	ELSE
		PRINTLC  
	ENDIF
		PRINTLC  [999]返回
	IF 現在ページ < 候補人数 / 30
		PRINTLC  [901]下一页
	ENDIF
	PRINTL
	DRAWLINE

	BINPUT
	LOCAL = RESULT
	SELECTCASE LOCAL
		CASE 999
			RESTART
		CASE 900
			現在ページ -= 1
			GOTO INPUT_LOOP_90
		CASE 901
			現在ページ += 1
			GOTO INPUT_LOOP_90
		CASEELSE
			IF MONEY < ITEMPRICE:90
				PRINTW 卢比不足。
				RESTART
			ENDIF
			MONEY -= ITEMPRICE:90
			CALL 記憶消去処理(LOCAL)
	ENDSELECT
	GOTO INPUT_LOOP_90
ENDIF

IF LOCAL == 41
	MONEY -= ITEMPRICE:LOCAL
	ITEM:LOCAL ++
	PRINTW 春药已制作完成
	RESTART
ENDIF
;複数所持アイテム
SELECTCASE ITEM種別(LOCAL)
	CASE "消耗品"
		PRINTFORM 请输入购买%ITEMNAME:LOCAL%的数量
		PRINTFORML 
		;金欠、アイテム数の超過はあとで合わせる
		PRINTL [0] - 取消
		PRINT [1] - 1　
		PRINT [5] - 5　
		PRINT [10] - 10　
		PRINT [20] - 20　
		PRINT [50] - 50　
		PRINT [99] - 最大可购
		BINPUT
		SIF RESULT * ITEMPRICE:LOCAL > MONEY
			RESULT = MONEY / ITEMPRICE:LOCAL
		ITEM:LOCAL += RESULT
		IF ITEM:LOCAL > 99
			RESULT = 99 - (ITEM:LOCAL - RESULT)
			ITEM:LOCAL = 99
		ENDIF
		PRINTFORMW 以%NUM_FORMAT(RESULT * ITEMPRICE:LOCAL)%%MONEYLABEL%购买了{RESULT}个%ITEMNAME:LOCAL%
		MONEY -= RESULT * ITEMPRICE:LOCAL
		RESTART
	CASE "成人用品"
		SIF ITEM:LOCAL
			RESTART
		PRINTFORML 是否购买%ITEMNAME:LOCAL%？
		PRINTL [0] - 确定  [1] - 取消
		INPUT
		SIF RESULT
			RESTART
		IF MONEY < ITEMPRICE:LOCAL
			PRINTW 卢比不足。
			RESTART
		ENDIF
		ITEM:LOCAL ++
		MONEY -= ITEMPRICE:LOCAL
		RESTART
	CASE "家居用品", "书籍类商品"
		SIF ITEM:LOCAL
			RESTART
		CALL 通信販売_アイテム説明(ITEMNAME:LOCAL)
		PRINTFORML 是否购买%ITEMNAME:LOCAL%？
		PRINTL [0] - 确定  [1] - 取消
		INPUT
		SIF RESULT
			RESTART
		IF MONEY < ITEMPRICE:LOCAL
			PRINTW 卢比不足。
			RESTART
		ENDIF
		ITEM:LOCAL ++
		MONEY -= ITEMPRICE:LOCAL
		RESTART
ENDSELECT


@通信販売_品揃え登録(HTML文字列, 右側表示モード)
#DIMS REF HTML文字列
#DIMS 右側表示モード

SELECTCASE 右側表示モード
	CASE "成人用品"
		HTML文字列 += "・解锁特殊指令所需的成人用品分类。<br><br>"
		FOR LOCAL, 0, 200
			SIF ITEMNAME:LOCAL == ""
				CONTINUE
			SIF ITEM種別(LOCAL) != "成人用品"
				CONTINUE
			SIF ITEM:LOCAL && 購入済み非表示フラグ
				CONTINUE
			IF ITEM:LOCAL
				HTML文字列 += @"<nonbutton><font color='#%カラーパレット_HTML("グレーアウト")%'>[{LOCAL, 2}] %ITEMNAME:LOCAL, 20, LEFT% （已购买）　　　价格：%NUM_FORMAT(ITEMPRICE:LOCAL), 6%卢比</font></nonbutton>"
			ELSE
				HTML文字列 += @"<button value='{LOCAL}'>[{LOCAL, 2}] 购买%ITEMNAME:LOCAL, 20, LEFT% </button>　　　价格：%NUM_FORMAT(ITEMPRICE:LOCAL), 6%卢比"
			ENDIF
			HTML文字列 += "<br>"
		NEXT
		HTML文字列 += "</div>"
		IF 購入済み非表示フラグ
			HTML文字列 += @"<div rect='2250,3044,3875,2812'><button value='-98'>[-98] 已购商品显示 <font color='#%カラーパレット_HTML("グレーアウト")%'>开启</font> / 关闭</button>"
		ELSE
			HTML文字列 += @"<div rect='2250,3044,3875,2812'><button value='-98'>[-98] 已购商品显示 开启 / <font color='#%カラーパレット_HTML("グレーアウト")%'>关闭</font></button>"
		ENDIF
	CASE "消耗品"
		HTML文字列 += "・使用后消失或需选择目标的消耗品分类。<br><br>"
		FOR LOCAL, 0, 200
			SIF ITEMNAME:LOCAL == ""
				CONTINUE
			SIF ITEM種別(LOCAL) != "消耗品"
				CONTINUE
			HTML文字列 += @"<button value='{LOCAL}'>[{LOCAL, 2}] 购买%ITEMNAME:LOCAL, 20, LEFT% </button>　　价格：%NUM_FORMAT(ITEMPRICE:LOCAL), 7%卢比　　持有量：{ITEM:LOCAL, 2}个"
			HTML文字列 += "<br>"
		NEXT
	CASE "家居用品"
		HTML文字列 += "・解锁家居指令所需的家居用品分类。<br><br>"
		FOR LOCAL, 0, 200
			SIF ITEMNAME:LOCAL == ""
				CONTINUE
			SIF ITEM種別(LOCAL) != "家居用品"
				CONTINUE
			SIF ITEM:LOCAL && 購入済み非表示フラグ
				CONTINUE
			IF ITEM:LOCAL
				HTML文字列 += @"<nonbutton><font color='#%カラーパレット_HTML("グレーアウト")%'>[{LOCAL, 2}] %ITEMNAME:LOCAL, 20, LEFT% （已购买）　　　价格：%NUM_FORMAT(ITEMPRICE:LOCAL), 6%卢比</font></nonbutton>"
			ELSE
				HTML文字列 += @"<button value='{LOCAL}'>[{LOCAL, 2}] 购买%ITEMNAME:LOCAL, 20, LEFT% </button>　　　价格：%NUM_FORMAT(ITEMPRICE:LOCAL), 6%卢比"
			ENDIF
			HTML文字列 += "<br>"
		NEXT
		HTML文字列 += "</div>"
		IF 購入済み非表示フラグ
			HTML文字列 += @"<div rect='2250,3044,3875,2812'><button value='-98'>[-98] 已购商品显示 <font color='#%カラーパレット_HTML("グレーアウト")%'>开启</font> / 关闭</button>"
		ELSE
			HTML文字列 += @"<div rect='2250,3044,3875,2812'><button value='-98'>[-98] 已购商品显示 开启 / <font color='#%カラーパレット_HTML("グレーアウト")%'>关闭</font></button>"
		ENDIF
	CASE "书籍类商品"
		HTML文字列 += "・解锁特殊能力的书籍分类。<br><br>"
		FOR LOCAL, 0, 200
			SIF ITEMNAME:LOCAL == ""
				CONTINUE
			SIF ITEM種別(LOCAL) != "书籍类商品"
				CONTINUE
			SIF ITEM:LOCAL && 購入済み非表示フラグ
				CONTINUE
			IF ITEM:LOCAL
				HTML文字列 += @"<nonbutton><font color='#%カラーパレット_HTML("グレーアウト")%'>[{LOCAL, 2}] %ITEMNAME:LOCAL, 20, LEFT% （已购买）　　　价格：%NUM_FORMAT(ITEMPRICE:LOCAL), 6%卢比</font></nonbutton>"
			ELSE
				HTML文字列 += @"<button value='{LOCAL}'>[{LOCAL, 2}] 购买%ITEMNAME:LOCAL, 20, LEFT% </button>　　　价格：%NUM_FORMAT(ITEMPRICE:LOCAL), 6%卢比"
			ENDIF
			HTML文字列 += "<br>"
		NEXT
		HTML文字列 += "</div>"
		IF 購入済み非表示フラグ
			HTML文字列 += @"<div rect='2250,3044,3875,2812'><button value='-98'>[-98] 已购商品显示 <font color='#%カラーパレット_HTML("グレーアウト")%'>开启</font> / 关闭</button>"
		ELSE
			HTML文字列 += @"<div rect='2250,3044,3875,2812'><button value='-98'>[-98] 已购商品显示 开启 / <font color='#%カラーパレット_HTML("グレーアウト")%'>关闭</font></button>"
		ENDIF
ENDSELECT


@ITEM種別(アイテム番号)
#FUNCTIONS
#DIM アイテム番号

SELECTCASE アイテム番号
	CASE 0 TO 20
		RETURNF "成人用品"
	CASE 40, 70, 90, 91, 92
		RETURNF "消耗品"
	CASE 80 TO 83
		RETURNF "家居用品"
	CASE 60, 71, 72
		RETURNF "书籍类商品"
ENDSELECT


@通信販売_アイテム説明(アイテム名)
#DIMS アイテム名

SELECTCASE アイテム名
	CASE "扑克牌套装"
		PRINTL 标准扑克套装
		PRINTL 仅需一套即可体验多种玩法
		PRINTL ※解锁自宅客厅的「打扑克」指令
		PRINTL
	CASE "饮料柜"
		PRINTL 可大量冷藏饮品的魔法道具
		PRINTL 满足多人宅家畅饮需求
		PRINTL ※解锁自宅客厅的「举办酒会」指令
		PRINTL
	CASE "按摩垫"
		PRINTL 家用专业按摩垫
		PRINTL 专业设备带来非凡体验
		PRINTFORML ※解锁自宅%CALLNAME:MASTER%房间的「开始按摩」指令
		PRINTL
	CASE "被炉"
		PRINTL 暖心又实用的冬日必备神器。
		PRINTL 大型号设计，多人共享也宽敞舒适。
		PRINTFORML ※ 冬季时，好感度达到一定值以上的角色会来和室拜访（最多可容纳10人左右）。
		PRINTL
	CASE "书籍『快乐搬家术』"
		PRINTL 阐述搬家如何丰富人生并带来幸福的著作
		PRINTL 作者曾搬家达99次，搬到不同的岛屿也是常有的事
		PRINTFORML ※在ZP商店解锁特殊能力「自由搬迁术」
		PRINTL
	CASE "书籍『肉类烹饪入门』"
		PRINTL 收录家常肉类料理的烹饪指南
		PRINTL 可掌握基础煎烤技巧与食材处理方法
		PRINTL ※解锁以下料理配方
		PRINTL 　炸猪排三明治・一磅牛排・烤肉套餐
		PRINTL
	CASE "书籍『美味海鲜推荐』"
		PRINTL 提供简易海鲜料理制作方法的图鉴
		PRINTL 可学习基础处理技巧与鱼类解剖诀窍
		PRINTL ※解锁以下料理配方
		PRINTL 　海鲜炒面・昆布腌刺身・寿司拼盘
		PRINTL
ENDSELECT


