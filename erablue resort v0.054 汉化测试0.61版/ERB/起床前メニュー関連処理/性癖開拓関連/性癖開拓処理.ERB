
@性癖開拓処理
#DIM DYNAMIC 表示候補, キャラクタ数上限
#DIM 現在ページ
#DIM 開拓対象
#DIM 複数名フラグ
#DIM キャラ番号
#DIM 性癖番号
#DIM スキップフラグ
#DIM 開拓性癖ループ
#DIMS 複数登録キャラ
#DIMS DYNAMIC 複数登録配列, 100
#DIM DYNAMIC 開拓性癖配列, 100
#DIMS HTML文字列
#DIM 選択番号
#DIM 入力値

VARSET 表示候補, -1
現在ページ = 0
複数名フラグ = 0
複数登録キャラ = _
選択番号 = 0

;表示キャラを登録
LOCAL:1 = 0
FOR LOCAL, 1, CHARANUM
	;非滞在は出さない
	SIF CFLAG:LOCAL:滞在期間 < 0
		CONTINUE
	表示候補:(LOCAL:1) = LOCAL
	LOCAL:1 += 1
NEXT
CALL キャラ配列フィルタ処理(表示候補, -1)

$表示_LOOP
PRINTL
PRINTL
PRINTL
DRAWLINE
PRINTL 从图书馆藏书中对指定色情书籍进行加工，使其传递给任意角色以开发角色性癖
PRINTL 要开发谁的性癖？
DRAWLINE
PRINTBUTTON "[9000] 批量开发多名角色", 9000
PRINTL
IF OPTION変数:性癖開拓自動継続
	HTML_PRINT @"<button value='9997'>[9997] 失败时自动继续选项 ON / <font color='#%カラーパレット_HTML("グレーアウト")%'>OFF</font></button>"
ELSE
	HTML_PRINT @"<button value='9997'>[9997] 失败时自动继续选项 <font color='#%カラーパレット_HTML("グレーアウト")%'>ON</font> / OFF</button>"
ENDIF
DRAWLINE
LOCAL:1 = 0
;キャラの表示（15人まで）
FOR LOCAL, (現在ページ * 15), ((現在ページ * 15) + 15)
	;登録が終わったら表示終了
	IF 表示候補:LOCAL == -1
		LOCAL:1 = 1
		BREAK
	ENDIF
	LOCALS = %GET_NAME(表示候補:LOCAL, 1)%　
	IF 性癖素質:(表示候補:LOCAL):性癖開発用フラグ変数 == 0
		LOCALS += "当前性癖开发：无　　　　　　"
	ELSE
		LOCALS += @"当前性癖开发：%GET_性癖素質NAME(性癖素質:(表示候補:LOCAL):性癖開発用フラグ変数, 表示候補:LOCAL), 16, LEFT%"
	ENDIF
	IF キャラ一覧ソート:0 != ""
		LOCALS += @"%ソート情報表示(表示候補:LOCAL)%"
	ENDIF
	IF 文字色グループ取得(表示候補:LOCAL) >= 0
		SETCOLOR 同室時_グループ文字色:(文字色グループ取得(表示候補:LOCAL))
	ELSEIF CFLAG:(表示候補:LOCAL):同室文字色
		SETCOLOR CFLAG:(表示候補:LOCAL):同室文字色
	ENDIF
	PRINTBUTTON @"[{LOCAL, 3}] %LOCALS%", LOCAL
	RESETCOLOR
	PRINTL 
NEXT

DRAWLINE

;ページめくり表示
IF 現在ページ > 0
	PRINTBUTTONLC "[9009]上一页", 9009
ELSE
	PRINTLC 　
ENDIF
PRINTFORM - {現在ページ + 1} -
IF LOCAL:1 == 0
	PRINTBUTTONC "[9010]下一页", 9010
ENDIF
PRINTL 

DRAWLINE
CALL フィルタソートボタンセット表示(9020, 9030, 9031, 9040)
DRAWLINE

PRINTBUTTON "[9998]系统说明", 9998
PRINT 　　
PRINTBUTTON "[9999]返回", 9999

IF チュートリアルフラグ:性癖開拓 == 0
	入力値 = 9998
ELSE
	BINPUT
	入力値 = RESULT
ENDIF
;広告対象のINPUT
SELECTCASE 入力値
	CASE 9020, 9030, 9031, 9040
		CALL フィルタソートボタンセット実行部(入力値, 9020, 9030, 9031, 9040)
		現在ページ = 0
		RESTART
	CASE 9009
		現在ページ = MAX(現在ページ - 1, 0)
		GOTO 表示_LOOP
	CASE 9010
		SIF LOCAL:1 == 0
			現在ページ += 1
		GOTO 表示_LOOP
	CASE 9999
		RETURN -1
	CASE 9997
		INVERTBIT OPTION変数:性癖開拓自動継続, 0
		GOTO 表示_LOOP
	CASE 9998
		PRINTL
		DRAWLINE
		PRINTL ［性癖开发系统教程］
		DRAWLINE
		HTML_PRINT "<img src='顔エラ' height='900' width='900'>"
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		CALL 性癖開拓システムチュートリアル
		DRAWLINE
		RESTART
	CASE 9000
		複数名フラグ = 1
	CASEELSE
		開拓対象 = 表示候補:入力値
ENDSELECT

IF 複数名フラグ
	VARSET 開拓性癖配列
	$性癖表示LOOP
	現在ページ = 0
	DRAWLINE
	PRINTFORML 批量进行多名角色的性癖开发
	PRINTL 要开发哪种性癖？
	PRINTL ※可设置优先级进行多选
	PRINTL 　对于选中的角色，若已获得０级性癖则分配１级，已获得１级则分配２级
	PRINTL 　依此类推进行书籍分配
	DRAWLINE
	
	;左枠
	HTML文字列 = <div rect='81,31,1937,2812' padding='50,25,50' border='31' bcolor='#C0C0C0'>
	FOR LOCAL, 1, 100
		IF ERDNAME(性癖素質, LOCAL) != ""
			IF ENUMFUNCBEGINSWITH(@"性癖開拓チャレンジ処理_%ERDNAME(性癖素質, LOCAL)%")
				IF 選択番号 == LOCAL
					HTML文字列 += @"<font color='#%カラーパレット_HTML("黄")%'><button value='{LOCAL}'>[{LOCAL, 2}]%GET_性癖素質NAME(LOCAL)%</button></font>"
				ELSE
					HTML文字列 += @"<button value='{LOCAL}'>[{LOCAL, 2}]%GET_性癖素質NAME(LOCAL)%</button>"
				ENDIF
				IF MATCH(開拓性癖配列, LOCAL)
					HTML文字列 += @"<font color='#%カラーパレット_HTML("黄")%'>：%TOFULL(TOSTR(FINDELEMENT(開拓性癖配列, LOCAL)))%</font>"
				ENDIF
				HTML文字列 += "<br>"
			ENDIF
		ENDIF
	NEXT
	HTML文字列 += "<br>"
	IF 開拓性癖配列:0
		HTML文字列 += "<button value='998'>[998]按此优先级开发</button><br>"
	ELSE
		HTML文字列 += @"<font color='#%カラーパレット_HTML("グレーアウト")%'>[998]按此优先级开发</font><br>"
	ENDIF
	HTML文字列 += "<button value='999'>[999]返回</button><br>"
	HTML文字列 += "</div>"

	;右枠
	HTML文字列 += "<div rect='2050,31,3875,2812' padding='50,25,50' border='31' bcolor='#C0C0C0'>"
	IF 選択番号
		CALLF GET_性癖素質NAME(選択番号, , 1)
		HTML文字列 += TSTR:ツールチップ受渡
		HTML文字列 += "<br><button value='997'>[997] 添加到候选列表</button><br>"
	ENDIF
	HTML文字列 += "</div>"

	
	HTML_PRINT HTML文字列, 1
	FOR LOCAL, 0, 30
		PRINTL 
	NEXT

	BINPUT
	性癖番号 = RESULT
	SELECTCASE 性癖番号
		CASE 1 TO 100
			選択番号 = 性癖番号
			GOTO 性癖表示LOOP
		CASE 997
			IF MATCH(開拓性癖配列, 選択番号)
				ARRAYREMOVE 開拓性癖配列, FINDELEMENT(開拓性癖配列, 選択番号), 1
			ELSE
				開拓性癖配列:(FINDELEMENT(開拓性癖配列, 0)) = 選択番号
			ENDIF
			GOTO 性癖表示LOOP
		CASE 998
			$フィルタソートLOOP
			;表示キャラを登録
			VARSET 表示候補, -1
			LOCAL:1 = 0
			FOR キャラ番号, 1, CHARANUM
				;非滞在は出さない
				SIF CFLAG:キャラ番号:滞在期間 < 0
					CONTINUE
				スキップフラグ = 1
				FOR 開拓性癖ループ, 0, 100
					SIF 開拓性癖配列:開拓性癖ループ == 0
						BREAK
					;すでに性癖持ってるならスキップ
					SIF 性癖素質:キャラ番号:(開拓性癖配列:開拓性癖ループ)
						CONTINUE
					;名前の設定されていない性癖は取れない
					SIF GET_性癖素質NAME(開拓性癖配列:開拓性癖ループ, キャラ番号) == ""
						CONTINUE
					スキップフラグ = 0
				NEXT
				SIF スキップフラグ
					CONTINUE
				表示候補:(LOCAL:1) = キャラ番号
				LOCAL:1 += 1
			NEXT
			CALL キャラ配列フィルタ処理(表示候補, -1)

			$表示_LOOP2
			DRAWLINE
			PRINTFORML 批量进行多名角色的性癖开发
			PRINTL 要开发哪些角色的性癖？（最多可选100名）
			DRAWLINE
			PRINTBUTTON "[9001] 全选当前显示角色", 9001
			PRINTL
			DRAWLINE
			LOCAL:1 = 0
			;キャラの表示（15人まで）
			FOR LOCAL, (現在ページ * 15), ((現在ページ * 15) + 15)
				;登録が終わったら表示終了
				IF 表示候補:LOCAL == -1
					LOCAL:1 = 1
					BREAK
				ENDIF
				IF STRFIND(複数登録キャラ, @"_{表示候補:LOCAL}_") > -1
					SETCOLOR カラーパレット("黄")
				ELSEIF 文字色グループ取得(表示候補:LOCAL) >= 0
					SETCOLOR 同室時_グループ文字色:(文字色グループ取得(表示候補:LOCAL))
				ELSEIF CFLAG:(表示候補:LOCAL):同室文字色
					SETCOLOR CFLAG:(表示候補:LOCAL):同室文字色
				ENDIF
				LOCALS = %GET_NAME(表示候補:LOCAL, 1)%
				IF 性癖素質:(表示候補:LOCAL):性癖開発用フラグ変数 == 0
					LOCALS += "当前性癖开发：无　　　　　　"
				ELSE
					LOCALS += @"当前性癖开发：%GET_性癖素質NAME(性癖素質:(表示候補:LOCAL):性癖開発用フラグ変数, 表示候補:LOCAL), 16, LEFT%"
				ENDIF
				IF キャラ一覧ソート:0 != ""
					LOCALS += @"%ソート情報表示(表示候補:LOCAL)%"
				ENDIF
				PRINTBUTTON @"[{LOCAL, 3}] %LOCALS%", LOCAL
				RESETCOLOR
				PRINTL 
			NEXT

			DRAWLINE

			;ページめくり表示
			IF 現在ページ > 0
				PRINTBUTTONLC "[9009]上一页", 9009
			ELSE
				PRINTLC 　
			ENDIF
			PRINTFORM - {現在ページ + 1} -
			IF LOCAL:1 == 0
				PRINTBUTTONC "[9010]下一页", 9010
			ENDIF
			PRINTL 
			DRAWLINE
			CALL フィルタソートボタンセット表示(9020, 9030, 9031, 9040)
			DRAWLINE

			PRINTBUTTON "[9000] 确认当前选择", 9000
			PRINTL
			PRINTBUTTON "[9999]返回", 9999
			BINPUT

			;広告対象のINPUT
			SELECTCASE RESULT
				CASE 9020, 9030, 9031, 9040
					CALL フィルタソートボタンセット実行部(RESULT, 9020, 9030, 9031, 9040)
					現在ページ = 0
					GOTO フィルタソートLOOP
				CASE 9009
					現在ページ = MAX(現在ページ - 1, 0)
					GOTO 表示_LOOP2
				CASE 9010
					SIF LOCAL:1 == 0
						現在ページ += 1
					GOTO 表示_LOOP2
				CASE 9999
					GOTO 性癖表示LOOP
				CASE 9000
					VARSET 複数登録配列
					SPLIT 複数登録キャラ, "_", 複数登録配列
					FOR LOCAL, 1, 100
						SIF 複数登録配列:LOCAL == ""
							BREAK
						REPLACE 複数登録配列:LOCAL, "_", ""
						開拓対象 = TOINT(RESULTS)
						FOR 開拓性癖ループ, 0, 100
							SIF 開拓性癖配列:開拓性癖ループ == 0
								BREAK
							;すでに性癖持ってるならスキップ
							SIF 性癖素質:開拓対象:(開拓性癖配列:開拓性癖ループ)
								CONTINUE
							;名前の設定されていない性癖は取れない
							SIF GET_性癖素質NAME(開拓性癖配列:開拓性癖ループ, 開拓対象) == ""
								CONTINUE

							性癖素質:開拓対象:性癖開発用フラグ変数 = 開拓性癖配列:開拓性癖ループ
							PRINTFORML 正在对%CALLNAME:開拓対象%进行%GET_性癖素質NAME(開拓性癖配列:開拓性癖ループ, 開拓対象)%相关色情书籍的加工
							BREAK
						NEXT
					NEXT
					PRINTW ※结果将在当日结束时显示
					RESTART
				CASE 9001
					FOR LOCAL, 0, CHARANUM
						SIF 表示候補:LOCAL < 0
							CONTINUE
						FOR 開拓性癖ループ, 0, 100
							SIF 開拓性癖配列:開拓性癖ループ == 0
								BREAK
							;すでに性癖持ってるならスキップ
							SIF 性癖素質:(表示候補:LOCAL):(開拓性癖配列:開拓性癖ループ)
								CONTINUE
							;名前の設定されていない性癖は取れない
							SIF GET_性癖素質NAME(開拓性癖配列:開拓性癖ループ, 表示候補:LOCAL) == ""
								CONTINUE

							性癖素質:(表示候補:LOCAL):性癖開発用フラグ変数 = 開拓性癖配列:開拓性癖ループ
							BREAK
						NEXT
					NEXT
					PRINTFORML 正在对所有显示角色进行对应色情书籍的加工
					PRINTW ※结果将在当日结束时显示
					RESTART
				CASEELSE
					LOCALS = _{表示候補:RESULT}_
					IF STRFIND(複数登録キャラ, LOCALS) > -1
						REPLACE 複数登録キャラ, LOCALS, "_"
						複数登録キャラ = %RESULTS%
					ELSE
						IF STRCOUNT(複数登録キャラ, "_") < 99
							複数登録キャラ += @"{表示候補:RESULT}_"
						ENDIF
					ENDIF
					GOTO 表示_LOOP2
			ENDSELECT
		CASE 999
			複数登録キャラ = 
			RESTART
	ENDSELECT
ELSE
	$単体開拓ループ
	PRINTL
	DRAWLINE
	PRINTFORML 正在开发%CALLNAME:開拓対象%的性癖
	PRINTL 要开发哪种性癖？
	DRAWLINE

	;左枠
	HTML文字列 = <div rect='81,31,1937,2812' padding='50,25,50' border='31' bcolor='#C0C0C0'>

	FOR LOCAL, 1, 100
		IF ERDNAME(性癖素質, LOCAL) != ""
			;すでに性癖持ってるならスキップ
			SIF 性癖素質:開拓対象:LOCAL
				CONTINUE
			;名前の設定されていない性癖は取れない
			SIF GET_性癖素質NAME(LOCAL, 開拓対象) == ""
				CONTINUE
			IF ENUMFUNCBEGINSWITH(@"性癖開拓チャレンジ処理_%ERDNAME(性癖素質, LOCAL)%")
				IF 選択番号 == LOCAL
					HTML文字列 += @"<font color='#%カラーパレット_HTML("黄")%'><button value='{LOCAL}'>[{LOCAL}]%GET_性癖素質NAME(LOCAL, 開拓対象)%</button></font><br>"
				ELSE
					HTML文字列 += @"<button value='{LOCAL}'>[{LOCAL}]%GET_性癖素質NAME(LOCAL, 開拓対象)%</button><br>"
				ENDIF
			ENDIF
		ENDIF
	NEXT
	HTML文字列 += "<br>"
	IF 性癖素質:開拓対象:性癖開発用フラグ変数
		HTML文字列 += "<button value='0'>[0]取消开发计划</button><br>"
	ENDIF
	HTML文字列 += "<button value='999'>[999]返回</button><br>"
	HTML文字列 += "</div>"

	;右枠
	HTML文字列 += "<div rect='2050,31,3875,2812' padding='50,25,50' border='31' bcolor='#C0C0C0'>"
	IF 選択番号
		CALLF GET_性癖素質NAME(選択番号, 開拓対象, 1)
		HTML文字列 += TSTR:ツールチップ受渡
		HTML文字列 += "<br><button value='998'>[998] 确认开发此性癖</button><br>"
	ENDIF
	HTML文字列 += "</div>"

	HTML_PRINT HTML文字列, 1
	FOR LOCAL, 0, 30
		PRINTL 
	NEXT
	BINPUT
	LOCAL = RESULT
	SELECTCASE LOCAL
		CASE 0
			PRINTW 取消加工操作
			性癖素質:開拓対象:性癖開発用フラグ変数 = LOCAL
			RESTART
		CASE 1 TO 100
			選択番号 = LOCAL
			GOTO 単体開拓ループ
		CASE 998
			PRINTFORML 正在对%CALLNAME:開拓対象%进行%GET_性癖素質NAME(選択番号, 開拓対象)%相关色情书籍的加工
			PRINTW ※结果将在当日结束时显示
			性癖素質:開拓対象:性癖開発用フラグ変数 = 選択番号
			RESTART
		CASE 999
			GOTO 表示_LOOP
	ENDSELECT
ENDIF

@性知識条件_性癖開拓チャレンジ()
#FUNCTION
;性癖チャレンジで必要な最低の性知識レベルを返す

IF 高速船記録:派遣先登録 == "智慧殿堂" && 高速船記録:派遣状態 == "派遣中"
	RETURNF -1
ELSE
	RETURNF 0
ENDIF
