@イベント発生条件_キャライベント_フェルンへの性教育
;開放条件を満たしたら1を返すこと
#DIM キャラ番号_フリーレン
#DIM キャラ番号_フェルン
#DIM キャラ番号_シュタルク
#DIM 縁結び数
#DIM DT_ID
#DIM 人物番号1
#DIM 人物番号2

キャラ番号_フリーレン = GETCHARA(1041)
キャラ番号_フェルン   = GETCHARA(1042)
キャラ番号_シュタルク = GETCHARA(1043)

;フリーレンが陥落済み
SIF 陥落チェック_性的(キャラ番号_フリーレン) == 0
	RETURN 0
;フェルンが招待済み
SIF CFLAG:キャラ番号_フェルン:招待不可フラグ != 0
	RETURN 0
;フェルンが島にいる
;これ満たしてるなら↑のやついらなそうだけど、今後の参考文献的な意味で残しておく
SIF CFLAG:キャラ番号_フェルン:滞在期間 < 1
	RETURN 0
;フェルンが未陥落
SIF 陥落チェック_性的(キャラ番号_フェルン) >= 1
	RETURN 0
;フェルンにシュタルク以外の縁結び相手がいないこと
縁結び数 = DT_SELECT("関係性データベース", @"(対象キャラ１ = {CFLAG:キャラ番号_フェルン:人物番号} Or 対象キャラ２ = {CFLAG:キャラ番号_フェルン:人物番号}) And (関係性種別 = '恋慕' Or 関係性種別 = 'セフレ')")
DT_ID = RESULT:1
IF 縁結び数
	;縁結び相手が複数いたら✕
	SIF 縁結び数 >= 2
		RETURN 0
	;縁結び相手がシュタルク以外だと✕
	人物番号1 = DT_CELL_GET("関係性データベース", DT_ID, "対象キャラ１", 1)
	人物番号2 = DT_CELL_GET("関係性データベース", DT_ID, "対象キャラ２", 1)
	SIF 人物番号1 != CFLAG:キャラ番号_シュタルク:人物番号 && 人物番号2 != CFLAG:キャラ番号_シュタルク:人物番号
		RETURN 0
ENDIF
;シュタルクが寝取られ性癖を持っていない
SIF 性癖素質:キャラ番号_シュタルク:寝取られ > 1
	RETURN 0
RETURN 1


@イベント消滅条件_キャライベント_フェルンへの性教育
;この条件を満たした時、イベントは発生してない扱いとなる
;発生条件＞消滅条件で見るので、発生と消滅を両方満たしている時は「発生した！」というメッセージが出るが発生していない扱いになる
;そのため条件には注意すること

;消滅条件を満たしたら1を返す
; IF 消滅条件式
; 	RETURN 1
; ENDIF
; RETURN 0

;例えば、「発生条件を満たしている時のみ出現させたい」のなら以下のようになる
CALL イベント発生条件_キャライベント_フェルンへの性教育
IF RESULT
	;発生条件OKなので0を返す
	RETURN 0
ELSE
	;発生条件アウトなので1を返す
	RETURN 1
ENDIF

@イベント関数_キャライベント_フェルンへの性教育(ARG)
#DIM キャラ番号_フリーレン
#DIM キャラ番号_フェルン
#DIM キャラ番号_シュタルク
#DIM イベント内容
#DIM CONST イベント内容_フェルンに性教育      = 0
#DIM CONST イベント内容_二人に性教育          = 1
#DIM CONST イベント内容_二人に性教育_縁結び済 = 2

キャラ番号_フリーレン = GETCHARA(1041)
キャラ番号_フェルン   = GETCHARA(1042)
キャラ番号_シュタルク = GETCHARA(1043)

;イベント内容の分岐判定
IF (TALENT:PLAYER:性別 & 2) && CFLAG:キャラ番号_シュタルク:招待不可フラグ == 0
	;あなたにＰがある ＆ シュタルクが招待可能
	IF DT_SELECT("関係性データベース", @"(対象キャラ１ = {CFLAG:キャラ番号_フェルン:人物番号} Or 対象キャラ１ = {CFLAG:キャラ番号_シュタルク:人物番号}) And (対象キャラ２ = {CFLAG:キャラ番号_フェルン:人物番号} Or 対象キャラ２ = {CFLAG:キャラ番号_シュタルク:人物番号}) And (関係性種別 = '恋慕' Or 関係性種別 = 'セフレ')")
		;シュタルクとフェルンが恋慕 or セフレ
		イベント内容 = イベント内容_二人に性教育_縁結び済
	ELSE
		イベント内容 = イベント内容_二人に性教育
	ENDIF
ELSE
	イベント内容 = イベント内容_フェルンに性教育
ENDIF

DRAWLINE
PRINTL ［对菲伦的性教育］
DRAWLINE
PRINTW
CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
PRINTL 芙莉莲：
PRINTFORMW 「──我希望你能教菲伦，关于性爱的事。」
PRINTL
PRINTFORMW 芙莉莲对%CALLNAME:PLAYER%提出「有件事想拜托你」，当%CALLNAME:PLAYER%点头后，她开口第一句就是这个。
PRINTL
PRINTFORMW …………刚才说什么？
PRINTL
CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
PRINTL 芙莉莲：
PRINTFORMW 「所以我希望你能教菲伦性爱。……好吧，我先从头说起。」
PRINTL
PRINTFORMW 「……菲伦啊，她是个战争孤儿。」
PRINTL
PRINTFORMW 「她幼时失去双亲，在那之后有一段时间，被一个叫海塔的酒肉和尚收养，一起生活。」
PRINTL
PRINTFORMW 「但那个海塔也年事已高。海塔在察觉自己寿命将至后，让菲伦拜我为徒，现在她就和我一起旅行。到现在大概有十年了吧。」
PRINTL
PRINTFORMW 「……但是啊，就算我们是师徒，也有我无法教她的事。」
PRINTL
PRINTFORMW 「你可能知道，像我这样的精灵，虽然寿命很长，但几乎没有性欲或繁殖的欲望。」
PRINTL
PRINTFORMW 「所以关于旅行和魔法的事我倒是可以教菲伦，但男女之间的事什么的我就没自信教了。」
PRINTL
PRINTFORMW 「我也不觉得海塔会教她这些……反正想着以后时机到了再说吧，就一直拖着，结果现在正好遇到了一个很合适的『老师』，所以我觉得这是个好机会。」
PRINTL
IF TALENT:キャラ番号_フリーレン:恋慕
	CALL PRINT_STRW(@"「……呵呵。毕竟你，可是能让像我这样欲望淡薄的精灵，都产生『想要一个你的孩子』这种想法……_H_我连对欣梅尔都没有过这种感觉。」")
ELSE
	CALL PRINT_STRW(@"「毕竟，和你做爱，连我这个出生至今从未感受过性欲的精灵，都会不自觉地沉迷其中。」")
ENDIF
PRINTL
PRINTFORMW 「我想对菲伦来说，这一定也会是个很好的经验。」
IF イベント内容 == イベント内容_二人に性教育
	PRINTL 
	PRINTFORMW 「……还有，如果可以的话，也希望让修塔尔克来旁观。」
	PRINTL
	PRINTFORMW 「他之前应该也没有机会学习这些，艾泽……也就是修塔尔克的师父，我也不觉得他会教性教育。所以我觉得至少需要一个旁观的机会。」
ELSEIF イベント内容 == イベント内容_二人に性教育_縁結び済
	PRINTL
	PRINTFORML 芙莉莲这么说着，但你明明已经为菲伦和修塔尔克牵了红线。
	PRINTFORMW 当%CALLNAME:PLAYER%问是怎么回事时，芙莉莲苦笑着继续说。
	PRINTL
	CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
	PRINTL 芙莉莲：
	PRINTFORMW 「就是啊……菲伦，她好像不太满足呢。从表情就能看出来。再怎么说我也是她的师父嘛。」
	PRINTL
	PRINTFORMW 「修塔尔克是个战士，应该很有体力啊……我猜他可能就是单纯地技术不好吧。嘛，艾泽……修塔尔克的师父我也不觉得他会教这些，也没办法。」
	PRINTL
	PRINTFORMW 「所以啊，我希望你能教他们。教他们俩，性爱的方法。」
	PRINTL
	CALL PRINT_STRW(@"「和你做的『真正的性爱』，是这么舒服、这么幸福，啊……_H_」")
ELSEIF TALENT:キャラ番号_フリーレン:恋慕
	PRINTL
	PRINTFORML 虽然她这么说，但芙莉莲是%CALLNAME:PLAYER%的恋人吧。这难道不是出轨吗。
	PRINTFORMW 当%CALLNAME:PLAYER%问她作为恋人有什么想法时，芙莉莲歪了歪头。
	PRINTL
	CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
	PRINTL 芙莉莲：
	PRINTFORMW 「嗯……嫉妒之类的，抱歉，我还有点不太明白。」
	PRINTL
	PRINTFORMW 「但是，作为师父，想把这份舒服和幸福教给菲伦，让她也知道，这不是理所当然的事吗？」
	PRINTL
	CALL PRINT_STRW(@"「……呵呵，既然难得，我们三个人一起试试也挺好的呢。我和菲伦，还有你……_H_」")
ENDIF
PRINTL
PRINTFORMW 「就是这么回事……呢。怎么样？」
PRINTL
PRINTBUTTON "[0] 明白了", 0
PRINTL
PRINTBUTTON "[1] 无法马上决定", 1
PRINTL
BINPUT
SELECTCASE RESULT
	CASE 0
		IF イベント内容 == イベント内容_二人に性教育
			PRINTL
			PRINTFORMW %CALLNAME:PLAYER%答应后，芙莉莲轻轻笑了。
			PRINTL
			CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
			PRINTL 芙莉莲：
			PRINTFORMW 「那太好了。……呵呵，你一定能成为一个好老师。我保证。」
			PRINTL
			PRINTFORMW 「那么，等我找到合适的时机就把他们俩带来，拜托你了。」
			PRINTL
			PRINTFORMW 芙莉莲这么说着，在%CALLNAME:PLAYER%的脸颊上印下了感谢的一吻。
			PRINTL
			PRINTFORMW ────
			PRINTL
			PRINTFORML 接受了芙莉莲的请求，下一个事件将会发生。
			SIF !FLAG:クリア済み視聴フラグ
				フェルン性教育イベフラグ = 1
		ELSEIF イベント内容 == イベント内容_二人に性教育_縁結び済
			PRINTL
			PRINTFORMW %CALLNAME:PLAYER%答应后，芙莉莲轻轻笑了。
			PRINTL
			CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
			PRINTL 芙莉莲：
			PRINTFORMW 「那太好了。……呵呵，你一定能教会菲伦，让她满意的性爱。」
			PRINTL
			PRINTFORMW 「那么，等我找到合适的时机就把他们俩带来，拜托你了。」
			PRINTL
			PRINTFORMW 芙莉莲这么说着，在%CALLNAME:PLAYER%的脸颊上印下了感谢的一吻。
			PRINTL
			PRINTFORMW ────
			PRINTL
			PRINTFORML 接受了芙莉莲的请求，下一个事件将会发生。
			SIF !FLAG:クリア済み視聴フラグ
				フェルン性教育イベフラグ = 1
		ELSE
			PRINTL
			PRINTFORMW %CALLNAME:PLAYER%答应后，芙莉莲轻轻笑了。
			PRINTL
			CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
			PRINTL 芙莉莲：
			PRINTFORMW 「那太好了。……其实啊，这件事我已经告诉菲伦了。」
			PRINTL
			PRINTFORMW 「菲伦也已经长得很成熟了嘛。毕竟是人类，到了这个年龄就算有了孩子也不奇怪。」
			PRINTL
			PRINTFORMW 「虽然她有点困惑……呵呵，但感觉她非常感兴趣。」
			PRINTL
			PRINTFORMW 这么说着，芙莉莲调皮地笑了笑，然后满怀信任地靠向%CALLNAME:PLAYER%
			PRINTL
			PRINTFORMW 「那，菲伦就拜托你了。」
			PRINTL
			PRINTFORMW 然后，在%CALLNAME:PLAYER%的脸颊上轻轻地吻了一下。
			PRINTL
			PRINTFORMW ────
			PRINTL
			PRINTFORML 获得了芙莉莲的许可，现在可以对菲伦进行『性教育』了。
			PRINTFORMW 对于她那成熟却依然无知的身体，尽情地教导她何为「真正的性爱」吧！
			SIF !FLAG:クリア済み視聴フラグ
				フェルン性教育イベフラグ = 2
			;CSTR:キャラ番号_フェルン:固有素質0 = 性の教え子
		ENDIF
	CASE 1
		PRINTL
		PRINTFORMW 当%CALLNAME:PLAYER%犹豫不决时，芙莉莲轻轻笑了。
		PRINTL
		CALL 顔グラ単発表示_デフォルト(キャラ番号_フリーレン)
		PRINTL 芙莉莲：
		PRINTFORMW 「好吧，你先考虑一下。我会先跟菲伦说一声的。」
		PRINTL
		PRINTFORML 你向芙莉莲撒娇，让回答暂时保留。
		PRINTFORMW 如果想教菲伦性爱了，那时候再和芙莉莲谈一次吧。
		RETURN 0
ENDSELECT


CALL イベント完了フラグ汎用処理("フェルンへの性教育")






