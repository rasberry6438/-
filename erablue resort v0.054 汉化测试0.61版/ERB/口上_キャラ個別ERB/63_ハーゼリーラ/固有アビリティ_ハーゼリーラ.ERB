
@固有アビ_63_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM トーラの書
#DIM 対象一時保存

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
	アビ名 = ボアズ+
	消費ＭＰ = 100
ELSE
	アビ名 = ボアズ
	消費ＭＰ = 100
ENDIF

トーラの書 = バフ番号取得_枠("トーラの書", 戦闘行動キャラ)

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵単体に［攻撃力✕100％］の水属性ダメージを5回与える。
		詳細文文字列受け渡し変数 += @"<br>（消去不可）の月影の幻惑効果を与える。成功率150％。"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 30
			詳細文文字列受け渡し変数 += @"<br>［1］のスロウ効果を与える。"
		ENDIF
		詳細文文字列受け渡し変数 += @"<br>自身にトーラの書効果が存在する時、このアビリティは2回発動する。"
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵単体に［攻撃力✕100％］の水属性ダメージを5回与える。
		詳細文文字列受け渡し変数 += @"<br>（消去不可）の月影の幻惑効果を与える。成功率150％。"
		詳細文文字列受け渡し変数 += @"<br>＞［累積5％/最大15％］の攻撃力減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［累積5％/最大15％］の防御力減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［累積5％/最大15％］の弱体耐性減少効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［累積5％/最大15％］の命中率減少効果を与える。"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 30
			詳細文文字列受け渡し変数 += @"<br>［1］のスロウ効果を与える。"
		ENDIF
		詳細文文字列受け渡し変数 += @"<br>自身にトーラの書効果が存在する時、このアビリティは2回発動する。"
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵単体
		対象一時保存 = アビテンプレート用_対象保存:0
		アビ汎用変数:効果割合 = 100
		FOR LOCAL, 0, 4
			CALL アビテンプレート_ダメージ処理_水属性
		NEXT
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_攻撃力
		アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_防御力
		アビ汎用文字列:バフ・デバフ対象能力 = 防御力
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_弱体耐性
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体耐性
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_命中率
		アビ汎用文字列:バフ・デバフ対象能力 = 命中率
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 1
			アビ汎用変数:基礎成功確率 = 120
			CALL アビテンプレート_不利効果_スロウ
		ENDIF
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果量 = 150
			CALL アビテンプレート_回復処理_MAXでも回復
		ENDIF
		
		IF トーラの書 > -1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_指定(対象一時保存)
			アビ汎用変数:効果割合 = 100
			FOR LOCAL, 0, 4
				CALL アビテンプレート_ダメージ処理_水属性
			NEXT
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_攻撃力
			アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_防御力
			アビ汎用文字列:バフ・デバフ対象能力 = 防御力
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_弱体耐性
			アビ汎用文字列:バフ・デバフ対象能力 = 弱体耐性
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_命中率
			アビ汎用文字列:バフ・デバフ対象能力 = 命中率
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
				CALL アビ汎用変数文字列リセット
				アビ汎用変数:効果量 = 1
				アビ汎用変数:基礎成功確率 = 120
				CALL アビテンプレート_不利効果_スロウ
			ENDIF
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_味方全体_生者のみ
				アビ汎用変数:効果量 = 150
				CALL アビテンプレート_回復処理_MAXでも回復
			ENDIF
		ENDIF
ENDSELECT



@固有アビ_63_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM トーラの書

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
	アビ名 = ヤヒン+
	消費ＭＰ = 100
ELSE
	アビ名 = ヤヒン
	消費ＭＰ = 100
ENDIF

トーラの書 = バフ番号取得_枠("トーラの書", 戦闘行動キャラ)

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>味方単体に［100％］（通常枠・1回）の被ダメージ減少効果を与える。
		詳細文文字列受け渡し変数 += @"<br>（通常枠・1回）の弱体無効効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>（通常枠・1回）の幻影効果を与える。"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
			詳細文文字列受け渡し変数 += @"<br>［300］のバリア効果を与える。"
		ENDIF
		詳細文文字列受け渡し変数 += @"<br>自身にトーラの書効果が存在する時、このアビリティは味方単体と自身の両方を対象とする。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方単体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 被ダメージ減少
		アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
		アビ汎用変数:効果割合 = 100
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 弱体無効
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 幻影
		アビ汎用文字列:バフ・デバフ対象能力 = 幻影
		アビ汎用変数:効果量 = 100
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = バリア
			アビ汎用文字列:バフ・デバフ対象能力 = バリア
			アビ汎用変数:効果量 = 300
			CALL アビテンプレート_有利効果_バフ効果セット
		ENDIF
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果量 = 150
			CALL アビテンプレート_回復処理_MAXでも回復
		ENDIF
		
		IF トーラの書 > -1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 被ダメージ無効
			アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
			アビ汎用変数:効果割合 = 100
			アビ汎用変数:持続回数 = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 弱体無効
			アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
			アビ汎用変数:持続回数 = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 幻影
			アビ汎用文字列:バフ・デバフ対象能力 = 回避率
			アビ汎用変数:持続回数 = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = バリア
				アビ汎用文字列:バフ・デバフ対象能力 = バリア
				アビ汎用変数:効果量 = 300
				CALL アビテンプレート_有利効果_バフ効果セット
			ENDIF
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_味方全体_生者のみ
				アビ汎用変数:効果量 = 150
				CALL アビテンプレート_回復処理_MAXでも回復
			ENDIF
		ENDIF
ENDSELECT



@固有アビ_63_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 三日月
#DIM 上弦
#DIM 望
#DIM 隊列番号
#DIM バフ行数
#DIM 対象キャラ
#DIM トーラの書

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
	アビ名 = フェイスオブザムーン+
	消費ＭＰ = 75
ELSE
	アビ名 = フェイスオブザムーン
	消費ＭＰ = 100
ENDIF

隊列番号 = キャラ隊列検索(GETCHARA(63))

三日月 = バフ番号取得_枠("三日月", 戦闘行動キャラ)
上弦 = バフ番号取得_枠("上弦", 戦闘行動キャラ)
トーラの書 = バフ番号取得_枠("トーラの書", 戦闘行動キャラ)

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}
		詳細文文字列受け渡し変数 += @"<br>味方全体に［20％］の水属性攻撃上昇効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>（2ターン）の月狂の涙効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>［15％］の奥義ゲージ増加を与える。"
		詳細文文字列受け渡し変数 += @"<br>対象に月効果が存在する時、月が少し満ちる。"
		詳細文文字列受け渡し変数 += @"<br>自身にトーラの書効果が存在する時、このアビリティは2回発動する。"
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}
		詳細文文字列受け渡し変数 += @"<br>味方全体に［20％］の水属性攻撃上昇効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>（2ターン）の月狂の涙効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［100％］のDA率上昇効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［20％］のTA率上昇効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［20％］の追撃効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>＞［10％］の与ダメージ上昇効果を与える。"
		詳細文文字列受け渡し変数 += @"<br>［15％］の奥義ゲージ増加を与える。"
		詳細文文字列受け渡し変数 += @"<br>対象に月効果が存在する時、月が少し満ちる。"
		詳細文文字列受け渡し変数 += @"<br>自身にトーラの書効果が存在する時、このアビリティは2回発動する。"
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 属性与ダメージ_水
		アビ汎用文字列:バフ・デバフ対象能力 = 属性与ダメージ_水
		アビ汎用変数:効果量 = 20
		アビ汎用変数:持続ターン = 2
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月狂の涙
		アビ汎用文字列:バフ・デバフ対象能力 = 月狂の涙
		アビ汎用変数:持続ターン = 2
		アビ汎用変数:効果量 = 0
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月狂の涙_DA率
		アビ汎用文字列:バフ・デバフ対象能力 = DA率
		アビ汎用変数:効果量 = 100
		CALL アビテンプレート_有利効果_付随バフ効果セット("月狂の涙")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月狂の涙_TA率
		アビ汎用文字列:バフ・デバフ対象能力 = TA率
		アビ汎用変数:効果量 = 20
		CALL アビテンプレート_有利効果_付随バフ効果セット("月狂の涙")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月狂の涙_追撃
		アビ汎用文字列:バフ・デバフ対象能力 = 追撃
		アビ汎用変数:効果割合 = 20
		CALL アビテンプレート_有利効果_付随バフ効果セット("月狂の涙")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月狂の涙_与ダメ増加
		アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
		アビ汎用変数:効果割合 = 10
		CALL アビテンプレート_有利効果_付随バフ効果セット("月狂の涙")
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 15
		CALL アビテンプレート_有利効果_奥義ゲージUP

		FOR 対象キャラ, 0, 4
			IF 刻印現在数確認("月", 対象キャラ) > 0 && 刻印現在数確認("月", 対象キャラ) < 5
				IF 刻印現在数確認("月", 対象キャラ) == 4
					アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月が満ちきった！
				ELSEIF 刻印現在数確認("月", 対象キャラ) == 2
					アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月が満ちていく…！
				ELSE
					アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月の時間が少し進んだ…
				ENDIF
				CALL アビ対象選択テンプレート_指定(対象キャラ)
				アビ汎用文字列:バフ・デバフ対象能力 = 月
				CALL アビテンプレート_刻印追加(1)
			ENDIF
		NEXT

		IF トーラの書 > -1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用文字列:バフ・デバフ枠 = 属性与ダメージ_水
			アビ汎用文字列:バフ・デバフ対象能力 = 属性与ダメージ_水
			アビ汎用変数:効果量 = 20
			アビ汎用変数:持続ターン = 2
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月狂の涙
			アビ汎用文字列:バフ・デバフ対象能力 = 月狂の涙
			アビ汎用変数:持続ターン = 2
			アビ汎用変数:効果量 = 0
			アビ汎用変数:特殊表示オプション = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 15
			CALL アビテンプレート_有利効果_奥義ゲージUP
			
			FOR 対象キャラ, 0, 4
				IF 刻印現在数確認("月", 対象キャラ) > 0 && 刻印現在数確認("月", 対象キャラ) < 5
					IF 刻印現在数確認("月", 対象キャラ) == 4
						アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月が満ちきった！
					ELSEIF 刻印現在数確認("月", 対象キャラ) == 2
						アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月が満ちていく…！
					ELSE
						アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月の時間が少し進んだ…
					ENDIF
					CALL アビ対象選択テンプレート_指定(対象キャラ)
					アビ汎用文字列:バフ・デバフ対象能力 = 月
					CALL アビテンプレート_刻印追加(1)
				ENDIF
			NEXT
		ENDIF
ENDSELECT



@固有アビ_63_4(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 隊列番号
隊列番号 = キャラ隊列検索(キャラ番号)

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 80
	アビ名 = ルナティック・ヴェンデッタ
	消費ＭＰ = 300
ENDIF

SIF 隊列番号 > -1 && 戦闘中カウント:隊列番号:1
	アビテンプレート用_アビ封印用フラグ = 1

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>自身に（消去不可）の月狂の鏡光効果を与える。
		詳細文文字列受け渡し変数 += @"<br>このアビリティでは行動回数を消費しない。"
		詳細文文字列受け渡し変数 += @"<br>このアビリティは1戦闘中1回しか使えない。"
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>自身に（消去不可）の月狂の鏡光効果を与える。
		詳細文文字列受け渡し変数 += @"<br>（月狂の鏡光："
		詳細文文字列受け渡し変数 += @"<br>　自身の奥義が2回発動するようになり、味方全体が通常攻撃時に月効果に応じた水属性ダメージを与えるようになる効果。）"
		詳細文文字列受け渡し変数 += @"<br>このアビリティでは行動回数を消費しない。"
		詳細文文字列受け渡し変数 += @"<br>このアビリティは1戦闘中1回しか使えない。"
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 月狂の鏡光
		アビ汎用文字列:バフ・デバフ対象能力 = 月狂の鏡光
		アビ汎用変数:効果量 = 0
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		戦闘中カウント:戦闘行動キャラ:1 = 1
		
		アビテンプレート用_行動消費無しフラグ = 1
ENDSELECT



@固有戦闘開始時処理_キャラ_63
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM 対象キャラ

対象キャラ = GETCHARA(63)
隊列番号 = キャラ隊列検索(対象キャラ)

バフ・デバフ行数 = バフ番号取得_枠("トーラの書", 隊列番号)

IF バフ・デバフ行数 < 0
	IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 70
		KSTR:(K++) = 「血祭りにしてやるわ……！」
	ELSEIF 陥落チェック(対象キャラ)
		KSTR:(K++) = 「さっさと片付けるわよ！」
	ELSE
		KSTR:(K++) = 「さぁ、参りましょう」
	ENDIF
	
	アビテンプレート用_アビ名 = 女教皇の正位置
	
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用文字列:バフ・デバフ枠 = トーラの書
	アビ汎用文字列:バフ・デバフ対象能力 = トーラの書
	アビ汎用変数:効果割合 = 0
	アビ汎用変数:持続ターン = -1
	アビ汎用変数:消去不可オプション = 1
	アビ汎用変数:特殊表示オプション = 1
	CALL アビテンプレート_有利効果_バフ効果セット
	
	IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 75
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ対象能力 = 月
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_刻印追加(5)
	ENDIF
ENDIF

;月バフ用に全員にセット
CALL アビ対象選択テンプレート_味方全体_生者のみ

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 月_攻撃力
アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
アビ汎用変数:効果割合 = 10
アビ汎用変数:付随割合 = 5
CALL アビテンプレート_有利効果_付随バフ効果セット("月")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 月_防御力
アビ汎用文字列:バフ・デバフ対象能力 = 防御力
アビ汎用変数:効果割合 = 10
アビ汎用変数:付随割合 = 5
CALL アビテンプレート_有利効果_付随バフ効果セット("月")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 月海の羽衣_防御力
アビ汎用文字列:バフ・デバフ対象能力 = 防御力
アビ汎用変数:効果割合 = 20
CALL アビテンプレート_有利効果_付随バフ効果セット("月")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 月海の羽衣_ダメ軽減
アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
アビ汎用変数:効果割合 = 20
CALL アビテンプレート_有利効果_付随バフ効果セット("月")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 月海の羽衣_ダメカ
アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
アビ汎用変数:効果割合 = 20
CALL アビテンプレート_有利効果_付随バフ効果セット("月")

IF 基礎BATTLE_STATE:対象キャラ:Lv >= 80
	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 月の映鏡
	アビ汎用文字列:バフ・デバフ対象能力 = 追撃
	アビ汎用変数:効果割合 = 40
	CALL アビテンプレート_有利効果_付随バフ効果セット("月")
ENDIF



@固有ターン終了時処理_キャラ_63
#DIM 三日月
#DIM 上弦
#DIM 望
#DIM 月狂の涙
#DIM バフ行数
#DIM 隊列番号
#DIM 対象キャラ
#DIM ハーゼ

FOR 対象キャラ, 0, 4
	IF 刻印現在数確認("月", 対象キャラ) > 0 && 刻印現在数確認("月", 対象キャラ) < 5
		IF 刻印現在数確認("月", 対象キャラ) == 4
			アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月が満ちきった！
		ELSEIF 刻印現在数確認("月", 対象キャラ) == 2
			アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月が満ちていく…！
		ELSE
			アビ汎用文字列:テンプレ代替メッセージ１ = %CALLNAME:(BATTLE_STATE:対象キャラ:0)%の月の時間が少し進んだ…
		ENDIF
		CALL アビ対象選択テンプレート_指定(対象キャラ)
		アビ汎用文字列:バフ・デバフ対象能力 = 月
		CALL アビテンプレート_刻印追加(1)
	ENDIF
NEXT



@バフ・デバフ特殊表示_トーラの書(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML トーラの書
PRINTFORML アビリティが2回発動する状態［消去不可］
PRINTFORML 持続ターン：永続



@バフ・デバフ特殊表示_月(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

SELECTCASE DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "効果量_固定値")
	CASE 5
		PRINTFORML 望
		PRINTFORML 月が満ちきった状態［消去不可］
		PRINTFORML 持続ターン：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}
	CASE 3 TO 4
		PRINTFORML 上弦
		PRINTFORML 月が満ちかけている状態［消去不可］
		PRINTFORML 持続ターン：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}
	CASE 1 TO 2
		PRINTFORML 三日月
		PRINTFORML 月が満ち始めた状態［消去不可］
		PRINTFORML 持続ターン：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}
ENDSELECT



@バフ・デバフ特殊表示_月狂の涙(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
#DIM ハーゼ
VARSET LOCALS

ハーゼ = GETCHARA(63)

PRINTFORML 月狂の涙
PRINTFORML 月の満ち欠けに応じて攻撃性能が上昇する状態
PRINTFORML 持続ターン：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}



@バフ・デバフ特殊表示_月狂の鏡光(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 月狂の鏡光
PRINTFORML 奥義が2回発動/味方が連続攻撃時、月の満ち欠けに応じて敵に水属性ダメージを与える状態［消去不可］
PRINTFORML 持続ターン：{DT_CELL_GET("戦闘効果データベース", バフ・デバフ行数, "持続ターン")}



@固有通常攻撃後処理_バフ_月(バフ・デバフ行数, 全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM バフ・デバフ行数
#DIM ハーゼ隊列番号
#DIM 月狂の鏡光
#DIM ハーゼ
#DIM 月満ち欠け

ハーゼ = GETCHARA(63)
SELECTCASE 刻印現在数確認("月", 戦闘行動キャラ)
	CASE 5
		月満ち欠け = 4
	CASE 3 TO 4
		月満ち欠け = 3
	CASE 1 TO 2
		月満ち欠け = 2
ENDSELECT

SIF 全滅フラグ
	RETURN 0

ハーゼ隊列番号 = キャラ隊列検索(ハーゼ)
月狂の鏡光 = バフ番号取得_枠("月狂の鏡光", ハーゼ隊列番号)

IF INRANGE(ハーゼ隊列番号, 0, 3) && BATTLE_STATE:ハーゼ隊列番号:ＨＰ > 0 && 月狂の鏡光 > -1 && 連撃数 > 1
	アビテンプレート用_アビ名 = 月狂の鏡光
	
	CALL アビ汎用変数文字列リセット
	アビ汎用変数:効果割合 = 350
	FOR LOCAL, 0, 月満ち欠け
		CALL アビテンプレート_ダメージ処理_水属性
	NEXT
ENDIF

;--------------------------------------------------
;戦闘能力画面に表示されるキャラごとの固有処理説明
;--------------------------------------------------
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;　口上と同じ感覚で使う為に書式を統一しているが、ステータス画面で表示されるので
;　基本的にWAIT系列は使わないことを推奨
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_63(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

KSTR:(K++) = □ 特性：『月海の羽衣』 □---------------------------------------------------------------
KSTR:(K++) = 　月の満ち欠けに応じて味方全体の防御性能が上昇
KSTR:(K++) = 　
IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 70
	KSTR:(K++) = □ 特性：『月の映鏡』 □-----------------------------------------------------------------
	KSTR:(K++) = 　月の満ち欠けに応じて味方全体に水属性追撃効果
	KSTR:(K++) = 　
ENDIF
KSTR:(K++) = □ 特性：『女教皇の正位置』 □----------------------------------------------------------
IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 75
	KSTR:(K++) = 　メインメンバー編成時、戦闘開始時に自身にトーラの書効果［永続/消去不可］/味方全体の月が完全に満ちる
ELSE
	KSTR:(K++) = 　メインメンバー編成時、戦闘開始時に自身にトーラの書効果［永続/消去不可］
ENDIF
KSTR:(K++) = 　◆再発動不可
KSTR:(K++) = 　
IF 基礎BATTLE_STATE:対象キャラ:Lv >= 70
	KSTR:(K++) = □ 特性：『至賢の領域・女教皇と月』 □--------------------------------------------------
	KSTR:(K++) = 　ボアズ/ヤヒン発動時、味方全体のHPを回復
	KSTR:(K++) = 　
ENDIF

CALL 口上変数表示(対象キャラ, 1)



