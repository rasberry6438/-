
@固有アビ_11_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 祝福判定
#DIM 祝福対象

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 55
	アビ名 = 祝福的接吻＋
	消費ＭＰ = 200
ELSE
	アビ名 = 祝福的接吻
	消費ＭＰ = 250
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>赋予我方单体（独立槽・不可驱散）的严迫的祝福效果。
		詳細文文字列受け渡し変数 += @"<br>若目标已持有严迫的祝福，则回复［500］ＨＰ。"
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>赋予我方单体（独立槽・不可驱散）的严迫的祝福效果。
		詳細文文字列受け渡し変数 += @"<br>＞赋予［50％］的土属性攻击力提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［100％］的防御力提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［100％］的DA率提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［100％］的弱化抗性提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［20％］的追击效果。"
		詳細文文字列受け渡し変数 += @"<br>若目标已持有严迫的祝福，则回复［500］ＨＰ。"
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_味方単体_生者のみ
		祝福対象 = アビテンプレート用_対象保存:0
		祝福判定 = バフ番号取得_枠("巌迫の祝福", 祝福対象) 
		IF 祝福判定 > -1
			アビ汎用変数:効果量 = 500
			CALL アビテンプレート_回復処理_MAXでも回復
			
			CALL アビ汎用変数文字列リセット
		ENDIF
		アビ汎用文字列:バフ・デバフ枠 = 巌迫の祝福
		アビ汎用文字列:バフ・デバフ対象能力 = 巌迫の祝福
		アビ汎用変数:効果量 = 0
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 巌迫の祝福_属性与ダメージ_土
		アビ汎用文字列:バフ・デバフ対象能力 = 属性与ダメージ_土
		アビ汎用変数:効果量 = 50
		CALL アビテンプレート_有利効果_付随バフ効果セット("巌迫の祝福")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 巌迫の祝福_防御力
		アビ汎用文字列:バフ・デバフ対象能力 = 防御力
		アビ汎用変数:効果割合 = 100
		CALL アビテンプレート_有利効果_付随バフ効果セット("巌迫の祝福")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 巌迫の祝福_DA率
		アビ汎用文字列:バフ・デバフ対象能力 = DA率
		アビ汎用変数:効果割合 = 100
		CALL アビテンプレート_有利効果_付随バフ効果セット("巌迫の祝福")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 巌迫の祝福_弱体耐性
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体耐性
		アビ汎用変数:効果割合 = 100
		CALL アビテンプレート_有利効果_付随バフ効果セット("巌迫の祝福")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 巌迫の祝福_追撃
		アビ汎用文字列:バフ・デバフ対象能力 = 追撃
		アビ汎用変数:効果割合 = 20
		CALL アビテンプレート_有利効果_付随バフ効果セット("巌迫の祝福")
ENDSELECT


@固有アビ_11_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 75
	アビ名 = 降砂岩＋
	消費ＭＰ = 100
ELSE
	アビ名 = 降砂岩
	消費ＭＰ = 150
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>随机对敌人造成6次［666］的无属性伤害。
		詳細文文字列受け渡し変数 += @"<br>赋予敌方全体［1］层迟缓效果。"
		詳細文文字列受け渡し変数 += @"<br>赋予［1］个增益消除。"
		詳細文文字列受け渡し変数 += @"<br>◆当『金』之楔石效果生效时，在［4的倍数回合］结束时自动发动。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		FOR LOCAL, 0, 6
			アビ汎用変数:敵対心無視オプション = 1
			CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
			アビ汎用変数:効果量 = 666
			CALL アビテンプレート_ダメージ処理_無属性
		NEXT
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵全体_生者のみ
		アビ汎用変数:効果量 = 1
		CALL アビテンプレート_不利効果_スロウ
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 1
		CALL アビテンプレート_不利効果_バフ消去
ENDSELECT

@固有アビ_11_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 効果数値
#DIM 隊列番号
隊列番号 = キャラ隊列検索(キャラ番号)

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 45
	アビ名 = 『金』の楔石
	消費ＭＰ = 500
ENDIF

SIF 隊列番号 > -1 && 戦闘中カウント:隊列番号:0
	アビテンプレート用_アビ封印用フラグ = 1

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>赋予自身（独立槽・不可驱散）的『金』之楔石效果。
		詳細文文字列受け渡し変数 += @"<br>此技能无法再次使用。"
		詳細文文字列受け渡し変数 += @"<br>使用此技能不消耗行动次数。"
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>赋予自身（独立槽・不可驱散）的『金』之楔石效果。
		詳細文文字列受け渡し変数 += @"<br>＞赋予［100％］的攻击力提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［300％］的防御力提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［1000％］的TA率提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予弱化无效效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［10％］的伤害提升效果。"
		詳細文文字列受け渡し変数 += @"<br>此技能无法再次使用。"
		詳細文文字列受け渡し変数 += @"<br>使用此技能不消耗行动次数。"
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 『金』の楔石
		アビ汎用文字列:バフ・デバフ対象能力 = 『金』の楔石
		アビ汎用変数:効果量 = 0
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 『金』の楔石_攻撃力
		アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
		アビ汎用変数:効果割合 = 100
		CALL アビテンプレート_有利効果_付随バフ効果セット("『金』の楔石")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 『金』の楔石_防御力
		アビ汎用文字列:バフ・デバフ対象能力 = 防御力
		アビ汎用変数:効果割合 = 300
		CALL アビテンプレート_有利効果_付随バフ効果セット("『金』の楔石")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 『金』の楔石_絶対TA
		アビ汎用文字列:バフ・デバフ対象能力 = TA率
		アビ汎用変数:効果量 = 1000
		CALL アビテンプレート_有利効果_付随バフ効果セット("『金』の楔石")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 『金』の楔石_弱体無効
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
		CALL アビテンプレート_有利効果_付随バフ効果セット("『金』の楔石")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 『金』の楔石_与ダメ増加
		アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
		アビ汎用変数:効果割合 = 10
		CALL アビテンプレート_有利効果_付随バフ効果セット("『金』の楔石")
		
		戦闘中カウント:戦闘行動キャラ:0 = 現在ターン数
		
		アビテンプレート用_行動消費無しフラグ = 1
ENDSELECT

@固有行動開始時処理_キャラ_11
;ターン開始時処理関数から呼び出し
#DIM 『金』の楔石
#DIM 隊列番号

SIF 戦闘中カウント:戦闘行動キャラ:0 == 現在ターン数
	RETURN 0

隊列番号 = キャラ隊列検索(GETCHARA(11))

『金』の楔石 = バフ番号取得_枠("『金』の楔石", 隊列番号)
IF 『金』の楔石 > -1
	IF 現在ターン数 % 2 != 戦闘中カウント:戦闘行動キャラ:0 % 2
		WSTR:(K++) = 伽莱翁静静伫立着...
		行動不能フラグ = 1
	ELSEIF 現在ターン数 % 2 == 戦闘中カウント:戦闘行動キャラ:0 % 2
		WSTR:(K++) = 大地母亲的仁爱正在隆起...
		アビテンプレート用_アビ名 = 『金』の楔石
		
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用変数:効果割合 = 50
		アビ汎用変数:消去不可オプション = 1
		アビ汎用文字列:バフ・デバフ枠 = 大地母亲的仁爱
		アビ汎用文字列:バフ・デバフ対象能力 = 与ダメージ
		アビ汎用変数:持続ターン = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 20
		CALL アビテンプレート_有利効果_奥義ゲージUP
	ENDIF
ENDIF


@固有ターン終了時処理_キャラ_11
;降砂岩自動発動処理
;ターン終了時処理関数から呼び出し
#DIM 『金』の楔石
#DIM 隊列番号

隊列番号 = キャラ隊列検索(GETCHARA(11))

『金』の楔石 = バフ番号取得_枠("『金』の楔石", 隊列番号)
IF 『金』の楔石 > -1
	IF 現在ターン数 % 4 == 0
		WSTR:(K++) = 《破溃。（usubut…）》
		アビテンプレート用_アビ名 = 降砂岩
		
		FOR LOCAL, 0, 6
			アビ汎用変数:敵対心無視オプション = 1
			CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
			アビ汎用変数:効果量 = 666
			CALL アビテンプレート_ダメージ処理_無属性
		NEXT
		
		CALL アビ対象選択テンプレート_敵全体_生者のみ
		アビ汎用変数:効果量 = 1
		CALL アビテンプレート_不利効果_スロウ
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 1
		CALL アビテンプレート_不利効果_バフ消去
	ENDIF
ENDIF



@バフ・デバフ特殊表示_巌迫の祝福(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 巌迫の祝福
PRINTFORML 土属性攻击力・防御力・DA率・弱化抗性提升/普通攻击时发动追击［永久/不可驱散］



@バフ・デバフ特殊表示_『金』の楔石(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 『金』の楔石
PRINTFORML 攻击性能・防御性能大幅提升/特定回合陷入行动不能状态，但在特定回合获得伤害提升・奥义槽上升效果［永久/不可驱散］
PRINTFORML （若增益赋予回合为奇数回合：偶数回合行动不能・奇数回合获得增益）
PRINTFORML （若增益赋予回合为偶数回合：奇数回合行动不能・偶数回合获得增益）

