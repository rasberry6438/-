;--------------------------------------------------
;●パチュリー・ノーレッジ口上＠erablue_resort用
;　――キャラの射精、オーナーの射精への反応など……を呼び出すためのハブ
;--------------------------------------------------

;--------------------------------------------------
;●ライセンス/更新履歴/概要/使用フラグ
;--------------------------------------------------
;　いずれもパチュリー口上_readme.txt記載に従う
;--------------------------------------------------

;--------------------------------------------------
;キャラ射精時
;--------------------------------------------------
;ふたなりまたは男性のパッチェさんが射精するよ～という話
;--------------------------------------------------
@KOJO_ORGASM_射精_1147(対象キャラ)
#DIM 対象キャラ
#DIM 相手キャラ番号
	CALL 口上変数初期化_1147

	相手キャラ番号 = RFLAG:フィニッシュ相手番号

	;相手がオーナーの時
	;つまり逆アナルとかだな……！
	;性癖外なのでひとまずカット
	IF 相手キャラ番号 == MASTER
	;相手がオーナー以外の場合
	ELSE
		;さすがに……カットするぜ！
	ENDIF

	CALL 口上変数表示(対象キャラ, 0)

;--------------------------------------------------
;調教者の射精時
;--------------------------------------------------
;RFLAG:フィニッシュ場所
	;どこに出されたか  
;RCVAR:対象キャラ:被射精絶頂の強度
	;１以上だと射精された時にキャラも絶頂
	;現状はフィニッシュ場所が0～3の時しか起こらない
;--------------------------------------------------
;精液集めギミックについて
;　オーナーの精液には魔力が結構多く含まれている
;　それが無尽蔵に出てくるので、総合的な量はめちゃくちゃ多い
;　お空と幻想郷での魔力の違いなどのアレコレを研究するために、外付け魔力タンク扱いされる
;　
;　
;　
;　メモ：恋慕になるまで妊娠してくれない……とかか……？
;　初射精時、era様がでてきて、妊娠できるようにするか……？　複雑化するなー……
;--------------------------------------------------
@KOJO_ORGASM_被射精_1147(対象キャラ)
#DIM 対象キャラ
#DIM 相手キャラ番号
#DIM 精液量ミリリットル
#DIM ドコソコ内射精フラグ
#DIMS フィニッシュポイント

	CALL 口上変数初期化_1147

	;配列や候補数カウントの初期化
	;今後メチャクチャ色々やるのでここで。
	CALL パッチェさん_たくさん差分くん_INITIALIZE()

	;射精してきた相手
	相手キャラ番号 = RFLAG:口上用射精キャラ番号

	;相手がオーナーでない場合
	IF 相手キャラ番号 != MASTER
		;これはもう前提としてぜ～んぶカット
;		CALL KOJO_ORGASM_被射精_1147_OTHER(対象キャラ)
	;相手がオーナーの時
	;分岐先でやると大変なことは先にここでやります
	ELSE
		;--------------------------------------------------
		;●射精量の保存など
		;--------------------------------------------------
		;射精量はたぶんこれで取れる
		;　RCVAR:相手キャラ番号:射精量
		;/
		;射精量は、下記計算で産出されている
		;・最小射精量は「（前立腺Lv-3）*（5-チンポサイズ）」
		;　　※前立腺Lv0で、普通サイズの場合、「-15」になる
		;　　※ただしその後ゼロまで補正される
		;　　※前立腺射精の場合、開発レベルが４以上の必要があるよ
		;・最大射精量は「30*5/(5-チンポサイズ)」
		;　　※普通チンポで「30」、巨根だと「37」、馬並みだと「50」になるはず
		;・ループ
		;　ループ回数は「最低１回、絶頂強度に応じて繰り返し」
		;　　消費量＝MAX（現在精力*3/4、最小射精量、０）→射精キャラの現在精力の75％が基礎になるはず
		;　　消費量＝MIN（消費量、最大射精量、現在精力）→この中で一番小さい数値が選ばれる（たぶん「最大射精量」になるだろう）
		;　　現在精力から消費量をマイナスする
		;　総消費量に消費量をプラスしカウント
		;　射精回数をカウント
		;　射精回数が絶頂強度を越えていないなら繰り返し（最強絶頂なら５回繰り返すはずだね）
		;・……ここでの「総消費量」が、「RCVAR:相手キャラ番号:射精量」に入る
		;　　すげー大雑把に……
		;　　＞精力が十分で、巨根の場合、「最大射精量37×絶頂強度(＝射精回数)」が子宮に注ぎ込まれる
		;　　……ことになる。強絶頂なら37、最強絶頂なら185ってところか。
		;　　チンポが小さいと射精量も少なくなるが、その代わり「消費も少なく」なるので、射精可能回数が多くなる。
		;　　（一般キャラの精力は300程度なので、３回ほど射精すると枯れる。これは３日ほどで回復する……という想定のようだ）
		;・射精者がオーナーかつ、真・絶倫を持っている場合/射精させたのがオーナーかつ、筒枯らしを持っている場合
		;　　ただし、オーナーが射精に絡む場合、技能によって絶頂強度＝射精回数が変動する
		;　　これはチンポが小さいほど補正量が大きい。
		;　　＞子供チンポの射精量21×(絶頂強度5×補正14)＝1470
		;　　＞普通チンポの射精量30×(絶頂強度5×補正10)＝1500
		;　　＞巨根チンポの射精量37×(絶頂強度5×補正 8)＝1480
		;　　……ってなるようなイメージだそうだ。
		;　　（オーナーの精力は実質無限で、「小さいと回数が多い」メリットがない。なので、精液量が同等になるように補正しているようだ）
		;/
		;さて、膣内精液量、600で「（対象キャラ）の子宮の中は、注ぎこまれた（射精キャラ）の精で満たされている」となる。
		;子宮の容積は妊娠前で2ml程度らしい（妊娠時は4000-5000ml程度まで大きくなる）
		;セックスファンタジーで「注ぎ込まれた精液で膨らむ」「射精量も圧倒的に多い」説を採用したとして、100倍の200mlくらいを「子宮内精液600」とする。
		;つまり、「子宮内精液１＝0.33ml」。
		;ちなみに普通の射精は3mlくらいらしい。
		;普通ちんぽの射精１回「射精量30」は、約9.9ml。３倍！！！　まあこのくらいは出るでしょ。
		;巨根の最強絶頂の「射精量185」は、61.05ml。20倍！！！
		;/
		;……という考えであったが、処理作成者的には、射精量10＝1ml　くらいの塩梅だった模様。
		;射精量30＝3mlで、普通ちんぽの射精１回がそのくらいになるね。
		;まあオーナーの精力は実質無限だし、上述の通り「最強絶頂による射精」で５倍になるので……
		;/
		;ちなみにというか、勃起はMAX1500で、射精すると「（勃起-1000）/2」だけ萎える。
		;1500なら、萎えて1250、1000なら萎えて500になる感じだね。


;★この辺チェックしないとダメよ～ということでコメントアウト　っていうか膣内射精されたフラグとかは取れるんだからドコソコ内射精フラグは要らなくない？
;		精液量ミリリットル = RCVAR:相手キャラ番号:射精量 / 10
;
;		;精液量を、フラグに保存
;		;他の場所でもこの辺呼ぶ可能性があるので、関数にしておく
;		;将来的にコンドームなど実装の可能性があるためここでチェックしたりするにはコレ
;		;/
;		;膣内射精された
;		SIF RCVAR:対象キャラ:膣内射精フラグ == 1
;			ドコソコ内射精フラグ = RCVAR:対象キャラ:膣内射精フラグ
;		;腸内射精された
;		SIF RCVAR:対象キャラ:腸内射精フラグ = 1
;			ドコソコ内射精フラグ = RCVAR:対象キャラ:腸内射精フラグ
;		;精飲した
;		SIF RCVAR:対象キャラ:精飲フラグ
;			ドコソコ内射精フラグ = RCVAR:対象キャラ:精飲フラグ
;
;		;保存ぬ
;		CALL パッチェさん_精液量保存(対象キャラ, 射精者, RFLAG:フィニッシュ場所, 精液量ミリリットル, ドコソコ内射精フラグ)



		;--------------------------------------------------
		;●フィニッシュ場所による分岐
		;--------------------------------------------------
		;おまじない：初期化
		フィニッシュポイント '= ""

		;フィニッシュ場所によって分岐
		IF 0
			;フィニッシュ場所の値によってどこに射精されたかが取れる
			;「＠SHOOT_NAME_XX」で確認できるはず
			;　 0：膣内
			;　 1：腸内
			;　 2：口
			;　 3：乳内
			;　 4：なし
			;　 5：顔射
			;　 6：腹射
			;　 7：背中
			;　 8：太もも
			;　 9：てのひら
			;　10：足
			;　30：その他
		;0：膣内
		ELSEIF RFLAG:フィニッシュ場所 == 0
			フィニッシュポイント '= "膣内"
		;1：腸内
		ELSEIF RFLAG:フィニッシュ場所 == 1
			フィニッシュポイント '= "腸内"
		;2：口内
		ELSEIF RFLAG:フィニッシュ場所 == 2
			フィニッシュポイント '= "口内"
		;3：乳内
		ELSEIF RFLAG:フィニッシュ場所 == 3
			フィニッシュポイント '= "乳内"
		;5：顔射
		ELSEIF RFLAG:フィニッシュ場所 == 5
			フィニッシュポイント '= "顔射"
		;6：腹射
		ELSEIF RFLAG:フィニッシュ場所 == 6
			フィニッシュポイント '= "腹射"
		;7：背中
		ELSEIF RFLAG:フィニッシュ場所 == 7
			フィニッシュポイント '= "背中"
		;8：太もも
		ELSEIF RFLAG:フィニッシュ場所 == 8
			フィニッシュポイント '= "太もも"
		;9：てのひら
		ELSEIF RFLAG:フィニッシュ場所 == 9
			フィニッシュポイント '= "てのひら"
		;10：足
		ELSEIF RFLAG:フィニッシュ場所 == 10
			フィニッシュポイント '= "足"
		;30：その他
		ELSEIF RFLAG:フィニッシュ場所 == 30
			フィニッシュポイント '= "その他"
		ELSE
			;ここにはこないはずだよ
			フィニッシュポイント '= "その他"
		ENDIF

		TRYCALLFORM KOJO_ORGASM_被射精_1147_OWNER_%フィニッシュポイント%(対象キャラ)

	ENDIF

	;配列にセットしてきたセリフ・地の文をKSTRにセット
	CALL パッチェさん_たくさん差分くん_TO_KSTR()

	CALL 口上変数表示(対象キャラ, 0)


;;--------------------------------------------------
;★使いそうなやつメモ
;;--------------------------------------------------
;
;	SIF 性癖素質:対象キャラ:精飲 >= 3
;		マゾメス度_性癖部分 += 1
;	SIF 性癖素質:対象キャラ:膣内射精 >= 3
;		マゾメス度_性癖部分 += 1
;	SIF 性癖素質:対象キャラ:腸内射精 >= 3
;		マゾメス度_性癖部分 += 1
;	SIF 性癖素質:対象キャラ:首絞め >= 3
;		マゾメス度_性癖部分 += 1
;	;発情期アリ、かつ、発情期素質が４つ以上追加されてたら＋１
;	SIF TALENT:対象キャラ:発情期あり >= 1 && (3 < (GETBIT(TALENT:対象キャラ:発情期あり, 0) + GETBIT(TALENT:対象キャラ:発情期あり, 1) + GETBIT(TALENT:対象キャラ:発情期あり, 2) + GETBIT(TALENT:対象キャラ:発情期あり, 3) + GETBIT(TALENT:対象キャラ:発情期あり, 4) + GETBIT(TALENT:対象キャラ:発情期あり, 5) + GETBIT(TALENT:対象キャラ:発情期あり, 6) + GETBIT(TALENT:対象キャラ:発情期あり, 7)))
;		マゾメス度_TALENT部分 += 1
;

;		;場所関連
;		;普通に屋内の場合……などはカットじゃカット！　まあさすがにね。
;		;/
;		;野外
;		SIF OPENPLACE(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置) == 2
;			てくすたーる += "/野外"
;		;ベッドルームの場合（かつ、風呂場でない場所）
;		IF 0
;		ELSEIF BEDROOM(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置) && !BATHROOM(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置)
;			てくすたーる += "/ベッドルーム"
;		;まあ寝かせられる場所
;		ELSEIF 自由利用BEDROOM(CFLAG:対象キャラ:現在マップ種別, CFLAG:対象キャラ:現在位置)
;			てくすたーる += "/ベッドルーム"
;		;パッチェさんの部屋
;		ELSEIF CFLAG:対象キャラ:現在位置 == キャラクター部屋検索(対象キャラ) && CFLAG:ARG:現在マップ種別 == 部屋検索_マップ種別
;			てくすたーる += "/ベッドルーム"
;		;サウナルーム
;		ELSEIF SAUNAROOM(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
;			てくすたーる += "/サウナルーム"
;		;泳装になる場所
;		ELSEIF SWIMROOM(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
;			てくすたーる += "/泳装になる場所"
;		;飲食系エリア
;		ELSEIF IS_FOOD_COURT(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
;			てくすたーる += "/屋内"
;		;野外
;		ELSEIF OPENPLACE(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置) == 2
;			てくすたーる += "/野外"
;		;その他屋内
;		ELSEIF OPENPLACE(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置) == 1
;			てくすたーる += "/屋内"
;		;野外でも見晴らしのいい場所でもない
;		;まあ自室とか……？
;		ELSE
;			てくすたーる += "/屋内"
;		ENDIF

