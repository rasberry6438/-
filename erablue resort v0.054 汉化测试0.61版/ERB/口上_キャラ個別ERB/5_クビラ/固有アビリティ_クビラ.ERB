@固有アビ_5_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 効果数値
#DIM バフ・デバフ行数

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 55
	アビ名 = 迅雷风烈＋
	消費ＭＰ = 120
	効果数値 = 400
ELSE
	アビ名 = 迅雷风烈
	消費ＭＰ = 150
	効果数値 = 200
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>对敌方全体造成［攻击力✕{効果数値}％］的光属性伤害。
		詳細文文字列受け渡し変数 += @"<br>赋予［25％］（Ａ槽・3回合）的光属性抗性降低效果。"
		詳細文文字列受け渡し変数 += @"<br>赋予自身（独立槽・3回合・不可驱散）的大烈风效果。"
		IF アビ名 == "迅雷风烈＋"
			詳細文文字列受け渡し変数 += @"<br>赋予我方全体暴击性能提升效果。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>对敌方全体造成［攻击力✕{効果数値}％］的光属性伤害。
		詳細文文字列受け渡し変数 += @"<br>赋予［25］（常规槽・3回合）的光属性抗性降低效果。"
		詳細文文字列受け渡し変数 += @"<br>赋予自身（独立槽・3回合・不可驱散）的大烈风效果。"
		詳細文文字列受け渡し変数 += @"<br>（大烈风："
		詳細文文字列受け渡し変数 += @"<br>　普通攻击后对敌方全体造成［攻击力✕150％］的光属性伤害，获得「卧猪之矛」状态）"
		詳細文文字列受け渡し変数 += @"<br>（卧猪之矛："
		詳細文文字列受け渡し変数 += @"<br>　当叠加至4层或以上的回合结束时，将发动技能「猪突猛进」，并触发「卧猪之矛」层数减少4层之状态）"
		IF アビ名 == "迅雷风烈＋"
			詳細文文字列受け渡し変数 += @"<br>赋予我方全体［70％］（Ａ槽・3回合）的暴击率提升效果。"
			詳細文文字列受け渡し変数 += @"<br>［30％］（Ａ槽・3回合）的暴击伤害提升效果。"
		ENDIF
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵全体_生者のみ
		アビ汎用変数:効果割合 = 効果数値
		CALL アビテンプレート_ダメージ処理_光属性
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 属性被ダメージ_光
		アビ汎用文字列:バフ・デバフ対象能力 = 属性被ダメージ_光
		アビ汎用変数:効果量 = 25
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:基礎成功確率 = 90
		CALL アビテンプレート_不利効果_デバフ効果セット

		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 大烈风
		アビ汎用文字列:バフ・デバフ対象能力 = 大烈风
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット

		IF アビ名 == "迅雷风烈＋"
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用文字列:バフ・デバフ枠 = クリティカル率A
			アビ汎用文字列:バフ・デバフ対象能力 = クリティカル率
			アビ汎用変数:効果量 = 70
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用文字列:バフ・デバフ枠 = クリティカルダメージ率A
			アビ汎用文字列:バフ・デバフ対象能力 = クリティカルダメージ率
			アビ汎用変数:効果量 = 30
			アビ汎用変数:持続ターン = 3
			CALL アビテンプレート_有利効果_バフ効果セット
		ENDIF
ENDSELECT

@固有アビ_5_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM バフ・デバフ行数

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 50
	アビ名 = 猪突猛进＋
	消費ＭＰ = 50
ELSE
	アビ名 = 猪突猛进
	消費ＭＰ = 70
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>对敌方单体造成［攻击力✕400％］的光属性伤害。
		詳細文文字列受け渡し変数 += @"<br>赋予我方全体（3回合・不可驱散）的猪突猛进效果。"
		詳細文文字列受け渡し変数 += @"<br>◆根据技能发动次数提升技能效果［最多5次］"
		RETURN 消費ＭＰ
	CASE "アビ説明文_詳細"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>对敌方单体造成［攻击力✕400％］的光属性伤害。
		詳細文文字列受け渡し変数 += @"<br>赋予我方全体（3回合・不可驱散）的猪突猛进效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［技能猪突猛进的使用次数✕5％］的连续攻击率提升效果。"
		詳細文文字列受け渡し変数 += @"<br>＞赋予［技能猪突猛进的使用次数✕3％］的普通攻击伤害提升效果。"
		詳細文文字列受け渡し変数 += @"<br>技能猪突猛进的使用次数最多为5次。"
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵単体
		アビ汎用変数:効果割合 = 400
		CALL アビテンプレート_ダメージ処理_光属性

		SIF 戦闘中カウント:戦闘行動キャラ:0 < 5
			戦闘中カウント:戦闘行動キャラ:0 += 1

		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 猪突猛进
		アビ汎用文字列:バフ・デバフ対象能力 = 猪突猛进
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 猪突猛进_連続攻撃率
		アビ汎用文字列:バフ・デバフ対象能力 = 連続攻撃率
		アビ汎用変数:効果量 = 戦闘中カウント:戦闘行動キャラ:0 * 5
		CALL アビテンプレート_有利効果_付随バフ効果セット("猪突猛进")

		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 猪突猛进_通常攻撃ダメージ
		アビ汎用文字列:バフ・デバフ対象能力 = ダメージ補正_通常攻撃ダメージ
		アビ汎用変数:効果量 = 戦闘中カウント:戦闘行動キャラ:0 * 3
		CALL アビテンプレート_有利効果_付随バフ効果セット("猪突猛进")
ENDSELECT

@固有アビ_5_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM バフ・デバフ行数
#DIM Lv閾値 = 15, 40

IF 基礎BATTLE_STATE:キャラ番号:Lv >= Lv閾値:1
	アビ名 = 英华发外＋
	消費ＭＰ = 35
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= Lv閾値:0
	アビ名 = 英华发外
	消費ＭＰ = 50
ELSE
	アビ名 = 	
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>赋予自身［攻击力✕100％］（常规槽・3次or3回合）的反击效果。
		詳細文文字列受け渡し変数 += @"<br>赋予［60％］（Ａ槽・3回合）的仇恨值提升效果。"
		詳細文文字列受け渡し変数 += @"<br>赋予［5％］（独立槽・3回合）的受伤时奥义槽增加效果。"
		IF アビ名 == "英华发外＋"
			詳細文文字列受け渡し変数 += @"<br>赋予自身（1回合）的全体援护效果。"
			詳細文文字列受け渡し変数 += @"<br>赋予受到致死攻击时，以［ＨＰ1］状态存活（常规槽・1次or1回合）的自动复活效果。"
		ENDIF
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 反击
		アビ汎用文字列:バフ・デバフ対象能力 = 反击
		アビ汎用変数:効果割合 = 100
		アビ汎用変数:持続回数 = 3
		アビ汎用変数:持続ターン = 3
		CALL アビテンプレート_有利効果_バフ効果セット

		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 敵対心A
		アビ汎用文字列:バフ・デバフ対象能力 = 敵対心
		アビ汎用変数:効果量 = 60
		アビ汎用変数:持続ターン = 3
		CALL アビテンプレート_有利効果_バフ効果セット

		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 英华发外
		アビ汎用文字列:バフ・デバフ対象能力 = 特殊反応_被ダメ時
		アビ汎用変数:持続ターン = 3
		CALL アビテンプレート_有利効果_バフ効果セット

		IF アビ名 == "英华发外＋"
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 全体かばう
			アビ汎用文字列:バフ・デバフ対象能力 = 全体かばう
			アビ汎用変数:持続ターン = 1
			CALL アビテンプレート_有利効果_バフ効果セット

			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 自動復活
			アビ汎用文字列:バフ・デバフ対象能力 = 自動復活
			アビ汎用変数:効果量 = 1
			アビ汎用変数:持続回数 = 1
			アビ汎用変数:持続ターン = 1
			CALL アビテンプレート_有利効果_バフ効果セット
		ENDIF
ENDSELECT


@固有アビ_5_4(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM バフ・デバフ行数
#DIM 判定値
#DIM CONST 使用可能ターン = 6

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 30
	アビ名 = 亥气冲天
	消費ＭＰ = 250
ELSE
	アビ名 = 
ENDIF

IF キャラ隊列検索(GETCHARA(5)) > -1
	判定値 = 現在ターン数
	SIF 判定値 < 使用可能ターン
		アビテンプレート用_アビ封印用フラグ = 1
ENDIF

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消耗ＭＰ：{消費ＭＰ}<br>ランダムな敵に［攻撃力✕200％］の光属性ダメージを24回与える。
		詳細文文字列受け渡し変数 += @"<br>赋予自身［2000］的ＨＰ回复。"
		詳細文文字列受け渡し変数 += @"<br>解除［1］个减益。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
				CALL アビ汎用変数文字列リセット
			FOR LOCAL, 0, 24
				アビ汎用変数:敵対心無視オプション = 1
				CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
				アビ汎用変数:効果割合 = 200
				CALL アビテンプレート_ダメージ処理_光属性
			NEXT

		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用変数:効果量 = 2000
		CALL アビテンプレート_回復処理_MAXでも回復
		
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		CALL アビテンプレート_有利効果_デバフ消去
ENDSELECT


@固有戦闘開始時処理_キャラ_5
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM 対象番号

CALL アビ対象選択テンプレート_自己のみ
アビ汎用文字列:バフ・デバフ枠 = 亥神宮の主
アビ汎用文字列:バフ・デバフ対象能力 = 特殊反応_被ダメ時
アビ汎用変数:持続ターン = -1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:特殊表示オプション = 1
CALL アビテンプレート_有利効果_パッシブバフ効果セット


CALL アビ対象選択テンプレート_自己のみ
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 猪突・上宝沁金之击枪
アビ汎用文字列:バフ・デバフ対象能力 = 猪突・上宝沁金之击枪
アビ汎用変数:持続ターン = -1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:特殊表示オプション = 1
CALL アビテンプレート_有利効果_パッシブバフ効果セット

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 猪突・上宝沁金之击枪_通常攻撃ダメージ
アビ汎用文字列:バフ・デバフ対象能力 = ダメージ補正_通常攻撃ダメージ
アビ汎用変数:効果割合 = 15
CALL アビテンプレート_有利効果_付随バフ効果セット("猪突・上宝沁金之击枪")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 猪突・上宝沁金之击枪_最大ＨＰ
アビ汎用文字列:バフ・デバフ対象能力 = 最大ＨＰ
アビ汎用変数:効果割合 = 20
CALL アビテンプレート_有利効果_付随バフ効果セット("猪突・上宝沁金之击枪")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 猪突・上宝沁金之击枪_防御力
アビ汎用文字列:バフ・デバフ対象能力 = 防御力
アビ汎用変数:効果割合 = 30
CALL アビテンプレート_有利効果_付随バフ効果セット("猪突・上宝沁金之击枪")

CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 猪突・上宝沁金之击枪_ゲージ上昇効率
アビ汎用文字列:バフ・デバフ対象能力 = ゲージ上昇効率
アビ汎用変数:効果割合 = 35
CALL アビテンプレート_不利効果_付随デバフ効果セット("猪突・上宝沁金之击枪")

CALL アビテンプレ変数リセット


@特殊反応_被ダメ時_亥神宮の主(バフ番号, 攻撃者隊列, 被ダメ記録順)
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM 卧猪之矛
#DIM 被ダメ記録順
#DIM 攻撃者隊列
#DIM バフ番号

隊列番号 = キャラ隊列検索(GETCHARA(5))
卧猪之矛 = 刻印現在数確認("卧猪之矛", 隊列番号)
バフ・デバフ行数 = バフ番号取得_枠("亥神宮の主", 隊列番号)

IF バフ・デバフ行数 > -1
	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用文字列:バフ・デバフ対象能力 = 卧猪之矛
	アビ汎用変数:特殊表示オプション = 1
	CALL アビテンプレート_刻印追加(1)
ENDIF


@特殊反応_被ダメ時_英华发外(バフ番号, 攻撃者隊列, 被ダメ記録順)
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM 被ダメ記録順
#DIM 攻撃者隊列
#DIM バフ番号

隊列番号 = キャラ隊列検索(GETCHARA(5))
バフ・デバフ行数 = バフ番号取得_枠("英华发外", 隊列番号)

IF バフ・デバフ行数 > -1
	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用変数:効果量 = 8
	CALL アビテンプレート_有利効果_奥義ゲージUP
ENDIF


@固有通常攻撃後処理_キャラ_5(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM 隊列番号
#DIM バフ・デバフ行数
#DIM 卧猪之矛

SIF 全滅フラグ
	RETURN 0

隊列番号 = キャラ隊列検索(GETCHARA(5))
バフ・デバフ行数 = バフ番号取得_枠("大烈风", 隊列番号)
卧猪之矛 = 刻印現在数確認("卧猪之矛", 隊列番号)

IF バフ・デバフ行数 > -1
	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_敵全体_生者のみ
	アビ汎用変数:効果割合 = 150
	CALL アビテンプレート_ダメージ処理_光属性

	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用文字列:バフ・デバフ対象能力 = 卧猪之矛
	アビ汎用変数:特殊表示オプション = 1
	CALL アビテンプレート_刻印追加(1)
ENDIF


@固有ターン終了時処理_キャラ_5(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM 隊列番号
#DIM バフ・デバフ行数
#DIM 卧猪之矛
#DIMS 猪突猛进

SIF 全滅フラグ
	RETURN 0

隊列番号 = キャラ隊列検索(GETCHARA(5))
卧猪之矛 = 刻印現在数確認("卧猪之矛", 隊列番号)

IF 卧猪之矛 >= 4
	アビテンプレート用_アビ名 = 猪突猛进

	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_敵ランダムＸ体(1)
	アビ汎用変数:効果割合 = 400
	CALL アビテンプレート_ダメージ処理_光属性

	SIF 戦闘中カウント:戦闘行動キャラ:0 < 5
		戦闘中カウント:戦闘行動キャラ:0 += 1

	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_味方全体_生者のみ
	アビ汎用文字列:バフ・デバフ枠 = 猪突猛进
	アビ汎用文字列:バフ・デバフ対象能力 = 猪突猛进
	アビ汎用変数:持続ターン = 3
	アビ汎用変数:消去不可オプション = 1
	アビ汎用変数:特殊表示オプション = 1
	CALL アビテンプレート_有利効果_バフ効果セット

	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 猪突猛进_連続攻撃率
	アビ汎用文字列:バフ・デバフ対象能力 = 連続攻撃率
	アビ汎用変数:効果量 = 戦闘中カウント:戦闘行動キャラ:0 * 5
	CALL アビテンプレート_有利効果_付随バフ効果セット("猪突猛进")

	CALL アビ汎用変数文字列リセット
	アビ汎用文字列:バフ・デバフ枠 = 猪突猛进_通常攻撃ダメージ
	アビ汎用文字列:バフ・デバフ対象能力 = ダメージ補正_通常攻撃ダメージ
	アビ汎用変数:効果量 = 戦闘中カウント:戦闘行動キャラ:0 * 3
	CALL アビテンプレート_有利効果_付随バフ効果セット("猪突猛进")

	CALL アビ汎用変数文字列リセット
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用文字列:バフ・デバフ対象能力 = 卧猪之矛
	アビ汎用変数:特殊表示オプション = 1
	CALL アビテンプレート_刻印減少(4)
ENDIF



@バフ・デバフ特殊表示_亥神宮の主(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 亥神宮の主
PRINTFORML 受到伤害时获得「卧猪之矛」
PRINTFORML 持续回合：永久


@バフ・デバフ特殊表示_猪突・上宝沁金之击枪(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 猪突・上宝沁金之击枪
PRINTFORML 奥义槽增加困难，但普通攻击伤害提升。增加最大HP和防御力。
PRINTFORML 持续回合：永久


@バフ・デバフ特殊表示_卧猪之矛(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 卧猪之矛
PRINTFORML 当叠加至4层或以上的回合结束时，将发动「猪突猛进」，并触发「卧猪之矛」层数减少4层


@バフ・デバフ特殊表示_大烈风(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 大烈风
PRINTFORML 普通攻击后对敌方全体造成［攻击力✕150％］的光属性伤害，获得「卧猪之矛」状态[3回合/不可驱散]


@バフ・デバフ特殊表示_猪突猛进(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 猪突猛进
PRINTFORML 赋予我方全体连续攻击率、普通攻击伤害提升效果[3回合/不可驱散]


@探索欄表示_キャラ_5(レイヤー番号, 隊列番号)
#DIM 隊列番号
#DIM レイヤー番号

GDRAWTEXT レイヤー番号, "卧猪之矛:", 120, 90
GSETBRUSH レイヤー番号, 属性数値文字色変換_透明度込(BATTLE_STATE:隊列番号:属性)
GDRAWTEXT レイヤー番号, @"Ū{刻印現在数確認("卧猪之矛", 隊列番号)}", 200, 90
