@固有奥義_31(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 奥義威力
#DIMS 奥義名
#DIM 奥義変化フラグ

;リミVerの処理はリミのファイルにまとめるため、別関数を呼ぶ
IF CSTR:キャラ番号:スタイル管理文字列 == "[摇曳的想姬]娜尔梅亚"
	CALL 揺らぎの想姫固有奥義(ARGS, キャラ番号)
	RETURN RESULT
ENDIF

LOCAL = キャラ隊列検索(キャラ番号)
IF LOCAL <= 0
	奥義変化フラグ = 0
ELSEIF 戦闘中カウント:LOCAL:0 == 0
	奥義変化フラグ = 0
ELSE
	奥義変化フラグ = 1
ENDIF


IF 基礎BATTLE_STATE:キャラ番号:Lv >= 50
	IF 奥義変化フラグ == 0
		奥義名 = 蝴蝶刃改・源氏舞
	ELSE
		奥義名 = 蝴蝶刃改・神乐舞
	ENDIF
	奥義威力 = 500
ELSEIF 基礎BATTLE_STATE:キャラ番号:Lv >= 25
	IF 奥義変化フラグ == 0
		奥義名 = 蝴蝶刃・源氏舞＋
	ELSE
		奥義名 = 蝴蝶刃・神乐舞＋
	ENDIF
	奥義威力 = 450
ELSE
	IF 奥義変化フラグ == 0
		奥義名 = 蝴蝶刃・源氏舞
	ELSE
		奥義名 = 蝴蝶刃・神乐舞
	ENDIF
	奥義威力 = 400
ENDIF

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = %奥義名%
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥义威力：{奥義威力}％
		IF 奥義変化フラグ == 0
			詳細文文字列受け渡し変数 += @"<br>自身攻击力提升［15％/累积/最大50％/4回合］。"
			SIF 奥義名 == "蝴蝶刃改・源氏舞"
				詳細文文字列受け渡し変数 += @"<br>自身攻击力(B槽)提升［30％/3回合］。"
		ELSE
			詳細文文字列受け渡し変数 += @"<br>解除自身因蝴蝶刃施加的防御力降低效果。"
			SIF 奥義名 == "蝴蝶刃改・神乐舞"
				詳細文文字列受け渡し変数 += @"<br>自身回避率(A槽)提升［100％/2次］。"
		ENDIF
		RETURN 奥義威力
	CASE "奥義前効果"
	
	CASE "奥義追加効果"
		CALL アビ対象選択テンプレート_自己のみ
		IF 戦闘中カウント:戦闘行動キャラ:0 == 0
			アビ汎用文字列:バフ・デバフ枠 = 胡蝶刃_攻撃力
			アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
			アビ汎用変数:効果割合 = 15
			アビ汎用変数:累積上限_割合 = 50
			アビ汎用変数:持続ターン = 4
			CALL アビテンプレート_有利効果_累積バフ効果セット
			IF 奥義名 == "蝴蝶刃改・源氏舞"
				アビ汎用文字列:バフ・デバフ枠 = 攻撃力B
				アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
				アビ汎用変数:効果割合 = 30
				アビ汎用変数:持続ターン = 3
				CALL アビテンプレート_有利効果_バフ効果セット
			ENDIF
		ELSE
			CALL 戦闘効果削除(デバフ番号取得_枠("胡蝶刃_防御力", 戦闘行動キャラ))
			IF 奥義名 == "蝴蝶刃改・神乐舞"
				アビ汎用文字列:バフ・デバフ枠 = 回避率A
				アビ汎用文字列:バフ・デバフ対象能力 = 回避率
				アビ汎用変数:効果量 = 100
				アビ汎用変数:持続回数 = 2
			ENDIF
		ENDIF
ENDSELECT




@揺らぎの想姫固有奥義(ARGS, キャラ番号)
;@固有奥義31_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 奥義威力
#DIMS 奥義名

IF 基礎BATTLE_STATE:キャラ番号:Lv >= 25
	奥義名 = 蝴蝶刃・屠龙＋
	奥義威力 = 800
ELSE
	奥義名 = 蝴蝶刃・屠龙
	奥義威力 = 700
ENDIF

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = %奥義名%
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥义威力：{奥義威力}％
		詳細文文字列受け渡し変数 += @"<br>自身技能使用间隔缩短2回合。"
		詳細文文字列受け渡し変数 += @"<br>下回合行动时将进行2次攻击行动。"
		RETURN 奥義威力
	CASE "奥義前効果"
	
	CASE "奥義追加効果"
		SIF バフ番号取得_枠("再行動" , 戦闘行動キャラ) < 0
			BATTLE_STATE:戦闘行動キャラ:行動済みフラグ = 1
		戦闘中カウント:キャラ隊列検索(キャラ番号):0 -= 2
		戦闘中カウント:キャラ隊列検索(キャラ番号):1 -= 2
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 再行動
		アビ汎用文字列:バフ・デバフ対象能力 = 再行動
		アビ汎用変数:効果量 = 1
		アビ汎用変数:持続ターン = 2
		CALL アビテンプレート_有利効果_バフ効果セット
ENDSELECT


