
@COMNAME_S44_1
#FUNCTIONS
TSTR:コマンド名受渡 = 振动棒刺激
SIF MODE_存在判定_ターゲット側("振动棒", PLAYER)
	TSTR:コマンド名受渡 = 振动棒自慰

;===================================================
;コマンドタイプ
;===================================================
@COMTYPE_S_44_1
#FUNCTION
TFLAG:コマンドタイプ受渡 = COMTYPE("道具系&Ｖ系")
弱点コマンドカテゴリ = V
オートコマンド許可 = 1

@COM_TOOLTIP_S44_1
LOCALS = <br>■振动棒刺激<br>
LOCALS += "对已插入振动棒的对象进行操作的指令。<br>若振动棒插入自身则转为自慰行为。"
LOCALS += "<br>指令类型：道具系<br>获取来源：快Ｖ・接触・痛苦"
LOCALS += "<br>专属经验值：道具使用经验(PLAYER)・Ｖ经验(TARGET)<br>"
TSTR:ツールチップ受渡 = %LOCALS%

@COM_S44_1
;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
IF MODE_存在判定_ターゲット側("振动棒", PLAYER)
	CALL SOURCE_CALC_快Ｖ(PLAYER, -1, 500)
ELSE
	CALL SOURCE_CALC_快Ｖ(TARGET, PLAYER, 500)
	CALL SOURCE_CALC_接触(TARGET, PLAYER, 100)
	CALL SOURCE_CALC_接触(PLAYER, TARGET, 100)

	;苦痛
	LOCAL = 200 * PAIN_CHECK_V(TARGET) / 1000
	CALL SOURCE_CALC_苦痛(TARGET, PLAYER, LOCAL)
ENDIF

RCVAR:TARGET:道具コマンドフラグ = 1

RETURN 1

;-------------------------------------------------
;実行判定
;-------------------------------------------------
@COM_ABLE_S44_1
;Ｇスポ責め実行判定
SIF SAVESTR:ゲームフェイズ管理 != "通常モード"
	RETURN 0
;一括管理
SIF GLOBAL_COMABLE_S("44_1")
	RETURN RESULT
;振动棒モードじゃない時はアウト
SIF !MODE_存在判定_ターゲット側("振动棒", PLAYER) && !MODE_存在判定_ターゲット側("振动棒", TARGET)
	RETURN 0

;指を何かに使ってるなら無理
SIF TEQUIP:PLAYER:指
	RETURN 0
RETURN 1

;-------------------------------------------------
;実行時メッセージ
;-------------------------------------------------
@MESSAGE_COM_S44_1
#DIM 同時キャラ番号
PRINTFORM %CALLNAME:PLAYER%
IF MODE_存在判定_ターゲット側("振动棒", PLAYER)
	PRINTFORML 主动扭动插入体内的振动棒，贪婪索取强烈快感…
ELSE
	PRINTFORML 搅动插入%CALLNAME:TARGET%体内的振动棒施加强烈刺激…
ENDIF


