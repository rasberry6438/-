;乃々君のお家约会の命令
;ごちゃつくのを防ぐため、文章がメインではないシステム的な部分をこちらで取り扱う

@HOUSE_MAIN
#DIM DYNAMIC LOOP_FLAG
#DIMS MEMO_SELECT

WHILE LOOP_FLAG == 0
	REDRAW 0

	TFLAG:LINECOUNT_SHOP = LINECOUNT
	DRAWLINE
	PRINTFORML 現在位置：%SAVESTR:現在位置%
	DRAWLINE
	CALL INSIDE_HOUSE
	DRAWLINE

	MEMO_SELECT = 等待着/去其他地方/
	SELECTCASE SAVESTR:現在位置
	CASE @"%CALLNAME:TARGET%の自室"
		MEMO_SELECT += @"看看%CALLNAME:TARGET%的书架"
	CASE "リビング"
		SIF CFLAG:家族
			MEMO_SELECT += @"和%CALLNAME:TARGET%的家人聊天"
	CASE "弟的房間", "妹的房間", "両親的房間"
		MEMO_SELECT += @"寻找感兴趣的地方"
	CASE "書斎"
		MEMO_SELECT += @"查看书架"
	CASE "廚房"
		MEMO_SELECT += @"和%CALLNAME:TARGET%闲聊"
	CASE "温室", "庭"
		MEMO_SELECT += @"观察植物"
	ENDSELECT
	CALL PRINT_SELECT, MEMO_SELECT, @"等待%CALLNAME:TARGET%"

	SELECTCASE RESULT
	CASE 0
		PRINTFORMW %SEEING_HOUSE()%
	CASE 1
		SELECTCASE SAVESTR:現在位置
		CASE "テラス", "温室", "庭"
			CALL HOUSE_MOVE, "庭園"
		CASEELSE
			CALL HOUSE_MOVE, "邸宅"
		ENDSELECT
	CASE 100
		PRINTFORMW %CALLNAME:MASTER%决定等待%CALLNAME:TARGET%……。
		BREAK
	CASEELSE
		CALL HOUSE_ACTION
	ENDSELECT
WEND
CALL HOUSE_DATE_END


@HOUSE_MOVE, ARGS
#DIMS DYNAMIC MOVE_PLACE
#DIMS MOVING

IF ARGS == "邸宅"
	MOVE_PLACE += @"%CALLNAME:TARGET%的卧室/起居室/弟弟的房间/妹妹的房间/父母的房间/书房/厨房"
ELSEIF ARGS == "庭園"
	MOVE_PLACE += "露台/温室/庭院"
ENDIF

$SELECT_PLACE
PRINTFORMW 到底要去哪里呢？
CALL PRINT_SELECT, @"%MOVE_PLACE%", "还是算了"

SELECTCASE RESULT
CASE 0
	IF ARGS == "邸宅"
		MOVING = %CALLNAME:TARGET%的卧室
	ELSE
		MOVING = 露台
	ENDIF
CASE 1
	IF ARGS == "邸宅"
		MOVING = 起居室
	ELSE
		MOVING = 温室
	ENDIF
CASE 2
	IF ARGS == "邸宅"
		MOVING = 弟弟的房间
	ELSE
		MOVING = 庭院
	ENDIF
CASE 3
	MOVING = 妹妹的房间
CASE 4
	MOVING = 父母的房间
CASE 5
	MOVING = 书房
CASE 6
	MOVING = 厨房
CASE 100
	PRINTFORMW 决定再在这里待一会儿……。
	RETURN 1
ENDSELECT

IF SAVESTR:現在位置 == MOVING
	PRINTFORMW 现在就在这里！
	PRINTL 
	GOTO SELECT_PLACE
ELSEIF CFLAG:家族 == 0
	SELECTCASE MOVING
	CASE "妹的房間", "弟的房間"
		PRINTFORMW 现在不应该去那里吧……。
		PRINTL 
		GOTO SELECT_PLACE
	CASE "両親的房間"
		IF CFLAG:両親エッチ
			PRINTFORMW %CALLNAME:MASTER%走到%MOVING%門前。
			PRINTFORMW ……从房间里面传来了什么声音。
			PRINTFORML %CALLNAME:MASTER%……
			CALL PRINT_SELECT, "竖起耳朵/离開这里"
			IF RESULT == 0
				PRINTFORMW %CALLNAME:MASTER%把耳朵贴近門。
				CALL EVENT_MOB_SEX_K25, "両親エッチ"
			ELSE
				PRINTFORMW %CALLNAME:MASTER%察觉到里面在做「什么」，离開了这里……。
			ENDIF
		ELSE
			PRINTFORMW 现在不应该去那里吧……。
		ENDIF
		PRINTL 
		GOTO SELECT_PLACE
	CASEELSE
		PRINTFORMW %CALLNAME:MASTER%决定去%MOVING%……。
		SAVESTR:現在位置 = %MOVING%
	ENDSELECT
ELSE
	PRINTFORMW %CALLNAME:MASTER%决定去%MOVING%……。
	SAVESTR:現在位置 = %MOVING%
ENDIF
