;;;D20XX_Face関係のデバッグ用関数
@D20XX_Face_Test
	#DIM DYNAMIC LCOUNT
	FOR LCOUNT,0,100

		VARSET LATESTFACECHARA
		VARSET LATESTFACEID
		STR:参照用MAIDFACE文字列 = 

		LOCALS = 
		SELECTCASE LCOUNT
			CASE 0
				LOCALS = 0魔界空+4卷髪長槞+7肌\[色白\]+14角魔界人赤+12魔族耳\[色白\]+9無口系+11垂眼２左\[赤\]+11垂眼２右\[赤\]+11垂眼２左高光+11垂眼２右高光+11垂眼２右睫毛+11垂眼２左睫毛+13脏連体泳装+20脏披风+14悪魔羽[紫]+16分叉毛刺４槞+18困扰眉槞+19呆毛槞+,80,975,0,200,50,恐らく説明欄/
			CASE 1
				LOCALS += @"0魔界空+4卷髪長\[槞\]+7肌\[色白\]+14角魔界人\[赤\]+12魔族耳\[色白\]+9無口系+11垂眼２\[赤\]左+11垂眼２\[赤\]右+11垂眼２左高光+11垂眼２右高光+13脏連体泳装+20脏披风+14悪魔羽\[紫\]+16分叉毛刺４\[槞\]+18困扰眉\[槞\]+19呆毛\[槞\]+,80,975,0,200,50,恐らく説明欄/"
			CASE 2
				LOCALS = 0e+4卷髪長/[槞/]+14角魔界人左/[赤/]+12魔族耳左/[色白/]+7肌/[色白/]+14角魔界人/[赤/]+12魔族耳/[色白/]+9無口系+11垂眼２左/[赤/]+11垂眼２右/[赤/]+11垂眼２左高光+11垂眼２右高光+11垂眼２左睫毛+11垂眼２右睫毛+13脏連体泳装+20脏披风+14悪魔羽/[紫/]+16分叉毛刺４/[槞/]+18困扰眉/[槞/]+19呆毛/[槞/]+,0,945,945,0,0,/[魔界人(悪魔)/]槞彁 (不法侵入) 特技：理性主義/
			CASE 3
				LOCALS += @"0魔界空+4卷髪長\[槞\]+7肌\[色白\]+14角魔界人\[赤\]+12魔族耳\[色白\]+9無口系+11垂眼２\[赤\]左+11垂眼２\[赤\]右+11垂眼２左高光+11垂眼２右高光+13脏連体泳装+20脏披风+14悪魔羽\[紫\]+16分叉毛刺４\[槞\]+18困扰眉\[槞\]+19呆毛\[槞\]+,80,975,0,200,50,恐らく説明欄/"
			CASE 4
				LOCALS = 0e+4卷髪長\\[槞\\]+14角魔界人左\\[赤\\]+12魔族耳左\\[色白\\]+7肌\\[色白\\]+14角魔界人\\[赤\\]+12魔族耳\\[色白\\]+9無口系+11垂眼２左\\[赤\\]+11垂眼２右\\[赤\\]+11垂眼２左高光+11垂眼２右高光+11垂眼２左睫毛+11垂眼２右睫毛+13脏連体泳装+20脏披风+14悪魔羽\\[紫\\]+16分叉毛刺４\\[槞\\]+18困扰眉\\[槞\\]+19呆毛\\[槞\\]+,0,945,945,0,0,\\[魔界人(悪魔)\\]槞彁 (不法侵入) 特技：理性主義/
			CASE 5
				LOCALS = 0e+4卷髪長\/[槞\/]+14角魔界人左\/[赤\/]+12魔族耳左\/[色白\/]+7肌\/[色白\/]+14角魔界人\/[赤\/]+12魔族耳\/[色白\/]+9無口系+11垂眼２左\/[赤\/]+11垂眼２右\/[赤\/]+11垂眼２左高光+11垂眼２右高光+11垂眼２左睫毛+11垂眼２右睫毛+13脏連体泳装+20脏披风+14悪魔羽\/[紫\/]+16分叉毛刺４\/[槞\/]+18困扰眉\/[槞\/]+19呆毛\/[槞\/]+,0,945,945,0,0,\/[魔界人(悪魔)\/]槞彁 (不法侵入) 特技：理性主義/
			CASE 6
				LOCALS = 0e+4卷髪長\[槞\]+14角魔界人左\[赤\]+12魔族耳左\[色白\]+7肌\[色白\]+14角魔界人\[赤\]+12魔族耳\[色白\]+9無口系+11垂眼２左\[赤\]+11垂眼２右\[赤\]+11垂眼２左高光+11垂眼２右高光+11垂眼２左睫毛+11垂眼２右睫毛+13脏連体泳装+20脏披风+14悪魔羽\[紫\]+16分叉毛刺４\[槞\]+18困扰眉\[槞\]+19呆毛\[槞\]+,0,945,945,0,0,\[魔界人(悪魔)\]槞彁 (不法侵入) 特技：理性主義/
			CASE 7
				LOCALS = 0魔界空+4卷髪長槞+7肌+14角魔界人+12魔族耳+9無口系+11垂眼２左+11垂眼２右+11垂眼２左高光+11垂眼２右高光+13脏連体泳装+20脏披风+14悪魔羽+16分叉毛刺４槞+18困扰眉槞+19呆毛槞+,80,975,0,200,50,恐らく説明欄/
			CASE 8
				LOCALS = 0b+4直髪長[銀]+7肌[普通]+9微笑+11眯眯眼左+11眯眯眼右+13女仆装青+16斜刘海[銀]+18通常眉[灰色]+15a白+,0,945,945,0,1,[女仆の悪魔]弗理希艾尔 (２年生) 特技：自動補充/
			CASE 9
				LOCALS = 0b+4直髪長+7肌[普通]+9微笑+11眯眯眼左+11眯眯眼右+13女仆装青+16斜刘海[銀]+18通常眉[銀]+15a白+,0,945,945,0,1,[女仆の悪魔]弗理希艾尔 (２年生) 特技：自動補充/

			CASEELSE
				BREAK
		ENDSELECT
		PRINTFORML %LOCALS%
		;HTML_PRINT CONVERTSTR(LOCALS)

		CALL CREATE_SPRITE_MAIDFACE, 1, 0, LOCALS
		STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
		HTML_PRINT CONVERTSTR(STR:颜绘再現文字列)

		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
		PRINTL 
	NEXT
	PRINTFORMW Debug 槞彁の颜绘表示
	
	;大量作成テスト
	;FOR LCOUNT,0,100
	;	CALL D20XX_Face_RandomFcsv("天使")
	;	CALL D20XX_FACE_FcsvToSprite(RESULTS)
	;	CALL CREATE_SPRITE_MAIDFACE(1, 0, RESULTS)
	;	CALL D20XX_FACE_ReAddSlash(RESULTS)
	;	HTML_PRINT CONVERTSTR(RESULTS)
	;	CLEARLINE LINECOUNT
	;NEXT 

	$INPUT_LOOP
	STR:参照用MAIDFACE文字列 = 
	PRINTFORML [1]天使 [2]阿尔法兔子 [3]イヴァ阴蒂ナ [4]ウスラバニヤ [5]エンメロイア [6]オーロパリカ [999] 終了
	INPUT
	SELECTCASE RESULT
		CASE 1
			CALL D20XX_Face_RandomFcsv("天使")
			PRINTFORML Fcsv = %RESULTS%
			CALL D20XX_FACE_FcsvToSprite(RESULTS)
			PRINTFORML RESULTS1 = %RESULTS%
			CALL CREATE_SPRITE_MAIDFACE(1, 0, RESULTS)
			STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
			PRINTFORML STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
			HTML_PRINT CONVERTSTR(STR:颜绘再現文字列)
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			GOTO INPUT_LOOP
		CASE 2
			CALL D20XX_Face_RandomFcsv("阿尔法兔子")
			PRINTFORML Fcsv = %RESULTS%
			CALL D20XX_FACE_FcsvToSprite(RESULTS)
			PRINTFORML RESULTS = %RESULTS%
			CALL CREATE_SPRITE_MAIDFACE(1, 0, RESULTS)
			STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
			HTML_PRINT CONVERTSTR(STR:颜绘再現文字列)
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			GOTO INPUT_LOOP
		CASE 3
			CALL D20XX_Face_RandomFcsv("イヴァ阴蒂ナ")
			PRINTFORML Fcsv = %RESULTS%
			CALL D20XX_FACE_FcsvToSprite(RESULTS)
			PRINTFORML RESULTS = %RESULTS%
			CALL CREATE_SPRITE_MAIDFACE(1, 0, RESULTS)
			STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
			HTML_PRINT CONVERTSTR(STR:颜绘再現文字列)
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			GOTO INPUT_LOOP
		CASE 4
			CALL D20XX_Face_RandomFcsv("ウスラバニヤ")
			PRINTFORML Fcsv = %RESULTS%
			CALL D20XX_FACE_FcsvToSprite(RESULTS)
			PRINTFORML RESULTS = %RESULTS%
			CALL CREATE_SPRITE_MAIDFACE(1, 0, RESULTS)
			STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
			HTML_PRINT CONVERTSTR(STR:颜绘再現文字列)
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			GOTO INPUT_LOOP
		CASE 5
			CALL D20XX_Face_RandomFcsv("エンメロイア")
			PRINTFORML Fcsv = %RESULTS%
			CALL D20XX_FACE_FcsvToSprite(RESULTS)
			PRINTFORML RESULTS = %RESULTS%
			CALL CREATE_SPRITE_MAIDFACE(1, 0, RESULTS)
			STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
			HTML_PRINT CONVERTSTR(STR:颜绘再現文字列)
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			GOTO INPUT_LOOP
		CASE 6
			CALL D20XX_Face_RandomFcsv("オーロパリカ")
			PRINTFORML Fcsv = %RESULTS%
			CALL D20XX_FACE_FcsvToSprite(RESULTS)
			PRINTFORML RESULTS = %RESULTS%
			CALL CREATE_SPRITE_MAIDFACE(1, 0, RESULTS)
			STR:颜绘再現文字列 = %STR:参照用MAIDFACE文字列%
			HTML_PRINT CONVERTSTR(STR:颜绘再現文字列)
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			PRINTL 
			GOTO INPUT_LOOP
		CASE 999

		CASEELSE
			GOTO INPUT_LOOP
	ENDSELECT

@D20XX_Face_RandomFcsv(RACE,_Name)
	#DIM DYNAMIC MEMO_TARGET
	#DIM DYNAMIC ACTOR

	#DIM DYNAMIC LCOUNT
	#DIMS DYNAMIC RACE
	#DIMS DYNAMIC _Name
	#DIMS DYNAMIC CSTRS
	#DIMS DYNAMIC TALENTS

	MEMO_TARGET = TARGET

	;ベースはドッペル你
	ADDCHARA 99

	;記述の簡略化のために路人をTARGETにする
	TARGET = CHARANUM - 1
	;颜绘出力に必要な共通フラグ設定
	CFLAG:颜绘 = 1
	CFLAG:路人 = 1
	
	SIF Name != ""
		CSTR:ふりがな = %_Name%
	;短/

	CSTR:髪長 = %TEXTR("巻髪/中等長度/中等長度/披肩/披肩/披肩/長/長/長/長/超長/超長/超長")%
	CSTR:前髪 = %TEXTR("自然刘海/自然刘海２/自然刘海３/短刘海/Ｍ字刘海/Ｍ字刘海２/Ｍ字刘海３/斜刘海/斜刘海２/齐刘海/撩刘海/单眼遮盖/編髪/外八刘海/外八刘海２/双眼遮盖/長鬓角/長鬓角２/露额頭/分叉毛刺/分叉毛刺２/分叉毛刺３/分叉毛刺４/分叉毛刺５/分叉毛刺６/不对称/不对称２/进气口发型/尾卷刘海/尾卷刘海２/尾卷刘海３/右斜/中分/大半遮盖/大半遮盖２/大半遮盖３/半遮眼/交叉前发/交叉前发２/短前发/自然卷/前发分割/前发分割２/後梳/長め齐刘海/長め齐刘海２/散发/前髪尾")%
	CSTR:後髪 = %TEXTR("自然/直髪/外八/卷髪")%
	CSTR:改髪 = %TEXTR("无特殊髪型/无特殊髪型/无特殊髪型/无特殊髪型/双马尾/侧马尾/马尾辫/三股辫/大三股辫/低団子頭/団子頭/短双马尾/長双马尾/卷双马尾/钻頭双马尾/团子頭双马尾/細双马尾/三股辫双马尾/编起来/盘頭/侧盘頭/高侧盘頭/麻花辫/单辫/单辫２/双辫/简易扎发/妹妹頭")%
	CSTR:呆毛 = %TEXTR("无呆毛/无呆毛/无呆毛/无呆毛/呆毛/呆毛２/呆毛３/呆毛４/呆毛５/呆毛６")%
	CSTR:蝴蝶結 = %TEXTR("无蝴蝶結/无蝴蝶結/无蝴蝶結/无蝴蝶結/両側蝴蝶結/单側蝴蝶結/頭後蝴蝶結/頭上蝴蝶結")%
	CSTR:瞳色 = %TEXTR("黒/青/紫/緑/赤/茶/金/紅/桃/白/紺/焦茶/深緑/棕/銀")%
	IF RAND:6 == 0
		CSTR:眼形 = %TEXTR("眯眯眼/笑颜/笑颜２/笑颜３/笑颜４/温馨/闭眼/闭眼２/＞＜")%
	ELSE 
		CSTR:眼形 = %TEXTR("普通眼２/普通眼３/普通眼４/吊眼２/吊眼３/吊眼４/垂眼２/垂眼３/垂眼４/斜眼２/斜眼３/斜眼４/")%
	ENDIF
	CSTR:白眼 = 无眼白
	CSTR:眉形 = %TEXTR("通常眉/通常眉短/憤怒眉/憤怒眉短/斜眉/斜眉短/困扰眉/困扰眉短/麻呂眉/蹙眉/蹙眉短")%
	CSTR:嘴形 = %TEXTR("微笑/微笑２/微笑３/微笑４/微笑５/微笑６/へ字/へ字２/へ字３/へ字４/△/△２/ω/ω２/嘟嘴/嘟嘴２/嘟嘴３/嘟嘴４/猫口/笑顔/笑顔２/笑顔３/ワ/ヮ/ヮ２/半開/大口/無口系/嘲笑/嘲笑２/嘲笑３/嘲笑４/小口/一文字/～/いー/いー２/いー３/呀哒/呀哒２/呀哒３/哈欠小/哈欠大")%
	SIF RAND:7 == 0
		CSTR:高光 = 高光无
	TALENT:精灵耳 = 2


	TALENT:角 = 0
	TALENT:翼 = 0
	TALENT:動物耳 = 0
	;TALENT:肤色 = TOINT(TEXTR("0/0/0/0/0/0/0/0/0/0/0/0/2/2/2/2/2/2/1/1/1/3"))
	IF RAND(100) == 0
		;青肌はダエモスラビヤには居ない人種の遺伝だべ
		TALENT:肤色 = 3
	ELSEIF RAND(10) == 0
		;褐色は魔界では珍しい(というかメラニンを生成できる遺伝子を持たない事例が多い)
		TALENT:肤色 = 1
	ELSEIF RAND(3) == 0
		;普通の肌でもやや珍しめ
		TALENT:肤色 = 0
	ELSE
		;魔界には日光が無いので殆どの人は色白
		TALENT:肤色 = 2
	ENDIF

	SIF RAND:3 == 0
		CALL SET_OTHER, TEXTR("眼鏡/眼鏡/专家眼鏡/黑框眼鏡/玳瑁眼鏡"), TARGET


	;一旦全員女仆装
	;CALL SET_SHIRT, "女仆装"
	;CALL SET_SHIRT, "脏連体泳装"
	CALL SET_SHIRT, "軍服"

	SELECTCASE RACE
		CASE "天使"
			CSTR:髪色 = %TEXTR("金/銀/緑/白/白金")%
			CSTR:種族 = 天使
		CASE "阿尔法兔子"
			;白系の髪色だよ
			CSTR:髪色 = %TEXTR("金/銀/緑/白/白金")%
			CSTR:種族 = 阿尔法兔子
			TALENT:角 = 1
			;TALENT:翼 = 1
		CASE "イヴァ阴蒂ナ"
			;赤系の髪色だよ
			IF RAND:100 == 0
				;槞色は王族なのでイヴァ阴蒂ナ人の中から100分の1にしか現れない
				CSTR:髪色 = 槞
			ELSE 
				;赤系の髪色だよ
				CSTR:髪色 = %TEXTR("黒/茶/赤/桃/紅/焦茶/紫")%
			ENDIF 

			CSTR:種族 = イヴァ阴蒂ナ
			;巻き角
			SELECTCASE RAND(2)
				CASE 0
					TALENT:角 = 4
				CASE 1
					TALENT:角 = 10
			ENDSELECT
			TALENT:翼 = 1
			TALENT:頭羽 = 1
		CASE "ウスラバニヤ"
			;青系の髪色だよ
			CSTR:髪色 = %TEXTR("黒/銀/青/緑/紺/深緑/白")%
			CSTR:種族 = ウスラバニヤ
			;横角
			SELECTCASE RAND(2)
				CASE 0
					TALENT:角 = 1
				CASE 1
					TALENT:角 = 2
				CASE 2
					TALENT:角 = 3
			ENDSELECT
			TALENT:頭羽 = 1
		CASE "エンメロイア"
			;动画っぽい髪色しか居ないよ
			CSTR:髪色 = %TEXTR("金/青/緑/赤/紫/棕/桃")%
			CSTR:種族 = エンメロイア
			;前角
			SELECTCASE RAND(2)
				CASE 0
					TALENT:角 = 20
				CASE 1
					TALENT:角 = 21
			ENDSELECT
			TALENT:翼 = 1
			TALENT:頭羽 = 1
		CASE "オーロパリカ"
			;地味目な濃色の髪色だよ
			CSTR:髪色 = %TEXTR("黒/茶/紅/紺/焦茶/深緑")%
			CSTR:種族 = オーロパリカ
			TALENT:精灵耳 = 0
			
			SELECTCASE RAND(4)
				CASE 0
					TALENT:動物耳 = 1
				CASE 1
					TALENT:動物耳 = 4
				CASE 2
					TALENT:動物耳 = 5
				CASE 3
					TALENT:動物耳 = 6
			ENDSELECT
	ENDSELECT

	;ここで、TARGETの設定を丸々保存したい
	;VariableSize.CSVを参照
	FOR LCOUNT,0,120
		CSTRS += @"%CSTR:LCOUNT%+"
	NEXT

	FOR LCOUNT,0,300
		TALENTS += @"{TALENT:LCOUNT}+"
	NEXT


	RESULTS = 
	RESULTS += @"%CSTRS%%TALENTS%"

	TARGET = MEMO_TARGET
	
	CALL DELETE_CHARA, CHARANUM - 1
	CALL DEL_MOB
;
@D20XX_FACE_FcsvToSprite(Fcsv, FaceChange)
	#DIM DYNAMIC MEMO_TARGET
	#DIMS DYNAMIC FaceChange
	#DIM DYNAMIC LCOUNT
	#DIMS DYNAMIC Fcsv
	#DIMS DYNAMIC LRESULTS,550

	MEMO_TARGET = TARGET

	;ベースはドッペル你
	ADDCHARA 99

	;記述の簡略化のために路人をTARGETにする
	TARGET = CHARANUM - 1
	;颜绘出力に必要な共通フラグ設定
	CFLAG:颜绘 = 1
	CFLAG:路人 = 1
	
	SPLIT Fcsv ,@"+",  LRESULTS
	FOR LCOUNT,0,120
		CSTR:TARGET:LCOUNT += @"%LRESULTS:LCOUNT%"
	NEXT

	FOR LCOUNT,120,420
		TALENT:TARGET:(LCOUNT-120) = TOINT(LRESULTS:LCOUNT)
	NEXT

	;衣類関係　全部じゃないけど面倒なので一旦これくらいで良いべ
	EQUIP:TARGET:飾品 = STRLENS(CSTR:TARGET:飾品)
	CSTR:TARGET:服 = %SET_CLO_COMMON(CSTR:TARGET:服, TARGET)%
	EQUIP:TARGET:服 = STRLENS(CSTR:TARGET:服)
	CSTR:TARGET:裙 = %SET_CLO_COMMON(CSTR:TARGET:裙, TARGET)%
	EQUIP:TARGET:裙 = STRLENS(CSTR:TARGET:裙)
	CSTR:TARGET:下身衣装 = %SET_CLO_COMMON(CSTR:TARGET:下身衣装, TARGET)%
	CSTR:TARGET:下身衣装 = %MERGE_STR(CSTR:TARGET:下身衣装, CLOCOLOR_MAIDFACE(SHIRT(TARGET, "種類"), CHECK_CLOCOLOR(CSTR:TARGET:服), TARGET) )%
	EQUIP:TARGET:下身衣装 = STRLENS(CSTR:TARGET:下身衣装)

	;CSTRのふりがな機能で名前を受け渡ししてるので
	NAME:TARGET = %CSTR:TARGET:ふりがな%

	CALL SET_CHANGE_FACE(TARGET, FaceChange)
	RESULTS = %MAIDFACE(TARGET, 0)%

	TARGET = MEMO_TARGET
	CALL DELETE_CHARA, CHARANUM - 1
	CALL DEL_MOB
;
@D20XX_FACE_DFRAME(Fcsv, FaceChange)
	#DIM DYNAMIC LCOUNT
	#DIMS DYNAMIC Fcsv
	#DIMS DYNAMIC FaceChange
	#DIM DYNAMIC MEMO_REDRAW
	#DIM DYNAMIC MEMO_LINECOUNT
	#DIM DYNAMIC FSIZE
	;テ接吻トのインデント
	#DIMS DYNAMIC INDENT_TEXT
	;1行内のテ接吻トの色
	#DIMS DYNAMIC TEXT_COLOR
	#DIMS DYNAMIC HTMLF

	MEMO_REDRAW = CURRENTREDRAW()
	REDRAW 0

	RESULTS = 
	;ADDCHARA 99
	CALL D20XX_FACE_FcsvToSprite(Fcsv, FaceChange)
	CALL D20XX_FACE_Packaging(RESULTS)
	;RESULTS = %CONVERTSTR(RESULTS)%
	
	STR:CIP再現文字列 =
	HTMLF = 
	INDENT_TEXT = 
	TEXT_COLOR = 

	MEMO_LINECOUNT = LINECOUNT
	;颜绘と淫紋を表示する
	HTML_PRINT @"%CONVERTSTR(RESULTS)%"
	;表示された場合
	IF LINECOUNT > MEMO_LINECOUNT
		;一度描画した物を解体してHPRINT_STRに適用可能な形状にする
		HTMLF = %HTML_GETPRINTEDSTR(0)%
		;ここでいったん表示されている画像を消し、HTMLFを整理したうえで取得しなおす
		CLEARLINE 1
		HTML_TAGSPLIT HTMLF
		HTMLF = 
		FOR LCOUNT, 2, RESULT-2
			HTMLF += RESULTS:LCOUNT
		NEXT
	ENDIF

	;画像が出てるならインデントをつける
	FSIZE = MAIDFACESIZE()
	INDENT_TEXT = %BL(FSIZE/50 + 1)%
	MEMO_LINECOUNT = LINECOUNT
	FOR LCOUNT, 0, 20
		SELECTCASE LCOUNT
		;２行連続空白ならテ接吻ト表示終了
		CASEELSE
			SIF LCOUNT >= 7 && STR:LCOUNT == "" && STR:(LCOUNT + 1) == ""
				BREAK
		ENDSELECT

		;その行の默认文字色を設定
		IF SUBSTRING(STR:LCOUNT, 0, 7) == "#TEXTC="
			TEXT_COLOR = %EXTSTR(STR:LCOUNT, "", ":")%_
			STR:LCOUNT = %EXTSTR(STR:LCOUNT, ":")%
		ENDIF
		;STR:0に颜绘と淫紋の表示を追加
		IF LCOUNT == 0 && COND("颜绘表示中", TARGET)
			STR:0 = %TEXT_COLOR%%HTMLF%_ %STR:LCOUNT%
			CALL HPRINT_STRL, STR:LCOUNT
			TEXT_COLOR =
			CONTINUE
		ENDIF
		;HTMLへの分岐
		IF SUBSTRING(STR:LCOUNT, 0, 5) == "HTML:"
			STR:LCOUNT = %TEXT_COLOR%%INDENT_TEXT%_%SUBSTRING(STR:LCOUNT, 5, -1)%
			CALL HPRINT_STRL, STR:LCOUNT
			TEXT_COLOR =
			CONTINUE
		ENDIF

		STR:LCOUNT = %INDENT_TEXT%%STR:LCOUNT%

		;画面内に収圆圈かの格子
		SELECTCASE STRLENS(STR:LCOUNT)
		CASE IS <= NUM("折り返し文字数")
			CALL PRINT_STRL, @"%TEXT_COLOR%%STR:LCOUNT%"
			STR:LCOUNT = 
			TEXT_COLOR = 
		CASEELSE
			;、を優遇
			IF STRCOUNT(STR:LCOUNT, "、") && STRCOUNTS(STR:LCOUNT, "喜欢的东西:", "讨厌的东西:") == 0 && STRLENS(EXTSTR(STR:LCOUNT, "", "、") ) >= NUM("折り返し文字数")*2/3 && STRLENS(EXTSTR(STR:LCOUNT, "", "、") ) <= NUM("折り返し文字数") - 2
				CALL PRINT_STRL, @"%TEXT_COLOR%%EXTSTR(STR:LCOUNT, "", "、")%、"
				STR:LCOUNT = %EXTSTR(STR:LCOUNT, "、")%
			ELSE
				CALL PRINT_STRL, @"%TEXT_COLOR%%SUBSTRING(STR:LCOUNT, 0, NUM("折り返し文字数")-1)%"
				STR:LCOUNT = %SUBSTRING(STR:LCOUNT, NUM("折り返し文字数")-1, -1)%
			ENDIF
			SELECTCASE STR:LCOUNT
			CASE "", "_"
				TEXT_COLOR = 
			CASEELSE
				LCOUNT -= 1
			ENDSELECT
		ENDSELECT
	NEXT

	;改行のつじつま合わせ
	SIF STR:颜绘再現文字列 != ""
		CALL MULTILINE, TFLAG:MAX_height - (LINECOUNT - MEMO_LINECOUNT) + 1
	SIF COND("颜绘表示中", TARGET)
		TFLAG:颜绘表示中 = LINECOUNT
	CSTR:TARGET:颜绘変化 =

	CALL BLANKLINE

	VARSET STR, "", 0, 20
	REDRAW MEMO_REDRAW
;
