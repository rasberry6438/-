;药品菜单
@DRUG_MENU

;重置药品使用次数
VARSET TFLAG, 0, 951,958

$DRUG_MENU_START
;打印出患者
CALL Madical_interface_top
CALL Patient_Information
PRINTL

;治疗方式选择，只能用一次。
IF TFLAG:951 == 0
	PRINTFORMLC [1] 注射
ELSE
	PRINTLC 已使用
ENDIF

IF TFLAG:952 == 0
	PRINTFORMLC [2] 食疗
ELSE
	PRINTLC 已使用
ENDIF

IF TFLAG:953 == 0
	PRINTFORMLC [3] 内服
ELSE
	PRINTLC 已使用
ENDIF

PRINTL

IF TFLAG:954 == 0
	PRINTFORMLC [4] 外用
ELSE
	PRINTLC 已使用
ENDIF

IF TFLAG:955 == 0
	PRINTFORMLC [5] 理疗
ELSE
	PRINTLC 已使用
ENDIF

IF TFLAG:956 == 0
	PRINTFORMLC [6] 语疗
ELSE
	PRINTLC 已使用
ENDIF

PRINTL

IF TFLAG:957 == 0
	PRINTFORMLC [7] 其他
ELSE
	PRINTLC 已使用
ENDIF

;IF TFLAG:958 == 0
	PRINTFORMLC [8] SPECIAL
;ELSE
;	PRINTLC 已使用
;ENDIF

PRINTL
PRINTL
PRINTL [998]结束了，明天再来哦！（大概明天还会来）
PRINTL [999]结束了，不来也没关系！（近期不会再出现了）

INPUT

IF RESULT == 998
	BASE:M_C_ID:明日再来 = 1
	RETURN
ELSEIF RESULT == 999
	BASE:M_C_ID:近期问诊 = 10 + RAND:6
	RETURN
ENDIF

;打印出对应治疗方式的药品
SELECTCASE RESULT

	CASE 1
		CALL PRINT_DRUG(100, 113)
	
	CASE 2
		CALL PRINT_DRUG(200, 216)
	
	CASE 3
		CALL PRINT_DRUG(300, 317)

	CASE 4
		CALL PRINT_DRUG(400, 410)
		
	CASE 5
		CALL PRINT_DRUG(500, 513)

	CASE 6
		CALL PRINT_DRUG(600, 615)

	CASE 7
		CALL PRINT_DRUG(700, 719)

	CASE 8
		CALL SPECIAL_SKILL
		GOTO DRUG_MENU_START
		
ENDSELECT

PRINTL
PRINTL [0]返回

INPUT
SIF RESULT == 0
	GOTO DRUG_MENU_START

;使用药品后为对应的类型，添加已使用标志。
SELECTCASE RESULT

	CASE 100 TO 113
		TFLAG:951 = 1
	
	CASE 200 TO 216
		TFLAG:952 = 1
	
	CASE 300 TO 317
		TFLAG:953 = 1

	CASE 400 TO 410
		TFLAG:954 = 1
		
	CASE 500 TO 513
		TFLAG:955 = 1

	CASE 600 TO 615
		TFLAG:956 = 1

	CASE 700 TO 719
		TFLAG:957 = 1

ENDSELECT

;使用药品扣除对应EP点数
EIRIN_POINT -= DRUG_PRICE(RESULT)

;选择好药品后，进行药效结算
CALL DRUG_CALCULATION(RESULT)

;如果患者体力耗尽询问是否抢救
SIF BASE:M_C_ID:患者体力 <= 0
	CALL PATIENT_COMA

;兜底，如果没治好返回药品菜单选择页面，如果遗弃患者标记不为0，跳出。
IF BASE:M_C_ID:病症残余 > 0 && ABANDONED_PATIENTS == 0
	GOTO DRUG_MENU_START
ELSE
	;重置遗弃患者标记
	ABANDONED_PATIENTS = 0
ENDIF
	


;打印药品清单和药品最强药效
@PRINT_DRUG(ARG:0, ARG:1)
;换行变量
#DIM DYNAMIC CHANGE_LINE = 0

FOR LOCAL, ARG:0, ARG:1
	PRINTFORM [{LOCAL}]%STR:(LOCAL + 18000), 20,LEFT% {DRUG_BAST_EFFECT(LOCAL)} / EP {DRUG_PRICE(LOCAL), 4, RIGHT}    
	CHANGE_LINE ++
	IF CHANGE_LINE == 3
		PRINTL
		CHANGE_LINE = 0
	ENDIF
NEXT

;特殊技能
@SPECIAL_SKILL


PRINTFORMLC [1]超執刀 消耗：500 TSP 使已使用的治疗能够再次使用。
PRINTL
PRINTL [0]返回

INPUT

IF RESULT == 1
	IF BASE:MASTER:TSP >= 500
		PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%身影一阵模糊，新治疗器具重新摆放整齐。
		PRINTL
		PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)% TSP - 500
		PRINTL
		;超執刀 TPS-500 重置TFLAG使用标记
		BASE:MASTER:TSP -= 500
		VARSET TFLAG, 0, 951, 958
	ELSE
		PRINT TPS不足。
	ENDIF
ENDIF

PRINTW
