@PfScale(LOCALS,ARG)
PRINTFORML 对%LOCALS%的印象是？
SETCOLOR C_AQUA
PRINTBUTTON @"[热爱] ",5
SETCOLOR C_GREEN
PRINTBUTTON @"[喜欢] ",3	
SETCOLOR C_PINK
PRINTBUTTON @"[有趣] ",1
RESETCOLOR
PRINTBUTTON @"[一般] ",0
PRINTL
SETCOLOR C_GRAY
PRINTBUTTON @"[无趣] ",-1
SETCOLOR C_ORANGE
PRINTBUTTON @"[讨厌] ",-3
SETCOLOR C_RED
PRINTBUTTON @"[憎恶] ",-5
RESETCOLOR
IF ARG==1
	LOCALS:1'="[选择形容词] "
ELSEIF ARG==2
	LOCALS:1'="[结束设定] "
ELSEIF !ARG
	LOCALS:1'="[返回tag分类] "
ENDIF
PRINTBUTTON LOCALS:1,999
$INPUT_LOOP
INPUT
SELECTCASE RESULT
CASE 5,0,999
	LOCAL=RESULT
CASE -3,-1,1,3
	LOCAL=RESULT+RAND:2*RESULT/ABS(RESULT)
CASE -5
	LOCAL=RESULT*(RAND:2+1)
ENDSELECT
CALL REVIEW_GIFT(0)
LOCAL:1=STR_MULTI_COUNT(LOCALS,RESULTS:1)
LOCAL:2=STR_MULTI_COUNT(LOCALS,RESULTS:2)
IF LOCAL:1+LOCAL:2
	PfBad'=REPLACE(PfBad,LOCALS,"")	
	PfGood'=REPLACE(PfGood,LOCALS,"")	
ENDIF
IF LOCAL==999
ELSEIF (LOCAL>0&&(LOCAL:1+LOCAL)>5)||(LOCAL<0&&(LOCAL:2-LOCAL)>10)
	PfBad'=REPLACE(PfBad,LOCALS,"")	
	PfGood'=REPLACE(PfGood,LOCALS,"")	
	PRINTW 超出范围，重置喜好
ELSEIF (LOCAL>0&&LOCAL:2*(LOCAL:1+LOCAL))||(LOCAL<0&&(LOCAL:2-LOCAL)*LOCAL:1)
	PfBad'=REPLACE(PfBad,LOCALS,"")	
	PfGood'=REPLACE(PfGood,LOCALS,"")			
	PRINTW 喜好冲突，重置喜好
ELSEIF INRANGE(LOCAL,-10,-1)
	PfBad+=LOCALS*(-LOCAL)
ELSEIF INRANGE(LOCAL,1,5)
	PfGood+=LOCALS*LOCAL
ENDIF
CLEARLINE 4
RETURN LOCAL

CLEARLINE 1	
REUSELASTLINE 無效輸入
GOTO INPUT_LOOP
@PfSetDetailed
PRINTL 试想某天自己收到一份礼物，对礼物会有怎样的印象呢？
PRINTW 以下，超出范围（喜欢Lv5、讨厌Lv10）则重置该tag喜好，同时喜欢与讨厌同理。
CALL GIFT_ORDER_MADE_FROM_MASTER(0)
PRINTL 设定完毕了吗？
CALL ASK_YN()
SIF RESULT
	RESTART
;PRINTFORMW 喜好:%PfGood%，讨厌%PfBad%
@PresetTagChoice
PfGood'="虫/"*3+"魔法/時の/可愛的/妖怪/"
PfBad'="死生/"*10+"危険の/"*5+"可怕的/带来死亡の/被诅咒の/破滅の/"*3+"誇張/"
FOR LOCAL,40,50						
	SELECTCASE LOCAL
		CASE 40
			CALL PresetTag(LOCAL,,"秩序/")
			CALL PresetTag(LOCAL,1,"混沌/")
		CASE 41
			CALL PresetTag(LOCAL,,"茶/茶具/")	
		CASE 43
			CALL PresetTag(LOCAL,,"書物/書/文具/知的/")
		CASE 44
			CALL PresetTag(LOCAL,,"食器/")
		CASE 45
			CALL PresetTag(LOCAL,,"楽器/音楽/演奏の/乐谱/")
		CASE 47
			CALL PresetTag(LOCAL,,"魚/")
	ENDSELECT	
NEXT
SIF INRANGE(TALENT:0:121,1,3)
	PfGood+="酒具/酒/"*(TALENT:0:121*2-1)	
@PresetTag(ARG,ARG:1,ARGS)
;ARG:0数值，ARG:1喜恶，0喜1恶；ARGS tag
SELECTCASE ARG
	CASE 40 TO 45
		SIF !INRANGE(ABL:0:ARG,1,6)
			RETURN 0
		ARG:2=(ABL:0:ARG+1)/2*2-1
	CASE 46 TO 49
		SIF !INRANGE(TALENT:0:ARG,1,6)
			RETURN 0
		ARG:2=(TALENT:0:ARG+1)/2*2-1
ENDSELECT
SIF ARG:2!=5
	ARG:2+=RAND:2
IF !ARG:1
	PfGood+=ARGS*ARG:2
ELSE
	PfBad+=ARGS*ARG:2
ENDIF

;----------------------------------------------------------------------------------------------------
; 获取并排序计数分割结果的函数
;作者：狂气刘俊海
;----------------------------------------------------------------------------------------------------
; 调用 @CNT_SPLIT 获取原始数据，然后根据 Sort 参数进行排序
;・CALLFで使用のこと、REFを使用して变量を直接书き换える
;・参数必须、单语列表/出现个数列表の配列上限に注意！
;・区切り文字は"/"で固定 (由 @CNT_SPLIT 决定)
;・返回值１）STR_LIST、排序后的单语列表
;・返回值２）CNT_LIST、排序后的各单语的出现回数列表
;・返回值３）STR_NUM、单语的种类总数
;・返回值４）Sort、排序方式 (0:不变, 1:计数升序, 2:计数降序)
;----------------------------------------------------------------------------------------------------
@GET_SORTED_CNT_SPLIT(TARGET_STR, STR_LIST, CNT_LIST, STR_NUM, Sort)
#FUNCTION
#DIMS         TARGET_STR     ;分割对象STR
#DIMS REF     STR_LIST       ;单语列表 (输出)
#DIM  REF     CNT_LIST       ;各单语の出现个数列表 (输出)
#DIM  REF     STR_NUM        ;单语の种类の总数 (输出)
#DIM          Sort           ;排序方式 (0:不变, 1:计数升序, 2:计数降序)

; 排序所需的临时变量
#DIM          temp_i           ; 排序循环用
#DIM          temp_j          ; 排序循环用
#DIM          should_swap
#DIM          temp_cnt       ; 计数交换用临时变量
#DIMS         temp_str       ; 字符串交换用临时变量

CALLF CNT_SPLIT(TARGET_STR, STR_LIST, CNT_LIST, STR_NUM)

;根据 Sort 参数对获取到的数据进行排序
IF Sort
    ; 使用冒泡排序对 CNT_LIST 进行排序，同时交换对应的 STR_LIST 元素
    ; 排序范围是已经填充的 0 到 STR_NUM-1
    FOR temp_i, 0, STR_NUM - 1
        FOR temp_j, 0, STR_NUM - 1 - temp_i
            SIF temp_j + 1 >= STR_NUM
                CONTINUE

            should_swap = 0
            IF Sort == 1 ; 升序 (如果当前比下一个大，则交换)
                IF CNT_LIST:temp_j > CNT_LIST:(temp_j+1)
                    should_swap = 1
                ENDIF
            ELSEIF Sort == 2 ; 降序 (如果当前比下一个小，则交换)
                IF CNT_LIST:temp_j < CNT_LIST:(temp_j+1)
                    should_swap = 1
                ENDIF
            ENDIF

            IF should_swap
                ; 交换 CNT_LIST 中的元素
                temp_cnt = CNT_LIST:temp_j
                CNT_LIST:temp_j = CNT_LIST:(temp_j+1)
                CNT_LIST:(temp_j+1) = temp_cnt

                ; 交换 STR_LIST 中的对应元素
                temp_str '= STR_LIST:temp_j
                STR_LIST:temp_j '= STR_LIST:(temp_j+1)
                STR_LIST:(temp_j+1) '= temp_str
            ENDIF
        NEXT
    NEXT
ENDIF
@SimPfSet
VARSET LOCAL
LOCAL:2=LINECOUNT
PRINTL 请选择需要同步的对象
FOR LOCAL,1,CHARANUM
	SIF !TALENT:LOCAL:7
		CONTINUE
	LOCALS'=@"[%CALLNAME:LOCAL%]"
	PRINTBUTTON @"%LOCALS,12,LEFT%",LOCAL
	LOCAL:1++
	SIF LOCAL:1%4==0
		PRINTL
NEXT
INPUT
IF !INRANGE(RESULT,1,CHARANUM)||!TALENT:RESULT:7
	PRINTW 输入无效，现在返回
	CLEARLINE LINECOUNT-LOCAL:2
	RESTART
ELSE
	PfGood = %GET_STR(, "キャラデータ", RESULT, "感性：好き")%
	PfBad = %GET_STR(, "キャラデータ", RESULT, "感性：嫌い")%
	PRINTFORMW 已设定为与%CALLNAME:RESULT%相同的喜好
ENDIF
@ResetPf
PRINTFORML 重置%CALLNAME:MASTER%的喜恶吗？
CALL ASK_YN()
IF !RESULT
	VARSET PfGood
	VARSET PfBad
ENDIF
@SetPfChoice
LOCAL=LINECOUNT
PRINTFORML 设定%CALLNAME:MASTER%的喜好吧
PRINTBUTTON @"[使用预设] ",0
PRINTBUTTON @"[与恋人同步] ",1
PRINTBUTTON @"[详细设定] ",2
PRINTBUTTON @"[返回] ",9
INPUT
IF !RESULT
	PRINTFORML 根据%CALLNAME:MASTER%的技能等级设定喜好，确定吗？
	CALL ASK_YN()
	SIF !RESULT												
		CALL PresetTagChoice
ELSEIF RESULT==1
	CALL SimPfSet
ELSEIF RESULT==2
	CALL PfSetDetailed
ELSEIF RESULT==9
	RETURN
ENDIF
CLEARLINE LINECOUNT-LOCAL
RESTART