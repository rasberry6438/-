;-------------------------------------------------
;換装
;日常系指令、レベル1
;-------------------------------------------------
@COM429
#DIM C_ID
#DIM ID_換装対象, 人物数量上限
#DIM 換装可能人数
#DIM L_ID ;使用列表のID
CALL MAKE_CHARA_LIST("可换装的角色列表", L_ID, ID_換装対象, 換装可能人数)
IF 換装可能人数 <= 1
	;PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%换了衣服
	CALL 服装換装(MASTER)
	CALL CLOTHES_SETTING_TRAIN(MASTER)
	PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%换了衣服
	RETURN -1
ENDIF

;着替え対象の選択
;列表作成時に可否判定やってるのでここでは必要ないです
PRINTFORML 可以换衣服了
PRINTFORML 要给谁换衣服呢?
PRINTFORML 
CALL SIMPLE_CHARA_LIST(ID_換装対象, 換装可能人数)
;中止した
SIF RESULT == 999
	RETURN -1

;RESULTはすぐ腐るので
C_ID = ID_換装対象:(RESULT)
SIF FLAG:時間停止 == 1 && !(C_ID == MASTER)
	CFLAG:C_ID:時間停止換装 = 1
CALL 服装換装(C_ID)
CALL CLOTHES_SETTING_TRAIN(C_ID)
RETURN 0

SIF !FLAG:70
	TIME += 5
TFLAG:102 = 0

;CLOTHES_SETTING_TRAINに靴脱ぎ処理を移動させたので
;ここでCLOTHES_SETTING_TRAINすると靴を脱いでしまい、靴設定の保存ができません
;呼び出し元でCLOTHES_SETTING_TRAINすること
@服装換装(C_ID)
#DIM C_ID
#DIM DYNAMIC LINESTART2
#DIM DYNAMIC LINESTART3
#DIM DYNAMIC REDRAW_RECORD
#DIM DYNAMIC 部位选择 = 2
#DIM DYNAMIC 换装选择
#DIM DYNAMIC 部位选择屏蔽, 25
#DIM DYNAMIC PAGE
#DIMS DYNAMIC 部位名称
#DIM DYNAMIC 内裤指定类型
#DIM DYNAMIC 自设套装栏位选择
{
#DIMS CONST 表示部位, 23 = "", 
	"帽子", "飾品", "腕部装束", 
	"外搭",
	"上身衣服１","上身衣服２", 
	"和服", "連衣裙",
	"裙子", "下身衣服", "裤子", 
	"緊身内衣", "連体内衣", 
	"上半身内衣１", "上半身内衣２", 
	"下半身内衣１", "下半身内衣２", 
	"其他１", "其他２", "其他３", 
	"襪子", "靴"
}
{
#DIMS CONST 表示ラベル, 23 = "", 
	"　装備:頭　　　", "　装備:装飾　　", "　装備:腕　　　", 
	"　装備:外搭　　",
	"　装備:套头衫　", "　装備:衬衫　　", 
	"　装備:和服　　", "　装備:全身服　",
	"　装備:裙子　　", "　装備:下身衣物", "　装備:裤子　　", 
	"　装備:緊身内衣", "　装備:連體内衣", 
	"　装備:内衣(上)", "　装備:内衣(上)", 
	"　装備:内衣(下)", "　装備:内衣(下)", 
	"　装備:付属　　", "　装備:付属　　", "　装備:付属　　", 
	"　装備:襪子　　", "　装備:鞋　　　"
}

REDRAW_RECORD = CURRENTREDRAW()
REDRAW 0
PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%换衣服中
PRINTFORML
LINESTART = LINECOUNT
DO
	CALL SHOW_CLOTHES(C_ID, "現在的衣装")
	PRINTFORML 
	;PRINTFORML [7] - 衣装確認
	PRINTFORML [999] - 选项解释
	; PRINTFORML [6]   - 自设套装调整
	PRINTFORML [5]   - 不穿衣服
	;PRINTFORML [5] - 指定喜愛的衣装
	IF C_ID == MASTER
		HTML_PRINT "<nonbutton><font color='#404040'>[4]   - 默认睡衣的变更</font></nonbutton>"
	ELSE
		PRINTFORML [4]   - 默认睡衣的变更
	ENDIF
	PRINTFORML [3]   - 默认日常服装的变更
	PRINTFORML [2]   - 当前穿着暂时变更
	PRINTFORML [1]   - 胖次指定
	PRINTFORML 
	PRINTFORML [0] - 返回
	INPUT
	LINESTART2 = LINECOUNT
	换装选择 = RESULT
	SELECTCASE 换装选择
	CASE 999
		PRINTFORML 原版服装系统问题太多，因此本版本对服装进行了小幅重做，此处对各个选项的功能进行解释（自设套装目前还未完工）
		; HTML_PRINT @"<nonbutton>[6]   - %"自设套装调整", 20%: 对自设套装进行调整，包括新增、修改和删除，自设套装保存上限为100套</nonbutton>"
		HTML_PRINT @"<nonbutton>[5]   - %"不穿衣服", 20%: 这个不需要解释吧</nonbutton>"
		HTML_PRINT @"<nonbutton>[4]   - %"默认睡衣的变更", 20%: 设定当前角色的默认睡衣穿搭，可以选择预设的或自设的套装，也可随意搭配，主角没有睡衣设定</nonbutton>"
		HTML_PRINT @"<nonbutton>[3]   - %"默认日常服装的变更", 20%: 设定当前角色的默认穿搭，可以选择预设的或自设的套装，也可随意搭配</nonbutton>"
		HTML_PRINT @"<nonbutton>[2]   - %"当前穿着暂时变更", 20%: 设定当前角色的暂时穿搭，第二天恢复默认，与预设套装（如兔女郎等）冲突</nonbutton>"
		HTML_PRINT @"<nonbutton>[1]   - %"胖次指定", 20%: 内裤的设置和一般服装不一样，玩家自己可以换内裤（但不是这个选项而是上面的），但角色只能提议，毕竟一般不会有人喜欢别人帮你换吧</nonbutton>"
		FORCEWAIT
		CLEARLINE LINECOUNT - LINESTART2
		CONTINUE
	CASE 5
	;CLEARLINE LINECOUNT - LINESTART
	;CALL SHOW_CLOTHES(C_ID, "套装")
		DO
			PRINTFORML 脱掉%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的衣服，要这么做吗？ 
			PRINTFORML [1] - 是
			PRINTFORML [0] - 否
			INPUT
			SELECTCASE RESULT
			CASE 1
				IF C_ID != MASTER
					PRINTFORML 用催眠术给%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%下了命令
					PRINTFORMW 不准再穿衣服了
				ELSE
					PRINTFORMW 决定自己开始不穿衣服了
				ENDIF
				CALL CTRL_CLOTHES_SET(C_ID, "現在衣装の変更_全裸")
				PRINTFORML
				PRINTFORML 请问需要保留胖次吗？
				PRINTFORML [1] - 是
				PRINTFORML [0] - 否
				INPUT
				SELECTCASE RESULT
				CASE 1
					IF CFLAG:C_ID:睡衣
						EQUIP:C_ID:下半身内衣１ = CFLAG:C_ID:245
						EQUIP:C_ID:下半身内衣２ = CFLAG:C_ID:246
					ELSE
						EQUIP:C_ID:下半身内衣１ = CFLAG:C_ID:205
						EQUIP:C_ID:下半身内衣２ = CFLAG:C_ID:206
					ENDIF
				PRINTFORMW 那么胖次保留了
				CASE 0
				PRINTFORMW 那么明天开始%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%连胖次也不会穿了
				CFLAG:C_ID:指定胖次 = 100
				ENDSELECT  
				CALL DECIDE_CLOTHES(C_ID, "便装", "現在的衣装")
			CASE 0
			CASEELSE
			CLEARLINE LINECOUNT - LINESTART2
			CONTINUE
			ENDSELECT
			BREAK
		LOOP 1
		CLEARLINE LINECOUNT - LINESTART
		CONTINUE
	; CASE 5
	; 	; $換装5
	; 	;CALL SHOW_CLOTHES(C_ID, "套装")
	; 	DO
	; 		PRINTFORML 设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的喜愛套装中
	; 		PRINTFORML 
	; 		PRINTFORML [4] - 指定现在的服装为套装
	; 		PRINTFORML [3] - 穿设定好的套装
	; 		PRINTFORML [2] - 穿和特定角色同款的衣服
	; 		PRINTFORML [1] - 指定的复位
	; 		PRINTFORML 
	; 		PRINTFORML [0] - 放棄
	; 		INPUT
	; 		SELECTCASE RESULT
	; 		CASE 4
	; 			CALL DECIDE_CLOTHES(C_ID, "套装", "現在的衣装")
	; 		CASE 3
	; 			CALL COSPLAY_SET(C_ID, "套装")
	; 		CASE 2
	; 			CALL COSPLAY_CHARA(C_ID, "套装")
	; 		CASE 1
	; 			DO
	; 				PRINTFORML 真的复位吗？
	; 				PRINTFORML 
	; 				PRINTFORML [1] - 复位
	; 				PRINTFORML [0] - 放棄
	; 				INPUT
	; 				SELECTCASE RESULT
	; 				CASE 1
	; 					CALL CTRL_CLOTHES_SET(C_ID, "套装のリセット")
	; 				CASE 0
	; 				CASEELSE 
	; 					CLEARLINE 5
	; 					CONTINUE
	; 				ENDSELECT
	; 				BREAK
	; 			LOOP 1
	; 		CASE 0
	; 		CASEELSE
	; 			CLEARLINE LINECOUNT - LINESTART2
	; 			CONTINUE
	; 		ENDSELECT
	; 		BREAK
	; 		; GOTO 換装5
	; 	LOOP 1
	CASE 4
		;$換装4
		; IF C_ID == MASTER
		; PRINTFORMW 不可设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的睡衣
		; BREAK
		; ENDIF
		IF	C_ID == MASTER
			CLEARLINE LINECOUNT - LINESTART2
			CONTINUE
		ENDIF
		FOR LOCAL, 1, 23
			TEMP_CLOTHES:C_ID:LOCAL = CFLAG:C_ID:(240 + LOCAL)
		NEXT
		; DO
		; 	CLEARLINE LINECOUNT - LINESTART2
		; 	DRAWLINE
		; 	PRINTFORML 设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的睡衣中
		; 	CALL SHOW_CLOTHES(C_ID, "暂存状态")
		; 	DRAWLINE
		; 	FOR LOCAL:1, 1, 24
		; 		SIF GROUPMATCH(EQUIPNAME:(LOCAL:1), "下身衣服", "上半身内衣２", "下半身内衣１")
		; 			CONTINUE
		; 		IF LOCAL:1 != 23
		; 			IF 部位选择 == LOCAL:1
		; 				SETCOLOR C_AQUA
		; 				PRINTBUTTONLC @"[%EQUIPNAME:(LOCAL:1)%]" ,LOCAL:1 + 100
		; 				RESETCOLOR
		; 			ELSE
		; 				PRINTBUTTONLC @"[%EQUIPNAME:(LOCAL:1)%]" ,LOCAL:1 + 100
		; 			ENDIF
		; 		ELSE
		; 			IF 部位选择 == LOCAL:1
		; 				SETCOLOR C_AQUA
		; 				PRINTBUTTONLC @"[套装]" ,LOCAL:1 + 100
		; 				RESETCOLOR
		; 			ELSE
		; 				PRINTBUTTONLC @"[套装]" ,LOCAL:1 + 100
		; 			ENDIF
		; 		ENDIF
		; 	NEXT
		; 	PRINTL
		; 	DRAWLINE
		; 	CALL 衣服选择列表(部位选择, C_ID)
		; 	PRINTFORML [{0,2}]退出
		; 	INPUT
			; PRINTFORML 
			; PRINTFORML [5] - 随你喜欢
			; ;PRINTFORML [4] - 睡觉的服装
			; PRINTFORML [3] - 指定设定好的套装作为睡衣
			; PRINTFORML [2] - 裸睡
			; PRINTFORML [1] - 只穿内裤就睡觉
			; PRINTFORML 
			; PRINTFORML [0] - 放棄
			; SELECTCASE RESULT
			; 	CASE IS > 100
			; 		部位选择 = RESULT - 100
			; 	CASE 100
			; 		IF 部位选择 != 23
			; 			TEMP_CLOTHES:C_ID:部位选择 = 0
			; 		ELSE
			; 			VARSET TEMP_CLOTHES
			; 		ENDIF
			; 	CASE IS > 0
			; 		IF 部位选择 != 23
			; 			SIF STRLENS(GET_STR(C_ID, CLOTHES_PARTS_TO_CATEGORY(EQUIPNAME:部位选择), RESULT, "名前"))
			; 				TEMP_CLOTHES:C_ID:部位选择 = RESULT
			; 		ELSE
			; 			IF STRLENS(GET_STR(C_ID, "衣装セット", RESULT, "名前"))
			; 				FOR LOCAL:2, 1, 23
			; 					TEMP_CLOTHES:C_ID:(LOCAL:2) = GET_INT(C_ID, "衣装セット", LOCAL:2, EQUIPNAME:(LOCAL:2))
			; 				NEXT
			; 			ENDIF
			; 		ENDIF
			; 	CASE 0
			; 		FOR LOCAL:3, 1, 23
			; 			IF EQUIP:C_ID:(LOCAL:3) != TEMP_CLOTHES:C_ID:(LOCAL:3)
			; 				PRINTFORML 确定要这样设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的睡衣吗？
			; 				PRINTFORML （注意：非角色睡眠时间角色不会换上睡衣）
			; 				CALL ASK_YN
			; 				IF !RESULT
			; 					FOR LOCAL:4, 1, 23
			; 						CFLAG:C_ID:(240 + LOCAL:4) = TEMP_CLOTHES:C_ID:(LOCAL:4)
			; 					NEXT
			; 				ENDIF
			; 				BREAK
			; 			ENDIF
			; 		NEXT
			; 		VARSET TEMP_CLOTHES
			; 		BREAK
			; 	CASEELSE

				; CASE 5
				; 	CFLAG:C_ID:睡衣指定 = 0
				; CASE 4
				; 	SIF CFLAG:C_ID:套装
				; 		CALL CTRL_CLOTHES_SET(C_ID, "睡衣的变更_套装")
				; CASE 3
				; 	CALL COSPLAY_SELECT(C_ID, "睡衣", "睡衣セット")
				; CASE 2
				; 	CALL CTRL_CLOTHES_SET(C_ID, "睡衣的变更_全裸")
				; CASE 1
				; 	CALL CTRL_CLOTHES_SET(C_ID, "睡衣的变更_パンイチ")
				; CASE 0
				; CASEELSE
				; 	CLEARLINE LINECOUNT - LINESTART2
				; 	CONTINUE
			; ENDSELECT
			; CONTINUE
			; GOTO 換装4
		; LOOP 1
	CASE 3
		; $換装3
		FOR LOCAL, 1, 23
			TEMP_CLOTHES:C_ID:LOCAL = CFLAG:C_ID:(200 + LOCAL)
		NEXT
		; DO
		; 	CALL SHOW_CLOTHES(C_ID, "今日の衣装")
		; 	PRINTFORML 设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的便装中
		; 	PRINTFORML 
		; 	PRINTFORML [4] - 指定现在的服装（为发生而需要而被重写）
		; 	PRINTFORML [3] - 穿设定好的套装
		; 	PRINTFORML [2] - 穿和特定角色同款的衣服
		; 	PRINTFORML [1] - 由本人决定
		; 	PRINTFORML 
		; 	PRINTFORML [0] - 放棄
		; 	INPUT
		; 	SELECTCASE RESULT
		; 	CASE 4
		; 		CALL DECIDE_CLOTHES(C_ID, "便装", "現在的衣装")
		; 	CASE 3
		; 		CALL COSPLAY_SET(C_ID, "便装")
		; 	CASE 2
		; 		CALL COSPLAY_CHARA(C_ID, "便装")
		; 	CASE 1
		; 		PRINTFORMW 今日の衣装的设定交给本人了
		; 		CFLAG:C_ID:基本服装セット = 0
		; 	CASE 0
		; 	CASEELSE
		; 		CLEARLINE LINECOUNT - LINESTART2
		; 		CONTINUE
		; 	ENDSELECT
		; 	BREAK
			; GOTO 換装3
		; LOOP 1
	CASE 2
		;$換装2
		FOR LOCAL, 1, 23
			TEMP_CLOTHES:C_ID:LOCAL = EQUIP:C_ID:LOCAL
		NEXT
		; DO
		; 	;#;PRINTFORML CFLAG:C_ID:衣装一時変更{CFLAG:C_ID:衣装一時変更}
		; 	CALL SHOW_CLOTHES(C_ID, "現在的衣装")
		; 	PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的现在穿的衣服设定中
		; 	PRINTFORML 
		; 	;PRINTFORML [4] - 把衣服换成服装
		; 	PRINTFORML [3] - 穿设定好的套装
		; 	PRINTFORML [2] - 穿和特定角色同款的衣服
		; 	PRINTFORML [1] - 回到今天的默认
		; 	PRINTFORML 
		; 	PRINTFORML [0] - 放棄
		; 	INPUT
		; 	SELECTCASE RESULT
		; 	CASE 4
		; 		IF !CFLAG:C_ID:套装
		; 			CLEARLINE LINECOUNT - LINESTART2
		; 			;GOTO 換装2
		; 		ENDIF
		; 		CALL DECIDE_CLOTHES(C_ID, "現在的衣装", "套装")
		; 	CASE 3
		; 		CALL COSPLAY_SET(C_ID, "現在的衣装")
		; 	CASE 2
		; 		CALL COSPLAY_CHARA(C_ID, "現在的衣装")
		; 	CASE 1
		; 		PRINTFORMW 回到了今日的默认服装
		; 		CALL CTRL_CLOTHES_SET(C_ID, "現在衣装の変更_便装")
		; 	CASE 0
		; 	CASEELSE
		; 		CLEARLINE LINECOUNT - LINESTART2
		; 		CONTINUE
		; 	ENDSELECT
		; 	BREAK
			;GOTO 換装2
		; LOOP 1
	CASE 1
		;$換装1
		; DO
		; 	PRINTFORML 斟酌%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的胖次中
		; 	PRINTFORML   現在穿著的胖次：%GET_STR(C_ID, "下半身内衣_ずらし可能", EQUIP:C_ID:下半身内衣２, "名前")%
		; 	SELECTCASE CFLAG:C_ID:指定胖次
		; 	CASE 0
		; 		PRINTFORML 　現在的胖次設定：无指定
		; 	CASE 100
		; 		PRINTFORML 　現在的胖次設定：指定不穿
		; 	CASEELSE
		; 		PRINTFORML 　現在的胖次設定：%GET_STR(C_ID, "下半身内衣_ずらし可能", CFLAG:C_ID:指定胖次, "名前")%
		; 	ENDSELECT
		; 	PRINTFORML 
		; 	PRINTFORML 
		; 	SIF C_ID == MASTER
		; 		PRINTFORML [3] - 着用中の胖次を脱掉
		; 	PRINTFORML [2] - 现在的内裤设定为喜欢的胖次
		; 	PRINTFORML [1] - 解除喜欢的胖次
		; 	PRINTFORML 
		; 	PRINTFORML [0] - 放棄
		; 	INPUT
		; 	SELECTCASE RESULT
		; 	CASE 3
		; 		PRINTFORMW 現在着用している胖次を脱ぎました
		; 		EQUIP:C_ID:下半身内衣２ = 100
		; 	CASE 2
		; 		PRINTFORMW 指定喜欢的胖次
		; 		CFLAG:C_ID:指定胖次 = EQUIP:C_ID:下半身内衣２
		; 		SIF !CFLAG:C_ID:指定胖次
		; 			CFLAG:C_ID:指定胖次 = 100
		; 	CASE 1
		; 		PRINTFORMW 解除喜欢的胖次了
		; 		CFLAG:C_ID:指定胖次 = 0
		; 	CASE 0
		; 	CASEELSE
		; 		CLEARLINE LINECOUNT - LINESTART2
		; 		CONTINUE
		; 	ENDSELECT
		; 	BREAK
		; 	;GOTO 換装1
		; LOOP 1
		IF C_ID != MASTER
			PRINTFORML 要指定的胖次是日常的还是睡衣的呢？
			CALL ASK_M("日常", 1, "睡衣", 1)
			内裤指定类型 = RESULT
		ENDIF
		部位选择 = 6
		IF !内裤指定类型
			TEMP_CLOTHES:C_ID:6 = CFLAG:C_ID:指定胖次
		ELSE
			TEMP_CLOTHES:C_ID:6 = CFLAG:C_ID:睡衣胖次
		ENDIF
	CASE 0
		CLEARLINE LINECOUNT - LINESTART
		REDRAW REDRAW_RECORD
		RETURN
	CASEELSE
	ENDSELECT
	IF GROUPMATCH(换装选择, 2, 3, 4) && C_ID != MASTER
		FOR LOCAL, 1, 25
			SIF	GROUPMATCH(EQUIPNAME:LOCAL, "下身衣服", "上半身内衣１","上半身内衣２", "下半身内衣１","下半身内衣２")
				部位选择屏蔽:LOCAL = 1
		NEXT
	ELSEIF GROUPMATCH(换装选择, 2, 3, 4) && C_ID == MASTER
		FOR LOCAL, 1, 25
			SIF	GROUPMATCH(EQUIPNAME:LOCAL, "下身衣服","上半身内衣２", "下半身内衣１")
				部位选择屏蔽:LOCAL = 1
		NEXT
	ELSEIF GROUPMATCH(换装选择, 1)
		FOR LOCAL, 1, 25
			SIF	!GROUPMATCH(EQUIPNAME:LOCAL, "下半身内衣２")
				部位选择屏蔽:LOCAL = 1
		NEXT
	ENDIF
	DO
		CLEARLINE LINECOUNT - LINESTART2
		DRAWLINE
		IF 换装选择 != 1
			PRINTFORML 设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的\@ 换装选择 == 4 ? 睡衣 # 衣服\@中
			CALL SHOW_CLOTHES(C_ID, "暂存状态")
		ELSEIF 换装选择 == 1
			PRINTFORML 指定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的胖次中
			IF !内裤指定类型
				SELECTCASE TEMP_CLOTHES:C_ID:6
				CASE 0
					PRINTFORML 　日常胖次指定：无指定
				CASE 100
					PRINTFORML 　日常胖次指定：指定不穿
				CASEELSE
					PRINTFORML 　日常胖次指定：%GET_STR(C_ID, "下半身内衣_ずらし可能", TEMP_CLOTHES:C_ID:6, "名前")%
				ENDSELECT
			ELSE
				SELECTCASE TEMP_CLOTHES:C_ID:6
				CASE 0
					PRINTFORML 　睡衣胖次指定：无指定
				CASE 100
					PRINTFORML 　睡衣胖次指定：指定不穿
				CASEELSE
					PRINTFORML 　睡衣胖次指定：%GET_STR(C_ID, "下半身内衣_ずらし可能", TEMP_CLOTHES:C_ID:6, "名前")%
				ENDSELECT
			ENDIF
		ENDIF
		DRAWLINE
		SIF GROUPMATCH(换装选择, 1, 3, 4)
			PRINTFORML [{-1, 2}] - 重置先前的默认设定
		IF	GROUPMATCH(换装选择, 2, 3, 4)
			PRINTFORML [{-2, 2}] - 将目前的配装保存为自设套装
			PRINTFORML [{-3, 2}] - 删除一套自设套装
		ENDIF
		DRAWLINE
		FOR LOCAL:1, 1, 25
			SIF (INRANGE(LOCAL:1, 1, 22) && 部位选择屏蔽:(FINDELEMENT(EQUIPNAME, 表示部位:(LOCAL:1))) == 1) || (!INRANGE(LOCAL:1, 1, 22) && 部位选择屏蔽:(LOCAL:1) == 1)
				CONTINUE
			IF LOCAL:1 == 23
				部位名称 = 预设套装
			ELSEIF LOCAL:1 == 24
				部位名称 = 自设套装
			ELSE
				部位名称 = %表示ラベル:(LOCAL:1)%
			ENDIF
			IF (INRANGE(LOCAL:1, 1, 22) && EQUIPNAME:部位选择 == 表示部位:(LOCAL:1)) || (!INRANGE(LOCAL:1, 1, 22) && 部位选择 == LOCAL:1)
				SETCOLOR C_AQUA
				PRINTBUTTONLC @"[%部位名称%]" ,INRANGE(LOCAL:1, 1, 22) ? FINDELEMENT(EQUIPNAME, 表示部位:(LOCAL:1)) + 100 # LOCAL:1 + 100
				RESETCOLOR
			ELSE
				PRINTBUTTONLC @"[%部位名称%]" ,INRANGE(LOCAL:1, 1, 22) ? FINDELEMENT(EQUIPNAME, 表示部位:(LOCAL:1)) + 100 # LOCAL:1 + 100
			ENDIF
		NEXT
		PRINTL
		DRAWLINE
		CALL 衣服选择列表(部位选择, C_ID, PAGE, 部位选择屏蔽)
		PRINTFORML [{0,2}]完成并退出
		INPUT
		SELECTCASE RESULT
			CASE IS > 1000
				IF RESULT == 1001
					PAGE --
				ELSEIF RESULT == 1002
					PAGE ++
				ENDIF
			CASE IS > 100
				部位选择 = RESULT - 100
				PAGE = 0
				SIF 换装选择 == 1
					部位选择 = 6
			CASE 100
				IF !GROUPMATCH(部位选择, 1, 23, 24)
					TEMP_CLOTHES:C_ID:部位选择 = 0
				ELSEIF 换装选择 == 1
					TEMP_CLOTHES:C_ID:部位选择 = 100
				ELSE
					VARSET TEMP_CLOTHES
				ENDIF
			CASE IS > 0
				IF 部位选择 == 23
					IF STRLENS(GET_STR(C_ID, "衣装セット", RESULT, "名前"))
						FOR LOCAL:2, 1, 23
							TEMP_CLOTHES:C_ID:(LOCAL:2) = GET_INT(C_ID, "衣装セット", RESULT, EQUIPNAME:(LOCAL:2))
						NEXT
					ENDIF
				ELSEIF 部位选择 == 24
					IF 自设套装:RESULT:0
						FOR LOCAL:2, 1, 23
							TEMP_CLOTHES:C_ID:(LOCAL:2) = 自设套装:RESULT:(LOCAL:2)
						NEXT
					ENDIF
				ELSE
					SIF STRLENS(GET_STR(C_ID, CLOTHES_PARTS_TO_CATEGORY(EQUIPNAME:部位选择), RESULT, "名前"))
						TEMP_CLOTHES:C_ID:部位选择 = RESULT
				ENDIF
			CASE -1
				IF 换装选择 == 4
					CFLAG:C_ID:睡衣指定 = 0
				ELSEIF 换装选择 == 3
					CFLAG:C_ID:基本服装セット = 0
				ELSEIF 换装选择 == 1
					TEMP_CLOTHES:C_ID:6 = 0
				ENDIF
			CASE -2
				LINESTART3 = LINECOUNT
				IF GROUPMATCH(换装选择, 2, 3, 4)
					DO
						CLEARLINE LINECOUNT - LINESTART3
						PRINTFORML 请选择保存栏位
						CALL 衣服选择列表(24, C_ID, PAGE, 部位选择屏蔽)
						PRINTFORML [{0,2}]取消
						INPUT
						自设套装栏位选择 = RESULT
						SELECTCASE 自设套装栏位选择
							CASE IS > 1000
								IF 自设套装栏位选择 == 1001
									PAGE --
								ELSEIF 自设套装栏位选择 == 1002
									PAGE ++
								ENDIF
							CASE IS > 0
								IF 自设套装:自设套装栏位选择:0
									PRINTFORML 此栏位已存在套装，要替换吗？
									CALL ASK_YN
									IF !RESULT
										FOR	LOCAL:3, 1, 23
											自设套装:自设套装栏位选择:(LOCAL:3) = TEMP_CLOTHES:C_ID:(LOCAL:3)
										NEXT
										自设套装:自设套装栏位选择:0 = 1
										PRINTFORML 要给目前的自设套装取名吗？
										CALL ASK_YN
										IF !RESULT
											PRINTFORML 请输入名字
											INPUTS
											自设套装名称:自设套装栏位选择 = %RESULTS%
										ELSE
											自设套装名称:自设套装栏位选择 '= @"自设套装{RESULT}"
										ENDIF
									ENDIF
									BREAK
								ELSE
									FOR	LOCAL:3, 1, 23
										自设套装:自设套装栏位选择:(LOCAL:3) = TEMP_CLOTHES:C_ID:(LOCAL:3)
									NEXT
									自设套装:自设套装栏位选择:0 = 1
									PRINTFORML 要给目前的自设套装取名吗？
									CALL ASK_YN
									IF !RESULT
										PRINTFORML 请输入名字
										INPUTS
										自设套装名称:自设套装栏位选择 = %RESULTS%
									ELSE
										自设套装名称:自设套装栏位选择 '= @"自设套装{RESULT}"
									ENDIF
									BREAK
								ENDIF
							CASE 0
								BREAK
						ENDSELECT
					LOOP 1
				ENDIF
			CASE -3
				LINESTART3 = LINECOUNT
				IF GROUPMATCH(换装选择, 2, 3, 4)
					DO
						CLEARLINE LINECOUNT - LINESTART3
						PRINTFORML 请选择要删除的栏位
						CALL 衣服选择列表(24, C_ID, PAGE, 部位选择屏蔽)
						PRINTFORML [{0,2}]取消
						INPUT
						自设套装栏位选择 = RESULT
						SELECTCASE 自设套装栏位选择
							CASE IS > 1000
								IF 自设套装栏位选择 == 1001
									PAGE --
								ELSEIF 自设套装栏位选择 == 1002
									PAGE ++
								ENDIF
							CASE IS > 0
								IF 自设套装:自设套装栏位选择:0
									PRINTFORML 确认删除此栏位的套装吗？
									CALL ASK_YN
									IF !RESULT
										VARSET 自设套装:自设套装栏位选择:0
										自设套装名称:自设套装栏位选择 =
									ENDIF
									BREAK
								ENDIF
							CASE 0
								BREAK
						ENDSELECT
					LOOP 1
				ENDIF
			CASE 0
				IF 换装选择 == 4
					FOR LOCAL:3, 1, 23
						IF CFLAG:C_ID:(240 + LOCAL:3) != TEMP_CLOTHES:C_ID:(LOCAL:3)
							PRINTFORML 确定要这样设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的睡衣吗？
							PRINTFORML （注意：睡衣仅在角色睡眠时自动切换，当前换衣可能不会立刻起效）
							CALL ASK_YN
							IF !RESULT
								FOR LOCAL:4, 1, 23
									CFLAG:C_ID:(240 + LOCAL:4) = TEMP_CLOTHES:C_ID:(LOCAL:4)
								NEXT
								CFLAG:C_ID:睡衣指定 = 1000
							ENDIF
							BREAK
						ENDIF
					NEXT
				ELSEIF 换装选择 == 3
					FOR LOCAL:3, 1, 23
						IF CFLAG:C_ID:(200 + LOCAL:3) != TEMP_CLOTHES:C_ID:(LOCAL:3)
							PRINTFORML 确定要这样设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的默认日常服装吗？
							PRINTFORML （注意：默认日常服装为部分情况下角色衣服还原时的选项，当前可换衣可能不会立刻起效）
							CALL ASK_YN
							IF !RESULT
								FOR LOCAL:4, 1, 23
									CFLAG:C_ID:(200 + LOCAL:4) = TEMP_CLOTHES:C_ID:(LOCAL:4)
								NEXT
								CFLAG:C_ID:基本服装セット = 1000
							ENDIF
							BREAK
						ENDIF
					NEXT
				ELSEIF 换装选择 == 2
					FOR LOCAL:3, 1, 23
						IF EQUIP:C_ID:(LOCAL:3) != TEMP_CLOTHES:C_ID:(LOCAL:3)
							PRINTFORML 确定要这样设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%目前的服装吗？
							CALL ASK_YN
							IF !RESULT
								FOR LOCAL:4, 1, 23
									EQUIP:C_ID:(LOCAL:4) = TEMP_CLOTHES:C_ID:(LOCAL:4)
									CFLAG:C_ID:(600 + LOCAL:4) = EQUIP:C_ID:(LOCAL:4)
								NEXT
								CFLAG:C_ID:衣装一時変更 = 100
							ENDIF
							BREAK
						ENDIF
					NEXT
				ELSEIF 换装选择 == 1
					IF !内裤指定类型
						IF CFLAG:C_ID:指定胖次 != TEMP_CLOTHES:C_ID:6
							PRINTFORML 确定要这样设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的日常胖次吗？
							CALL ASK_YN
							IF !RESULT
								CFLAG:C_ID:指定胖次 = TEMP_CLOTHES:C_ID:6
							ENDIF
						ENDIF
					ELSEIF 内裤指定类型 == 1
						IF CFLAG:C_ID:睡衣胖次 != TEMP_CLOTHES:C_ID:6
							PRINTFORML 确定要这样设定%NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的睡衣胖次吗？
							CALL ASK_YN
							IF !RESULT
								CFLAG:C_ID:睡衣胖次 = TEMP_CLOTHES:C_ID:6
							ENDIF
						ENDIF
					ENDIF
				ENDIF
				SIF CFLAG:C_ID:没穿内裤 && EQUIP:C_ID:下半身内衣２
					EQUIP:C_ID:下半身内衣２ = 0
				VARSET TEMP_CLOTHES
				VARSET 部位选择屏蔽
				BREAK
			CASEELSE
			ENDSELECT
		CONTINUE
	LOOP 1
	CLEARLINE LINECOUNT - LINESTART
LOOP 1



;模倣させる対象角色の選択
@COSPLAY_CHARA(C_ID, TYPE)
#DIM  C_ID
#DIMS TYPE
#DIM  COS_CHARA
PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的%TYPE%设定中
PRINTFORML 和谁同款呢？
CALL SHOW_CHARA_LIST("可以穿同款衣服的角色列表", "体力気力")
COS_CHARA = RESULT
IF GROUPMATCH(COS_CHARA, 0, 999)
	PRINTFORMW 服装的设定中断了
	RETURN
ELSEIF COS_CHARA == C_ID
	SELECTCASE TYPE
	CASE "套装"
		PRINTFORMW 服装的设定中断了
	CASE "便装"
		PRINTFORMW 今日の衣装的设定交给本人了
		CFLAG:C_ID:基本服装セット = 0
	CASE "現在的衣装"
		PRINTFORMW 把今天的服装改了
		CALL CTRL_CLOTHES_SET(C_ID, "現在衣装の変更_便装")
	ENDSELECT
	RETURN
ENDIF
CALL DECIDE_CLOTHES(C_ID, TYPE, "角色便装", COS_CHARA)
SIF RESULT
	RESTART


;衣装セットのカテゴリ選択
@COSPLAY_SET(C_ID, TYPE)
#DIM  C_ID
#DIM  SET_ID
#DIMS TYPE
#DIMS CATEGORY
CALL SHOW_CLOTHES(C_ID, TYPE)
PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的%TYPE%设定中
PRINTFORML 服装的种类选择
PRINTFORML 
PRINTFORML [3] - 基本套装
PRINTFORML [2] - cosplay服装
PRINTFORML [1] - 角色特殊服装集
PRINTFORML 
PRINTFORML [0] - 放棄
DO
	INPUT
	SELECTCASE RESULT
	CASE 3
		CATEGORY '= "基本套装"
	CASE 2
		CATEGORY '= "cosplay服装"
	CASE 1
		CATEGORY '= "角色特殊服装集"
	CASE 0
		RETURN
	CASEELSE
		REUSELASTLINE 無效輸入
		CONTINUE
	ENDSELECT
	BREAK
LOOP 1 
CALL COSPLAY_SELECT(C_ID, TYPE, CATEGORY)
SIF !RESULT
	RESTART


;個々の衣装セットの選択
@COSPLAY_SELECT(C_ID, TYPE, CATEGORY)
#DIM  C_ID
#DIM  SET_ID
#DIMS TYPE
#DIMS CATEGORY
PRINTFORML %NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的%TYPE%设定中（%CATEGORY%）
PRINTFORML 选择使用的服装套装
PRINTFORML 
CALL CLASS_LIST("衣装セット", CATEGORY)
PRINTFORML 
PRINTFORML [0] - 放棄
DO
	INPUT
	SET_ID = RESULT
	SELECTCASE SET_ID
	CASE 0
		RETURN
	CASEELSE
		SIF GET_INT(0, "衣装セット" , SET_ID, CATEGORY)
			BREAK
		REUSELASTLINE 無效輸入
		CONTINUE
	ENDSELECT
LOOP 1 
CALL DECIDE_CLOTHES(C_ID, TYPE, "衣装セット", SET_ID)
SIF RESULT
	RESTART



;衣装決定の最終確認
@DECIDE_CLOTHES(C_ID, COS_SAVE, COS_LOAD, SET_ID)
#DIM  C_ID     ;設定する角色
#DIMS COS_SAVE ;衣装の保存先
#DIMS COS_LOAD ;衣装の参照元
#DIM  SET_ID   ;参照衣装等のID
;#; PRINTFORML C_ID{C_ID}, COS_SAVE%COS_SAVE%, COS_LOAD%COS_LOAD%, SET_ID{SET_ID}
PRINTFORMW 最終確認
CALL SHOW_CLOTHES(C_ID, COS_LOAD, SET_ID)
PRINTFORML 
PRINTFORML 这套服装可以麼？
PRINTFORML 
PRINTFORML [1] - 決定
PRINTFORML [0] - 再考虑考虑
PRINTFORML 
PRINTFORML [9] - 放棄
DO
	INPUT
	SELECTCASE RESULT
	CASE 1
		BREAK
	CASE 0
		RETURN 1
	CASE 9
		RETURN
	CASEELSE
		REUSELASTLINE 無效輸入
		CONTINUE
	ENDSELECT
LOOP 1


SELECTCASE COS_LOAD
CASE "現在的衣装"
	SELECTCASE COS_SAVE
	CASE "便装"
		PRINTFORMW 现在穿的服装以后每天都会穿了
		CFLAG:C_ID:基本服装セット = 100
		CALL CTRL_CLOTHES_SET(C_ID, "現在衣装の保存_おきにいり")
	CASE "套装"
		PRINTFORMW 现在穿的衣服放进指定了
		CALL CTRL_CLOTHES_SET(C_ID, "現在衣装の保存_おきにいり")
	ENDSELECT
	
CASE "衣装セット"
	PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%的%COS_SAVE%指定為%GET_STR(C_ID, "衣装セット", SET_ID, "名前")%
	SELECTCASE COS_SAVE
	CASE "現在的衣装"
		CALL CTRL_CLOTHES_SET(C_ID, "現在衣装の変更_衣装セット", SET_ID)
	CASE "便装"
		CALL CTRL_CLOTHES_SET(C_ID, "便装の変更_衣装セット", SET_ID)
	CASE "套装"
		CALL CTRL_CLOTHES_SET(C_ID, "套装の変更_衣装セット", SET_ID)
	CASE "睡衣"
		CALL CTRL_CLOTHES_SET(C_ID, "睡衣的变更_衣装セット", SET_ID)
	ENDSELECT

CASE "角色便装"
	PRINTFORMW %NAME_OUTPUT_TRANSLATION("CALLNAME", C_ID)%穿上和%NAME_OUTPUT_TRANSLATION("CALLNAME", SET_ID)%同様的衣服了
	SELECTCASE COS_SAVE
	CASE "現在的衣装"
		CALL CTRL_CLOTHES_SET(C_ID, "現在衣装の変更_角色衣装", SET_ID, "便装")
	CASE "便装"
		CALL CTRL_CLOTHES_SET(C_ID, "便装の変更_角色衣装", SET_ID, "便装")
	CASE "套装"
		CALL CTRL_CLOTHES_SET(C_ID, "套装の変更_角色衣装", SET_ID, "便装")
	ENDSELECT

ENDSELECT



;換装
@COM_ABLE429
;移動実行判定
SIF !TFLAG:100
	RETURN 0
;一括管理
SIF GLOBAL_COMABLE(429)
	RETURN RESULT
;私室設定
SIF (CFLAG:MASTER:現在位置 != CFLAG:MASTER:311) && (CFLAG:現在位置 != CFLAG:311)
	RETURN 0
SIF !GETBIT(CFLAG:TARGET:既成事實, 1) && TARGET
	RETURN 0
SIF CFLAG:诶嘿嘿
	RETURN 0
RETURN 1
