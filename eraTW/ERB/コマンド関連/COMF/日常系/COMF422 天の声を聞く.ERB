;-------------------------------------------------
;聆聽天之聲
;日常系指令、レベル1
;-------------------------------------------------
@COM422
PRINTL [0] - 想找人
PRINTL [1] - 想做掃除
PRINTL [2] - 想找住在外面的人
PRINTL [3] - ランキング
;SIF STALKED
;	PRINTFORML [3] - 【追踪】対象変更（現在的対象：%NAME_OUTPUT_TRANSLATION("CALLNAME", STALKED)%）
PRINTL [100] - 返回
INPUT
IF RESULT == 0
	CALL HITOSAGASI()
ELSEIF RESULT == 1
	CALL OHEYA_CHECK
ELSEIF RESULT == 2
	CALL BROAD_HITOSAGASI
	TIME += 3
	RETURN 1
ELSEIF RESULT == 3
	CALL RANKING
	TIME += 3
	RETURN 1
ELSEIF RESULT == 100
	RETURN -1
ENDIF
INPUTS
RESULT = TOINT(RESULTS)
IF RESULT == 0
	REPLACE RESULTS, CALLNAME:MASTER, "%CALLNAME:MASTER%"
	FOR LOCAL, 1, 19
		SIF STR:LOCAL == RESULTS
			RESULT = LOCAL
	NEXT
ENDIF

IF (RESULT >= 26 && RESULT <= 35) && ABL:MASTER:教養 < 1 && !INRANGE(CFLAG:MASTER:初期位置,26,35)
	PRINTFORMW 不熟悉的%NAME_OUTPUT_TRANSLATION("CALLNAME", MASTER)%没有找到…
ELSE
	IF IN_HOME(RESULT) == 1
		SIF AT_HOME(MASTER) == 0
			GOTO MURIDESU
		CALL SKIP_MOVE(CFLAG:MASTER:現在位置, RESULT)
	ENDIF
ENDIF

SIF SKYSOUND == 0
	TIME += 10
RETURN 1
$MURIDESU
PRINTW 到这就不能再前进了…
TIME += 10
RETURN 1

@BROAD_HITOSAGASI
$KAKUNIN
FOR LOCAL,0,11
	SIF LOCAL == MAIN_MAP
		CONTINUE
	LOCAL:1 = 5000 + LOCAL
	PRINTFORMLC [{LOCAL}] - %STR:(LOCAL:1)%
	CALL 広域チェック(LOCAL,1)
	CALL 広域チェック(LOCAL,2)
	PRINTL
NEXT
DRAWLINE
PRINT [100] - 確認終了
$INPUT_LOOP
INPUT
IF RESULT == 100 || RESULT == MAIN_MAP
	RETURN -1
ELSEIF RESULT < 0
	CLEARLINE 1
	GOTO INPUT_LOOP
ELSEIF RESULT >= 11
	PRINTW 未作成です
	CLEARLINE 2
	GOTO INPUT_LOOP
ENDIF
CALL 広域チェック(RESULT,2)
CALL ASK_YN("看看其他地方","確認終了")
SIF !RESULT
	GOTO KAKUNIN

@広域チェック(ARG,ARG:1)
VARSET LOCAL

FOR LOCAL,1,CHARANUM
	SIF AT_HOME(LOCAL) == 1
		CONTINUE
	SIF CFLAG:LOCAL:現在位置 == MAXROOM && CFLAG:LOCAL:睡眠
		CONTINUE
	FOR LOCAL:1,10,100,10
		IF CFLAG:LOCAL:現在位置 == ARG * 100 + LOCAL:1
			;その地域にいる角色を表示
			IF ARG:1 == 2
				SIF CFLAG:LOCAL:行動 == 5
					SETCOLOR 255, 100, 0
				PRINTFORM %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL)% 
				RESETCOLOR
			ENDIF
			LOCAL:2 ++
		ENDIF
	NEXT
NEXT
;その地域にいる人数
IF ARG:1 == 1
	IF LOCAL:2
		PRINTFORML {LOCAL:2}人
	ELSE
		PRINTL 誰也不在
	ENDIF
ENDIF
@RANKING
PRINTL [0] - 子供数
PRINTL [1] - 膣内射精数
PRINTL [2] - 肛内射精数
PRINTL [3] - 精飲数
PRINTL [4] - ぶっかけ数
PRINTL [5] - 絶頂経験
PRINTL [6] - 噴乳経験
PRINTL [7] - 自慰経験
PRINTL [8] - デート経験
PRINTL [9] - キス経験

PRINTL [100] - 戻る
INPUT
IF RESULT>=0 && RESULT<10
	CALL ランキング表示(RESULT)
	RETURN -1
ELSEIF RESULT == 100
	RETURN -1
ENDIF

@ランキング表示(ARG)
#DIM RANK
#DIM ra
#DIM ranum
#DIM flagnum
#DIM kind
VARSET LOCAL

;キャラ数だけLOCALの配列を準備
;すべて1に設定しておく
FOR RANK,1,CHARANUM
	LOCAL:RANK = 1
NEXT


;flagnum:フラグナンバーを管理
;kind:フラグ種類を管理（EXPかCFLAGか）
IF ARG==0
	PRINTL 子供数
	kind = 0
	flagnum=912
ELSEIF ARG == 1
	PRINTL 膣内射精数
	kind = 1
	flagnum=515
ELSEIF ARG == 2
	PRINTL 肛内射精数
	kind = 1
	flagnum=516
ELSEIF ARG == 3
	PRINTL 精飲数
	kind = 1
	flagnum=517
ELSEIF ARG == 4
	PRINTL 精浴数
	kind = 1
	flagnum=518
ELSEIF ARG == 5
	PRINTL 絶頂経験
	kind = 2
	flagnum=10
ELSEIF ARG == 6
	PRINTL 噴乳経験
	kind = 2
	flagnum=12
ELSEIF ARG == 7
	PRINTL 自慰経験
	kind = 2
	flagnum=22
ELSEIF ARG == 8
	PRINTL 约会経験
	kind = 2
	flagnum=77
ELSEIF ARG == 9
	PRINTL 亲吻経験
	kind = 2
	flagnum=27
ENDIF


;kind毎に分岐（内容はほぼ一緒）
IF kind == 0
	;他キャラと項目数の比較
	;もし負けていた場合はLOCALフラグをプラス1
	;最終的にLOCALフラグの数値が、全体の中での順位となる
	;例:LOCALフラグが1の場合、誰にも負けてない＝ランキング1位！
	;例:LOCALフラグが3の場合、二人に負けている＝ランキング3位
	FOR RANK,1,CHARANUM
		FOR ra,1,CHARANUM
			IF CFLAG:RANK:flagnum < CFLAG:ra:flagnum
				LOCAL:RANK ++
			ENDIF
		NEXT
	NEXT

	PRINTL -------------
	PRINTFORM %CALLNAME:0% 
	PRINTFORML {CFLAG:0:flagnum}人
	PRINTL ----
	
	;LOCALフラグの数値毎に表示
	;順位と名前を表示
	;同値のキャラはタイとする
	FOR ranum,1,21
		FOR RANK,1,CHARANUM
			IF LOCAL:RANK==ranum
				;項目が0の場合ランク付け終了
				IF CFLAG:(RANK):flagnum == 0
					BREAK
				ENDIF
				IF ranum <= 3
					CALL PRINT_FACE, RANK, "笑顔", "服", "", ""
					PRINTL
				ENDIF
				PRINTFORM {ranum}位  
				PRINTFORML {CFLAG:(RANK):flagnum}人
				FOR ra,1,CHARANUM
					IF LOCAL:ra == ranum
						PRINTFORM %CALLNAME:(ra)% 
					ENDIF
				NEXT
				SIF ranum == 3
					WAIT
				PRINTL
				BREAK
			ENDIF
		NEXT
	NEXT
	PRINTL -------------
ELSEIF kind == 1
	FOR RANK,1,CHARANUM
		FOR ra,1,CHARANUM
			IF CFLAG:RANK:flagnum < CFLAG:ra:flagnum
				LOCAL:RANK ++
			ENDIF
		NEXT
	NEXT

	PRINTL -------------
	FOR ranum,1,21
		FOR RANK,1,CHARANUM
			IF LOCAL:RANK==ranum
				IF CFLAG:(RANK):flagnum == 0
					BREAK
				ENDIF
				PRINTFORM {ranum}位  
				PRINTFORML {CFLAG:(RANK):flagnum}
				IF ranum <= 3
					CALL PRINT_FACE, RANK, "笑顔", "服", "", ""
					PRINTL
				ENDIF
				FOR ra,1,CHARANUM
					IF LOCAL:ra == ranum
						PRINTFORM %CALLNAME:(ra)% 
					ENDIF
				NEXT
				SIF ranum == 3
					WAIT
				PRINTL
				BREAK
			ENDIF
		NEXT
	NEXT
	PRINTL -------------
ELSEIF kind == 2
	FOR RANK,1,CHARANUM
		FOR ra,1,CHARANUM
			IF EXP:RANK:flagnum < EXP:ra:flagnum
				LOCAL:RANK ++
			ENDIF
		NEXT
	NEXT

	PRINTL -------------
	FOR ranum,1,21
		FOR RANK,1,CHARANUM
			IF LOCAL:RANK==ranum
				IF EXP:(RANK):flagnum == 0
					BREAK
				ENDIF
				PRINTFORM {ranum}位  
				PRINTFORML {EXP:(RANK):flagnum}回
				IF ranum <= 3
					CALL PRINT_FACE, RANK, "笑顔", "服", "", ""
					PRINTL
				ENDIF
				FOR ra,1,CHARANUM
					IF LOCAL:ra == ranum
						PRINTFORM %CALLNAME:(ra)% 
					ENDIF
				NEXT
				SIF ranum == 3
					WAIT
				PRINTL
				BREAK
			ENDIF
		NEXT
	NEXT
	PRINTL -------------
ENDIF

;聆聽天之聲
@COM_ABLE422
;停止中は不可
SIF FLAG:70 == 1
	RETURN 0
;実行判定
SIF !TFLAG:100
	RETURN 0
;一括管理
SIF GLOBAL_COMABLE(421)
	RETURN RESULT
;賽銭箱
SIF !天之声可(CFLAG:MASTER:現在位置)
	RETURN 0
SIF CFLAG:诶嘿嘿 == 2
	RETURN 0
RETURN 1