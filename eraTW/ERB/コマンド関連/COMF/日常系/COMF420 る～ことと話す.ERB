;-------------------------------------------------
;和留琴対話
;日常系指令、レベル1
;-------------------------------------------------
@COM420
PRINTL 「你有什么事吗？」
PRINTL [0] - 想找人
PRINTL [1] - 想做掃除
PRINTL [2] - 关于git控制系统
PRINTL [100] - 返回
INPUT
IF RESULT == 0
	PRINTL 「要寻找誰呢？」
	CALL HITOSAGASI()
ELSEIF RESULT == 1
CALL OHEYA_CHECK
ELSEIF RESULT == 2
	PRINTDATA
		DATAFORM 「使用git控制系统的话可以将补丁一次性整合起来哦」
		DATAFORM 「有git控制系统就可以很简单的把握变更的地方」
		DATAFORM 「過去的代码也能很好的得到保存」
	ENDDATA
	PRINTW 好像很厉害的様子
	RETURN -1
ELSEIF RESULT == 100
	RETURN -1
ELSE
	RETURN -1
ENDIF
INPUTS
RESULT = TOINT(RESULTS)
IF RESULT == 0
	REPLACE RESULTS, CALLNAME:MASTER, "%CALLNAME:MASTER%"
	FOR LOCAL, 1, 19
		SIF STR:LOCAL == RESULTS
			RESULT = LOCAL
	NEXT
ENDIF
SIF RESULT == 0
	RETURN -1
SIF IN_HOME(RESULT) == 1
	CALL SKIP_MOVE(CFLAG:MASTER:現在位置, RESULT)
RETURN -1

@OHEYA_CHECK
VARSET LOCAL
FOR LOCAL, MINROOM(), MAXROOM
	LOCALS = %NAME_FROM_PLACE(LOCAL)%
	SIF LOCALS == ""
		CONTINUE
	SIF CFLAG:MASTER:現在位置 == LOCAL
		SETCOLOR C_GREEN
;	PRINTBUTTON "["+LOCALS+"]", LOCAL
;	RESETCOLOR
;	PRINTFORM %" "*(22-STRLENS(LOCALS))%
	PRINTFORM [{LOCAL, 3}]%LOCALS, 24, LEFT%
	LOCALS = %SEIKETU(LOCAL), 15, RIGHT%
	PRINTFORM %LOCALS%　　
	RESETCOLOR
	LOCAL:1 ++
	SIF LOCAL:1 % 2 == 0
		PRINTL
NEXT
PRINTFORML 
DRAWLINE
PRINTFORML [0] 返回
;PRINTBUTTON "[確認終了]", 0

@SEIKETU(ARG)
#FUNCTIONS
IF OUTROOF(ARG) && DAY:2 == 4
	SELECTCASE YOGORE:ARG
		CASE IS < 100
			SETCOLOR C_GREEN
			RETURNF "積雪量:干净"
		CASE IS < 500
			SETCOLOR C_M_GREEN
			RETURNF "積雪量:小"
		CASE IS < 1000
			SETCOLOR C_P_GREEN
			RETURNF "積雪量:較小"
		CASE IS < 2000
			SETCOLOR 0xFFFFFF
			RETURNF "積雪量:中"
		CASE IS < 3500
			SETCOLOR 0xFFFFFF
			RETURNF "積雪量:較大"
		CASE IS < 5000
			SETCOLOR 0xFFFFFF
			RETURNF "積雪量:大"
		CASEELSE
			SETCOLOR 0xFFFFFF
			RETURNF "積雪量:雪山"
	ENDSELECT
ELSE
	SELECTCASE YOGORE:ARG
		CASE IS < 100
			SETCOLOR C_GREEN
			RETURNF "清潔度:最高"
		CASE IS < 500
			SETCOLOR C_M_GREEN
			RETURNF "清潔度:高"
		CASE IS < 1000
			SETCOLOR C_P_GREEN
			RETURNF "清潔度:較高"
		CASE IS < 2000
			SETCOLOR C_YELLOW
			RETURNF "清潔度:中"
		CASE IS < 3500
			SETCOLOR C_V_PINK
			RETURNF "清潔度:較低"
		CASE IS < 5000
			SETCOLOR C_RED
			RETURNF "清潔度:低"
		CASEELSE
			SETCOLOR C_RED
			RETURNF "清潔度:垃圾山"
	ENDSELECT
ENDIF

@HITOSAGASI(ARG)
CALL HITOSAGASI_2(1)
CALL HITOSAGASI_2(2)
PRINTFORML [0] 返回
;PRINTBUTTON "[確認終了]", 0

;ARG=何回目の表示か(1or2)
@HITOSAGASI_2(ARG)
SIF FLAG:並び替え
	CALL CHARASORT_EX
FOR LOCAL:1, 1, EX_CHARANUM
	IF FLAG:並び替え
		LOCAL = RESULT:(LOCAL:1)
		SIF LOCAL < 0
			CONTINUE
	ELSE
		LOCAL = LOCAL:1
		SIF LOCAL >= CHARANUM
			BREAK
	ENDIF
	SIF AT_HOME(LOCAL) == 0
		CONTINUE
	SIF CFLAG:LOCAL:現在位置 < MINROOM()
		CONTINUE
	SIF CFLAG:LOCAL:現在位置 == MAXROOM && CFLAG:LOCAL:睡眠
		CONTINUE
	IF ARG == 1
		SIF !CFLAG:LOCAL:神社在住
			CONTINUE
		SETCOLOR C_S_BLUE
	ELSEIF ARG == 2
		SIF CFLAG:LOCAL:神社在住
			CONTINUE
	ENDIF
	PRINTFORM %NAME_OUTPUT_TRANSLATION("CALLNAME", LOCAL),11,Left%
	RESETCOLOR
;xxx
	;名字对齐 主要是 舞 105
	;PRINTFORM 一般{STRLENS(CALLNAME:LOCAL)}
	;PRINTFORM U{STRLENSU(CALLNAME:LOCAL)}
	;PRINTFORM %" "*(12-STRLENS(CALLNAME:LOCAL))%
	;老版本存档 名字 修改成新版 842
	;SIF CALLNAME:105 != CSVCALLNAME(105)
	;	CALLNAME:105 = %CSVCALLNAME(105)%
	;881 修改
	CALLNAME:105 = 舞
	    NAME:105 = 舞
	;SIF LOCAL == 105
	;	PRINTFORM 　
;依頼 CFLAG:403
;   -1　依頼発生直後/ 1　依頼未受託/ 2　依頼中/ 3　依頼達成/ 4　期限切れ/ 5　報告忘れ/ 6　依頼失敗/
;    103 依頼終了（成功）/104 依頼終了（期限切れ）/105 依頼終了（報告忘れ）/106 依頼終了（失敗）

	;逆援交 - 提示 可能做成任务提示？！

IF CFLAG:LOCAL:404 % 100 == 15
	IF CFLAG:LOCAL:403 == 1
		CALL COLORMESSAGE(@"！",C_V_PINK, 0)
	ELSEIF CFLAG:LOCAL:403 == 2
		CALL COLORMESSAGE(@"？",C_V_PINK, 0)
	ELSE
		PRINT 　
	ENDIF
ELSE
	IF CFLAG:LOCAL:403 == 1
		;任务不满 且 能接任务
		IF SEARCH_IRAI_EMPTY() && INT_DATA_IRAI(CFLAG:LOCAL:依頼内容, "依頼受託可能条件", LOCAL)
			CALL COLORMESSAGE(@"！",C_YELLOW, 0)
		ELSEIF INT_DATA_IRAI(CFLAG:LOCAL:依頼内容, "依頼受託可能条件", LOCAL)
			IF !SEARCH_IRAI_EMPTY()
				CALL COLORMESSAGE(@"！",C_GRAY, 0)
			ELSE
				PRINT 　
			ENDIF
		ELSE
			PRINT 　
		ENDIF
	ELSEIF CFLAG:LOCAL:403 == 2
		CALL COLORMESSAGE(@"？",C_GRAY, 0)
	ELSEIF CFLAG:LOCAL:403 == 3
		CALL COLORMESSAGE(@"？",C_YELLOW, 0)
	ELSE
		PRINT 　
	ENDIF
ENDIF

;交互角色
TCVAR:LOCAL:356 = 0
FOR LOCAL:11, 1, COUNT_IRAI_SLOT() + 1

SELECTCASE IRAI_SLOT_TO_TASKNAME(LOCAL:11)
CASE "調達"
	;PRINTFORML 　　要求品：%ITEMNAME:(IRAI_SLOT_TO_ITEM(LOCAL:11))%×{IRAI_SUB:LOCAL:11}
	
CASE "伝令（人物）"
	;PRINTFORML 　目標人物：%NAME_OUTPUT_TRANSLATION("NAME", (IRAI_SLOT_TO_PERSON(LOCAL:11)))%
	SIF IRAI_SLOT_TO_PERSON(LOCAL:11) == LOCAL
		TCVAR:LOCAL:356 ++

CASE "捜索（人物）"
	IF IRAI_EX:(LOCAL:11) == LOCAL
		;PRINTFORML 　参考人物：%NAME_OUTPUT_TRANSLATION("CALLNAME", (IRAI_EX:(LOCAL:11)))%
		TCVAR:LOCAL:356 ++
	ENDIF

CASE "討伐"
	;PRINTFORML 　討伐対象：%NAME_OUTPUT_TRANSLATION("NAME", (IRAI_SLOT_TO_PERSON(LOCAL:11)))%
	SIF IRAI_SLOT_TO_PERSON(LOCAL:11) == LOCAL
		TCVAR:LOCAL:356 ++
ENDSELECT
NEXT
IF TCVAR:LOCAL:356 > 0 && CFLAG:LOCAL:403 == 103
	CALL COLORMESSAGE(@"*",C_GRAY, 0)
ELSEIF TCVAR:LOCAL:356 > 0
	CALL COLORMESSAGE(@"*",C_GREEN, 0)
ELSE
	PRINT  
ENDIF

	IF CFLAG:LOCAL:允许无套 == 2
		SETCOLOR 0xEE60EE
		PRINT ❤
	ELSEIF CFLAG:LOCAL:允许无套 == 1
		SETCOLOR 0xFFFF00
		PRINT ❤
	ELSEIF GETBIT(CFLAG:LOCAL:既成事實,1)
		PRINT ❤
	ELSE
		PRINT 　
	ENDIF
	RESETCOLOR
		IF TALENT:LOCAL:恋人
			SETCOLOR C_RED
			PRINTFORM [恋人]
		ELSEIF TALENT:LOCAL:恋慕 == 1
			SETCOLOR 0xEE60EE
			PRINTFORM [恋慕]
		ELSEIF TALENT:LOCAL:愛欲 == 1
			SETCOLOR 0x2E8B57
			PRINTFORM [愛欲]
		ELSEIF TALENT:LOCAL:炮友 == 2
			SETCOLOR 0xFF6347
			PRINTFORM [愛人]
		ELSEIF TALENT:LOCAL:思慕 == 1
			SETCOLOR 0xFFFF00
			PRINTFORM [思慕]
		ELSEIF TALENT:LOCAL:炮友 == 1
			SETCOLOR 0x7CFC00
			PRINTFORM [炮友]
		ELSE
			PRINTFORM       
		ENDIF
		RESETCOLOR


		IF ESTRUS_CYCLE(LOCAL) == 150
			SETCOLOR C_RED
			PRINTFORM [危険]
		ELSEIF ESTRUS_CYCLE(LOCAL) == 15
			SETCOLOR C_L_GRAY
			PRINTFORM [安全]
		ELSE
			PRINTFORM       
		ENDIF
		RESETCOLOR

;;;(MAXBASE:LOCAL:酒気 / 10) * 4 

		IF TCVAR:LOCAL:烂醉
			SELECTCASE BASE:LOCAL:酒気
				CASE IS >= (MAXBASE:LOCAL:酒気 / 10) * 4
					SETCOLOR C_RED
				CASE IS < (MAXBASE:LOCAL:酒気 / 10) * 4
					SETCOLOR 0x7CFC00
			ENDSELECT
			PRINT 醉
			RESETCOLOR
		ELSE
			SELECTCASE BASE:LOCAL:酒気

				CASE IS >= (MAXBASE:LOCAL:酒気 / 3) * 2
					SETCOLOR 0xFFFF00
					PRINTFORM 醉
				CASE IS < (MAXBASE:LOCAL:酒気 / 3) * 2
					PRINTFORM 　

			ENDSELECT
			RESETCOLOR
		endif
;xxx
	LOCALS = %NAME_FROM_PLACE(CFLAG:LOCAL:現在位置)%

	;交互对象---
	;SETCOLOR C_GRAY
	;FOR LOCAL:11, 1, 10
	;	SIF IRAI_SLOT_TO_PERSON(LOCAL:11) == LOCAL
	;		SETCOLOR C_GREEN
	;NEXT
	;PRINTFORM [{CFLAG:LOCAL:現在位置, 3}]
	;RESETCOLOR
	;交互对象---

	CALL COLORMESSAGE(@"[{CFLAG:LOCAL:現在位置, 3}]",C_GRAY, 0)
IF CFLAG:LOCAL:睡眠
	SETCOLOR 0,120,180
ELSEIF CFLAG:Master:現在位置 == CFLAG:LOCAL:現在位置
	SETCOLOR C_GRAY
ENDIF
	PRINTFORM %LOCALS%
RESETCOLOR
	;舞的房间修正
	SIF CFLAG:LOCAL:現在位置 == 235
		PRINTFORM 　
	IF STRCOUNT(LOCALS,"・")
		PRINTFORM %" "*(24-STRLENS(LOCALS))%
	ELSE
		PRINTFORM %" "*(25-STRLENS(LOCALS))%
	ENDIF
	IF LOCALS == ""
		PRINTFORM 不明な位置に居ます({CFLAG:LOCAL:現在位置})
	ELSEIF CFLAG:LOCAL:睡眠
		SIF EXP:LOCAL:睡眠姦経験 > 100 || (TCVAR:LOCAL:睡眠深度 > 2000 && Palam:LOCAL:眠姦 < 1000)
			SETCOLOR 0xEE60EE
		CALL COLORMESSAGE(@"就寝中:",C_GRAY, 0)
		PRINTFORM {TCVAR:LOCAL:睡眠深度,5,right}　起{CFLAG:LOCAL:起床時間 / 60,2,RIGHT}時 
		SETCOLOR C_GRAY
		IF CFLAG:LOCAL:起床時間 > TIME
			SIF CFLAG:LOCAL:起床時間 - TIME < 60
				SETCOLOR 255,255,255
			PRINTFORM {CFLAG:LOCAL:起床時間 - TIME,4}
		ELSE
			SIF CFLAG:LOCAL:起床時間 - TIME < 60
				SETCOLOR 255,255,255
			PRINTFORM {CFLAG:LOCAL:起床時間 - TIME + 1440,4}
		ENDIF
		CALL COLORMESSAGE(@"分后",C_GRAY, 0)
		RESETCOLOR			 
	ELSEIF CFLAG:LOCAL:行動 == 5
		IF CFLAG:LOCAL:現在位置 == TFLAG:宴会場 && TIME_PROGRESS(TIME:1) && (CFLAG:LOCAL:職種 == 49 || CFLAG:LOCAL:職種 == 51)
			;PRINTL 宴会中
			CALL COLORMESSAGE(@"宴会中　　　",C_GRAY, 0)
		ELSE
			;PRINTL 仕事中
			CALL COLORMESSAGE(@"仕事中　　　",C_GRAY, 0)
		ENDIF
		IF ARG == 1
			CALL COLORMESSAGE(@"　睡",0x7070C0, 0)
			PRINTFORM {CFLAG:LOCAL:就寝時間 / 60,2,RIGHT}
		ELSEIF ARG == 2
			CALL COLORMESSAGE(@"　回",0x66FFFF, 0)
			PRINTFORM {CFLAG:LOCAL:帰宅時間 / 60,2,RIGHT}
		ENDIF
		CALL COLORMESSAGE(@"時",C_GRAY, 0)
	ELSE
		CALL COLORMESSAGE(@"积攒度:",C_GRAY, 0)
			SIF !TCVAR:LOCAL:302
				SETCOLOR C_GREEN
			SIF TCVAR:LOCAL:発情 == 1
				SETCOLOR 0xFF00FF
			PRINTFORM {CFLAG:LOCAL:积攒度,5,right}
			RESETCOLOR
			IF ARG == 1
				CALL COLORMESSAGE(@"　睡",0x7070C0, 0)
				PRINTFORM {CFLAG:LOCAL:就寝時間 / 60,2,RIGHT}
			CALL COLORMESSAGE(@"時",C_GRAY, 0)
		SETCOLOR C_GRAY
		IF CFLAG:LOCAL:就寝時間 > TIME
			SIF CFLAG:LOCAL:就寝時間 - TIME < 60
				SETCOLOR 255,255,255
			PRINTFORM  {CFLAG:LOCAL:就寝時間 - TIME,4}
		ELSE
			SIF (CFLAG:LOCAL:就寝時間 - TIME + 1440) < 60
				SETCOLOR 255,255,255
			PRINTFORM  {CFLAG:LOCAL:就寝時間 - TIME + 1440,4}
		ENDIF
		CALL COLORMESSAGE(@"分后",C_GRAY, 0)
		RESETCOLOR
			ELSEIF ARG == 2
				CALL COLORMESSAGE(@"　回",0x66FFFF, 0)
				PRINTFORM {CFLAG:LOCAL:帰宅時間 / 60,2,RIGHT}
			CALL COLORMESSAGE(@"時",C_GRAY, 0)
		SETCOLOR C_GRAY
		IF CFLAG:LOCAL:帰宅時間 > TIME
			SIF CFLAG:LOCAL:帰宅時間 - TIME < 60
				SETCOLOR 255,255,255
			PRINTFORM  {CFLAG:LOCAL:帰宅時間 - TIME,4}
		ELSE
			SIF (CFLAG:LOCAL:帰宅時間 - TIME + 1440) < 60
				SETCOLOR 255,255,255
			PRINTFORM  {CFLAG:LOCAL:帰宅時間 - TIME + 1440,4}
		ENDIF
		CALL COLORMESSAGE(@"分后",C_GRAY, 0)
		RESETCOLOR
			ENDIF
	ENDIF
		IF Activity_Duration:LOCAL > 0
			SETCOLOR C_GRAY
			PRINTFORM  自由行動
			SETCOLOR 255,255,255
			PRINTFORM {Activity_Duration:LOCAL,3,RIGHT}
			SETCOLOR C_GRAY
			PRINTFORM 分 
		ENDIF
	RESETCOLOR
	PRINTL
	;
	;IF ARG == 1
	;	PRINTFORML ❤睡{CFLAG:LOCAL:就寝時間 / 60,2,RIGHT}時
	;ELSEIF ARG == 2
	;	PRINTFORML ❤回{CFLAG:LOCAL:帰宅時間 / 60,2,RIGHT}時
	;ENDIF
NEXT

;-------------------------------------------------
;実行判定
;-------------------------------------------------
;和留琴対話
@COM_ABLE420
;自宅外は不可
SIF AT_HOME(MASTER) == 0
	RETURN 0
;停止中は不可
SIF FLAG:70 == 1
	RETURN 0
;移動実行判定
SIF !TFLAG:100
	RETURN 0
;一括管理
SIF GLOBAL_COMABLE(420)
	RETURN RESULT
SELECTCASE MAIN_MAP
	CASE 0
		;留琴が寝ていたらダメ
		SIF CFLAG:2:睡眠
			RETURN 0
		;留琴の居る所
		SIF CFLAG:MASTER:現在位置 != CFLAG:2:現在位置
			RETURN 0
	CASE 3
		SIF CFLAG:MASTER:現在位置 != 323
			RETURN 0
	CASE 9
		SIF CFLAG:MASTER:現在位置 != 923
			RETURN 0
	CASEELSE
		RETURN 0
ENDSELECT

SIF CFLAG:诶嘿嘿 == 2
	RETURN 0
RETURN 1

