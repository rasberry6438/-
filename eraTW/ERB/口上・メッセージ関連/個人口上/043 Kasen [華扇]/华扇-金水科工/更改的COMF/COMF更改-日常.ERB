@COMF_K43_TPP_300

IF TCVAR:会話不能
	RETURN
ELSEIF TCVAR:烂醉
	PRINTFORML %CALLNAME:PLAYER%想和%CALLNAME:TARGET%对话，但身边飘来的浓烈酒气把%CALLNAME:PLAYER%都吓了够呛…
	PRINTFORMW 看起来完全无法进行对话…
ELSEIF TCVAR:302
	PRINTFORMW 已经是穷尽口舌的%CALLNAME:MASTER%完全没了可拿来继续的话题…
	TIME += 10
	IF CHK_DATENOW(CFLAG:TARGET:约会中)
		DOWNBASE:気力 += 50
		DOWNBASE:MASTER:気力 += 50
		TFLAG:193 = -1
	ELSE
		DOWNBASE:気力 += 100
		DOWNBASE:MASTER:気力 += 100
		TFLAG:193 = -1
	ENDIF
	RETURN 1
ELSEIF MARK:反発刻印 >= 3
	PRINTFORML %CALLNAME:PLAYER%正欲开口、得到的只有%CALLNAME:TARGET%冰冷的眼神…
	SOURCE:反感 = 300
	BASE:MASTER:気力 -= 100
	RETURN -1
ELSEIF ABL:MASTER:43 == 0
    PRINTFORM %CALLNAME:PLAYER%
		PRINTDATA
			DATAFORM 不着四六地
			DATAFORM 言语夹杂脏话地
			DATAFORM 根本不管他人地
			DATAFORM 一边大嚼着啥东西一边
		ENDDATA
    PRINTFORML 嚷嚷着
    PRINTFORMW 一旁一直忍受着的%CALLNAME:TARGET%实在是听不下去了…
	TIME += 15
	TFLAG:193 = -1
	RETURN 1
ELSEIF CFLAG:323 == 1
    PRINTFORM %CALLNAME:PLAYER%和%CALLNAME:TARGET%在浴室里
	PRINTDATA
		DATAFORM 借着水声
		DATAFORM 在水中泡着
        DATAFORM 一边搓着身体一边
	ENDDATA
    PRINTFORMW 说着话。
	TFLAG:193 = RAND:2
	RETURN 1
ELSEIF (CFLAG:MASTER:300 == 225 || CFLAG:MASTER:300 == 935) && (CFLAG:340 >= 700 || TCVAR:142)
    PRINTFORM %CALLNAME:PLAYER%
	PRINTDATA
		DATAFORM 为了缓解异样的气氛，
		DATAFORM 身子不自觉地扭动着，
        DATAFORM 一边努力抑制自己的兽欲，一边
	ENDDATA
    PRINTFORMW 和%CALLNAME:TARGET%勉强说着话…
	TFLAG:193 = RAND:2
	RETURN 1
ELSEIF CFLAG:TARGET:陪睡中
	PRINTDATA
		DATAFORM 和%CALLNAME:TARGET%手指相交
		DATAFORM 和%CALLNAME:TARGET%偎依在一起
		DATAFORM 有一點害羞的
		DATAFORM 抱著%CALLNAME:TARGET%
		DATAFORM 一邊和%CALLNAME:TARGET%玩鬧一邊
		DATAFORM 含羞的捂著臉和%CALLNAME:TARGET%
		DATAFORM 在被褥里
	ENDDATA
	PRINTFORMW 卿卿我我...
	TFLAG:193 = RAND:2
	RETURN 1
ELSE
	CALL COMF_K43_TPP_300_1
ENDIF
CALL REVEAL_YOUKAI(TARGET)

SELECTCASE TFLAG:192
	;通常
	CASE 0
		LOCAL = RAND:100
		LOCAL:1 = MIN(90 + GET_SUCCESS_RATE() / 5, 99)
		;相手が烂醉中だと大成功にも失敗にもならない
		SIF TCVAR:烂醉
			LOCAL = 50
		IF LOCAL < 5
			;7％で大成功
			TFLAG:193 = 1
			TFLAG:98 = 1
			EXP:MASTER:会話経験 ++
			IF CHK_DATENOW(CFLAG:TARGET:约会中)
				EXP:MASTER:約會経験 ++
				EXP:TARGET:約會経験 ++
			ENDIF
		ELSEIF LOCAL >= LOCAL:1
			;10～1％で失敗
			TFLAG:193 = -1
			TFLAG:98 = -1
		ELSE
			;残りは成功
			TFLAG:193 = 0
			TFLAG:98 = 0
		ENDIF
	;強制成功or大成功
	CASE 1
		IF RAND:100 <= 7
			TFLAG:193 = 1
			TFLAG:98 = 1
			EXP:MASTER:会話経験 ++
			IF CHK_DATENOW(CFLAG:TARGET:约会中)
				EXP:MASTER:約會経験 ++
				EXP:TARGET:約會経験 ++
			ENDIF
		ELSE
			TFLAG:193 = 0
			TFLAG:98 = 0
		ENDIF
	;強制失敗
	CASE -1
		TFLAG:193 = -1
		TFLAG:98 = -1
	;指令終了
	CASE -2
		TFLAG:193 = -1
		RETURN 0
ENDSELECT

;先制発生時は失敗しない
SIF TCVAR:20
	TFLAG:193 = MAX(TFLAG:193,0)
IF CFLAG:TARGET:陪睡中
	DOWNBASE:MASTER:気力 += 10
	SOURCE:情愛 = 200
ELSE
	DOWNBASE:気力 += 20
	DOWNBASE:MASTER:気力 += 20
ENDIF

SIF ABL:教養 > ABL:MASTER:教養 + 3 && FLAG:催眠強度 <= 50
	TFLAG:193 = -2

;固定で獲得するソース
SOURCE:歓楽 = 200

;ABL:親密をみる
IF ABL:親密 <= 1
	SOURCE:歓楽 += (ABL:親密 * 30)
ELSEIF ABL:親密 <= 3
	SOURCE:歓楽 += 200 + (ABL:親密 * 30)
ELSEIF ABL:親密 <= 5
	SOURCE:歓楽 += 500 + (ABL:親密 * 30)
ELSEIF ABL:親密 <= 8
	SOURCE:歓楽 += 750 + (ABL:親密 * 50)
ELSEIF ABL:親密 <= 10
	SOURCE:歓楽 += 1000 + (ABL:親密 * 50)
ELSE
	SOURCE:歓楽 += 1600 + (ABL:親密 * 30)
ENDIF


SOURCE:歓楽 = LIMIT(SOURCE:歓楽,0,5000)


SOURCE:受動 = 100 + 100 * ABL:従順
SOURCE:征服 = 100 + 100 * ABL:施虐属性

IF TFLAG:193 == -1 || TFLAG:193 == -2
	TIMES SOURCE:歓楽 , 0.10
	TIMES SOURCE:征服 , 0.50
	TIMES SOURCE:受動 , 0.50
ELSEIF TFLAG:193 == 0
	TIMES SOURCE:歓楽 , 1.00
	TIMES SOURCE:征服 , 1.00
	TIMES SOURCE:受動 , 1.00
ELSE
	TIMES SOURCE:歓楽 , 2.00
	TIMES SOURCE:征服 , 2.00
	TIMES SOURCE:受動 , 2.00
	TCVAR:301 += 50
ENDIF
SELECTCASE ABL:MASTER:話術技能
	CASE 0
		TIMES SOURCE:歓楽 , 0.20
		TIMES SOURCE:征服 , 0.20
		TIMES SOURCE:受動 , 0.20
	CASE 1
		TIMES SOURCE:歓楽 , 0.40
		TIMES SOURCE:征服 , 0.40
		TIMES SOURCE:受動 , 0.40
	CASE 2
		TIMES SOURCE:歓楽 , 0.70
		TIMES SOURCE:征服 , 0.70
		TIMES SOURCE:受動 , 0.70
	CASE 3
		TIMES SOURCE:歓楽 , 1.00
		TIMES SOURCE:征服 , 1.00
		TIMES SOURCE:受動 , 1.00
	CASE 4
		TIMES SOURCE:歓楽 , 1.20
		TIMES SOURCE:征服 , 1.20
		TIMES SOURCE:受動 , 1.20
	CASEELSE
		TIMES SOURCE:歓楽 , 1.50
		TIMES SOURCE:征服 , 1.50
		TIMES SOURCE:受動 , 1.50
ENDSELECT

;会話累積値
IF CHK_DATENOW(CFLAG:TARGET:约会中)
;	TCVAR:301 += 150 / (4 + ABL:MASTER:話術技能)
	TCVAR:301 += 150 / (4 + MIN(ABL:MASTER:話術技能 + (FLAG:催眠強度 > 25) + (FLAG:催眠強度 > 50) + (FLAG:催眠強度 > 75), 6))
ELSE
;	TCVAR:301 += 300 / (4 + ABL:MASTER:話術技能)
	TCVAR:301 += 300 / (4 + MIN(ABL:MASTER:話術技能 + (FLAG:催眠強度 > 25) + (FLAG:催眠強度 > 50) + (FLAG:催眠強度 > 75), 6))
ENDIF
IF TCVAR:301>100
	SETCOLOR C_RED
	PRINTFORML 会話累積値={TCVAR:301}
	RESETCOLOR
ELSE
	PRINTFORML 会話累積値={TCVAR:301}
ENDIF
TIME += 10
;IF TARGET == 110
;	PRINTFORML 筆談したので稍微時間がかかった…
;	TIME += 15
;ENDIF
EXP:MASTER:会話経験 ++
IF CHK_DATENOW(CFLAG:TARGET:约会中)
	EXP:MASTER:約會経験 ++
	EXP:TARGET:約會経験 ++
ENDIF

;相手が烂醉中だと効果大幅低減
IF TCVAR:烂醉
	TIMES SOURCE:歓楽 , 0.10
	TIMES SOURCE:征服 , 0.10
	TIMES SOURCE:受動 , 0.10
ENDIF
RETURN 1

;-----------------------------------------------------------------

@COMF_K43_TPP_332

#DIM 酒ID
VARSET LOCALS

PRINTFORML %CALLNAME:MASTER%掏出了——
CALL 酒一覧表示(1)
IF RESULT
	;飲む酒の種類
	TFLAG:194 = RESULT
	ITEM:RESULT --
ELSE
	RETURN -1
ENDIF
COM_STR = %ITEMNAME:(TFLAG:194)%
酒ID = ALC_ID(COM_STR)

PRINTFORML ，往%CALLNAME:TARGET%的酒杯里斟了满满一杯


;暫定的に成功フラグを立てる
TFLAG:193 = 0

IF !TALENT:TARGET:恋慕 && CFLAG:TARGET:烂酔奸 == 2
	PRINTFORML 但%CALLNAME:TARGET%已经不想再与%CALLNAME:MASTER%喝酒了…
	SOURCE:反感 += 3000
	BASE:情緒 = 0
	BASE:憤怒 = 1500
;	TFLAG:193 = -2
	RETURN -1
ENDIF
IF TCVAR:烂醉
	PRINTFORML 但哪怕是强如%CALLNAME:TARGET%也已经没了对酒的能力了…
	TFLAG:193 = -1
	RETURN -1
ELSEIF (TALENT:TARGET:酒耐性 == -2 && CFLAG:TARGET:不會喝酒 < 5) || TFLAG:192 == -1
	SELECTCASE CFLAG:TARGET:不會喝酒
		CASE IS < -10
			LOCALS = %CALLNAME:TARGET%露出不高兴的様子
		CASE IS <= -3
			LOCALS = 曾经经历过讨厌感觉的%CALLNAME:TARGET%不想再喝酒的様子…
		CASEELSE
		IF TARGET == 55 || TFLAG:192 == -1
			LOCALS = %CALLNAME:TARGET%推托说自己不能喝酒
		ELSE
			LOCALS = 不会喝酒的%CALLNAME:TARGET%似乎不想再喝了的様子…
		ENDIF
	ENDSELECT
	PRINTFORML %LOCALS%
	PRINTFORML [0] 放弃
	PRINTFORML [1] 説服
	$LOOP
	INPUT
	IF RESULT == 0 || TARGET == 55 || TFLAG:192 == -1
	;ひじりんは宗教的信条なので絶対飲まない。口上側で制御した場合もここ
		PRINTFORML 因为%CALLNAME:TARGET%完全没有要喝酒的意思、所以放弃了…
		TFLAG:193 = -5
		RETURN 0
	ELSEIF RESULT == 1
		IF (ABL:親密 * 200 + ABL:MASTER:話術技能 * 100 + MIN(3,CFLAG:不會喝酒) * 300) * BASE:情緒 / MAXBASE:情緒 >= 1500
			PRINTFORML 由于%CALLNAME:MASTER%的劝说%CALLNAME:TARGET%開始怯生生的喝起酒来…
			CFLAG:不會喝酒 += 1
			TFLAG:193 = 1
		ELSEIF CFLAG:不會喝酒 < -10
			PRINTFORML %CALLNAME:TARGET%终于被惹火了
			SOURCE:反感 += 3000
			BASE:情緒 = 0
			BASE:憤怒 = 1500
			TFLAG:好感度减少 = 5
			TFLAG:193 = -2
			RETURN 1
		ELSE
			PRINTFORML 不管%CALLNAME:MASTER%怎么劝说、%CALLNAME:TARGET%还是不肯喝酒…
			SOURCE:反感 += 500
			BASE:情緒 /= 2
			TFLAG:好感度减少 = 1
			TFLAG:193 = -1
			RETURN 1
		ENDIF
	ELSE
		GOTO LOOP
	ENDIF
ENDIF

TRYCALLFORM EFFECT_酒データ{酒ID}(TARGET)
DOWNBASE:MASTER:気力 += 50
DOWNBASE:MASTER:体力 += 10

CALL DRUNKEN(MASTER,TFLAG:194)

CALL COM332_TPP_1

TIME += 30
RETURN 1

@COM332_TPP_1
#DIM 酒気増加量
#DIM 味補正
DOWNBASE:気力 += 10

;固定で獲得するソース
SOURCE:歓楽 = 500

CALL DRUNKEN(TARGET,TFLAG:194)

;連続実行時は反感が発生
SIF PREVCOM == SELECTCOM
	SOURCE:反感 = 100

;ABL:従順をみる
IF ABL:従順 <= 1
	SOURCE:歓楽 += (ABL:従順 * 30)
ELSEIF ABL:従順 <= 3
	SOURCE:歓楽 += 400 + (ABL:従順 * 30)
ELSEIF ABL:従順 <= 5
	SOURCE:歓楽 += 600 + (ABL:従順 * 30)
ELSEIF ABL:従順 <= 8
	SOURCE:歓楽 += 800 + (ABL:従順 * 50)
ELSEIF ABL:従順 <= 11
	SOURCE:歓楽 += 1000 + (ABL:従順 * 70)
ELSE
	SOURCE:歓楽 += 1500 + (ABL:従順 * 40)
ENDIF

;好感度をみる
IF CFLAG:2 <= 500
	SOURCE:歓楽 += CFLAG:2
ELSEIF CFLAG:2 <= 5000
	SOURCE:歓楽 += 700 + (CFLAG:2 - 500) / 3
ELSE
	SOURCE:歓楽 += 2500 + (CFLAG:2 - 5000) / 5
ENDIF
SIF SOURCE:歓楽 < 0
	SOURCE:歓楽 = 0

SOURCE:受動 = 200 + 100 * ABL:従順
SOURCE:征服 = 200 + 100 * ABL:施虐属性

IF TFLAG:193 == -1
	TIMES SOURCE:歓楽 , 0.10
	TIMES SOURCE:征服 , 0.50
	TIMES SOURCE:受動 , 0.50
ELSEIF TFLAG:193 == 0
	TIMES SOURCE:歓楽 , 1.00
	TIMES SOURCE:征服 , 1.00
	TIMES SOURCE:受動 , 1.00
ELSE
	TIMES SOURCE:歓楽 , 2.00
	TIMES SOURCE:征服 , 2.00
	TIMES SOURCE:受動 , 2.00
ENDIF

;味による補正
味補正 = ALCOHOL_TASTE(TFLAG:194)
IF TALENT:TARGET:酒耐性 == -2 && ALCOHOL_TASTE(TFLAG:194) < 15
	IF CFLAG:TARGET:不會喝酒 < 3
		味補正 /= 2
		PRINTFORML %CALLNAME:TARGET%喝了一小口就停下了
	ELSEIF CFLAG:TARGET:不會喝酒 < 5
		味補正 = 味補正 / 3 * 2
		PRINTFORML %CALLNAME:TARGET%似乎不像以前那様抵触飲酒了
	ELSE
		PRINTFORML %CALLNAME:TARGET%漂亮地喝光了杯里的酒
	ENDIF
ENDIF

SOURCE:歓楽 = SOURCE:歓楽 * 味補正 / 10
SOURCE:征服 = SOURCE:征服 * 味補正 / 10
SOURCE:受動 = SOURCE:受動 * 味補正 / 10

;信頼
TFLAG:98 = ALCOHOL_TASTE(TFLAG:194) / 10

IF ALCOHOL_TASTE(TFLAG:194) < 10
	PRINTFORMW 似乎不对%CALLNAME:TARGET%的口味的様子…
	IF TALENT:TARGET:酒耐性 == -2
		CFLAG:TARGET:不會喝酒 --
		TFLAG:好感度减少 = 1
		TFLAG:98 = -1
	ENDIF
ELSEIF ALCOHOL_TASTE(TFLAG:194) >= 15
	SELECTCASE TFLAG:194
		CASE 513	;一夜奇稻田の特殊文本
			PRINTFORM %CALLNAME:TARGET%对%ITEMNAME:(TFLAG:194)%好像莫名很中意
			SELECTCASE TALENT:TARGET:酒耐性
				CASE 3
					PRINTFORMW ，直喝了个直抒胸臆酣畅淋漓…
				CASE 2
					PRINTFORMW ，不住地品尝着…
				CASE 1
					PRINTFORMW ，一口闷了下去…
				CASEELSE
					PRINTFORMW …
			ENDSELECT
		CASEELSE
			PRINTFORMW %CALLNAME:TARGET%对%ITEMNAME:(TFLAG:194)%很中意的様子…
	ENDSELECT
	SIF CFLAG:TARGET:不會喝酒 < 5
		CFLAG:TARGET:不會喝酒 ++
	CALL KIGEN_CHANGE(TARGET,40,1)
ELSE
	PRINTFORMW %CALLNAME:TARGET%选择一脸淡然地将%ITEMNAME:(TFLAG:194)%喝了下去…
ENDIF
;-----------------------------------------------------------------

@COMF_K43_TPP_360

CALL COMF_K43_TPP_360_1

TIME += 5
SIF BASE:MASTER:気力 <= 0
	RETURN 1
IF TALENT:TARGET:施虐狂
	LOCAL = -1
ELSE
	LOCAL = 1
ENDIF
IF COUNTER_SIKOU:TARGET:(TCVAR:TARGET:Counter行動) > 0 && TALENT:TARGET:施虐狂
	LOCAL *= 3
ELSEIF COUNTER_SIKOU:TARGET:(TCVAR:TARGET:Counter行動) < 0
	LOCAL *= 3
ENDIF
SIF TALENT:TARGET:態度 < 0 || TALENT:TARGET:習得速度 > 0
	LOCAL *= 2
COUNTER_SIKOU:TARGET:(TCVAR:TARGET:Counter行動) = LIMIT(COUNTER_SIKOU:TARGET:(TCVAR:TARGET:Counter行動) + LOCAL, -10, 10)
RETURN 1

;-------------------------------------------------

@COMF_K43_TPP_411

CALL COMF_K43_TPP_411_1

TFLAG:情緒上昇抑制 = 1
;天気を参照
SELECTCASE TIME:5
	CASE 4,6,8,10,12,13
		IF WIND_VELOCITY >= 1
			;(天候パッチ)強風時はヤバい天気
			TFLAG:194 = 2
		ELSE
			;悪天候
			TFLAG:194 = 1
		ENDIF
	CASE 5,9
		;ヤバい天気
		TFLAG:194 = 2
	;それ以外
	CASEELSE
		;(天候パッチ)強風時は悪天候
		SIF WIND_VELOCITY == 1
			TFLAG:194 = 1
		;(天候パッチ)暴風時はヤバい天気
		SIF WIND_VELOCITY >= 2
			TFLAG:194 = 2
		;夏場は死ねる
		SIF DAY:2 == 2 && TIME:5 == 1 && TIME > 360 && TIME < 1020
			TFLAG:194 = 3
ENDSELECT
SIF !OUTROOF(CFLAG:MASTER:現在位置)
	TFLAG:194 = 0
;↑判断各个环境对应的TFLAG:194
;↓各个TFLAG:194对应效果
SELECTCASE TFLAG:194
	CASE 0
		DOWNBASE:MASTER:体力 = 200
		DOWNBASE:MASTER:気力 = 200
		IF TARGET > 0 && !CFLAG:睡眠
			;固定获得量
			SOURCE:歓楽 = 400
			MAXBASE:TARGET:体力 += RAND:10
			DOWNBASE:TARGET:体力 = 200
			DOWNBASE:TARGET:気力 = 200
			;信赖增减
			TFLAG:98 += 3
			SIF ABL:MASTER:戦闘能力 > 2
			TFLAG:98 ++ 
			IF ABL:MASTER:戦闘能力 > ABL:戦闘能力
				EXP:戦闘経験 += 2
				TFLAG:98 ++ 
			ENDIF
			SIF ABL:MASTER:戦闘能力 < ABL:戦闘能力 - 2
				EXP:MASTER:戦闘経験 ++
			;“ABL:親密”影响因素
			IF ABL:親密 <= 5
				SOURCE:歓楽 += 500 + (ABL:親密 * 60)
				TFLAG:98 ++ 
			ELSEIF ABL:親密 <= 8
				SOURCE:歓楽 += 750 + (ABL:親密 * 75)
			ELSEIF ABL:親密 <= 11
				SOURCE:歓楽 += 1000 + (ABL:親密 * 75)
			ELSE
				SOURCE:歓楽 += 2000 + (ABL:親密 * 30)
			ENDIF
			;好感度影响因素
			IF CFLAG:2 <= 500
				SOURCE:歓楽 += CFLAG:2
			ELSEIF CFLAG:2 <= 5000
				SOURCE:歓楽 += 500 + (CFLAG:2 - 500) / 3
			ELSE
				SOURCE:歓楽 += 2000 + (CFLAG:2 - 5000) / 5
			ENDIF
			SIF SOURCE:歓楽 < 0
				SOURCE:歓楽 = 0
			EXP:MASTER:戦闘経験 ++
			EXP:戦闘経験 ++
		ENDIF
	CASE 1
	;恶劣天气
		DOWNBASE:MASTER:体力 = 300
		DOWNBASE:MASTER:気力 = 300
		IF TARGET > 0 && !CFLAG:睡眠
			;固定获得量
			SOURCE:歓楽 = 450
			MAXBASE:TARGET:体力  += RAND:15
			MAXBASE:TARGET:気力  += RAND:10
			DOWNBASE:TARGET:体力 = 300
			DOWNBASE:TARGET:気力 = 300
			;信赖增减
			TFLAG:98 += 3
			SIF ABL:MASTER:戦闘能力 > 2
			TFLAG:98 ++ 
			IF ABL:MASTER:戦闘能力 > ABL:戦闘能力
				EXP:戦闘経験 += 2
				TFLAG:98 ++ 
			ENDIF
			SIF ABL:MASTER:戦闘能力 < ABL:戦闘能力 - 2
				EXP:MASTER:戦闘経験 ++
			;“ABL:親密”影响因素
			IF ABL:親密 <= 5
				SOURCE:歓楽 += 520 + (ABL:親密 * 60)
				TFLAG:98 ++ 
			ELSEIF ABL:親密 <= 8
				SOURCE:歓楽 += 750 + (ABL:親密 * 75)
			ELSEIF ABL:親密 <= 11
				SOURCE:歓楽 += 1100 + (ABL:親密 * 75)
			ELSE
				SOURCE:歓楽 += 2150 + (ABL:親密 * 30)
			ENDIF
			;好感度影响因素
			IF CFLAG:2 <= 500
				SOURCE:歓楽 += CFLAG:2
			ELSEIF CFLAG:2 <= 5000
				SOURCE:歓楽 += 500 + (CFLAG:2 - 500) / 3
			ELSE
				SOURCE:歓楽 += 2000 + (CFLAG:2 - 5000) / 5
			ENDIF
			SIF SOURCE:歓楽 < 0
				SOURCE:歓楽 = 0
			EXP:MASTER:戦闘経験 += 2
			EXP:戦闘経験 += 2
		ENDIF
	CASE 2,3
	;危险天气+暑天
		DOWNBASE:MASTER:体力 = 600
		DOWNBASE:MASTER:気力 = 600
		IF TARGET > 0 && !CFLAG:睡眠
			;固定获得量
			SOURCE:歓楽 = 500
			MAXBASE:TARGET:体力 += RAND:30
			MAXBASE:TARGET:気力 += RAND:30
			DOWNBASE:TARGET:体力 = 600
			DOWNBASE:TARGET:気力 = 600
			;信赖增减
			TFLAG:98 += 3
			SIF ABL:MASTER:戦闘能力 > 2
			TFLAG:98 ++ 
			IF ABL:MASTER:戦闘能力 > ABL:戦闘能力
				EXP:戦闘経験 += 2
				TFLAG:98 ++ 
			ENDIF
			SIF ABL:MASTER:戦闘能力 < ABL:戦闘能力 - 2
				EXP:MASTER:戦闘経験 ++
			;“ABL:親密”影响因素
			IF ABL:親密 <= 5
				TFLAG:98 ++ 
				SOURCE:歓楽 += 550 + (ABL:親密 * 60)
			ELSEIF ABL:親密 <= 8
				SOURCE:歓楽 += 800 + (ABL:親密 * 75)
			ELSEIF ABL:親密 <= 11
				SOURCE:歓楽 += 1200 + (ABL:親密 * 75)
			ELSE
				SOURCE:歓楽 += 2300 + (ABL:親密 * 30)
			ENDIF
			;好感度影响因素
			IF CFLAG:2 <= 500
				SOURCE:歓楽 += CFLAG:2
			ELSEIF CFLAG:2 <= 5000
				SOURCE:歓楽 += 500 + (CFLAG:2 - 500) / 3
			ELSE
				SOURCE:歓楽 += 2000 + (CFLAG:2 - 5000) / 5
			ENDIF
			SIF SOURCE:歓楽 < 0
				SOURCE:歓楽 = 0
			EXP:MASTER:戦闘経験 += 3
			EXP:戦闘経験 += 3
		ENDIF
ENDSELECT
TIME += 60
	SIF CFLAG:同行
		CFLAG:同行 += 60
EXP:MASTER:戦闘経験 ++
TCVAR:MASTER:空腹時刻 -= 15
IF TARGET
	TCVAR:TARGET:空腹時刻 -= 15
	CALL ADD_TIRED(TARGET, POWER(TFLAG:194 + 1, 3) * 100)
ENDIF
SIF ITEM:101 && !RAND:2
	EXP:MASTER:戦闘経験 ++
RETURN 1